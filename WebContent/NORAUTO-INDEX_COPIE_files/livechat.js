!function(e){if("function"==typeof define&&define.amd){var n=define;define=e}!function t(e,n,i){function r(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return r(n?n:t)},l,l.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(n,i,r){!function(n,i){function r(t){if("string"!=typeof t)return t;return t.replace(/(?:^|[^\d])(\d{4}[\- ]?\d{4}[\- ]?\d{2}[\- ]?\d{2}[\- ]?\d{1,4})(?:[^\d]|$)/,"xxxx-xxxx-xxxx-xxxx")}function o(){"use strict";i("#idz_postmsg").prop("disabled",!1),i(".idz_writting").html("")}function a(){"use strict";i("#idz_postmsg").prop("disabled",!0),i(".idz_writting").html(n.T("livechat.xmpp.connection.disconnected"))}function s(t,e,r){var o=t.status,a=i.Deferred();if(n.opOffline=o.opOffline,n.c2cOffline=o.c2cOffline,n.opWatching=o.opWatching,n.opBusy=o.opBusy,n.initSession=!1,!o.opOffline){n.chat.history_id=t.chatId,n.vStats.history_id=t.chatId,n.chat.status=2,n.conversationJid=t.conversationJid,h.room.join(n.conversationJid,n.vuid,10).done(function(){h.room.groupchat(e,r),a.resolve()},a.reject),setTimeout(function(){h.getConnection().connected&&n.chat.sendPresence("dnd")},2500);var s=l();i("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+t.chatId+"&u="+n.vuid),i("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+t.chatId+"&u="+n.vuid+"&timezoneAbbr="+s),p.emit("conversation.chat.started")}return(o.opOffline||o.opBusy)&&a.reject(),a.promise()}function c(t){var e=t.status;n.opOffline=e.opOffline,n.c2cOffline=e.c2cOffline,n.opBusy=e.opBusy,n.initSession=!1;var r=i.Deferred();if(e.opOffline)setTimeout(function(){n.setStatus()},400),n.chat.disableLoading();else{n.chat.history_id=t.chatId,n.vStats.history_id=t.chatId,n.chat.status=2,n.conversationJid=t.conversationJid,h.room.join(n.conversationJid,n.vuid,10).done(function(){h.getConnection().connected&&n.chat.sendPresence("dnd"),r.resolve()},r.reject),n.operator=t.operator,n.operator.id===-1&&x.queue(),n.c2coperator=t.c2coperator?t.c2coperator:t.operator,n.on_call&&(n.operator=t.c2coperator);var o=l();i("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+t.chatId+"&u="+n.vuid),i("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+t.chatId+"&u="+n.vuid+"&timezoneAbbr="+o),p.emit("conversation.chat.started"),n.customize.floating_button>0&&n.floatingWidget.onPresenceChange(!0),!n.opStarted&&n.flags.proactif_alert&&""!=n.flags.proactif_alert&&n.chat.sendAlert(n.flags.proactif_alert,n.flags.message,!0),n.vaSCI&&n.chat.sendAlert("!vaSCI","",!0)}return(e.opOffline||e.opBusy)&&r.reject(),r.promise()}function u(){var t="visitor";(n.flags.proactif_alert||n.flags.proactif_invit)&&(t="proactif"),n.callbacks.onChatStarted({id:n.chat.history_id,startedBy:t})}function l(){var t=String(new Date),e=/\((.*)\)/.exec(t,"g");return!e||e.length<2?"":e[1]}if(!iAdvize.lock){var d,h=n.require("xmpp"),f=n.require("logger"),p=n.require("eventManager"),g=p.events,m=n.require("emojis-service");p.on(g.OnXmppRoomJoined,function(){h.sendChatState("paused")}),p.on(g.OnXmppConnectionDisconnected,function(){a()}),p.on(g.OnXmppConnectionConnected,function(){o()});var v,_;n.call.isEnabled&&(v=n.require("livechat/call")),n.callMeeting.enabled&&n.require("livechat/callmeeting"),1==n.preferences.mirroring_enabled&&(_=n.require("mirror")),n.visio.enabled&&n.require("visio"),n.define("emitter",function(){function t(t){function e(){for(var e=-1,i=n.length;++e<i;)n[e].apply(this,arguments);return t}var n=[];return e.on=function(e){return n.push(e),t},e}return function(){for(var e=-1,n=arguments.length,i={};++e<n;)i[arguments[e]]=t(i);return i.on=function(t,e){return i[t].on(e)},i}}),n.noDefaultScrollTemplate="iphone"==n.customize.layout||"mobile"==n.customize.layout||"tablette"==n.customize.layout||"chomette"==n.customize.layout||"monoprix2"==n.customize.layout||"interflora-uk"==n.customize.layout||"natixis-caissedepargne-espaceclient"==n.customize.layout||"nexecur"==n.customize.layout||"vvf"==n.customize.layout||"sfr3"==n.customize.layout||"boursorama3"==n.customize.layout||"fortuneo2"==n.customize.layout||"mecatechnic2"==n.customize.layout||"mecatechnic3"==n.customize.layout||"carglass"==n.customize.layout||"autosphere2"==n.customize.layout||"nordnet2"==n.customize.layout||"flowercampings"==n.customize.layout||"neckermannreisen"==n.customize.layout||"dermacenter"==n.customize.layout||"cdiscountv4"==n.customize.layout||"groupalia"==n.customize.layout||"entega2"==n.customize.layout;var y=function(){if(n.Templates.newTemplates)n.noOfferPanelTemplate=n.Templates.isResponsive;else{var t=n.require("template").customizer;n.noOfferPanelTemplate=t.noOfferPanelTemplate(n.customize.layout)}return n.noOfferPanelTemplate};n.initSession=!1;var b=function(t,e){return t&&e?t.toLowerCase()===e.toLowerCase():t===e},w=function(){1!==n.chat.satisfaction?(2===n.chat.status?window.confirm(n.T("VISITOR_CONFIRM_CLOSE"))&&(n.flags.visio_status&&p.emit(g.OnConversationVisioClosed),n.operator.id===-1||1===n.virtualOP||"1"!==n.preferences.param_satisfaction||2===n.chat.satisfaction||2!==n.chat.status||n.blocked?(n.Templates.hideUI(),n.chatbar_state=2,n.JSONStore.save({chatbar_state:n.chatbar_state})):(n.chat.satisfaction=1,n.Templates.displaySatisfaction(),n.callbacks.onSatisfactionDisplayed()),n.chat.sendChatClose(),n.callbacks.onChatEnded({id:n.chat.history_id,endedBy:"visitor"}),n.opDisconnected=0):(n.Templates.hideUI(),n.chatbar_state=2,n.JSONStore.save({chatbar_state:n.chatbar_state})),n.chatbox_state=4):n.Templates.removeSatisfaction()};n.define("waiting",function(t){function e(){n.flags.waitinglist=1,n.chat.status=2,u.queue(),a()}function r(t){n.opBusy=0,n.flags.waitinglist=2,n.util.addScript("getop",n.chaturl+"rpc/getop.php?persist=1&sid="+n.website_id+"&u="+n.vuid+"&getop="+t),u.unqueue()}function o(){var t=2===n.flags.waitinglist;return t&&(n.flags.waitinglist=0),t}function a(){var t={jid:Strophe.getBareJidFromJid(h.getConnection().jid),sid:n.website_id,u:n.vuid,dep:n.forceDep,hid:n.chat.history_id};i.getJSON(n.chaturl+"rpc/waitinglist.php?callback=?",t).done(x.remind),u.update()}function s(t){var e=n.T(t.message||"waiting.reminder").replace(/\{queuepos\}/g,t.position);e=n.util.nl2br(n.util.htmlspecialchars(e)),e=n.Templates.opAlert.replace(/\{MSG\}/g,e).replace(/\{TIME\}/g,n.chat.getMsgTime()),n.chat.put_dialog(e),n.chat.updateHistory(n.chat.OPALERT,"WAITING_LIST "+t.position)}var c=t("emitter"),u=c("queue","unqueue","update");return{queue:e,unqueue:r,update:a,remind:s,justUnqueued:o,on:u.on}});var x=n.require("waiting");n.playSound=function(t){var e='<embed src="'+n.chaturl+"sounds/swf.php?s="+n.website_id+"&q="+t+'" width="1" height="1" quality="high" pluginspage="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash">';i("#idz_sound_container").html(e),n.util.warn("playing sound")},n.onCoreLoaded=function(t){return n.coreloaded?("function"==typeof t&&t(),!1):(n.coreloaded=!0,i(document).keypress(function(t){27==t.keyCode&&t.preventDefault()}),n.chat.cCook=document.cookie,n.callbacks.onCookieSaved(),n.hasFocus=1,n.blinktm=null,n.oTitle=document.title,i(window).bind("scroll.activity",function(){n.onActivity()}),i(window.document).bind("keypress.activity",function(){n.onActivity()}),i("body").bind("mousemove.activity",function(){n.onActivity()}),i(window).focus(function(){n.hasFocus=1,null!==n.blinktm&&(clearInterval(n.blinktm),n.blinktm=null,document.title=n.oTitle)}),i(window).blur(function(){n.hasFocus=0,n.vStats.activeSince=null}),n.monitoredForms&&i("form").submit(function(t){if("post"==t.target.method.toLowerCase()){for(var e=n.monitoredForms.length;e--;)if(n.monitoredForms[e]==t.target.id){n.usePOST=t.target.id;break}}else n.usePOST=null}),n.onChatLoaded(t),!0)},n.onChatLoaded=function(t){if(!n.chatloaded){n.chatloaded=!0,n.chat.history_id=+n.flags.history_id,n.chat.prev_history=+n.flags.prev_history,n.chat.status=+n.flags.chat_status,n.chat.satisfaction=+n.flags.satisfaction_status,n.chat.cobrowsing=+n.flags.chat_cobrowsing,n.proactif_timeElapsed=n.flags.proactif_timeElapsed,n.proactif_activated=n.flags.proactif_activated,n.conversationJid=n.flags.conversationJid,n.chat.popinLeft=n.flags.popinLeft,n.chat.popinTop=n.flags.popinTop,n.callbacks.onScriptLoaded(),""===n.iframeID&&n.chat.bindWidgetEvents();var e=3===n.chat.status&&"0"===n.flags.operator_closed&&"1"===n.flags.visitor_closed;n.chat.history_id>0&&(2===n.chat.status||e)&&(p.on(g.OnXmppConnectionConnected,function(){h.room.join(n.conversationJid,n.vuid)}),h.connect(!0).fail(n.chat.showConnectionError));try{setTimeout(function(){n.Templates&&n.Templates.restoreState&&n.Templates.restoreState(),(n.chat.history_id>0||n.chat.prev_history>0)&&""==n.iframeID&&n.chat.reloadHistory(),2===n.chat.status&&"1"===n.flags.visio_status&&p.emit(g.OnConversationVisioRequested),i.each(["hideUI","hideDialog","minimizeChatbar"],function(t,e){var i=n.Templates[e];n.Templates[e]=function(){i.apply(n.Templates),n.callbacks.onChatHidden()}})},100)}catch(t){n.errorMailer("onChatLoaded try to connect: ",t,"")}}"function"==typeof t&&t()},n.transfer=function(t){var e=i.parseJSON(t);n.chat.putOpAlert(n.T("OPERATEUR_TRANSFER")),n.prevOp=n.operator,n.operator=e.operator,n.c2coperator=n.operator,n.chat.history_id=e.newConversationID,n.vStats.history_id=e.newConversationID,n.operator.isExpert===!0&&n.chat.putOpAlert(n.chat.getExpertDisclaimer());var r=l();i("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+e.newConversationID+"&u="+n.vuid),i("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+e.newConversationID+"&u="+n.vuid+"&timezoneAbbr="+r),n.chat.sendPresence("available"),n.callbacks.onVisitorTransferred({operatorId:n.operator.id,historyId:n.chat.history_id})},n.createConversation=function(t,e,r,o,a){if(n.initSession)return i.Deferred().reject().promise();n.initSession=!0;var u={sid:n.website_id,vuid:n.vuid,dep:n.forceDep,r:n.flags.proactif_activatedId||0,nick:Strophe.getNodeFromJid(h.getConnection().jid),msg:e?encodeURIComponent(e):"",messageId:a,op:n.operator.id||0,o:n.forceAgent?n.forceAgent:0,h:n.forceAgent&&n.vStats.merpHash?n.vStats.merpHash:"",br:n.vStats.browserInfo||""};if(void 0!==window.idzCustomData&&(idzCustomData.page_type&&(u.pt=encodeURIComponent(idzCustomData.page_type)),idzCustomData.brand&&(u.pb=encodeURIComponent(idzCustomData.brand)),idzCustomData.rayon&&(u.pr=encodeURIComponent(idzCustomData.rayon)),idzCustomData.univers&&(u.pu=encodeURIComponent(idzCustomData.univers)),idzCustomData.cust_name&&(u.pcna=encodeURIComponent(idzCustomData.cust_name)),idzCustomData.cust_firstname&&(u.pcfn=encodeURIComponent(idzCustomData.cust_firstname)),idzCustomData.cust_address&&(u.pcad=encodeURIComponent(idzCustomData.cust_address)),idzCustomData.cust_city&&(u.pcci=encodeURIComponent(idzCustomData.cust_city)),idzCustomData.cust_zipcode&&(u.pczc=encodeURIComponent(idzCustomData.cust_zipcode)),idzCustomData.cust_country&&(u.pcco=encodeURIComponent(idzCustomData.cust_country)),idzCustomData.cust_phonenumber&&(u.pcpn=encodeURIComponent(idzCustomData.cust_phonenumber)),idzCustomData.cust_email&&(u.pcem=encodeURIComponent(idzCustomData.cust_email))),"visio"===t)return i.getJSON(n.chaturl+"rpc/visio.php",u);n.vaSCI&&(u.va=n.vaSCI),u.cd=window.idzCustomData||[];var l=n.routing.enabled?"init_routing.php":"init_session.php";return d=i.getJSON(n.chaturl+"rpc/"+l+"?lang="+n.curlang+"&log_uuid="+r+"&callback=?",u),d.then(function(t){return n.routing.enabled?s(t,e,a):c(t)})},n.doInit=function(){2!=n.chat.status?n.chat.sendPresence("available"):n.chat.sendPresence("dnd"),n.chat.connected=!0},n.chat={OPMSG:1,VMSG:2,OPALERT:3,VALERT:4,OPRC:6,VRC:7,chatbox_state:1,status:0,history_id:0,composing:0,watch:0,connected:!1,reconnecting:!1,started:!1,cobrowsing:0,offercount:1,satisfaction:0,buildChat:function(){try{if(n.chatbuilt)return;n.chatbuilt=!0,n.Templates.loadChatCss(),p.emit("events.chatBuilt")}catch(t){}try{n.Templates.appendChat();var t=document.createElement("div");t.setAttribute("id","idz_sound_container"),i("body").append(t);var e=n.Templates.append2header();""!=e&&i("head").append(e)}catch(t){n.errorMailer("buildChat 2: ",t,"")}try{var r=n.T("BESOIN_AIDE"),o=n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA"),a="message";if(n.customize["chatbar_txt1_"+n.curlang]&&0!=n.customize["chatbar_txt1_"+n.curlang].length&&(r=n.customize["chatbar_txt1_"+n.curlang]),n.customize["chatbar_txt2_"+n.curlang]&&0!=n.customize["chatbar_txt2_"+n.curlang].length){o=n.customize["chatbar_txt2_"+n.curlang];var a="message_edit"}var s=n.Templates.getChatContent().replace(/\{CHATBAR_TXT1\}/g,r).replace(/\{CHATBAR_TXT2\}/g,o).replace(/\{CHATBAR_TITLE\}/g,a);i("#idz_chatglobal").html(s),e=n.Templates.append2body(),""!=e&&i("body").append(e),n.Templates.loadLayout()}catch(t){n.errorMailer("buildChat 3: ",t,"")}try{n.chat.loadLayout()}catch(t){n.errorMailer("buildChat 4: ",t,"")}},addCobrowsingImg:function(){i("body").append("<img src='https://static.iadvize.com/images/livechat/anim_clic.gif' id='anim_clic' width='163px' height='161px' style='position: absolute; z-index: 999999999998; top: -3000px; left: -3000px;' />"),i("body").append("<img src='https://static.iadvize.com/images/livechat/op_cursor.png' id='visitor_cursor' width='70px' height='70px' style='position: absolute; z-index: 999999999999; top: -3000px; left: -3000px;' />")},loadLayout:function(){1==n.chat.cobrowsing&&n.chat.addCobrowsingImg(),n.chat.bindSendMessage(),n.chat.bindChatStatesEvents(),i("#idz_button_font_pos, .idz_button_font_pos").click(function(){var t=1.1*parseFloat(i("#idz_dialogbox").css("font-size"));return t<=21&&(i("#idz_dialogbox").css({"font-size":t+"px"}),n.chat.sendCommand(n.operator.barejid,"!textsize "+t)),!1}),i("#idz_button_font_neg, .idz_button_font_neg").click(function(){var t=.9*parseFloat(i("#idz_dialogbox").css("font-size"));return t>=10&&(i("#idz_dialogbox").css({"font-size":t+"px"}),n.chat.sendCommand(n.operator.barejid,"!textsize "+t)),!1}),i("#idz_button_close, .idz_button_close").click(function(){if(p.emit("conversation.closed"),2===n.chat.status){var t=Strophe.getBareJidFromJid(h.getConnection().jid);h.getConnection().send($msg({to:t,from:t,type:"chat",website:n.website_id}).c("body").t("!magic_event disabled"))}return(n.Templates.closeDialog||w)(),!1}),i("#idz_button_hide, .idz_button_hide").click(function(){return i("#idz_chatbox").hasClass("idz_chatbox_hide")?(n.Templates.showDialog(),n.chat.sendAlert("!chatshow",n.T("VISITEUR_CHATBOX_OPEN")),n.chatbox_state=2):(n.Templates.hideDialog(),n.chat.sendAlert("!chathide",n.T("VISITOR_CHATBOX_MINIMIZE")),n.chatbox_state=3),n.JSONStore.save({chat_status:n.chat.status,chatbox_state:n.chatbox_state}),!1}),setTimeout(function(){n.customize["chatbar_txt2_"+n.curlang]&&0==n.customize["chatbar_txt2_"+n.curlang].length&&i("#idz_msgmsg").width()<=370&&i("#idz_msgmsg").val(n.T("POSER_VOTRE_QUESTION_ICI"))},500),i("#idz_button_mail, .idz_button_mail").click(function(){var t=i("#idz_dialogbox div.idz_msg_visitor").last().size(),e=i("#idz_dialogbox div.idz_msg_operator").last().size();if(!(t>0||e>0))return i("#idz_button_print").attr("target","_self"),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("CHAT_VIDE_ACTION_IMPOSSIBLE")).replace(/\{TIME\}/g,n.chat.getMsgTime())),i("#idz_dialogbox div.idz_msg_alert_op").last().addClass("idz_noaction"),!1;var r=window.prompt(n.T("EMAIL_PROMPT"),"");if(""===r||null===r)return!1;var o=n.chat.history_id;0==n.chat.history_id&&(o=n.chat.prev_history);var a=l();i("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+o+"&to="+encodeURIComponent(r)+"&u="+n.vuid+"&timezoneAbbr="+a),i("#mailFrame").length&&i("#mailFrame").remove(),i("body").append("<iframe id='mailFrame' name='mailFrame' style='width:0px; height:0px; border: 0px'></iframe>")}),i("#idz_button_print, .idz_button_print").click(function(){var t=i("#idz_dialogbox div.idz_msg_visitor").last().size(),e=i("#idz_dialogbox div.idz_msg_operator").last().size();return t>0||e>0?(i("#idz_button_print").attr("target","_blank"),!0):(i("#idz_button_print").attr("target","_self"),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("CHAT_VIDE_ACTION_IMPOSSIBLE")).replace(/\{TIME\}/g,n.chat.getMsgTime())),i("#idz_dialogbox div.idz_msg_alert_op").last().addClass("idz_noaction"),!1)}),i(".idz_slide_link_close a").click(function(t){t.preventDefault(),i(t.currentTarget).parents(".idz_slide").toggle()}),i("#idz_button_private").click(function(t){t.preventDefault(),i("#idz_chatbox_private").toggle()}),i(".idz_toggle").click(function(t){var e=i(t.currentTarget).find(".idz_toggle_button"),r=e.siblings("input"),o=r.val();e.toggleClass("idz_toggle_on"),e.toggleClass("idz_toggle_off"),1==o?(r.val(0),e.animate({"background-position-x":"-11px"},200)):(r.val(1),e.animate({"background-position-x":"-49px"},200));var a=r.val();n.JSONStore.saveData({visitorDeleteDataEnabled:a}),"1"===a?n.chat.sendAlert("!datadeletionenabled"):n.chat.sendAlert("!datadeletiondisabled")}),1==n.flags.visitorDeleteDataEnabled&&i(".idz_toggle").trigger("click"),setTimeout(function(){n.Templates.minimizeChatbarHide()},1e3),i("#idz_chatbar_minifier, .idz_chatbar_minifier").click(function(){return n.chat.sendAlert("!chatmini",n.T("VISITEUR_CHATBAR_MINIMIZE")),n.Templates.minimizeChatbar(),!1}),i("#idz_chatbar_mini, .idz_chatbar_mini").click(function(){return n.chat.sendAlert("!chatmaxi",n.T("VISITEUR_CHATBAR_OPEN")),n.Templates.maximizeChatbar(),n.Visio&&(n.Visio.reLaunchVideo=!0),i(this).hide(),!1}),i("#idz_msgmsg").charcount({max:n.preferences.chat_message_maxlength,className:"idz_char_counter",maxReachedClassName:"idz_char_counter_max",maxReachedText:n.T("MAXLENGTH_REACHED")}),i("#idz_chatbar").on("click",".idz_upload_trigger",function(t){t.stopPropagation(),t.preventDefault(),i(this).find("input").click()}),i("#idz_chatbar").on("change",".idz_upload_trigger input",function(t){p.emit(g.OnConversationChatFileSelected,t),t.preventDefault(),t.stopPropagation(),i(this).val("")}).on("click",".idz_upload_trigger input",function(t){t.stopPropagation()}),i("#idz_dialogbox").on("click",".idz_upload_abort",function(t){p.emit(g.OnConversationChatUploadAborted,i(this).parents(".idz_upload").data("id")),t.preventDefault(),t.stopPropagation()})},outframeChat:function(){i("body").append("<style>#idz_chatglobal, #idz_chatbar_mini {visibility:hidden;left:-9999px}</style>")},loadInvitation:function(t){if(!n.invitLoaded&&(n.Templates.loadChatCss(),n.invitLoaded=!0,1!==n.chat.composing)){n.callbacks.onInvitationDisplayed({id:t}),n.Templates.hideDialog();(iAdvize.$LAB||window.$LAB).script(n.chaturl+"invitation.php?id="+t+"&t="+n.customize.layout+"&sid="+n.website_id+"&lang="+n.curlang).wait(function(){})}},onClickChatWidget:function(){0==n.opOffline?(n.butMessage||(2!=n.chat.status&&n.chat.putOpAlert(n.T("SAISIR_UN_MESSAGE")),n.butMessage=!0),n.Templates.maximizeChatbar(),n.Templates.showDialog(),n.FNAC&&n.util.addScript("IDZclickcount",n.chaturl+"rpc/click_count.php?sid="+n.website_id)):0==n.preferences.param_noconnectedwidget&&(n.butMessage||(2!=n.chat.status&&n.chat.putOpAlert(n.T("SAISIR_UN_MESSAGE")),n.butMessage=!0),n.Templates.maximizeChatbar(),n.Templates.showDialog())},onClickC2cWidget:function(){n.chat.showC2cPopin()},bindWidgetEvents:function(){try{i(".idz_widget")&&i(".idz_widget").length&&(i("#operator_status_textarea")&&i("#operator_status_textarea").length?(i(".idz_widget").click(function(){return 0==n.opOffline&&""!==i("#operator_status_textarea").val()&&(i("#idz_msgmsg").val(i("#operator_status_textarea").val()),i("#operator_status_textarea").val(""),i("#idz_postmsg").click()),!1}),i("#operator_status_textarea").focus(function(){i("#operator_status_textarea").val()==n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA")&&(i("#operator_status_textarea").val(""),i("#operator_status_textarea").removeAttr("style"))})):i(".idz_widget").click(function(){return n.chat.onClickChatWidget(),!1}))}catch(t){}try{i("#operator_status_textarea")&&i("#operator_status_textarea").length&&i("#operator_status_textarea").keyup(function(t){13==t.which&&(i("#idz_msgmsg").val(i("#operator_status_textarea").val()),i("#operator_status_textarea").val(""),i("#idz_postmsg").click())})}catch(t){}try{i(".idz_widget_v2")&&i(".idz_widget_v2").length&&i(".idz_chatwidget").click(function(){return n.chat.onClickChatWidget(),!1})}catch(t){}try{i(".idz_c2cwidget").length&&i(".idz_c2cwidget").click(function(){return n.chat.onClickC2cWidget(),!1})}catch(t){}i(".idz_c2vwidget").length&&i(".idz_c2vwidget").click(function(){return p.emit(g.OnConversationVisioRequested),!1})},showC2cPopin:function(){p.emit("call.popin.open")},showC2cBusyMessage:function(t){v&&v.View.showC2cBusyMessage(t)},showC2cError:function(t){v&&v.View.showC2cError(t)},closeC2cPopin:function(){v&&v.View.closeC2cPopin()},resetC2cPopin:function(){v&&v.View.resetC2cPopin()},bindChatStatesEvents:function(){var t=function(t){n.operator.barejid&&(h.sendChatState(t),"composing"===t?(n.chat.composing=1,n.callbacks.onVisitorWriting()):(n.chat.composing=0,n.callbacks.onVisitorStopWriting()))};i("#idz_msgmsg").focusout(function(){t("paused")}).focusin(function(){t("active")}).keydown(function(e){13===e.which?t("active"):0===n.chat.composing&&t("composing")}).keyup(function(){!i(this).val().trim()&&n.chat.composing&&t("active")}),i("#idz_msgmsg").keydown(function(t){if(t.ctrlKey&&(13===t.keyCode||10===t.keyCode)){var e=i(this).val()+" \n";return void i(this).val(e)}if(13===t.which)return t.preventDefault(),void i("#idz_postmsg").click()})},bindSendMessage:function(){i("#idz_postmsg").on("click",function(){if(!i(this).prop("disabled")){try{var t=i("#idz_msgmsg").css("left"),e=i("#idz_msgmsg").css("top"),r=i("#idz_msgmsg").get(0).value;if(1===n.chat.satisfaction){var o=parseInt(i("#idzq1").attr("rel"),10)+1+"|";o=o+(parseInt(i("#idzq2").attr("rel"),10)+1)+"|",o=o+(parseInt(i("#idzq3").attr("rel"),10)+1)+"|",r===n.T("VOTRE_COMMENTAIRE_LIBRE")&&(r=""),o+=r;var a=n.chat.history_id||n.chat.prev_history;return n.util.addScript("satisfaction",n.chaturl+"rpc/satisfaction.php?save="+n.website_id+"&u="+n.vuid+"&hid="+a+"&data="+encodeURIComponent(o)),n.chat.sendAlert("!satisfaction completed",n.T("SATISFACTION_REPONDU")),n.Templates.removeSatisfaction(),i("#idz_msgmsg").val("").change(),n.chat.composing=0,n.callbacks.onSatisfactionAnswered(),!1}if(""===r||r===n.T("POSER_VOTRE_QUESTION_ICI")||r===n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA")||r===n.customize["chatbar_txt2_"+n.curlang])return setTimeout(function(){i("#idz_msgmsg").css({left:parseInt(t,10)+"px",top:parseInt(e,10)+"px"})},1030),!1;if(i("#idz_msgmsg").val("").change(),1===n.opDisconnected&&setTimeout(function(){n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("OPERATEUR_DECONNECTE")).replace(/\{TIME\}/g,n.chat.getMsgTime()))},300),n.operator.barejid&&(1!==n.on_call&&1===n.opOffline||n.blocked)&&2!==n.chat.status){var s=n.chat.getVmsg(r);return n.Templates.showDialog(),n.chat.put_dialog(s),n.chat.disableLoading(),setTimeout(function(){n.chat.putOpMsg(null,n.autoAnswer,0,1),n.setStatus()},300),!1}if(n.blocked||!r)return!1;var c=h.connect().fail(n.chat.showConnectionError);if(1===n.flags.waitinglist)return c.then(function(){n.Templates.showDialog(),n.chat.putVmsg(r),x.update()});if(n.operator.barejid||1===n.chat.satisfaction)c.done(function(){n.chat.onSendMessage(r)});else{var l=function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)}(),d=n.connection.getUniqueId();n.chat.enableLoading(),c.then(function(){return n.createConversation("chat",r,l,null,d)}).then(function(){if(n.routing.enabled){var t=n.$.Deferred();return n.operator.barejid||(n.operator.barejid="i_will_be_back"),t.resolve(d),t.promise()}return h.room.groupchat(r,d),n.util.retry(4,n.chat.onSendFirstMessage,n.chat,[r,d])}).done(function(t){u(),n.chat.putVmsg(r,t,l),n.operator.isExpert===!0&&n.chat.putOpAlert(n.chat.getExpertDisclaimer())}).fail(function(){1===n.flags.waitinglist?n.chat.putVmsg(r):(n.chat.put_dialog(n.chat.getVmsg(n.util.nl2br(n.util.htmlspecialchars(r)))),n.chat.showUnavailableMessage()),n.chat.disableLoading()})}}catch(t){n.errorMailer("bindSendMessage: ",t,"")}return!1}})},enableLoading:function(){i("#idz_msgmsg").attr("disabled","disabled"),i(".idz_loading").show()},disableLoading:function(){i("#idz_msgmsg").attr("disabled",!1),i(".idz_loading").hide()},showUnavailableMessage:function(){n.chat.putOpMsg(null,n.autoAnswer,0,1),n.chat.status=1,n.operator={}},onSendFirstMessage:function(t,e){var r=i.Deferred();return n.chat.dialogCount(),n.Templates.showDialog(),h.invitation.sendEngage(e,t,n.conversationJid,n.operator.barejid,n.website_id,n.chat.history_id).then(r.resolve,r.reject),setTimeout(r.reject,4e3),n.proactif_now=0,r.promise()},onSendMessage:function(t){if("1"===n.preferences.bankcard_number_hidden&&(t=r(t)),t){n.Templates.showDialog();var e=h.getConnection().getUniqueId();n.chat.sendMessage(t,e).fail(function(){}),n.chat.putVmsg(t,e),n.proactif_now=0}},dialogCount:function(){n.flags.proactif_activatedId&&!n.flags.proactif_dialogIsCounted&&(n.flags.proactif_dialogIsCounted=!0,setTimeout(function(){n.util.addScript("proactifDialogcount",n.chaturl+"rpc/proactif_dialogCount.php?inc="+n.flags.proactif_activatedId+"&sid="+n.website_id+"&u="+n.vuid+"&hid="+n.chat.history_id)},1650))},updateHistory:function(t,e,i,r){if(e){i=i||0;var o=n&&n.vStats?n.vStats.browserInfo+" | "+n.vStats.country:"";r||(r=""),n.util.addScript("IDZhistory",n.chaturl+"rpc/chat_history.php?sid="+n.website_id+"&update="+n.chat.history_id+"&u="+n.vuid+"&oid="+n.operator.id+"&data="+encodeURIComponent(e)+"&type="+t+"&id="+i+"&nick="+Strophe.getNodeFromJid(h.getConnection().jid)+"&userData="+o+"&log_uuid="+r)}},reloadHistory:function(){n.chat.buildChat(),setTimeout(function(){var t=n.chat.history_id||n.chat.prev_history,e=l();n.util.addScript("IDZRhistory",n.chaturl+"rpc/chat_history.php?reload="+t+"&u="+n.vuid),i("#idz_button_print").attr("href",n.chaturl+"gethistory.php?id="+t+"&u="+n.vuid),i("#idz_button_mail").attr("href",n.chaturl+"gethistory_mail.php?id="+t+"&u="+n.vuid+"&timezoneAbbr="+e)},400)},convertLinks:function(t,e){var n="";return e&&(n="target=_blank "),t.replace(/((ftp|https?):\/\/([-\w\.]+)+(:\d+)?(\/([\w\/_\.\(\)\-,\#\~\%\=\+&;:]*(\?\S+)?)?)?)/gm,"<a "+n+'rel="nofollow" href="$1">$1</a>')},getVmsg:function(t,i){var r=i!=e?i:n.chat.getMsgTime();return t=n.chat.convertLinks(t,!0),t=m.replaceAliasesToShortname(t),t=m.replaceUtf8ToShortname("apple",t),t=m.replaceShortnameToImage("apple",t),n.Templates.vMsg.replace(/\{MSG\}/g,t).replace(/\{TIME\}/g,r)},putVmsg:function(t,e,i){e=e||0;var r=n.util.nl2br(n.util.htmlspecialchars(t));n.chat.put_dialog(n.chat.getVmsg(r),e),t=m.replaceShortnameToUtf8("apple",t),n.chat.updateHistory(n.chat.VMSG,t,e,i),n.chat.disableLoading(),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.callbacks.onVisitorStopWriting(),n.callbacks.onMessageSent({time:n.chat.getMsgTime(),msg:r})},getOpAlert:function(t,i){var r=i!=e?i:n.chat.getMsgTime();return t=n.util.nl2br(n.util.htmlspecialchars(t)),t=t.replace(/&lt;br \/&gt;/gi,"<br/>").replace(/&lt;br\/&gt;/gi,"<br/>").replace(/&lt;br&gt;/gi,"<br/>"),n.Templates.opAlert.replace(/\{MSG\}/g,t).replace(/\{TIME\}/g,r)},putOpAlert:function(t,e){n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(n.chat.getOpAlert(t)),e&&1===e&&n.chat.updateHistory(n.chat.OPALERT,t),n.callbacks.onAlertReceived({time:n.chat.getMsgTime(),msg:t})},getOpMsg:function(t,r){var o=r!=e?r:n.chat.getMsgTime(),a=n.static_url+"images/livechat/blank.gif";n.operator.isExpert&&n.operator.avatar?a=n.static_url+"images/avatars/"+n.operator.avatar:n.operator.avatar&&(a=n.static_url+"images/avatars/client_"+n.client_id+"/"+n.operator.avatar);var s="";if(n.operator.pseudo){s=n.util.htmlspecialchars(n.operator.pseudo);var c="";n.operator.isExpert&&(c=" "+iAdvize.T("SEE_MORE")),s=s+'<span class="idz_colonspace">'+c+"</span> : "}t.indexOf(n.autoAnswer)===-1&&(t=t.indexOf(n.website_url)===-1?n.chat.convertLinks(t,!0):n.chat.convertLinks(t,!1)),t=t.replace(/&lt;br \/&gt;/gi,"<br/>").replace(/&lt;br\/&gt;/gi,"<br/>").replace(/&lt;br&gt;/gi,"<br/>"),t=m.replaceUtf8ToImage("apple",t);var u=n.Templates.opMsg.replace(/\{PSEUDO\}/g,s).replace(/\{AVATAR\}/g,a).replace(/\{MSG\}/g,t).replace(/\{TIME\}/g,o);if(n.operator.direct_phone&&""!=n.operator.direct_phone&&0===n.phoneDisplayed){n.phoneDisplayed=1;var l=n.Templates.opMsgFooter.replace(/\{PHONE_PRICE\}/g,n.operator.phone_facturation).replace(/\{PHONE_NUMBER\}/g,n.operator.direct_phone);u=u.replace(/\{FOOTER\}/g,l)}else u=u.replace(/\{FOOTER\}/g,"");if(n.operator.id){p.emit("events.operatorMessageSent",n.operator);u=i(u).attr("data-operatorid",n.operator.id)[0].outerHTML}return u},putOpFile:function(t,e){i('.idz_upload[data-id="'+t+'"]').remove(),e.find("img").on("load",function(){n.chat.scroll_dialog()}),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(e),n.chat.scroll_dialog()},putOpProduct:function(t,e){e.find("img").on("load",function(){n.chat.scroll_dialog()}),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(e),n.chat.scroll_dialog()},putOpMsg:function(t,e,r,o){var a="";a=o?n.util.nl2br(e):n.util.nl2br(n.util.htmlspecialchars(e));try{if(null!=t){n.opMsgList=n.opMsgList||[];var s=!1;if(i.each(n.opMsgList,function(e,n){n==t&&(s=!0)}),s)return;n.opMsgList.push(t),n.opMsgList.length>5&&n.opMsgList.shift()}}catch(t){}n.Templates.showDialog(),n.Templates.maximizeChatbar();var c=n.chat.getOpMsg(a);n.chat.put_dialog(c),p.emit("events.operatorMessageAppended",n.operator),null!=t&&i("#idz_dialogbox").find(".idz_msgtext:last").attr({id:t}),1===r?n.chat.updateHistory(n.chat.OPMSG,e,t):2===r&&setTimeout(function(){n.chat.updateHistory(n.chat.OPMSG,e,t)},2200),n.callbacks.onMessageReceived({time:n.chat.getMsgTime(),msg:e})},onCommand:function(t){function e(){if(!n.operator.id){if(n.routing.enabled&&!n.activeCall&&(0===n.chat.history_id||0===n.vStats.history_id||!n.conversationJid))return n.errorMailer("Routing operator found with invalid states",new Error("invalid routing states"),"",{historyId:n.chat.history_id,vStatsHistoryId:n.vStats.history_id,jid:n.conversationJid,profile:e,operator:n.operator}),n.opOffline=1,n.chat.status=1,n.operator={},n.chat.putOpMsg(null,n.T("AN_ERROR_OCCURED_PLEASE_RETRY"),0,1),void n.chat.disableLoading();var t=r.substr(r.indexOf(" ")+1),e=JSON.parse(t);n.operator=e,n.operator.isExpert===!0&&n.chat.putOpAlert(n.chat.getExpertDisclaimer()),n.routing.enabled&&n.chat.sendAlert(n.flags.proactif_alert,n.flags.message,!0),n.activeCall?v&&v.Service.onCallOperator(e.barejid):(n.logMailer("conversations.routing.operator.found","Routing operator found",{vuid:iAdvize.vuid,barejid:e.barejid}),h.invitation.sendEngage(e.identifier,e.message,n.conversationJid,n.operator.barejid,n.website_id,n.chat.history_id),n.chat.sendProfile(e.barejid,n.vStats.getProfile()),p.emit("events.chatBuilt",null))}}var r=t.body,o=t.from,a=t.barejid,s=t.getCommand(),c=function(){var t=n.operator.barejid;return null===t||b(t,a)},l=s.name,f=s.param1,m=s.param2;if(""===n.iframeID){if("routing_operator_found"===l&&d.then(e),"vprofile"===l&&n.chat.sendProfile(o,n.vStats.getProfile()),"remindqueued"===l&&x.remind({position:f}),"unqueued"===l&&x.unqueue(a),"windowsize"===l&&n.chat.sendCommand(o,"!windowsize "+i(window).width()+"|"+i(window).height()),"getcook"===l&&(n.chat.sendCookie(o),n.util.warn("sending cookie: "+n.chat.cCook)),"customdata"===l&&n.chat.sendCustomData(o),
"visio"===l&&("refused"===f?p.emit(g.OnConversationVisioRefused):"timeout"===f?p.emit(g.OnConversationVisioTimeout):"close"===f&&p.emit(g.OnConversationVisioClose)),c()&&"push"===l){var w="";f=n.util.nl2br(n.util.htmlspecialchars(f)),m=n.util.nl2br(n.util.htmlspecialchars(m)),n.chat.updateHistory(n.chat.OPALERT,"PUSH "+f+" "+m),n.callbacks.onLinkReceived({name:m,url:f,push:!0}),f.indexOf(n.website_url)===-1?w=" target='_blank'":setTimeout(function(){window.parent.location.href=f},800);var T=n.Templates.putLinkItem(f,m,w);y()?n.chat.put_dialog(T):n.chat.putOpAlert(n.T("OPERATEUR_PUSHLINK"))}if("blockme"===l&&(2===n.chat.status?(n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("OPERATEUR_DECONNECTION")).replace(/\{TIME\}/g,n.chat.getMsgTime())),n.opDisconnected=1,n.JSONStore.saveData({opdisconnected:1}),n.blocked=!0):n.Templates.hideUI()),c()&&"links"===l&&(w="",f=n.util.nl2br(n.util.htmlspecialchars(decodeURIComponent(f))),m=n.util.nl2br(n.util.htmlspecialchars(m)),n.chat.updateHistory(n.chat.OPALERT,"LINKS "+f+" "+m),f.indexOf(n.website_url)===-1&&(w=" target='_blank'"),T=n.Templates.putLinkItem(f,m,w),y()?n.chat.put_dialog(T):n.chat.putOpAlert(n.T("OPERATEUR_SENDLINK")),n.callbacks.onLinkReceived({name:m,url:f,push:!1})),c()&&"offers"===l){w="",n.chat.updateHistory(n.chat.OPALERT,"OFFERS "+n.util.htmlspecialchars(f)+" "+n.util.htmlspecialchars(m)),f.indexOf(n.website_url)===-1&&(w=" target='_blank'");var C=n.Templates.putOfferItem(n.util.htmlspecialchars(f),n.util.htmlspecialchars(m),w);y()?n.chat.put_dialog(C):n.chat.putOpAlert(n.T("OPERATEUR_SENDOFFER")),n.callbacks.onOfferReceived({name:m.split("|")[0],url:f})}if(c()&&"pushoffer"===l){w="",n.chat.updateHistory(n.chat.OPALERT,"OFFERS "+n.util.htmlspecialchars(f)+" "+n.util.htmlspecialchars(m)),f.indexOf(n.website_url)===-1?w=" target='_blank'":setTimeout(function(){window.parent.location.href=f},800);var C=n.Templates.putOfferItem(n.util.htmlspecialchars(f),n.util.htmlspecialchars(m),w);y()?n.chat.put_dialog(C):n.chat.putOpAlert(n.T("OPERATEUR_PUSHOFFER"))}if(c()&&"closedialog"===l){if(2===n.chat.status){i("#idz_msgmsg, #idz_postmsg").prop("disabled",!0),n.flags.visio_status&&p.emit(g.OnConversationVisioClosed),n.chat.putOpAlert(n.T("FIN_DISCUSSION")),n.callbacks.onChatEnded({id:n.chat.history_id,endedBy:"operator"}),delete n.operator.barejid;var S=4e3;iAdvize.REDOUTE&&(S=8e3),169===n.client_id&&(S=1e4),setTimeout(function(){i("#idz_msgmsg, #idz_postmsg").prop("disabled",!1),n.operator.id===-1||1===n.virtualOP||"1"!=n.preferences.param_satisfaction||0!==n.chat.satisfaction||n.blocked?n.Templates.hideDialog():(n.chat.satisfaction=1,n.Templates.displaySatisfaction(),n.callbacks.onSatisfactionDisplayed())},S)}n.flags.popup_mode&&delete n.flags.popup_mode,n.chat.EndOfChat()}if("nomoreslot"===l||"routing_operator_not_found"===l){if(n.routing.enabled&&!n.operator.barejid)return;n.routing.enabled&&n.logMailer("conversations.routing.operator.nomoreslot","Routing operator unavailable",{vuid:iAdvize.vuid,barejid:n.operator.id,history_id:n.chat.history_id}),n.chat.putOpMsg(null,n.T("BONJOUR_NOTRE_SERVICE_CLIENT_EST_ACTUELLEMENT_FERME"),0,1),n.util.addScript("IDZhistory",n.chaturl+"rpc/chat_history.php?sid="+n.website_id+"&missed="+n.chat.history_id+"&oid="+n.operator.id+"&u="+n.vuid),n.opOffline=1,n.chat.status=1,n.operator={}}if("showinvit"===l&&n.chat.loadInvitation(f),"c2c"===l){if(clearTimeout(n.c2cTimeout),"opanswered"===f){var O=i(t.raw).attr("conversationJid");h.room.join(O,n.vuid),n.conversationJid=O,n.callbacks.onCallStarted(),1===n.preferences.c2c_callvisitorfirst?i(".c2cpopin_label").html('<div class="c2cpopin_label_phone"></div>'+n.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT2")):i(".c2cpopin_label").html('<div class="c2cpopin_label_phone"></div>'+n.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT3")),1!==n.preferences.call_offline_enabled&&(n.on_call=1),n.opOffline=0,n.chat.status=2,n.chat.history_id=m,n.vStats.history_id=m,n.chat.dialogCount(),n.setStatus(),n.operator=n.c2coperator,b(n.c2coperator.barejid,a)||(n.c2coperator.barejid=a,n.operator.barejid=a,n.util.addScript("getop",n.chaturl+"rpc/getop.php?sid="+n.website_id+"&u="+n.vuid+"&getop="+a)),n.flags.proactif_alert&&""!=n.flags.proactif_alert&&n.chat.sendAlert(n.flags.proactif_alert,n.flags.message,!0),n.c2cTimeout=setTimeout(function(){i("#c2cpopin_step2").hide(),i("#c2cpopin_step1").show(),n.chat.closeC2cPopin()},1e4)}else"start"===f?(i(".c2cpopin_label").html('<div class="c2cpopin_label_phone"></div>'+n.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT3")),n.chat.dialogCount(),1!==n.preferences.call_offline_enabled&&(n.on_call=1),n.opOffline=0,n.chat.status=2,n.chat.history_id=m,setTimeout(function(){i("#c2cpopin_step2").hide(),i("#c2cpopin_step1").show(),n.chat.closeC2cPopin()},7e3)):"stop"===f?(h.room.leave(n.conversationJid,n.vuid),n.callbacks.onCallEnded(),i(".c2cpopin_label").html('<div class="c2cpopin_label_phone"></div>'+n.T("NOUS_VOUS_RAPPELLONS_GRATUITEMENT_TXT1")),n.on_call=0,n.chat.status=3,n.chatbox_state=4,n.activeCall=null,setTimeout(function(){i("#c2cpopin_step2").hide(),i("#c2cpopin_step1").show(),n.chat.closeC2cPopin()},7e3),"1"==n.preferences.param_satisfaction&&0==n.chat.satisfaction&&(n.chat.buildChat(),n.chat.satisfaction=1,n.Templates.displaySatisfaction(),n.callbacks.onSatisfactionDisplayed())):"redial"==f?v&&v.Service.onMakeCall():"error"==f&&(n.chat.showC2cError(n.T(m.trim())),n.on_call=0,n.chat.status=1);n.JSONStore.saveData({on_call:n.on_call,chat_status:n.chat.status,history_id:n.chat.history_id,chatbox_state:n.chatbox_state})}if("init_cobro"===l&&_){if(!_.init)return n.errorMailer("Mirroring init_cobro error: Defined Mirror but undefined method",{object:_,type:typeof _,browser:window.navigator.userAgent,url:window.location.href},""),!0;_.init(n.preferences.cobrowsing_version).done(function(){n.operator.barejid&&n.chat.sendCommand(n.operator.barejid,"!cobro_init")})}}if("magic_event"===l){if(!_)return!0;if(!_.isReceiver||!_.state||!_.receiverDispatcher)return n.errorMailer("Mirroring magic_event error: Defined Mirror but undefined methods",{object:_,type:typeof _,browser:window.navigator.userAgent,url:window.location.href},""),!0;"sender"==f||"disabled"==f||"receiver"==f?("sender"==f&&_.isReceiver()&&(i("#op_cursor").animate({top:"-3000px",left:"-3000px"},150),""==n.iframeID&&(n.Templates.showDialog(),n.chat.cobrowsing=0,n.JSONStore.saveData({chat_cobrowsing:n.chat.cobrowsing}),n.chat.putOpAlert(n.T("COBROWSING_STOP")),n.chat.updateHistory(n.chat.OPALERT,"COBROWSING_STOP"),n.callbacks.onCobrowsingStopped())),"sender"!=f||n.operator.barejid||(n.monitor_jid=a),"disabled"==f&&2!=n.chat.status&&delete n.monitor_jid,"sender"==f&&""!=n.iframeID&&setTimeout(function(){n.chat.sendCommand(n.operator.barejid,"!magic_event iframe_change "+n.iframeID+" "+document.location.href)},600),_.state(f)):"receiver_request"==f?""==n.iframeID&&(n.chat.buildChat(),n.Templates.showDialog(),n.Templates.maximizeChatbar(),n.chat.put_dialog(n.Templates.askCobrowsing.replace(/\{TIME\}/g,n.chat.getMsgTime())),n.chat.updateHistory(n.chat.OPALERT,"COBROWSING_ASK"),i('[id="idz_cobrowsing_accept"]').bind("click",function(t){return n.chat.addCobrowsingImg(),i(t.target).closest(".idz_msg_alert_op").remove(),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("COBROWSING_ACCEPT")).replace(/\{TIME\}/g,n.chat.getMsgTime())),_.state("receiver"),n.chat.updateHistory(n.chat.OPALERT,"COBROWSING_ACCEPT"),n.chat.sendCommand(n.operator.barejid,"!magic_event receiver_accept"),"numericable"==n.customize.layout||n.flags.streamId||(n.Templates.hideDialog(),n.chatbar_state=1,n.JSONStore.saveData({chatbar_state:n.chatbar_state})),n.chat.cobrowsing=1,n.JSONStore.saveData({chat_cobrowsing:n.chat.cobrowsing}),n.callbacks.onCobrowsingAccepted(),!1}),i('[id="idz_cobrowsing_refuse"]').bind("click",function(t){return i(t.target).closest(".idz_msg_alert_op").remove(),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("COBROWSING_REFUSE")).replace(/\{TIME\}/g,n.chat.getMsgTime())),n.chat.updateHistory(n.chat.OPALERT,"COBROWSING_REFUSE"),n.chat.sendCommand(n.operator.barejid,"!magic_event receiver_refuse"),n.callbacks.onCobrowsingRefused(),!1}),n.callbacks.onCobrowsingRequested()):_.receiverDispatcher(r.substr(s.length+2))}"change_page"===l&&(document.location.href=decodeURIComponent(f)),"ackEngage"===l&&(n.routing.enabled&&n.logMailer("conversations.routing.operator.engage.acknowledge","Routing acknowledge received",{vuid:iAdvize.vuid,barejid:iAdvize.operator.barejid,historyId:n.chat.history_id}),2!==n.chat.status&&u(),n.chat.status=2,n.operator.barejid=a)},onChatStates:function(t,e){try{b(n.operator.pseudo,t)&&""===n.iframeID&&("composing"===e?(i(".idz_writting").html(n.T("OPERATEUR_COMPOSING")),n.callbacks.onOperatorWriting()):(i(".idz_writting").html(" "),n.callbacks.onOperatorStopWriting()))}catch(t){n.PROD?n.errorMailer("onChatState: ",t,e):console&&console.debug&&console.debug("[Erreur][onChatStates]",t.message,e)}},onMessage:function(t){var e=t.body,r=t.id,o=t.from,a=t.barejid;if(!iAdvize.hideUI&&!function(t){return Strophe.getResourceFromJid(t)===n.vuid}(o)&&(n.util.debug("MESSAGE: from "+o+": "+e),""==n.iframeID)){if(n.opBusy=0,n.opDisconnected=0,!function(){var t=n.conversationJid;return null===t||b(t,a)}())return n.chat.sendCommand(a,"!chatting"),i(".idz_writting").html(" "),!0;if(n.operator.barejid||(n.operator.barejid=a),n.chat.putOpMsg(r,e,1),setTimeout(function(){i(".idz_writting").html(" ")},350),n.chat.status=2,n.chatbox_state=2,n.virtualOP=0,n.blink_title(),"1"==n.customize.sound_alert){var s=x.justUnqueued()?"outofqueue":"message";n.playSound(s)}}},onMessageReceipt:function(t){try{if(t.isCommand()){var e=t.getCommand();"transfer"===e.name&&n.transfer(e.param1)}}catch(e){n.PROD?n.errorMailer("onReceipt: ",e,t):console&&console.debug&&console.debug("[Erreur][onMessageReceipt]",e.message,t)}return!0},EndOfChat:function(){n.chat.status=3,(0==n.chat.prev_history||isNaN(n.chat.prev_history)||n.chat.history_id>n.chat.prev_history)&&(n.chat.prev_history=n.chat.history_id),n.chat.history_id=0,n.chatbox_state=4,n.JSONStore.save({chat_status:n.chat.status,chatbox_state:n.chatbox_state,chatbar_state:n.chatbar_state,opdisconnected:0}),n.prevOp=n.operator,n.operator={},h.getConnection().connected&&(h.room.leave(n.conversationJid,n.vuid),n.chat.sendPresence("available"))},EndOfWaiting:function(){n.chat.status=3,(0==n.chat.prev_history||isNaN(n.chat.prev_history)||n.chat.history_id>n.chat.prev_history)&&(n.chat.prev_history=n.chat.history_id),n.chat.history_id=0,n.chatbox_state=3,n.prevOp=-1,n.operator={},n.chat.sendPresence("available"),n.chat.putOpAlert(n.T("WAITING_CONNECTION_ERREUR"))},showConnectionError:function(){(i("#idz_chatglobal").is(":visible")||2==n.chat.status)&&(i(".idz_writting").html(""),n.chat.putOpAlert(n.T("CONNECTION_ERREUR")),n.chat.disableLoading(),i("#idz_msgmsg, #idz_postmsg").prop("disabled",!0))},sendMessage:function(t,e){var r=i.Deferred(),o=function(t){r.resolve(t)};try{if(!t||""===t)return r.reject("desk.publish.error.empty"),r.promise();if(n.blocked)return r.reject("desk.publish.error.blocked"),r.promise();if(3==n.chat.status&&n.chat.history_id>0&&n.chat.sendPresence("dnd"),n.chat.status=2,n.chatbox_state=2,n.chatbar_state=0,n.operator.id===-1)return r.reject("desk.publish.error.waiting"),r.promise();h.room.groupchat(t,e).done(o).fail(n.chat.onRetrySendMessage)}catch(t){return r.reject("desk.publish.error.unknown",t)}return r.promise()},onRetrySendMessage:function(t,e,i){i&&i.done(function(t){}).fail(n.chat.onRetrySendMessage)},sendChatClose:function(){var t=n.chat.sendAlert("!chatclose",n.T("VISITOR_CHATBOX_CLOSE"));1!=n.chat.status&&(n.chat.status=3,n.flags.waitinglist=0,n.chat.sendPresence("available"),n.opDisconnected=0,n.JSONStore.saveData({chat_status:n.chat.status,visitor_closed:1,waitinglist:0,opdisconnected:0}),n.chat.updateHistory(n.chat.OPALERT,"VISITOR_CHAT_CLOSE",t))},sendAlert:function(t,e,i){try{if(1==n.virtualOP)return;var r=(new Date).getTime();if(2==n.chat.status||i){var o=$msg({to:n.operator.barejid,from:h.getConnection().jid,type:"chat",id:r,website:n.website_id}).c("body").t(t);return h.getConnection().send(o),r}}catch(i){n.errorMailer("sendAlert: ",i,t+"\n\n"+e)}},sendPresence:function(t){var e={site:n.website_id,opid:n.operator.id,frameid:n.iframeID};n.chat.history_id&&(e.history=n.chat.history_id),"unavailable"==t?h.getConnection().send($pres({type:"unavailable"})):"available"==t?h.getConnection().send($pres(e).c("status").t(location.href)):"away"!=t&&"dnd"!=t||h.getConnection().send($pres(e).c("show").t(t).up().c("status").t(location.href))},sendCommand:function(t,e){try{if(!n.vRoster.isOnline(t))return;var i=(new Date).getTime();(n.vRoster.isOnPupitre(t)||"!chatting"===e)&&h.getConnection().send($msg({id:i,to:t+"/operators",from:h.getConnection().jid,type:"command",website:n.website_id}).c("body").t(e))}catch(t){n.errorMailer("SendCommand: ",t,e)}},sendProfile:function(t,e){try{h.getConnection().send($msg({to:t,from:h.getConnection().jid,type:"command",website:n.website_id}).c("body").t("!vprofile "+e))}catch(t){n.errorMailer("sendProfile: ",t,msg)}},sendCookie:n.util.runOnce(1500,function(t){var e="!getcook "+n.chat.cCook;h.getConnection().send($msg({to:t[0],from:h.getConnection().jid,type:"command",website:n.website_id}).c("body").t(e))}),sendCustomData:function(t){var e="!customdata "+n.vStats.customData();h.getConnection().send($msg({to:t,from:h.getConnection().jid,type:"command",website:n.website_id}).c("body").t(e))},getMsgTime:function(){var t=new Date,e=t.getHours(),n=t.getMinutes();return n<10&&(n="0"+n),e+":"+n},scroll_dialog:function(){if(n.noDefaultScrollTemplate)n.Templates.myScroll?setTimeout(function(){n.Templates.myScroll.refresh(),n.Templates.myScroll.scrollToElement("#idz_dialogbox_bottom",100)},0):i("#idz_dialogbox").animate({scrollTop:i("#idz_dialogbox")[0].scrollHeight});else{var t=i("#idz_dialogbox");t.data("jsp")?t.data("jsp").reinitialise():t.jScrollPane({showArrows:!0}),t.data("jsp").scrollToPercentY(100)}},scroll_link:function(){if(n.noDefaultScrollTemplate)n.Templates.myScroll||i("#idz_chatbox_left_content").animate({scrollTop:i("#idz_chatbox_left_content")[0].scrollHeight});else{var t=i("#idz_chatbox_left_content");t.data("jsp")?t.data("jsp").reinitialise():t.jScrollPane({showArrows:!0}),t.data("jsp").scrollToPercentY(100)}},put_dialog:function(t,e){var r=i(t);r.find(".idz_msgtext").attr("data-id",e);var o=r.attr("class"),a=i("#idz_dialogbox_bottom"),s=a.prev("div").attr("class"),c=a.prev("div").find(".idz_msgtime:last").html();if("idz_msg_operator"!=o&&"idz_msg_visitor"!=o||o!=s)i("#idz_dialogbox #idz_dialogbox_bottom").before(t);else{var u=r.find(".idz_msgtext"),l=r.find(".idz_msgtime");c==l.html()&&(l=""),a.prev("div").find(".idz_msgtext:last").after(u).after(l),"idz_msg_operator"==o&&i(".idz_opename:last").remove()}n.chat.scroll_dialog()},getLocalTime:function(t){var e=6e4*(new Date).getTimezoneOffset(),n=new Date,i=new Date(n.getTime()+e);i.setHours(t.split(":")[0]),i.setMinutes(t.split(":")[1]);var r=new Date(i.getTime()-e),o=r.getHours(),a=r.getMinutes();return a<10&&(a="0"+a),o+":"+a},prepare_history:function(e){try{e=JSON.parse("["+e+"]")}catch(t){n.errorMailer("prepare_history JSON.parse: ",t,e),e=!1}if(e){var r=i("<div id='hist_container'></div>"),o="",a="",s="",c="",u="",l=!0,d=!1;n.opMsgList=[];var h="",f="",v="",_=0,b=!1;i.each(e,function(t,e){try{if(e[3]){if(b=!1,i.each(n.opMsgList,function(t,n){n==e[3]&&(b=!0)}),b)return!0;n.opMsgList.push(e[3]),n.opMsgList.length>5&&n.opMsgList.shift()}}catch(t){}if(f=n.util.htmlSimpleEscape(e[2]),f=f.replace(/&lt;br \/&gt;/gi,"<br/>").replace(/&lt;br\/&gt;/gi,"<br/>").replace(/&lt;br&gt;/gi,"<br/>"),_!=e[0]||1!=e[0]&&2!=e[0]?(1==e[0]&&r.append(n.chat.getOpMsg(f,e[1])),2==e[0]&&r.append(n.chat.getVmsg(f,e[1]))):(h=v==e[1]?"":"<div class='idz_msgtime'>"+e[1]+"</div>",f=m.replaceUtf8ToImage("apple",f),r.find(".idz_msgtext:last").after("<div class='idz_msgtext'>"+f+"</div>").after(h)),_=e[0],v=e[1],2==e[0]&&l&&(l=!1,n.operator.isExpert===!0&&(r.append(n.chat.getOpAlert(n.chat.getExpertDisclaimer(),v)),_=3,d=!0)),3==e[0]){if(o=e[2],"LINKS"===(a=o.split(" ")[0])||"PUSH"===a){s=o.split(" ")[1],c=o.substr(s.length+a.length+2),s.indexOf(n.website_url,0)==-1&&(u=" target='_blank'");var w=n.Templates.putLinkItem(s,c,u);y()?r.append(w):("LINKS"===a&&r.append(n.chat.getOpAlert(n.T("OPERATEUR_SENDLINK"),e[1])),"PUSH"===a&&r.append(n.chat.getOpAlert(n.T("OPERATEUR_PUSHLINK"),e[1])))}if("OFFERS"===a){s=o.split(" ")[1],c=o.substr(s.length+a.length+2),s.indexOf(n.website_url)===-1&&(u=" target='_blank'");var x=n.Templates.putOfferItem(s,c,u);y()?r.append(x):r.append(n.chat.getOpAlert(n.T("OPERATEUR_SENDOFFER"),e[1]))}"VISIOCONF_ACCEPT"===a&&r.append(n.chat.getOpAlert(n.T("VISIOCONF_ACCEPT"),e[1])),"COBROWSING_ASK"===a&&r.append(n.chat.getOpAlert(n.T("COBROWSING_ASK_SHORT"),e[1])),"COBROWSING_ACCEPT"===a&&r.append(n.chat.getOpAlert(n.T("COBROWSING_ACCEPT"),e[1])),"COBROWSING_REFUSE"===a&&r.append(n.chat.getOpAlert(n.T("COBROWSING_REFUSE"),e[1])),"COBROWSING_STOP"===a&&r.append(n.chat.getOpAlert(n.T("COBROWSING_STOP"),e[1])),"CHAT_CLOSE"!==a&&"VISITOR_CHAT_CLOSE"!==a&&"OPERATOR_CHAT_CLOSE"!==a||r.append(n.chat.getOpAlert(n.T("FIN_DISCUSSION_SHORT"),e[1]))}if(1==e[0]&&n.opMsgList.push(e[3]),e[0]===n.chat.OPRC||e[0]===n.chat.VRC)try{var T=JSON.parse(e[2]),C=e[0]===n.chat.OPRC?"operator":"visitor",S=e[1],O=e[3];p.emit(g.OnXmppOOBReceived,O,C,S,T.type,T.data.url,T.data,r)}catch(t){console.error(t)}}),d===!1&&n.operator.isExpert===!0&&r.append(n.chat.getOpAlert(n.chat.getExpertDisclaimer()));var w=n.opMsgList.length;w>5&&(n.opMsgList=n.opMsgList.slice(w-5,w)),i("#idz_dialogbox #idz_dialogbox_bottom").before(r),p.emit("events.operatorMessageAppended",n.operator),i("#idz_dialogbox").find(".idz_msgtime").each(function(){t=i(this).text(),t=n.chat.getLocalTime(t),i(this).replaceWith("<div class='idz_msgtime'>"+t+"</div>")}),2==n.chatbox_state&&n.chat.offercount>1&&(y()||n.Templates.showOfferPanel()),n.chat.scroll_dialog(),n.chat.scroll_link()}},getExpertDisclaimer:function(){return n.T("chatbox.operatorAlert.expertDisclaimer").replace(/\{\{ company }}/g,n.website_label)}},n.blink_title=function(){1!==n.hasFocus&&(null!==n.blinktm&&(clearInterval(n.blinktm),n.blinktm=null),n.blinktm=setInterval(function(){i("title").html()===n.oTitle?document.title=n.T("NOUVEAU_MESSAGE"):document.title=n.oTitle},1500))},n.lastPreview=null,n.livePreview=window.setInterval(function(){if(n.chat&&2===n.chat.status&&n.operator&&n.operator.barejid){var t=i("#idz_msgmsg").val();if(""!=t&&n.lastPreview!=t&&t!=n.T("POSER_VOTRE_QUESTION_ICI")&&t!=n.T("POSER_VOTRE_QUESTION_ICI_UN_CONSEILLER_VOUS_REPONDRA")&&t!=n.customize["chatbar_txt2_"+n.curlang]){n.lastPreview=t,"1"===n.preferences.bankcard_number_hidden&&(t=r(t));var e=$msg({to:Strophe.getBareJidFromJid(n.operator.barejid)+"/operators",from:h.getConnection().jid,type:"command",website:n.website_id}).c("body").t("!preview "+t);h.getConnection().send(e)}}},2800),n.findOPDelayed=function(){return n.routing.enabled?0:setTimeout(function(){n.AvailableOp.find()},1500)},n.findOpCallback=function(t){var e=n.preferences.priority_channel;if("all"!=e&&0==t.opOffline&&0==t.c2cOffline&&("chat"==e&&(t.c2cOffline=1),"call"==e&&(t.opOffline=1)),n.opOffline=t.opOffline,n.c2cOffline=t.c2cOffline,n.callMeeting.available=!!t.callMeeting&&t.callMeeting.available,n.callMeeting.enabled=!!t.callMeeting&&t.callMeeting.enabled,n.callInstant.available=!!t.callInstant&&t.callInstant.available,n.callInstant.enabled=!!t.callInstant&&t.callInstant.enabled,n.callOffline.available=!!t.callOffline&&t.callOffline.available,n.callOffline.enabled=!!t.callOffline&&t.callOffline.enabled,n.c2vOffline=t.c2vOffline,t.opBusy&&(n.opBusy=t.opBusy),setTimeout(function(){2!=n.chat.status&&(n.callbacks.onStatusChanged({offline:t.opOffline,busy:t.opBusy,c2cOffline:t.c2cOffline}),n.callbacks.onCallStatusChanged({offline:t.c2cOffline,chatOffline:t.opOffline}))},450),1==t.opOffline&&1==n.c2cOffline&&1==n.c2vOffline){try{n.setStatus(),n.chat.connected===!0&&_&&_.disable&&_.disable()}catch(t){}try{n.chat.status<2&&n.Templates.hideUI()}catch(t){}}else if(setTimeout(n.setStatus,300),1==t.opOffline)try{n.chat.status<2&&n.Templates.hideUI()}catch(t){}p.emit("targeting.poll.callback",t)},n.onActivity=function(){n.vStats.lastMove=(new Date).getTime(),null==n.vStats.activeSince&&(n.vStats.activeSince=(new Date).getTime())},n.setStatus=function(){if(n.flags.popup_mode&&!n.popout)return!0;n.floatingWidget&&n.floatingWidget.onPresenceChange(),n.SetOnline(),n.SetOffline(),n.OCallBack&&(1==n.opOffline&&1==n.c2cOffline||1==n.on_call?n.OCallBack.onOffline():n.OCallBack.onOnline());var t="";i(".idz_widget_v2").length&&(n.opOffline&&n.c2cOffline?0!=n.preferences.param_noconnectedwidget?i(".idz_widget_v2").hide():(i(".idz_widget_v2 .wtext1").html(" "),i(".idz_widget_v2 .wtext2").html(n.T("OPERATEURS_INDISPONIBLES_ENVOYER_EMAIL")),i(".idz_widget_v2 .wtext5").show()):(n.opOffline?i(".idz_chatwidget").hide():(t+="Nous vous assistons en direct par chat.",i(".idz_chatwidget").show()),n.opOffline||n.c2cOffline||(t+=" <span>OU</span> "),n.c2cOffline?(i(".idz_c2cwidget").hide(),n.chat&&n.chat.closeC2cPopin(),i("#call_button_online,.call_button_online").hide(),i("#call_button_offline,.call_button_offline").show()):(t+=n.T("NOUS_VOUS_RAPPELONS_GRATUITEMENT"),i(".idz_c2cwidget").show()),1==n.preferences.param_connectedwidget?i(".idz_widget_v2").hide():(i(".idz_widget_v2 .wtext1").html(n.T("PUIS_JE_VOUS_AIDER")),i(".idz_widget_v2 .wtext2").html(t),i(".idz_widget_v2").show()),i(".idz_widget_v2 .wtext5").hide()))},n.onChatButtonDisplay=function(){p.emit(g.chatButtonDisplayed),n.callButCB||(n.callbacks.onChatButtonDisplayed(),n.callButCB=!0)},n.onCallButtonDisplay=function(){p.emit(g.callButtonDisplayed),n.chatButCB||(n.callbacks.onCallButtonDisplayed(),n.chatButCB=!0)},n.onVisioButtonDisplay=function(){p.emit(g.videoButtonDisplayed),n.visioButCB||(n.callbacks.onVideoButtonDisplayed(),n.visioButCB=!0)},n.SetOnline=function(){1!=n.on_call&&(0==n.opOffline&&("1"==n.customize.chatbar_avatar&&(i("#idz_avatar_status").addClass("idz_online").removeClass("idz_offline").html(n.T("EN_LIGNE")),i("#idz_status_msg").html(n.T("NOS_CONSEILLERS_SONT_ACTUELLEMENT_A_VOTRE_DISPOSITION"))),i(".idz_widget").length&&i("#button_online").is(":hidden")&&(1!=n.preferences.param_connectedwidget?(i("#button_offline").hide(),i("#button_online").show(),n.onChatButtonDisplay()):(i("#button_offline").hide(),i("#button_online").hide()))),0==n.c2cOffline&&(i(".idz_c2cwidget").length&&(1!=n.preferences.param_c2c_connectedwidget?(i(".idz_c2cwidget").show(),n.onCallButtonDisplay()):i(".idz_c2cwidget").hide()),1!=n.preferences.param_c2c_connectedwidget?(i("#call_button_online,.call_button_online").show(),i("#call_button_offline,.call_button_online").hide()):(i("#call_button_online,.call_button_online").hide(),i("#call_button_offline,.call_button_offline").hide())),0==n.c2vOffline&&(i(".idz_c2vwidget").length&&(1!=n.preferences.param_visio_connectedwidget?(i(".idz_c2vwidget").show(),n.onVisioButtonDisplay()):i(".idz_c2vwidget").hide()),1!=n.preferences.param_visio_connectedwidget?(i("#visio_button_online,.visio_button_online").show(),i("#visio_button_offline,.visio_button_online").hide()):(i("#visio_button_online,.visio_button_online").hide(),i("#visio_button_offline,.visio_button_offline").hide())))},n.SetOffline=function(){1!=n.opOffline&&1!=n.on_call||("1"==n.customize.chatbar_avatar&&(i("#idz_avatar_status").addClass("idz_offline").removeClass("idz_online").html(n.T("HORS_LIGNE")),i("#idz_status_msg").html(n.T("BONJOUR_AUCUN_CONSEILLER_EST_DISPONIBLE_POUR_VOUS_REPONDRE"))),i(".idz_widget").length&&(i("#button_offline").length&&i("#button_offline").is(":hidden")?0==n.preferences.param_noconnectedwidget?(i("#button_offline").show(),i("#button_online").hide()):(i("#button_offline").hide(),i("#button_online").hide()):i("#button_online").hide()),i(".idz_chatwidget").length&&i(".idz_chatwidget").hide()),1==n.c2vOffline&&(i(".idz_c2vwidget").length&&i(".idz_c2vwidget").hide(),0==n.preferences.param_visio_noconnectedwidget?(i("#visio_button_offline,.visio_button_offline").show(),i("#visio_button_online,.visio_button_offline").hide()):(i("#visio_button_offline,.visio_button_offline").hide(),i("#visio_button_online,.visio_button_offline").hide()))},n.logMailer=f.info,n.errorMailer=f.error,void 0===n.Utils&&(n.Utils={}),n.Utils.errorMailer=n.errorMailer,n.connection=h.getConnection()}}(iAdvize,iAdvize.$)},{}],2:[function(t,e,n){!function(t){function e(e){var n=e||window.event,i=[].slice.call(arguments,1),r=0,o=0,a=0,e=t.event.fix(n);return e.type="mousewheel",n.wheelDelta&&(r=n.wheelDelta/120),n.detail&&(r=-n.detail/3),a=r,void 0!==n.axis&&n.axis===n.HORIZONTAL_AXIS&&(a=0,o=-1*r),void 0!==n.wheelDeltaY&&(a=n.wheelDeltaY/120),void 0!==n.wheelDeltaX&&(o=-1*n.wheelDeltaX/120),i.unshift(e,r,o,a),(t.event.dispatch||t.event.handle).apply(this,i)}var n=["DOMMouseScroll","mousewheel"];if(t.event.fixHooks)for(var i=n.length;i;)t.event.fixHooks[n[--i]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=n.length;t;)this.addEventListener(n[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=n.length;t;)this.removeEventListener(n[--t],e,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}(iAdvize.$),function(t,e,n){t.fn.jScrollPane=function(i){function r(i,r){function o(e){var r,s,u,d,h,f,m=!1,v=!1;if(B=e,H===n)h=i.scrollTop(),f=i.scrollLeft(),i.css({overflow:"hidden",padding:0}),F=i.innerWidth()+yt,$=i.innerHeight(),i.width(F),H=t('<div class="jspPane" />').css("padding",_t).append(i.children()),V=t('<div class="jspContainer" />').css({width:F+"px",height:$+"px"}).append(H).appendTo(i);else{if(i.css("width",""),m=B.stickToBottom&&E(),v=B.stickToRight&&j(),d=i.innerWidth()+yt!=F||i.outerHeight()!=$,d&&(F=i.innerWidth()+yt,$=i.innerHeight(),V.css({width:F+"px",height:$+"px"})),!d&&bt==W&&H.outerHeight()==J)return void i.width(F);bt=W,H.css("width",""),i.width(F),V.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}H.css("overflow","auto"),W=e.contentWidth?e.contentWidth:H[0].scrollWidth,J=H[0].scrollHeight,H.css("overflow",""),G=W/F,X=J/$,Q=X>1,Y=G>1,Y||Q?(i.addClass("jspScrollable"),r=B.maintainPosition&&(tt||it),r&&(s=O(),u=A()),a(),c(),l(),r&&(C(v?W-F:s,!1),T(m?J-$:u,!1)),N(),k(),U(),B.enableKeyboardNavigation&&D(),B.clickOnTrack&&p(),L(),B.hijackInternalLinks&&P()):(i.removeClass("jspScrollable"),H.css({top:0,width:V.width()-yt}),R(),M(),z(),g()),B.autoReinitialise&&!vt?vt=setInterval(function(){o(B)},B.autoReinitialiseDelay):!B.autoReinitialise&&vt&&clearInterval(vt),h&&i.scrollTop(0)&&T(h,!1),f&&i.scrollLeft(0)&&C(f,!1),i.trigger("jsp-initialised",[Y||Q])}function a(){Q&&(V.append(t('<div class="jspVerticalBar" />').append(t('<div class="jspCap jspCapTop" />'),t('<div class="jspTrack" />').append(t('<div class="jspDrag" />').append(t('<div class="jspDragTop" />'),t('<div class="jspDragBottom" />'))),t('<div class="jspCap jspCapBottom" />'))),rt=V.find(">.jspVerticalBar"),ot=rt.find(">.jspTrack"),K=ot.find(">.jspDrag"),B.showArrows&&(ut=t('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",h(0,-1)).bind("click.jsp",I),lt=t('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",h(0,1)).bind("click.jsp",I),B.arrowScrollOnHover&&(ut.bind("mouseover.jsp",h(0,-1,ut)),lt.bind("mouseover.jsp",h(0,1,lt))),d(ot,B.verticalArrowPositions,ut,lt)),st=$,V.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){st-=t(this).outerHeight()}),K.hover(function(){K.addClass("jspHover")},function(){K.removeClass("jspHover")}).bind("mousedown.jsp",function(e){t("html").bind("dragstart.jsp selectstart.jsp",I),K.addClass("jspActive");var n=e.pageY-K.position().top;return t("html").bind("mousemove.jsp",function(t){v(t.pageY-n,!1)}).bind("mouseup.jsp mouseleave.jsp",m),!1}),s())}function s(){ot.height(st+"px"),tt=0,at=B.verticalGutter+ot.outerWidth(),H.width(F-at-yt);try{0===rt.position().left&&H.css("margin-left",at+"px")}catch(t){}}function c(){Y&&(V.append(t('<div class="jspHorizontalBar" />').append(t('<div class="jspCap jspCapLeft" />'),t('<div class="jspTrack" />').append(t('<div class="jspDrag" />').append(t('<div class="jspDragLeft" />'),t('<div class="jspDragRight" />'))),t('<div class="jspCap jspCapRight" />'))),dt=V.find(">.jspHorizontalBar"),ht=dt.find(">.jspTrack"),et=ht.find(">.jspDrag"),B.showArrows&&(gt=t('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",h(-1,0)).bind("click.jsp",I),mt=t('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",h(1,0)).bind("click.jsp",I),B.arrowScrollOnHover&&(gt.bind("mouseover.jsp",h(-1,0,gt)),mt.bind("mouseover.jsp",h(1,0,mt))),d(ht,B.horizontalArrowPositions,gt,mt)),et.hover(function(){et.addClass("jspHover")},function(){et.removeClass("jspHover")}).bind("mousedown.jsp",function(e){t("html").bind("dragstart.jsp selectstart.jsp",I),et.addClass("jspActive");var n=e.pageX-et.position().left;return t("html").bind("mousemove.jsp",function(t){y(t.pageX-n,!1)}).bind("mouseup.jsp mouseleave.jsp",m),!1}),ft=V.innerWidth(),u())}function u(){V.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){ft-=t(this).outerWidth()}),ht.width(ft+"px"),it=0}function l(){if(Y&&Q){var e=ht.outerHeight(),n=ot.outerWidth();st-=e,t(dt).find(">.jspCap:visible,>.jspArrow").each(function(){ft+=t(this).outerWidth()}),ft-=n,$-=n,F-=e,ht.parent().append(t('<div class="jspCorner" />').css("width",e+"px")),s(),u()}Y&&H.width(V.outerWidth()-yt+"px"),J=H.outerHeight(),X=J/$,Y&&(pt=Math.ceil(1/G*ft),pt>B.horizontalDragMaxWidth?pt=B.horizontalDragMaxWidth:pt<B.horizontalDragMinWidth&&(pt=B.horizontalDragMinWidth),et.width(pt+"px"),nt=ft-pt,b(it)),Q&&(ct=Math.ceil(1/X*st),ct>B.verticalDragMaxHeight?ct=B.verticalDragMaxHeight:ct<B.verticalDragMinHeight&&(ct=B.verticalDragMinHeight),K.height(ct+"px"),Z=st-ct,_(tt))}function d(t,e,n,i){var r,o="before",a="after";"os"==e&&(e=/Mac/.test(navigator.platform)?"after":"split"),e==o?a=e:e==a&&(o=e,r=n,n=i,i=r),t[o](n)[a](i)}function h(t,e,n){return function(){return f(t,e,this,n),this.blur(),!1}}function f(e,n,i,r){i=t(i).addClass("jspActive");var o,a,s=!0,c=function(){0!==e&&wt.scrollByX(e*B.arrowButtonSpeed),0!==n&&wt.scrollByY(n*B.arrowButtonSpeed),a=setTimeout(c,s?B.initialDelay:B.arrowRepeatFreq),s=!1};c(),o=r?"mouseout.jsp":"mouseup.jsp",r=r||t("html"),r.bind(o,function(){i.removeClass("jspActive"),a&&clearTimeout(a),a=null,r.unbind(o)})}function p(){g(),Q&&ot.bind("mousedown.jsp",function(e){if(e.originalTarget===n||e.originalTarget==e.currentTarget){var i,r=t(this),o=r.offset(),a=e.pageY-o.top-tt,s=!0,c=function(){var t=r.offset(),n=e.pageY-t.top-ct/2,o=$*B.scrollPagePercent,l=Z*o/(J-$);if(a<0)tt-l>n?wt.scrollByY(-o):v(n);else{if(!(a>0))return void u();tt+l<n?wt.scrollByY(o):v(n)}i=setTimeout(c,s?B.initialDelay:B.trackClickRepeatFreq),s=!1},u=function(){i&&clearTimeout(i),i=null,t(document).unbind("mouseup.jsp",u)};return c(),t(document).bind("mouseup.jsp",u),!1}}),Y&&ht.bind("mousedown.jsp",function(e){if(e.originalTarget===n||e.originalTarget==e.currentTarget){var i,r=t(this),o=r.offset(),a=e.pageX-o.left-it,s=!0,c=function(){var t=r.offset(),n=e.pageX-t.left-pt/2,o=F*B.scrollPagePercent,l=nt*o/(W-F);if(a<0)it-l>n?wt.scrollByX(-o):y(n);else{if(!(a>0))return void u();it+l<n?wt.scrollByX(o):y(n)}i=setTimeout(c,s?B.initialDelay:B.trackClickRepeatFreq),s=!1},u=function(){i&&clearTimeout(i),i=null,t(document).unbind("mouseup.jsp",u)};return c(),t(document).bind("mouseup.jsp",u),!1}})}function g(){ht&&ht.unbind("mousedown.jsp"),ot&&ot.unbind("mousedown.jsp")}function m(){
t("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),K&&K.removeClass("jspActive"),et&&et.removeClass("jspActive")}function v(t,e){Q&&(t<0?t=0:t>Z&&(t=Z),e===n&&(e=B.animateScroll),e?wt.animate(K,"top",t,_):(K.css("top",t),_(t)))}function _(t){t===n&&(t=K.position().top),V.scrollTop(0),tt=t;var e=0===tt,r=tt==Z,o=t/Z,a=-o*(J-$);xt==e&&Ct==r||(xt=e,Ct=r,i.trigger("jsp-arrow-change",[xt,Ct,Tt,St])),w(e,r),H.css("top",a),i.trigger("jsp-scroll-y",[-a,e,r]).trigger("scroll")}function y(t,e){Y&&(t<0?t=0:t>nt&&(t=nt),e===n&&(e=B.animateScroll),e?wt.animate(et,"left",t,b):(et.css("left",t),b(t)))}function b(t){t===n&&(t=et.position().left),V.scrollTop(0),it=t;var e=0===it,r=it==nt,o=t/nt,a=-o*(W-F);Tt==e&&St==r||(Tt=e,St=r,i.trigger("jsp-arrow-change",[xt,Ct,Tt,St])),x(e,r),H.css("left",a),i.trigger("jsp-scroll-x",[-a,e,r]).trigger("scroll")}function w(t,e){B.showArrows&&(ut[t?"addClass":"removeClass"]("jspDisabled"),lt[e?"addClass":"removeClass"]("jspDisabled"))}function x(t,e){B.showArrows&&(gt[t?"addClass":"removeClass"]("jspDisabled"),mt[e?"addClass":"removeClass"]("jspDisabled"))}function T(t,e){v(t/(J-$)*Z,e)}function C(t,e){y(t/(W-F)*nt,e)}function S(e,n,i){var r,o,a,s,c,u,l,d,h,f=0,p=0;try{r=t(e)}catch(t){return}for(o=r.outerHeight(),a=r.outerWidth(),V.scrollTop(0),V.scrollLeft(0);!r.is(".jspPane");)if(f+=r.position().top,p+=r.position().left,r=r.offsetParent(),/^body|html$/i.test(r[0].nodeName))return;s=A(),u=s+$,f<s||n?d=f-B.verticalGutter:f+o>u&&(d=f-$+o+B.verticalGutter),d&&T(d,i),c=O(),l=c+F,p<c||n?h=p-B.horizontalGutter:p+a>l&&(h=p-F+a+B.horizontalGutter),h&&C(h,i)}function O(){return-H.position().left}function A(){return-H.position().top}function E(){var t=J-$;return t>20&&t-A()<10}function j(){var t=W-F;return t>20&&t-O()<10}function k(){V.unbind(At).bind(At,function(t,e,n,i){var r=it,o=tt;return wt.scrollBy(n*B.mouseWheelSpeed,-i*B.mouseWheelSpeed,!1),r==it&&o==tt})}function R(){V.unbind(At)}function I(){return!1}function N(){H.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(t){S(t.target,!1)})}function M(){H.find(":input,a").unbind("focus.jsp")}function D(){function e(){var t=it,e=tt;switch(n){case 40:wt.scrollByY(B.keyboardSpeed,!1);break;case 38:wt.scrollByY(-B.keyboardSpeed,!1);break;case 34:case 32:wt.scrollByY($*B.scrollPagePercent,!1);break;case 33:wt.scrollByY(-$*B.scrollPagePercent,!1);break;case 39:wt.scrollByX(B.keyboardSpeed,!1);break;case 37:wt.scrollByX(-B.keyboardSpeed,!1)}return r=t!=it||e!=tt}var n,r,o=[];Y&&o.push(dt[0]),Q&&o.push(rt[0]),H.focus(function(){i.focus()}),i.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(i){if(i.target===this||o.length&&t(i.target).closest(o).length){var a=it,s=tt;switch(i.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:n=i.keyCode,e();break;case 35:T(J-$),n=null;break;case 36:T(0),n=null}return!(r=i.keyCode==n&&a!=it||s!=tt)}}).bind("keypress.jsp",function(t){return t.keyCode==n&&e(),!r}),B.hideFocus?(i.css("outline","none"),"hideFocus"in V[0]&&i.attr("hideFocus",!0)):(i.css("outline",""),"hideFocus"in V[0]&&i.attr("hideFocus",!1))}function z(){i.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp")}function L(){if(location.hash&&location.hash.length>1){var e,n,i=escape(location.hash.substr(1));try{e=t("#"+i+', a[name="'+i+'"]')}catch(t){return}e.length&&H.find(i)&&(0===V.scrollTop()?n=setInterval(function(){V.scrollTop()>0&&(S(e,!0),t(document).scrollTop(V.position().top),clearInterval(n))},50):(S(e,!0),t(document).scrollTop(V.position().top)))}}function P(){t(document.body).data("jspHijack")||(t(document.body).data("jspHijack",!0),t(document.body).delegate("a[href*=#]","click",function(n){var i,r,o,a,s,c,u=this.href.substr(0,this.href.indexOf("#")),l=location.href;if(location.href.indexOf("#")!==-1&&(l=location.href.substr(0,location.href.indexOf("#"))),u===l){i=escape(this.href.substr(this.href.indexOf("#")+1));try{r=t("#"+i+', a[name="'+i+'"]')}catch(t){return}r.length&&(o=r.closest(".jspScrollable"),a=o.data("jsp"),a.scrollToElement(r,!0),o[0].scrollIntoView&&(s=t(e).scrollTop(),((c=r.offset().top)<s||c>s+t(e).height())&&o[0].scrollIntoView()),n.preventDefault())}}))}function U(){var t,e,n,i,r,o=!1;V.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(a){var s=a.originalEvent.touches[0];t=O(),e=A(),n=s.pageX,i=s.pageY,r=!1,o=!0}).bind("touchmove.jsp",function(a){if(o){var s=a.originalEvent.touches[0],c=it,u=tt;return wt.scrollTo(t+n-s.pageX,e+i-s.pageY),r=r||Math.abs(n-s.pageX)>5||Math.abs(i-s.pageY)>5,c==it&&u==tt}}).bind("touchend.jsp",function(t){o=!1}).bind("click.jsp-touchclick",function(t){if(r)return r=!1,!1})}function q(){var t=A(),e=O();i.removeClass("jspScrollable").unbind(".jsp"),i.replaceWith(Ot.append(H.children())),Ot.scrollTop(t),Ot.scrollLeft(e),vt&&clearInterval(vt)}var B,H,F,$,V,W,J,G,X,Q,Y,K,Z,tt,et,nt,it,rt,ot,at,st,ct,ut,lt,dt,ht,ft,pt,gt,mt,vt,_t,yt,bt,wt=this,xt=!0,Tt=!0,Ct=!1,St=!1,Ot=i.clone(!1,!1).empty(),At=t.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";_t=i.css("paddingTop")+" "+i.css("paddingRight")+" "+i.css("paddingBottom")+" "+i.css("paddingLeft"),yt=(parseInt(i.css("paddingLeft"),10)||0)+(parseInt(i.css("paddingRight"),10)||0),t.extend(wt,{reinitialise:function(e){e=t.extend({},B,e),o(e)},scrollToElement:function(t,e,n){S(t,e,n)},scrollTo:function(t,e,n){C(t,n),T(e,n)},scrollToX:function(t,e){C(t,e)},scrollToY:function(t,e){T(t,e)},scrollToPercentX:function(t,e){C(t*(W-F),e)},scrollToPercentY:function(t,e){T(t*(J-$),e)},scrollBy:function(t,e,n){wt.scrollByX(t,n),wt.scrollByY(e,n)},scrollByX:function(t,e){y((O()+Math[t<0?"floor":"ceil"](t))/(W-F)*nt,e)},scrollByY:function(t,e){v((A()+Math[t<0?"floor":"ceil"](t))/(J-$)*Z,e)},positionDragX:function(t,e){y(t,e)},positionDragY:function(t,e){v(t,e)},animate:function(t,e,n,i){var r={};r[e]=n,t.animate(r,{duration:B.animateDuration,easing:B.animateEase,queue:!1,step:i})},getContentPositionX:function(){return O()},getContentPositionY:function(){return A()},getContentWidth:function(){return W},getContentHeight:function(){return J},getPercentScrolledX:function(){return O()/(W-F)},getPercentScrolledY:function(){return A()/(J-$)},getIsScrollableH:function(){return Y},getIsScrollableV:function(){return Q},getContentPane:function(){return H},scrollToBottom:function(t){v(Z,t)},hijackInternalLinks:t.noop,destroy:function(){q()}}),o(r)}return i=t.extend({},t.fn.jScrollPane.defaults,i),t.each(["mouseWheelSpeed","arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){i[this]=i[this]||i.speed}),this.each(function(){var e=t(this),n=e.data("jsp");n?n.reinitialise(i):(t("script",e).filter('[type="text/javascript"],:not([type])').remove(),n=new r(e,i),e.data("jsp",n))})},t.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:n,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:0,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8}}(iAdvize.$,this)},{}],3:[function(t,e,n){iAdvize.define("livechat/call",function(t,e){var n=iAdvize,i=(n.$,t("livechat/call/service")),r=t("livechat/call/view"),o=t("livechat/call/event");!function(){r.init({CallEvent:o}),o.init({CallView:r,CallService:i})}(),e.Service=i,e.View=r,e.Event=o})},{}],4:[function(t,e,n){iAdvize.define("livechat/call/event",function(t,e){function n(){return s.closeC2cPopin(),!1}function i(t){return t.stopPropagation(),l("#c2cpopin_flag_list").show(),!1}function r(){l("body").unbind("click.clickoutsideCountry"),l("#c2cpopin_flag_list").is(":visible")&&l("#c2cpopin_flag_list").fadeOut()}function o(){var t=u.Templates.buildC2cPopin,e=u.call.countries,n=l(this).attr("id");return s.updateSelectedCountryC2c(n,t,e),l("#c2cpopin_flag_list").is(":visible")&&l("#c2cpopin_flag_list").fadeOut(),!1}function a(){return l(this).hasClass("c2cpopin_phone_default")&&l(this).removeClass("c2cpopin_phone_default"),!1}var s,c,u=iAdvize,l=u.$,d=t("eventManager");e.init=function(t){s=t.CallView,c=t.CallService,d.on("call.popin.open",s.showC2cPopin)},e.bindEvents=function(t){t.find("#c2cpopin_close").click(n),t.find(".c2cpopin_call").off("click").click(c.onMakeCall),t.find("#c2cpopin_flag_selector").click(i),l("body").bind("click.clickoutsideCountry",r),t.find("#c2cpopin_flag_list li").click(o),t.find("#c2cpopin_phone").focus(a)}})},{}],5:[function(t,e,n){iAdvize.define("livechat/call/service",function(t,e){function n(t,e){if(!a.ringing){a.activeCall=t,a.ringing=!0;var n=void 0!==window.idzCustomData?idzCustomData:{};s.each(n,function(t,e){"city_cp"==t?n.city=e:"name_firstname"==t?n.name=e:"extID"==t&&(n.extid=e)});var i={customData:n},r=a.routing.enabled?"c2c_routing.php":"c2c.php";c.connect().done(function(){a.util.addScript("IDZc2cCall",a.chaturl+"rpc/"+r+"?sid="+a.website_id+"&oid="+a.c2coperator.id+"&vphone="+encodeURIComponent(t)+"&u="+a.vuid+"&visitorCountryCode="+e+"&visitorLocale="+a.visitor.locale+"&dep="+a.forceDep+"&vnick="+Strophe.getBareJidFromJid(c.getConnection().jid)+"&forcedLang="+a.forcedLang+"&"+s.param(i))})}}function i(t,e,n){var i=void 0!==window.idzCustomData?idzCustomData:{};s.each(i,function(t,e){"city_cp"==t?i.city=e:"name_firstname"==t?i.name=e:"extID"==t&&(i.extid=e)});var r={customData:i};c.connect().done(function(){a.util.addScript("IDZc2cCall",a.chaturl+"rpc/c2c_routing_operator.php?sid="+a.website_id+"&operator="+t+"&vphone="+encodeURIComponent(e)+"&u="+a.vuid+"&visitorCountryCode="+n+"&visitorLocale="+a.visitor.locale+"&dep="+a.forceDep+"&vnick="+Strophe.getBareJidFromJid(c.getConnection().jid)+"&forcedLang="+a.forcedLang+"&"+s.param(r))})}function r(t,e){s("#c2cpopin_step1").hide(),s("#c2cpopin_step2").show(),n(t,e)}function o(t,e){var n,i,r=a.call.countries[e];if(!r)throw new Error("Unknown country or not referenced in the countries list");if(r.number_pattern&&(n=new RegExp(r.number_pattern),!n.test(t)))throw new Error("The given phone number format is unknown");return i=parseInt(r.zero_prefixed,10),i&&(t=t.substr(1)),"+"+r.calling_code+t}var a=iAdvize,s=a.$,c=t("xmpp"),u=t("eventManager");u.on("call.phone.format.validated",r),u.on("call.phone.callOperator",i),e.onMakeCall=function(){var t=s("#c2cpopin_phone").val(),e=s("#c2cpopin_flag_selector div").attr("rel");try{if(!t)throw new Error("No phone number provided");phoneNumber=o(t,e)}catch(t){return a.chat.showC2cError(a.T("INVALID_PHONE_NUMBER"))}return s("#c2cpopin_step1").removeClass("c2cpopin_error"),u.emit("call.phone.format.validated",phoneNumber,e),!1},e.onCallOperator=function(t){var e=(a.activeCall,s("#c2cpopin_flag_selector div").attr("rel"));return u.emit("call.phone.callOperator",t,phoneNumber,e),!1},e.onPhoneValidated=r,e.getInternationalPhoneNumberFormat=o})},{}],6:[function(t,e,n){iAdvize.define("livechat/call/view",function(t,e){function n(t,e){var n,r,o=[],a=[];for(n in t)r=t[n],o.push(i(r,e)),a.push(r);return u=a.shift(),"<ul>"+o.join("")+"</ul>"}function i(t,e){return e.replace(/{([\s\S]+?)}/g,function(e,n){return t[n]||""})}function r(t,e,i){var r,o,a=d(window).height();t?(r=n(e,i),o=l.Templates.buildC2cPopin(r)):o=l.Templates.c2cPopin;var s=d(o);return l.Templates.buildC2cPopin&&s.find("#c2cpopin_flag_list .flag").hide(),s.find("#c2coverlay").css({height:a}),s}function o(){var t=d(window).height();d("#c2coverlay").css({height:t}),d("#c2coverlay").show(),d("#c2cpopin").show()}function a(){d("#idzc2c").remove()}function s(t,e,n){var i,r,o=d("#c2cpopin_flag_selector div"),a=o.find("img"),s="";t&&"string"==typeof t&&(t=t.toLowerCase()),n[t]||(t=l.curlang,n[t]||(t=u.country_code)),o.removeClass().addClass("flag flag_"+t),o.attr({rel:t}),e&&(r=n[t].icon_path,o.css("background","none"),i=a.data("basepath")||"",s=i+r,a.attr("src",s))}var c,u,l=iAdvize,d=l.$,h=t("xmpp"),f=t("eventManager");e.init=function(t){c=t.CallEvent},e.updateSelectedCountryC2c=s,e.showC2cPopin=function(){var t,e=l.Templates.buildC2cPopin,n=l.call.countries,i=l.Templates.countryItemTemplate;if(l.ringing=!1,l.chat.connected||h.connect(),d("#c2cpopin").length>0)o();else{var a=r(e,n,i);c.bindEvents(a),a.appendTo("body")}l.visitor.country&&(t=l.visitor.country),s(t,e,n),l.callInstant.available||d("#c2cpopin_step1 .c2cpopin_call").hide(),f.emit("call.popin.open.after")},e.closeC2cPopin=function(){l.ringing=!1,a(),d("#c2coverlay").hide(),d("#c2cpopin").hide()},e.showC2cError=function(t){clearTimeout(l.c2cTimeout),this.showC2cPopin(),d("#c2cpopin_step2").hide(),d("#c2cpopin_step1").show(),d("#c2cpopin_step1").addClass("c2cpopin_error"),d(".c2cpopin_label_error").attr("style","").html(l.util.htmlspecialchars(t))},e.showC2cBusyMessage=function(t){this.showC2cPopin(),d("#c2cpopin_step2").hide(),d("#c2cpopin_step1").show(),d("#c2cpopin_step1").addClass("c2cpopin_error"),d(".c2cpopin_label_error").html(l.util.htmlspecialchars(t)).css("color","black")},e.resetC2cPopin=a})},{}],7:[function(t,e,n){"use strict";e.exports=t("./lib/emojisService.js")},{"./lib/emojisService.js":9}],8:[function(t,e,n){"use strict";e.exports={"<3":"heavy-black-heart","</3":"broken-heart",":)":"slightly-smiling-face","(:":"slightly-smiling-face",":-)":"slightly-smiling-face","C:":"grinning-face","c:":"grinning-face",":D":"grinning-face",":-D":"grinning-face",";)":"winking-face",";-)":"winking-face","):":"slightly-frowning-face",":(":"slightly-frowning-face",":-(":"slightly-frowning-face",":'(":"crying-face","=)":"smiling-face-with-open-mouth","=-)":"smiling-face-with-open-mouth",":*":"kissing-face",":-*":"kissing-face",":>":"grinning-face",":->":"grinning-face","8)":"smiling-face-with-sunglasses",":\\":"confused-face",":-\\":"confused-face",":/":"confused-face",":-/":"confused-face",":|":"neutral-face",":-|":"neutral-face",":O":"face-with-open-mouth",":-o":"face-with-open-mouth",">:(":"angry-face",">:-(":"angry-face",":-p":"face-with-stuck-out-tongue",":P":"face-with-stuck-out-tongue",":-P":"face-with-stuck-out-tongue",":-b":"face-with-stuck-out-tongue",";p":"face-with-stuck-out-tongue-and-winking-eye",";-p":"face-with-stuck-out-tongue-and-winking-eye",";b":"face-with-stuck-out-tongue-and-winking-eye",";-b":"face-with-stuck-out-tongue-and-winking-eye",";P":"face-with-stuck-out-tongue-and-winking-eye",";-P":"face-with-stuck-out-tongue-and-winking-eye",":o)":"monkey-face","D:":"anguished-face",":fu:":"reversed-hand-with-middle-finger-extended",xD:"rolling-on-the-floor-laughing"}},{}],9:[function(t,e,n){"use strict";function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var r=t("lodash"),o=t("emoji-aware").split,a=t("store"),s=t("./aliases.js");e.exports=function(t){var e=r.get(t,"baseUrl","/"),n=r.chain(r.clone(s)).mapKeys(function(t,e){return e.replace("\\","\\\\").replace(")","\\)").replace(":","\\:").replace(";","\\;").replace("-","\\-").replace("*","\\*").replace("|","\\|").replace("(","\\(").replace("/","\\/")}).keys().value().join("|"),c=new RegExp("(\\s|^)("+n+")(?:(?=\\s|$))","mg"),u={recents:"idz-icon-emojis-recent",people:"idz-icon-emojis-people",nature:"idz-icon-emojis-animals-plants","food-drink":"idz-icon-emojis-food",objects:"idz-icon-emojis-objects","travel-places":"idz-icon-emojis-car",activity:"idz-icon-emojis-activity",symbols:"idz-icon-emojis-symbols",flags:"idz-icon-emojis-flag"},l={},d={},h={},f={},p={},g=function(t){for(var e=0,n=0,i=0,r=[];e<t.length;)n=t.charCodeAt(e++),i?(r.push((65536+(i-55296<<10)+(n-56320)).toString(16)),i=0):55296<=n&&n<=56319?i=n:r.push(n.toString(16));return r.join("-")},m=function(t,n){var i=f[t][n];return e+"/"+t+"/"+i.category+"/"+n+".png"},v=function(t){return e+"/"+t+"/"+t+".png"},_=function(t){return e+"/"+t+"/"+t+".json"},y=function(t){var e=r.get(a.get("emojis"),t,{name:"recents",emojis:[{char:"no recent",shortname:"noRecent",category:"recent",count:0}],fullName:"Recents"});return e.emojis=r.chain(e.emojis).sortBy(function(t){return t.count}).reverse().value(),e},b=function(t,e){var n=a.get("emojis"),o=y(t).emojis;r.remove(o,{shortname:"noRecent"}),r.findIndex(o,function(t){return t.unicode===e.unicode})===-1?o=o.concat({shortname:e.shortname,char:e.char,category:"recent",count:1,unicode:e.unicode}):r.find(o,function(t){return t.unicode===e.unicode}).count+=1,r.size(o)>14&&(o=r.chain(o).sortBy("count").drop().value()),a.set("emojis",r.assign({},n,i({},t,r.assign(y(t),{emojis:o}))))},w=function(t,e){var n=l[t]||{};return e&&(n=r.assign(n,{recents:y(t)})),n},x=function(t,e){return l[t]=r.merge(l[t]||{},e),T(t,e),l[t]},T=function(t,e){h[t]={},d[t]={},f[t]={},p[t]={},r.each(e,function(e){"recents"!==e.name&&r.each(e.emojis,function(e){h[t][e.unicode]=e.shortname,d[t][e.shortname]=e.char,f[t][e.shortname]=e,p[t][e.unicode]=e,r.has(e,"modifiers")&&r.each(e.modifiers,function(e){h[t][e.unicode]=e.shortname,d[t][e.shortname]=e.char,f[t][e.shortname]=e,p[t][e.unicode]=e})})})},C=function(t){return r.has(l,t)},S=function(t,e){var n=o(e);return n===!1?O(e):(n=r.map(n,function(e){var n=g(e);return r.has(p[t],n)?":"+h[t][n]+":":r.has(p.apple,n)?":"+h.apple[n]+":":e}),O(n.join("")))},O=function(t){return t.replace(c,function(t,e,n){return e+":"+s[n]+":"})},A=function(t,e,n){var i='<img src="<%url%>" data-char="<%char%>" data-shortname="<%shortname%>" class="emoji idzEmoji'+(n?" emojiBig":"")+'" alt="<%char%>"/>';return e=e.replace(/:([a-z0-9-]+):/gm,function(e,n){var o=e;return r.has(d.apple,n)&&(o=i.replace(/<%char%>/g,d.apple[n]).replace(/<%url%>/g,m("apple",n)).replace(/<%shortname%>/g,n)),r.has(d[t],n)&&(o=i.replace(/<%char%>/g,d[t][n]).replace(/<%url%>/g,m(t,n)).replace(/<%shortname%>/g,n)),o})},E=function(t,e){var n=o(e),i=n&&1===n.length;return A(t,S(t,e),i)},j=function(t,e){var n=O(e);return n=n.replace(/:([a-z0-9-]+):/gm,function(e,n){var i=e;return r.has(d.apple,n)&&(i=d.apple[n]),r.has(d[t],n)&&(i=d[t][n]),i})},k=function(){return u};return{getUnicode:g,getEmojiUrl:m,getSpriteUrl:v,getJSONUrl:_,getHistory:y,updateHistory:b,getEmojis:w,setEmojis:x,hasTheme:C,getIcons:k,replaceUtf8ToImage:E,replaceUtf8ToShortname:S,replaceAliasesToShortname:O,replaceShortnameToImage:A,replaceShortnameToUtf8:j}}},{"./aliases.js":8,"emoji-aware":15,lodash:28,store:60}],10:[function(t,e,n){e.exports=function(t){t.addConnectionPlugin("fileupload",{connection:null,init:function(t){this.connection=t},requestSlot:function(e,n,i,r){var o=$iq({id:this.connection.getUniqueId(),from:this.connection.jid,to:"upload."+t.getDomainFromJid(this.connection.jid),type:"get"}).c("request",{xmlns:"urn:xmpp:http:upload"}).c("filename",{},e.name).c("size",{},e.size).c("content-type",{},e.contentType);this.connection.sendIQ(o,n,i,r)}})}},{}],11:[function(t,e,n){var i,r,o={}.hasOwnProperty,a=function(t,e){return function(){return t.apply(e,arguments)}};Strophe.addConnectionPlugin("muc",{_connection:null,rooms:{},roomNames:[],init:function(t){return this._connection=t,this._muc_handler=null,Strophe.addNamespace("MUC_OWNER",Strophe.NS.MUC+"#owner"),Strophe.addNamespace("MUC_ADMIN",Strophe.NS.MUC+"#admin"),Strophe.addNamespace("MUC_USER",Strophe.NS.MUC+"#user"),Strophe.addNamespace("MUC_ROOMCONF",Strophe.NS.MUC+"#roomconfig"),Strophe.addNamespace("MUC_REGISTER","jabber:iq:register")},join:function(t,e,n,i,o,a,s,c){var u,l;return l=this.test_append_nick(t,e),u=$pres({from:this._connection.jid,to:l}).c("x",{xmlns:Strophe.NS.MUC}),null!=s&&(u=u.c("history",s).up()),null!=a&&u.cnode(Strophe.xmlElement("password",[],a)),null!=c&&u.up().cnode(c),null==this._muc_handler&&(this._muc_handler=this._connection.addHandler(function(e){return function(n){var i,r,o,a,s,c,u,l,d;if(!(i=n.getAttribute("from")))return!0;if(c=i.split("/")[0],!e.rooms[c])return!0;if(t=e.rooms[c],r={},"message"===n.nodeName)r=t._message_handlers;else if("presence"===n.nodeName&&(d=n.getElementsByTagName("x"),d.length>0))for(o=0,s=d.length;o<s;o++)if(u=d[o],(l=u.getAttribute("xmlns"))&&l.match(Strophe.NS.MUC)){r=t._presence_handlers;break}for(a in r)(0,r[a])(n,t)||delete r[a];return!0}}(this))),this.rooms.hasOwnProperty(t)||(this.rooms[t]=new r(this,t,e,a),i&&this.rooms[t].addHandler("presence",i),n&&this.rooms[t].addHandler("message",n),o&&this.rooms[t].addHandler("roster",o),this.roomNames.push(t)),this._connection.send(u)},leave:function(t,e,n,i){var r,o,a,s;return r=this.roomNames.indexOf(t),delete this.rooms[t],r>=0&&(this.roomNames.splice(r,1),0===this.roomNames.length&&(this._connection.deleteHandler(this._muc_handler),this._muc_handler=null)),s=this.test_append_nick(t,e),a=this._connection.getUniqueId(),o=$pres({type:"unavailable",id:a,from:this._connection.jid,to:s}),null!=i&&o.c("status",i),null!=n&&this._connection.addHandler(n,null,"presence",null,a),this._connection.send(o),a},message:function(t,e,n,i,r,o){var a,s,c;return c=this.test_append_nick(t,e),r=r||(null!=e?"chat":"groupchat"),o=o||this._connection.getUniqueId(),a=$msg({to:c,from:this._connection.jid,type:r,id:o}).c("body").t(n),a.up(),null!=i&&(a.c("html",{xmlns:Strophe.NS.XHTML_IM}).c("body",{xmlns:Strophe.NS.XHTML}).h(i),0===a.node.childNodes.length?(s=a.node.parentNode,a.up().up(),a.node.removeChild(s)):a.up().up()),a.c("x",{xmlns:"jabber:x:event"}).c("composing"),this._connection.send(a),o},groupchat:function(t,e,n,i){return this.message(t,null,e,n,void 0,i)},invite:function(t,e,n){var i,r;return r=this._connection.getUniqueId(),i=$msg({from:this._connection.jid,to:t,id:r}).c("x",{xmlns:Strophe.NS.MUC_USER}).c("invite",{to:e}),null!=n&&i.c("reason",n),this._connection.send(i),r},multipleInvites:function(t,e,n){var i,r,o,a,s;for(a=this._connection.getUniqueId(),r=$msg({from:this._connection.jid,to:t,id:a}).c("x",{xmlns:Strophe.NS.MUC_USER}),i=0,o=e.length;i<o;i++)s=e[i],r.c("invite",{to:s}),null!=n&&(r.c("reason",n),r.up()),r.up();return this._connection.send(r),a},directInvite:function(t,e,n,i){var r,o,a;return a=this._connection.getUniqueId(),r={xmlns:"jabber:x:conference",jid:t},null!=n&&(r.reason=n),null!=i&&(r.password=i),o=$msg({from:this._connection.jid,to:e,id:a}).c("x",r),this._connection.send(o),a},queryOccupants:function(t,e,n){var i,r;return i={xmlns:Strophe.NS.DISCO_ITEMS},r=$iq({from:this._connection.jid,to:t,type:"get"}).c("query",i),this._connection.sendIQ(r,e,n)},configure:function(t,e,n){var i,r;return i=$iq({to:t,type:"get"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}),r=i.tree(),this._connection.sendIQ(r,e,n)},cancelConfigure:function(t){var e,n;return e=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"cancel"}),n=e.tree(),this._connection.sendIQ(n)},saveConfiguration:function(t,e,n,i){var r,o,a,s,c;if(a=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}),void 0!==Strophe.x&&void 0!==Strophe.x.Form&&e instanceof Strophe.x.Form)e.type="submit",a.cnode(e.toXML());else for(a.c("x",{xmlns:"jabber:x:data",type:"submit"}),o=0,s=e.length;o<s;o++)r=e[o],a.cnode(r).up();return c=a.tree(),this._connection.sendIQ(c,n,i)},createInstantRoom:function(t,e,n){var i;return i=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),this._connection.sendIQ(i.tree(),e,n)},createConfiguredRoom:function(t,e,n,i){var r,a,s;a=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_OWNER}).c("x",{xmlns:"jabber:x:data",type:"submit"}),a.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#roomconfig").up().up();for(r in e)o.call(e,r)&&(s=e[r],a.c("field",{var:r}).c("value").t(s).up().up());return this._connection.sendIQ(a.tree(),n,i)},setTopic:function(t,e){var n;return n=$msg({to:t,from:this._connection.jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(e),this._connection.send(n.tree())},_modifyPrivilege:function(t,e,n,i,r){var o;return o=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_ADMIN}).cnode(e.node),null!=n&&o.c("reason",n),this._connection.sendIQ(o.tree(),i,r)},modifyRole:function(t,e,n,i,r,o){var a;return a=$build("item",{nick:e,role:n}),this._modifyPrivilege(t,a,i,r,o)},kick:function(t,e,n,i,r){return this.modifyRole(t,e,"none",n,i,r)},voice:function(t,e,n,i,r){return this.modifyRole(t,e,"participant",n,i,r)},mute:function(t,e,n,i,r){return this.modifyRole(t,e,"visitor",n,i,r)},op:function(t,e,n,i,r){return this.modifyRole(t,e,"moderator",n,i,r)},deop:function(t,e,n,i,r){return this.modifyRole(t,e,"participant",n,i,r)},modifyAffiliation:function(t,e,n,i,r,o){var a;return a=$build("item",{jid:e,affiliation:n}),this._modifyPrivilege(t,a,i,r,o)},ban:function(t,e,n,i,r){return this.modifyAffiliation(t,e,"outcast",n,i,r)},member:function(t,e,n,i,r){return this.modifyAffiliation(t,e,"member",n,i,r)},revoke:function(t,e,n,i,r){return this.modifyAffiliation(t,e,"none",n,i,r)},owner:function(t,e,n,i,r){return this.modifyAffiliation(t,e,"owner",n,i,r)},admin:function(t,e,n,i,r){return this.modifyAffiliation(t,e,"admin",n,i,r)},changeNick:function(t,e){var n,i;return i=this.test_append_nick(t,e),n=$pres({from:this._connection.jid,to:i,id:this._connection.getUniqueId()}),this._connection.send(n.tree())},setStatus:function(t,e,n,i){var r,o;return o=this.test_append_nick(t,e),r=$pres({from:this._connection.jid,to:o}),null!=n&&r.c("show",n).up(),null!=i&&r.c("status",i),this._connection.send(r.tree())},registrationRequest:function(t,e,n){var i;return i=$iq({to:t,from:this._connection.jid,type:"get"}).c("query",{xmlns:Strophe.NS.MUC_REGISTER}),this._connection.sendIQ(i,function(t){var n,i,r,o,a,s;for(i=t.getElementsByTagName("field"),i.length,o={required:[],optional:[]},a=0,s=i.length;a<s;a++)n=i[a],r={var:n.getAttribute("var"),label:n.getAttribute("label"),type:n.getAttribute("type")},n.getElementsByTagName("required").length>0?o.required.push(r):o.optional.push(r);return e(o)},n)},submitRegistrationForm:function(t,e,n,i){var r,o,a;r=$iq({to:t,type:"set"}).c("query",{xmlns:Strophe.NS.MUC_REGISTER}),r.c("x",{xmlns:"jabber:x:data",type:"submit"}),r.c("field",{var:"FORM_TYPE"}).c("value").t("http://jabber.org/protocol/muc#register").up().up();for(o in e)a=e[o],r.c("field",{var:o}).c("value").t(a).up().up();return this._connection.sendIQ(r,n,i)},listRooms:function(t,e,n){var i;return i=$iq({to:t,from:this._connection.jid,type:"get"}).c("query",{xmlns:Strophe.NS.DISCO_ITEMS}),this._connection.sendIQ(i,e,n)},test_append_nick:function(t,e){var n,i;return i=Strophe.escapeNode(Strophe.getNodeFromJid(t)),n=Strophe.getDomainFromJid(t),i+"@"+n+(null!=e?"/"+e:"")}}),r=function(){function t(t,e,n,i){this.client=t,this.name=e,this.nick=n,this.password=i,this._roomRosterHandler=a(this._roomRosterHandler,this),this._addOccupant=a(this._addOccupant,this),this.roster={},this._message_handlers={},this._presence_handlers={},this._roster_handlers={},this._handler_ids=0,this.client.muc&&(this.client=this.client.muc),this.name=Strophe.getBareJidFromJid(this.name),this.addHandler("presence",this._roomRosterHandler)}return t.prototype.join=function(t,e,n){return this.client.join(this.name,this.nick,t,e,n,this.password)},t.prototype.leave=function(t,e){return this.client.leave(this.name,this.nick,t,e),delete this.client.rooms[this.name]},t.prototype.message=function(t,e,n,i){return this.client.message(this.name,t,e,n,i)},t.prototype.groupchat=function(t,e){return this.client.groupchat(this.name,t,e)},t.prototype.invite=function(t,e){return this.client.invite(this.name,t,e)},t.prototype.multipleInvites=function(t,e){return this.client.invite(this.name,t,e)},t.prototype.directInvite=function(t,e){return this.client.directInvite(this.name,t,e,this.password)},t.prototype.configure=function(t){return this.client.configure(this.name,t)},t.prototype.cancelConfigure=function(){return this.client.cancelConfigure(this.name)},t.prototype.saveConfiguration=function(t){return this.client.saveConfiguration(this.name,t)},t.prototype.queryOccupants=function(t,e){return this.client.queryOccupants(this.name,t,e)},t.prototype.setTopic=function(t){return this.client.setTopic(this.name,t)},t.prototype.modifyRole=function(t,e,n,i,r){return this.client.modifyRole(this.name,t,e,n,i,r)},t.prototype.kick=function(t,e,n,i){return this.client.kick(this.name,t,e,n,i)},t.prototype.voice=function(t,e,n,i){return this.client.voice(this.name,t,e,n,i)},t.prototype.mute=function(t,e,n,i){return this.client.mute(this.name,t,e,n,i)},t.prototype.op=function(t,e,n,i){return this.client.op(this.name,t,e,n,i)},t.prototype.deop=function(t,e,n,i){return this.client.deop(this.name,t,e,n,i)},t.prototype.modifyAffiliation=function(t,e,n,i,r){return this.client.modifyAffiliation(this.name,t,e,n,i,r)},t.prototype.ban=function(t,e,n,i){return this.client.ban(this.name,t,e,n,i)},t.prototype.member=function(t,e,n,i){return this.client.member(this.name,t,e,n,i)},t.prototype.revoke=function(t,e,n,i){return this.client.revoke(this.name,t,e,n,i)},t.prototype.owner=function(t,e,n,i){return this.client.owner(this.name,t,e,n,i)},t.prototype.admin=function(t,e,n,i){return this.client.admin(this.name,t,e,n,i)},t.prototype.changeNick=function(t){return this.nick=t,this.client.changeNick(this.name,nick)},t.prototype.setStatus=function(t,e){return this.client.setStatus(this.name,this.nick,t,e)},t.prototype.addHandler=function(t,e){var n;switch(n=this._handler_ids++,t){case"presence":this._presence_handlers[n]=e;break;case"message":this._message_handlers[n]=e;break;case"roster":this._roster_handlers[n]=e;break;default:return this._handler_ids--,null}return n},t.prototype.removeHandler=function(t){return delete this._presence_handlers[t],delete this._message_handlers[t],delete this._roster_handlers[t]},t.prototype._addOccupant=function(t){var e;return e=new i(t,this),this.roster[e.nick]=e,e},t.prototype._roomRosterHandler=function(e){var n,i,r,o,a;switch(n=t._parsePresence(e),o=n.nick,r=n.newnick||null,n.type){case"error":return!0;case"unavailable":r&&(n.nick=r,this.roster[o]&&this.roster[r]&&(this.roster[o].update(this.roster[r]),this.roster[r]=this.roster[o]),this.roster[o]&&!this.roster[r]&&(this.roster[r]=this.roster[o].update(n))),delete this.roster[o];break;default:this.roster[o]?this.roster[o].update(n):this._addOccupant(n)}a=this._roster_handlers;for(i in a)(0,a[i])(this.roster,this)||delete this._roster_handlers[i];return!0},t._parsePresence=function(t){var e,n,i,r,o,a,s,c,u;for(i={},i.nick=Strophe.getResourceFromJid(t.getAttribute("from")),i.type=t.getAttribute("type"),i.states=[],c=t.childNodes,r=0,a=c.length;r<a;r++)switch(e=c[r],e.nodeName){case"status":i.status=e.textContent||null;break;case"show":i.show=e.textContent||null;break;case"x":if(e.getAttribute("xmlns")===Strophe.NS.MUC_USER)for(u=e.childNodes,o=0,s=u.length;o<s;o++)switch(n=u[o],n.nodeName){case"item":i.affiliation=n.getAttribute("affiliation"),i.role=n.getAttribute("role"),i.jid=n.getAttribute("jid"),i.newnick=n.getAttribute("nick");break;case"status":n.getAttribute("code")&&i.states.push(n.getAttribute("code"))}}return i},t}(),function(){function t(t){this.parse=a(this.parse,this),null!=t&&this.parse(t)}t.prototype.parse=function(t){var e,n,i,r,o,a,s,c,u,l,d,h,f;for(h=t.getElementsByTagName("query")[0].childNodes,this.identities=[],this.features=[],this.x=[],o=0,u=h.length;o<u;o++)switch(i=h[o],n=i.attributes,i.nodeName){case"identity":for(a={},s=0,l=n.length;s<l;s++)e=n[s],a[e.name]=e.textContent;this.identities.push(a);break;case"feature":this.features.push(i.getAttribute("var"));break;case"x":if("FORM_TYPE"===!i.childNodes[0].getAttribute("var")||"hidden"===!i.childNodes[0].getAttribute("type"))break;for(f=i.childNodes,c=0,d=f.length;c<d;c++)r=f[c],r.attributes.type||this.x.push({var:r.getAttribute("var"),label:r.getAttribute("label")||"",
value:r.firstChild.textContent||""})}return{identities:this.identities,features:this.features,x:this.x}},t}(),i=function(){function t(t,e){this.room=e,this.update=a(this.update,this),this.admin=a(this.admin,this),this.owner=a(this.owner,this),this.revoke=a(this.revoke,this),this.member=a(this.member,this),this.ban=a(this.ban,this),this.modifyAffiliation=a(this.modifyAffiliation,this),this.deop=a(this.deop,this),this.op=a(this.op,this),this.mute=a(this.mute,this),this.voice=a(this.voice,this),this.kick=a(this.kick,this),this.modifyRole=a(this.modifyRole,this),this.update(t)}return t.prototype.modifyRole=function(t,e,n,i){return this.room.modifyRole(this.nick,t,e,n,i)},t.prototype.kick=function(t,e,n){return this.room.kick(this.nick,t,e,n)},t.prototype.voice=function(t,e,n){return this.room.voice(this.nick,t,e,n)},t.prototype.mute=function(t,e,n){return this.room.mute(this.nick,t,e,n)},t.prototype.op=function(t,e,n){return this.room.op(this.nick,t,e,n)},t.prototype.deop=function(t,e,n){return this.room.deop(this.nick,t,e,n)},t.prototype.modifyAffiliation=function(t,e,n,i){return this.room.modifyAffiliation(this.jid,t,e,n,i)},t.prototype.ban=function(t,e,n){return this.room.ban(this.jid,t,e,n)},t.prototype.member=function(t,e,n){return this.room.member(this.jid,t,e,n)},t.prototype.revoke=function(t,e,n){return this.room.revoke(this.jid,t,e,n)},t.prototype.owner=function(t,e,n){return this.room.owner(this.jid,t,e,n)},t.prototype.admin=function(t,e,n){return this.room.admin(this.jid,t,e,n)},t.prototype.update=function(t){return this.nick=t.nick||null,this.affiliation=t.affiliation||null,this.role=t.role||null,this.jid=t.jid||null,this.status=t.status||null,this.show=t.show||null,this},t}()},{}],12:[function(t,e,n){e.exports=function(t){t.addConnectionPlugin("outofband",{_conn:null,init:function(e){this._conn=e,t.addNamespace("OUTOFBAND","jabber:iq:oob")},sendIq:function(e,n){var i=null;return $(e).filter("iq").each(function(){var e=$(this).find("url:first").text(),r=$(this).find("desc:first").text();switch(n){case null:i=$iq({to:$(this).attr("from"),from:$(this).attr("to"),type:"result",id:$(this).attr("id")});break;case"404":i=$iq({to:$(this).attr("from"),from:$(this).attr("to"),type:"error",id:$(this).attr("id")}).c("query",{xmlns:t.NS.OUTOFBAND}).c("url",{},e).c("desc",{},r).up().c("error",{code:"404",type:"cancel"}).c("item-not-found",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"});break;case"406":i=$iq({to:$(this).attr("from"),from:$(this).attr("to"),type:"error",id:$(this).attr("id")}).c("query",{xmlns:t.NS.OUTOFBAND}).c("url",{},e).c("desc",{},r).up().c("error",{code:"406",type:"modify"}).c("not-acceptable",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"});break;default:console.log("Unhandled errorcode: a response has not been sent")}}),i&&(console.log(i.toString()),this._conn.send(i)),i},sendUrl:function(e,n,i){var r=$iq({id:this._conn.getUniqueId(),type:"set",from:this._conn.jid,to:e}).c("query",{xmlns:t.NS.OUTOFBAND}).c("url",{},n).c("desc",{},i);this._conn.send(r)},addOutOfBandHandler:function(e,n,i,r){this._conn.addHandler(e,t.NS.OUTOFBAND,"iq",n,null,i,r)}})}},{}],13:[function(t,e,n){Strophe.addConnectionPlugin("receipts",{_conn:null,_msgQueue:{},_retries:{},_resendCount:10,_resendTime:9e3,_requestCallbacks:{},init:function(t){this._conn=t,Strophe.addNamespace("RECEIPTS","urn:xmpp:receipts")},statusChanged:function(t){if(t===Strophe.Status.CONNECTED||t===Strophe.Status.ATTACHED){var e=this;setTimeout(function(){e.resendQueue()},4e3)}},sendMessage:function(t,e,n){var i=t.tree().getAttribute("id");i||(i=+new Date,t.tree().setAttribute("id",i));var r=Strophe.xmlElement("request",{xmlns:Strophe.NS.RECEIPTS});return t.tree().appendChild(r),this._msgQueue[i]=t,this._retries[i]=0,(e||n)&&(this._requestCallbacks[i]=[e,n]),this._conn.send(t),n||this.resendMessage(i),i},resendMessage:function(t){var e=this;setTimeout(function(){if(e._msgQueue[t]){if(!e._conn.connected)return void e.resendMessage(t);if(++e._retries[t]>e._resendCount)return;e._msgQueue[t].tree().setAttribute("from",e._conn.jid),e._conn.send(e._msgQueue[t]),e.resendMessage(t)}},this._resendTime)},addReceiptHandler:function(t,e,n,i){var r=this,o=function(e){var n=t(e);return r._processReceipt(e,n),n};this._conn.addHandler(o,Strophe.NS.RECEIPTS,"message",e,null,n,i)},_processReceipt:function(t,e){var n=t.getAttribute("id"),i=t.getAttribute("from"),r=t.getElementsByTagName("request"),o=t.getElementsByTagName("received"),a="error"===t.getAttribute("type"),s=this;if(r.length>0&&!a&&(e&&"object"==typeof e&&"done"in e?e.done(function(){s.sendReceipt(i,n)}):this.sendReceipt(i,n)),o.length>0){var c=o[0].getAttribute("id");if(c&&(delete this._msgQueue[c],delete this._retries[c],c in this._requestCallbacks)){var u=this._requestCallbacks[c][a?1:0];u&&u.apply(null),delete this._requestCallbacks[c]}}},sendReceipt:function(t,e){var n=$msg({to:t,from:this._conn.jid,id:this._conn.getUniqueId()}),i=Strophe.xmlElement("received",{xmlns:Strophe.NS.RECEIPTS,id:e});n.tree().appendChild(i),this._conn.send(n)},resendQueue:function(){if(!this._conn.connected){var t=this;return void setTimeout(function(){t.resendQueue()},4e3)}for(var e in this._msgQueue)this._msgQueue.hasOwnProperty(e)&&(this._msgQueue[e].tree().setAttribute("from",this._conn.jid),this._conn.send(this._msgQueue[e]))},getUnreceivedMsgs:function(){var t=[];for(var e in this._msgQueue)this._msgQueue.hasOwnProperty(e)&&t.push(this._msgQueue[e]);return t},clearMessages:function(){this._msgQueue={}}})},{}],14:[function(t,n,i){!function(t,e){"function"==typeof define&&define.amd?define("strophe-base64",function(){return e()}):t.Base64=e()}(this,function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(e){var n,i,r,o,a,s,c,u="",l=0;do{n=e.charCodeAt(l++),i=e.charCodeAt(l++),r=e.charCodeAt(l++),o=n>>2,a=(3&n)<<4|i>>4,s=(15&i)<<2|r>>6,c=63&r,isNaN(i)?(a=(3&n)<<4,s=c=64):isNaN(r)&&(c=64),u=u+t.charAt(o)+t.charAt(a)+t.charAt(s)+t.charAt(c)}while(l<e.length);return u},decode:function(e){var n,i,r,o,a,s,c,u="",l=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{o=t.indexOf(e.charAt(l++)),a=t.indexOf(e.charAt(l++)),s=t.indexOf(e.charAt(l++)),c=t.indexOf(e.charAt(l++)),n=o<<2|a>>4,i=(15&a)<<4|s>>2,r=(3&s)<<6|c,u+=String.fromCharCode(n),64!=s&&(u+=String.fromCharCode(i)),64!=c&&(u+=String.fromCharCode(r))}while(l<e.length);return u}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-sha1",function(){return e()}):t.SHA1=e()}(this,function(){function t(t,i){t[i>>5]|=128<<24-i%32,t[15+(i+64>>9<<4)]=i;var a,s,c,u,l,d,h,f,p=new Array(80),g=1732584193,m=-271733879,v=-1732584194,_=271733878,y=-1009589776;for(a=0;a<t.length;a+=16){for(u=g,l=m,d=v,h=_,f=y,s=0;s<80;s++)p[s]=s<16?t[a+s]:o(p[s-3]^p[s-8]^p[s-14]^p[s-16],1),c=r(r(o(g,5),e(s,m,v,_)),r(r(y,p[s]),n(s))),y=_,_=v,v=o(m,30),m=g,g=c;g=r(g,u),m=r(m,l),v=r(v,d),_=r(_,h),y=r(y,f)}return[g,m,v,_,y]}function e(t,e,n,i){return t<20?e&n|~e&i:t<40?e^n^i:t<60?e&n|e&i|n&i:e^n^i}function n(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function i(e,n){var i=a(e);i.length>16&&(i=t(i,8*e.length));for(var r=new Array(16),o=new Array(16),s=0;s<16;s++)r[s]=909522486^i[s],o[s]=1549556828^i[s];var c=t(r.concat(a(n)),512+8*n.length);return t(o.concat(c),672)}function r(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function o(t,e){return t<<e|t>>>32-e}function a(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<24-n%32;return e}function s(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>24-n%32&255);return e}function c(t){for(var e,n,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="",o=0;o<4*t.length;o+=3)for(e=(t[o>>2]>>8*(3-o%4)&255)<<16|(t[o+1>>2]>>8*(3-(o+1)%4)&255)<<8|t[o+2>>2]>>8*(3-(o+2)%4)&255,n=0;n<4;n++)r+=8*o+6*n>32*t.length?"=":i.charAt(e>>6*(3-n)&63);return r}return{b64_hmac_sha1:function(t,e){return c(i(t,e))},b64_sha1:function(e){return c(t(a(e),8*e.length))},binb2str:s,core_hmac_sha1:i,str_hmac_sha1:function(t,e){return s(i(t,e))},str_sha1:function(e){return s(t(a(e),8*e.length))}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-md5",function(){return e()}):t.MD5=e()}(this,function(t){var e=function(t,e){var n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n},n=function(t,e){return t<<e|t>>>32-e},i=function(t){for(var e=[],n=0;n<8*t.length;n+=8)e[n>>5]|=(255&t.charCodeAt(n/8))<<n%32;return e},r=function(t){for(var e="",n=0;n<32*t.length;n+=8)e+=String.fromCharCode(t[n>>5]>>>n%32&255);return e},o=function(t){for(var e="0123456789abcdef",n="",i=0;i<4*t.length;i++)n+=e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15);return n},a=function(t,i,r,o,a,s){return e(n(e(e(i,t),e(o,s)),a),r)},s=function(t,e,n,i,r,o,s){return a(e&n|~e&i,t,e,r,o,s)},c=function(t,e,n,i,r,o,s){return a(e&i|n&~i,t,e,r,o,s)},u=function(t,e,n,i,r,o,s){return a(e^n^i,t,e,r,o,s)},l=function(t,e,n,i,r,o,s){return a(n^(e|~i),t,e,r,o,s)},d=function(t,n){t[n>>5]|=128<<n%32,t[14+(n+64>>>9<<4)]=n;for(var i,r,o,a,d=1732584193,h=-271733879,f=-1732584194,p=271733878,g=0;g<t.length;g+=16)i=d,r=h,o=f,a=p,d=s(d,h,f,p,t[g+0],7,-680876936),p=s(p,d,h,f,t[g+1],12,-389564586),f=s(f,p,d,h,t[g+2],17,606105819),h=s(h,f,p,d,t[g+3],22,-1044525330),d=s(d,h,f,p,t[g+4],7,-176418897),p=s(p,d,h,f,t[g+5],12,1200080426),f=s(f,p,d,h,t[g+6],17,-1473231341),h=s(h,f,p,d,t[g+7],22,-45705983),d=s(d,h,f,p,t[g+8],7,1770035416),p=s(p,d,h,f,t[g+9],12,-1958414417),f=s(f,p,d,h,t[g+10],17,-42063),h=s(h,f,p,d,t[g+11],22,-1990404162),d=s(d,h,f,p,t[g+12],7,1804603682),p=s(p,d,h,f,t[g+13],12,-40341101),f=s(f,p,d,h,t[g+14],17,-1502002290),h=s(h,f,p,d,t[g+15],22,1236535329),d=c(d,h,f,p,t[g+1],5,-165796510),p=c(p,d,h,f,t[g+6],9,-1069501632),f=c(f,p,d,h,t[g+11],14,643717713),h=c(h,f,p,d,t[g+0],20,-373897302),d=c(d,h,f,p,t[g+5],5,-701558691),p=c(p,d,h,f,t[g+10],9,38016083),f=c(f,p,d,h,t[g+15],14,-660478335),h=c(h,f,p,d,t[g+4],20,-405537848),d=c(d,h,f,p,t[g+9],5,568446438),p=c(p,d,h,f,t[g+14],9,-1019803690),f=c(f,p,d,h,t[g+3],14,-187363961),h=c(h,f,p,d,t[g+8],20,1163531501),d=c(d,h,f,p,t[g+13],5,-1444681467),p=c(p,d,h,f,t[g+2],9,-51403784),f=c(f,p,d,h,t[g+7],14,1735328473),h=c(h,f,p,d,t[g+12],20,-1926607734),d=u(d,h,f,p,t[g+5],4,-378558),p=u(p,d,h,f,t[g+8],11,-2022574463),f=u(f,p,d,h,t[g+11],16,1839030562),h=u(h,f,p,d,t[g+14],23,-35309556),d=u(d,h,f,p,t[g+1],4,-1530992060),p=u(p,d,h,f,t[g+4],11,1272893353),f=u(f,p,d,h,t[g+7],16,-155497632),h=u(h,f,p,d,t[g+10],23,-1094730640),d=u(d,h,f,p,t[g+13],4,681279174),p=u(p,d,h,f,t[g+0],11,-358537222),f=u(f,p,d,h,t[g+3],16,-722521979),h=u(h,f,p,d,t[g+6],23,76029189),d=u(d,h,f,p,t[g+9],4,-640364487),p=u(p,d,h,f,t[g+12],11,-421815835),f=u(f,p,d,h,t[g+15],16,530742520),h=u(h,f,p,d,t[g+2],23,-995338651),d=l(d,h,f,p,t[g+0],6,-198630844),p=l(p,d,h,f,t[g+7],10,1126891415),f=l(f,p,d,h,t[g+14],15,-1416354905),h=l(h,f,p,d,t[g+5],21,-57434055),d=l(d,h,f,p,t[g+12],6,1700485571),p=l(p,d,h,f,t[g+3],10,-1894986606),f=l(f,p,d,h,t[g+10],15,-1051523),h=l(h,f,p,d,t[g+1],21,-2054922799),d=l(d,h,f,p,t[g+8],6,1873313359),p=l(p,d,h,f,t[g+15],10,-30611744),f=l(f,p,d,h,t[g+6],15,-1560198380),h=l(h,f,p,d,t[g+13],21,1309151649),d=l(d,h,f,p,t[g+4],6,-145523070),p=l(p,d,h,f,t[g+11],10,-1120210379),f=l(f,p,d,h,t[g+2],15,718787259),h=l(h,f,p,d,t[g+9],21,-343485551),d=e(d,i),h=e(h,r),f=e(f,o),p=e(p,a);return[d,h,f,p]};return{hexdigest:function(t){return o(d(i(t),8*t.length))},hash:function(t){return r(d(i(t),8*t.length))}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-utils",function(){return e()}):t.stropheUtils=e()}(this,function(){return{utf16to8:function(t){var e,n,i="",r=t.length;for(e=0;e<r;e++)n=t.charCodeAt(e),n>=0&&n<=127?i+=t.charAt(e):n>2047?(i+=String.fromCharCode(224|n>>12&15),i+=String.fromCharCode(128|n>>6&63),i+=String.fromCharCode(128|n>>0&63)):(i+=String.fromCharCode(192|n>>6&31),i+=String.fromCharCode(128|n>>0&63));return i},addCookies:function(t){var e,n,i,r,o,a,s;for(e in t||{})o="",a="",s="",n=t[e],i="object"==typeof n,r=escape(unescape(i?n.value:n)),i&&(o=n.expires?";expires="+n.expires:"",a=n.domain?";domain="+n.domain:"",s=n.path?";path="+n.path:""),document.cookie=e+"="+r+o+a+s}}}),function(t,e){"function"==typeof define&&define.amd?define("strophe-polyfill",[],function(){return e()}):t.polyfills=e()}(this,function(){var t={bind:function(t,e){var n=Array.prototype.slice,i=Array.prototype.concat,r=n.call(arguments,2);return function(){return t.apply(e?e:this,i.call(r,n.call(arguments,0)))}}};return Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)}),Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length,n=Number(arguments[1])||0;for(n=n<0?Math.ceil(n):Math.floor(n),n<0&&(n+=e);n<e;n++)if(n in this&&this[n]===t)return n;return-1}),t}),function(t,e){if("function"==typeof define&&define.amd)define("strophe-core",["strophe-sha1","strophe-base64","strophe-md5","strophe-utils","strophe-polyfill"],function(){return e.apply(this,arguments)});else{var n=e(t.SHA1,t.Base64,t.MD5,t.stropheUtils,t.polyfills);t.Strophe=n.Strophe,t.$build=n.$build,t.$iq=n.$iq,t.$msg=n.$msg,t.$pres=n.$pres}}(this,function(t,n,i,r,o){function a(t,e){return new l.Builder(t,e)}function s(t){return new l.Builder("message",t)}function c(t){return new l.Builder("iq",t)}function u(t){return new l.Builder("presence",t)}var l,d=o.bind;return l={bind:d,VERSION:"3.2.0",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(t){for(var e=0;e<l.XHTML.tags.length;e++)if(t==l.XHTML.tags[e])return!0;return!1},validAttribute:function(t,e){if(void 0!==l.XHTML.attributes[t]&&l.XHTML.attributes[t].length>0)for(var n=0;n<l.XHTML.attributes[t].length;n++)if(e==l.XHTML.attributes[t][n])return!0;return!1},validCSS:function(t){for(var e=0;e<l.XHTML.css.length;e++)if(t==l.XHTML.css[e])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(t,e){l.NS[t]=e},forEachChild:function(t,e,n){var i,r;for(i=0;i<t.childNodes.length;i++)r=t.childNodes[i],r.nodeType!=l.ElementType.NORMAL||e&&!this.isTagEqual(r,e)||n(r)},isTagEqual:function(t,e){return t.tagName==e},_xmlGenerator:null,_makeGenerator:function(){var t;return document.implementation.createDocument===e||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(t=this._getIEXmlDom(),t.appendChild(t.createElement("strophe"))):t=document.implementation.createDocument("jabber:client","strophe",null),t},xmlGenerator:function(){return l._xmlGenerator||(l._xmlGenerator=l._makeGenerator()),l._xmlGenerator},_getIEXmlDom:function(){for(var t=null,e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],n=0;n<e.length&&null===t;n++)try{t=new ActiveXObject(e[n])}catch(e){t=null}return t},xmlElement:function(t){if(!t)return null;var n,i,r,o=l.xmlGenerator().createElement(t);for(n=1;n<arguments.length;n++){var a=arguments[n];if(a)if("string"==typeof a||"number"==typeof a)o.appendChild(l.xmlTextNode(a));else if("object"==typeof a&&"function"==typeof a.sort)for(i=0;i<a.length;i++){var s=a[i];"object"==typeof s&&"function"==typeof s.sort&&s[1]!==e&&null!==s[1]&&o.setAttribute(s[0],s[1])}else if("object"==typeof a)for(r in a)a.hasOwnProperty(r)&&a[r]!==e&&null!==a[r]&&o.setAttribute(r,a[r])}return o},xmlescape:function(t){return t=t.replace(/\&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/'/g,"&apos;"),t=t.replace(/"/g,"&quot;")},xmlunescape:function(t){return t=t.replace(/\&amp;/g,"&"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&gt;/g,">"),t=t.replace(/&apos;/g,"'"),t=t.replace(/&quot;/g,'"')},xmlTextNode:function(t){return l.xmlGenerator().createTextNode(t)},xmlHtmlNode:function(t){var e;if(window.DOMParser){e=(new DOMParser).parseFromString(t,"text/xml")}else e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(t);return e},getText:function(t){if(!t)return null;var e="";0===t.childNodes.length&&t.nodeType==l.ElementType.TEXT&&(e+=t.nodeValue);for(var n=0;n<t.childNodes.length;n++)t.childNodes[n].nodeType==l.ElementType.TEXT&&(e+=t.childNodes[n].nodeValue);return l.xmlescape(e)},copyElement:function(t){var e,n;if(t.nodeType==l.ElementType.NORMAL){for(n=l.xmlElement(t.tagName),e=0;e<t.attributes.length;e++)n.setAttribute(t.attributes[e].nodeName,t.attributes[e].value);for(e=0;e<t.childNodes.length;e++)n.appendChild(l.copyElement(t.childNodes[e]))}else t.nodeType==l.ElementType.TEXT&&(n=l.xmlGenerator().createTextNode(t.nodeValue));return n},createHtml:function(t){var e,n,i,r,o,a,s,c,u,d,h;if(t.nodeType==l.ElementType.NORMAL)if(r=t.nodeName.toLowerCase(),l.XHTML.validTag(r))try{for(n=l.xmlElement(r),e=0;e<l.XHTML.attributes[r].length;e++)if(o=l.XHTML.attributes[r][e],void 0!==(a=t.getAttribute(o))&&null!==a&&""!==a&&a!==!1&&0!==a)if("style"==o&&"object"==typeof a&&void 0!==a.cssText&&(a=a.cssText),"style"==o){for(s=[],c=a.split(";"),i=0;i<c.length;i++)u=c[i].split(":"),d=u[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),l.XHTML.validCSS(d)&&(h=u[1].replace(/^\s*/,"").replace(/\s*$/,""),s.push(d+": "+h));s.length>0&&(a=s.join("; "),n.setAttribute(o,a))}else n.setAttribute(o,a);for(e=0;e<t.childNodes.length;e++)n.appendChild(l.createHtml(t.childNodes[e]))}catch(t){n=l.xmlTextNode("")}else for(n=l.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(l.createHtml(t.childNodes[e]));else if(t.nodeType==l.ElementType.FRAGMENT)for(n=l.xmlGenerator().createDocumentFragment(),e=0;e<t.childNodes.length;e++)n.appendChild(l.createHtml(t.childNodes[e]));else t.nodeType==l.ElementType.TEXT&&(n=l.xmlTextNode(t.nodeValue));return n},escapeNode:function(t){return"string"!=typeof t?t:t.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(t){return"string"!=typeof t?t:t.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(t){return t.indexOf("@")<0?null:t.split("@")[0]},getDomainFromJid:function(t){var e=l.getBareJidFromJid(t);if(e.indexOf("@")<0)return e;var n=e.split("@");return n.splice(0,1),n.join("@")},getResourceFromJid:function(t){var e=t.split("/");return e.length<2?null:(e.splice(0,1),e.join("/"))},getBareJidFromJid:function(t){return t?t.split("/")[0]:null},log:function(t,e){},debug:function(t){this.log(this.LogLevel.DEBUG,t)},info:function(t){this.log(this.LogLevel.INFO,t)},warn:function(t){this.log(this.LogLevel.WARN,t)},error:function(t){this.log(this.LogLevel.ERROR,t)},fatal:function(t){this.log(this.LogLevel.FATAL,t)},serialize:function(t){var e;if(!t)return null;"function"==typeof t.tree&&(t=t.tree());var n,i,r=t.nodeName;for(t.getAttribute("_realname")&&(r=t.getAttribute("_realname")),e="<"+r,n=0;n<t.attributes.length;n++)"_realname"!=t.attributes[n].nodeName&&(e+=" "+t.attributes[n].nodeName+"='"+l.xmlescape(t.attributes[n].value)+"'");if(t.childNodes.length>0){for(e+=">",n=0;n<t.childNodes.length;n++)switch(i=t.childNodes[n],i.nodeType){case l.ElementType.NORMAL:e+=l.serialize(i);break;case l.ElementType.TEXT:e+=l.xmlescape(i.nodeValue);break;case l.ElementType.CDATA:e+="<![CDATA["+i.nodeValue+"]]>"}e+="</"+r+">"}else e+="/>";return e},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(t,e){l._connectionPlugins[t]=e}},l.Builder=function(t,e){"presence"!=t&&"message"!=t&&"iq"!=t||(e&&!e.xmlns?e.xmlns=l.NS.CLIENT:e||(e={xmlns:l.NS.CLIENT})),this.nodeTree=l.xmlElement(t,e),this.node=this.nodeTree},l.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return l.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(t){for(var n in t)t.hasOwnProperty(n)&&(t[n]===e?this.node.removeAttribute(n):this.node.setAttribute(n,t[n]));return this},c:function(t,e,n){var i=l.xmlElement(t,e,n);return this.node.appendChild(i),"string"!=typeof n&&"number"!=typeof n&&(this.node=i),this},cnode:function(t){var n,i=l.xmlGenerator();try{n=i.importNode!==e}catch(t){n=!1}var r=n?i.importNode(t,!0):l.copyElement(t);return this.node.appendChild(r),this.node=r,this},t:function(t){var e=l.xmlTextNode(t);return this.node.appendChild(e),this},h:function(t){var e=document.createElement("body");e.innerHTML=t;for(var n=l.createHtml(e);n.childNodes.length>0;)this.node.appendChild(n.childNodes[0]);return this}},l.Handler=function(t,e,n,i,r,o,a){this.handler=t,this.ns=e,this.name=n,this.type=i,this.id=r,this.options=a||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.options.matchBare?this.from=o?l.getBareJidFromJid(o):null:this.from=o,this.user=!0},l.Handler.prototype={isMatch:function(t){var e,n=null;if(n=this.options.matchBare?l.getBareJidFromJid(t.getAttribute("from")):t.getAttribute("from"),e=!1,this.ns){var i=this;l.forEachChild(t,null,function(t){t.getAttribute("xmlns")==i.ns&&(e=!0)}),e=e||t.getAttribute("xmlns")==this.ns}else e=!0;var r=t.getAttribute("type");return!(!e||this.name&&!l.isTagEqual(t,this.name)||this.type&&(Array.isArray(this.type)?this.type.indexOf(r)==-1:r!=this.type)||this.id&&t.getAttribute("id")!=this.id||this.from&&n!=this.from)},run:function(t){var e=null;try{e=this.handler(t)}catch(t){throw t.sourceURL?l.fatal("error: "+this.handler+" "+t.sourceURL+":"+t.line+" - "+t.name+": "+t.message):t.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",t,t.message)),l.fatal("error: "+this.handler+" "+t.fileName+":"+t.lineNumber+" - "+t.name+": "+t.message)):l.fatal("error: "+t.message+"\n"+t.stack),t}return e},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},l.TimedHandler=function(t,e){this.period=t,this.handler=e,this.lastCalled=(new Date).getTime(),this.user=!0},l.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},l.Connection=function(t,e){this.service=t,this.options=e||{};var n=this.options.protocol||"";0===t.indexOf("ws:")||0===t.indexOf("wss:")||0===n.indexOf("ws")?this._proto=new l.Websocket(this):this._proto=new l.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(d(this._onIdle,this),100),r.addCookies(this.options.cookies);for(var i in l._connectionPlugins)if(l._connectionPlugins.hasOwnProperty(i)){var o=l._connectionPlugins[i],a=function(){};a.prototype=o,this[i]=new a,this[i].init(this)}},l.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(t){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)});return"string"==typeof t||"number"==typeof t?e+":"+t:e+""},connect:function(t,e,n,i,r,o,a){this.jid=t,this.authzid=l.getBareJidFromJid(this.jid),this.authcid=a||l.getNodeFromJid(this.jid),this.pass=e,this.servtype="xmpp",this.connect_callback=n,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.domain=l.getDomainFromJid(this.jid),this._changeConnectStatus(l.Status.CONNECTING,null),this._proto._connect(i,r,o)},attach:function(t,e,n,i,r,o,a){if(!(this._proto instanceof l.Bosh))throw{name:"StropheSessionError",message:'The "attach" method can only be used with a BOSH connection.'};this._proto._attach(t,e,n,i,r,o,a)},restore:function(t,e,n,i,r){if(!this._sessionCachingSupported())throw{name:"StropheSessionError",message:'The "restore" method can only be used with a BOSH connection.'};this._proto._restore(t,e,n,i,r)},_sessionCachingSupported:function(){if(this._proto instanceof l.Bosh){if(!JSON)return!1;try{window.sessionStorage.setItem("_strophe_","_strophe_"),window.sessionStorage.removeItem("_strophe_")}catch(t){return!1}return!0}return!1},xmlInput:function(t){},xmlOutput:function(t){},rawInput:function(t){},rawOutput:function(t){},nextValidRid:function(t){},send:function(t){if(null!==t){if("function"==typeof t.sort)for(var e=0;e<t.length;e++)this._queueData(t[e]);else"function"==typeof t.tree?this._queueData(t.tree()):this._queueData(t);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(t,e,n,i){var r=null,o=this;"function"==typeof t.tree&&(t=t.tree());var a=t.getAttribute("id");a||(a=this.getUniqueId("sendIQ"),t.setAttribute("id",a));var s=t.getAttribute("to"),c=this.jid,u=this.addHandler(function(t){r&&o.deleteTimedHandler(r);var i=!1,a=t.getAttribute("from");if(a!==s&&(s||a!==l.getBareJidFromJid(c)&&a!==l.getDomainFromJid(c)&&a!==c)||(i=!0),!i)throw{name:"StropheError",message:"Got answer to IQ from wrong jid:"+a+"\nExpected jid: "+s};var u=t.getAttribute("type");if("result"==u)e&&e(t);else{if("error"!=u)throw{name:"StropheError",message:"Got bad IQ type of "+u};n&&n(t)}},null,"iq",["error","result"],a);return i&&(r=this.addTimedHandler(i,function(){return o.deleteHandler(u),n&&n(null),!1})),this.send(t),a},_queueData:function(t){if(null===t||!t.tagName||!t.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(t)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(d(this._onIdle,this),100)},addTimedHandler:function(t,e){var n=new l.TimedHandler(t,e);return this.addTimeds.push(n),n},deleteTimedHandler:function(t){this.removeTimeds.push(t)},addHandler:function(t,e,n,i,r,o,a){var s=new l.Handler(t,e,n,i,r,o,a);return this.addHandlers.push(s),s},deleteHandler:function(t){this.removeHandlers.push(t);var e=this.addHandlers.indexOf(t);e>=0&&this.addHandlers.splice(e,1)},disconnect:function(t){if(this._changeConnectStatus(l.Status.DISCONNECTING,t),l.info("Disconnect was called because: "+t),this.connected){var e=!1;this.disconnecting=!0,this.authenticated&&(e=u({xmlns:l.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,d(this._onDisconnectTimeout,this)),this._proto._disconnect(e)}else l.info("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests()},_changeConnectStatus:function(t,e){for(var n in l._connectionPlugins)if(l._connectionPlugins.hasOwnProperty(n)){var i=this[n];if(i.statusChanged)try{i.statusChanged(t,e)}catch(t){l.error(n+" plugin caused an exception changing status: "+t)}}if(this.connect_callback)try{this.connect_callback(t,e)}catch(t){l.error("User connection callback caused an exception: "+t)}},_doDisconnect:function(t){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),l.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(l.Status.DISCONNECTED,t),this.connected=!1},_dataRecv:function(t,e){l.info("_dataRecv called");var n=this._proto._reqToData(t);if(null!==n){this.xmlInput!==l.Connection.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==l.Connection.prototype.rawInput&&(e?this.rawInput(e):this.rawInput(l.serialize(n)));for(var i,r;this.removeHandlers.length>0;)r=this.removeHandlers.pop(),(i=this.handlers.indexOf(r))>=0&&this.handlers.splice(i,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var o,a,s=n.getAttribute("type");if(null!==s&&"terminate"==s){if(this.disconnecting)return;return o=n.getAttribute("condition"),a=n.getElementsByTagName("conflict"),null!==o?("remote-stream-error"==o&&a.length>0&&(o="conflict"),this._changeConnectStatus(l.Status.CONNFAIL,o)):this._changeConnectStatus(l.Status.CONNFAIL,"unknown"),void this._doDisconnect(o)}var c=this;l.forEachChild(n,null,function(t){var e,n;for(n=c.handlers,c.handlers=[],e=0;e<n.length;e++){var i=n[e];try{!i.isMatch(t)||!c.authenticated&&i.user?c.handlers.push(i):i.run(t)&&c.handlers.push(i)}catch(t){l.warn("Removing Strophe handlers due to uncaught exception: "+t.message)}}})}},mechanisms:{},_connect_cb:function(t,e,n){l.info("_connect_cb was called"),this.connected=!0;var i;try{i=this._proto._reqToData(t)}catch(t){if("badformat"!=t)throw t;this._changeConnectStatus(l.Status.CONNFAIL,"bad-format"),this._doDisconnect("bad-format")}if(i){this.xmlInput!==l.Connection.prototype.xmlInput&&(i.nodeName===this._proto.strip&&i.childNodes.length?this.xmlInput(i.childNodes[0]):this.xmlInput(i)),this.rawInput!==l.Connection.prototype.rawInput&&(n?this.rawInput(n):this.rawInput(l.serialize(i)));if(this._proto._connect_cb(i)!==l.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var r;r=i.getElementsByTagNameNS?i.getElementsByTagNameNS(l.NS.STREAM,"features").length>0:i.getElementsByTagName("stream:features").length>0||i.getElementsByTagName("features").length>0;var o,a,s=i.getElementsByTagName("mechanism"),c=[];if(!r)return void this._proto._no_auth_received(e);if(s.length>0)for(o=0;o<s.length;o++)a=l.getText(s[o]),
this.mechanisms[a]&&c.push(this.mechanisms[a]);if(this._authentication.legacy_auth=i.getElementsByTagName("auth").length>0,!(this._authentication.legacy_auth||c.length>0))return void this._proto._no_auth_received(e);this.do_authentication!==!1&&this.authenticate(c)}}},authenticate:function(t){var e;for(e=0;e<t.length-1;++e){for(var i=e,r=e+1;r<t.length;++r)t[r].prototype.priority>t[i].prototype.priority&&(i=r);if(i!=e){var o=t[e];t[e]=t[i],t[i]=o}}var s=!1;for(e=0;e<t.length;++e)if(t[e].prototype.test(this)){this._sasl_success_handler=this._addSysHandler(d(this._sasl_success_cb,this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(d(this._sasl_failure_cb,this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(d(this._sasl_challenge_cb,this),null,"challenge",null,null),this._sasl_mechanism=new t[e],this._sasl_mechanism.onStart(this);var u=a("auth",{xmlns:l.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var h=this._sasl_mechanism.onChallenge(this,null);u.t(n.encode(h))}this.send(u.tree()),s=!0;break}s||(null===l.getNodeFromJid(this.jid)?(this._changeConnectStatus(l.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(l.Status.AUTHENTICATING,null),this._addSysHandler(d(this._auth1_cb,this),null,null,null,"_auth_1"),this.send(c({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:l.NS.AUTH}).c("username",{}).t(l.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(t){var e=n.decode(l.getText(t)),i=this._sasl_mechanism.onChallenge(this,e),r=a("response",{xmlns:l.NS.SASL});return""!==i&&r.t(n.encode(i)),this.send(r.tree()),!0},_auth1_cb:function(t){var e=c({type:"set",id:"_auth_2"}).c("query",{xmlns:l.NS.AUTH}).c("username",{}).t(l.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return l.getResourceFromJid(this.jid)||(this.jid=l.getBareJidFromJid(this.jid)+"/strophe"),e.up().c("resource",{}).t(l.getResourceFromJid(this.jid)),this._addSysHandler(d(this._auth2_cb,this),null,null,null,"_auth_2"),this.send(e.tree()),!1},_sasl_success_cb:function(t){if(this._sasl_data["server-signature"]){var e,i=n.decode(l.getText(t)),r=i.match(/([a-z]+)=([^,]+)(,|$)/);if("v"==r[1]&&(e=r[2]),e!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}l.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);var o=[],a=function(t,e){for(;t.length;)this.deleteHandler(t.pop());return d(this._sasl_auth1_cb,this)(e),!1};return o.push(this._addSysHandler(d(function(t){d(a,this)(o,t)},this),null,"stream:features",null,null)),o.push(this._addSysHandler(d(function(t){d(a,this)(o,t)},this),l.NS.STREAM,"features",null,null)),this._sendRestart(),!1},_sasl_auth1_cb:function(t){this.features=t;var e,n;for(e=0;e<t.childNodes.length;e++)n=t.childNodes[e],"bind"==n.nodeName&&(this.do_bind=!0),"session"==n.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(l.Status.AUTHFAIL,null),!1;this._addSysHandler(d(this._sasl_bind_cb,this),null,null,null,"_bind_auth_2");var i=l.getResourceFromJid(this.jid);return i?this.send(c({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:l.NS.BIND}).c("resource",{}).t(i).tree()):this.send(c({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:l.NS.BIND}).tree()),!1},_sasl_bind_cb:function(t){if("error"==t.getAttribute("type")){l.info("SASL binding failed.");var e,n=t.getElementsByTagName("conflict");return n.length>0&&(e="conflict"),this._changeConnectStatus(l.Status.AUTHFAIL,e),!1}var i,r=t.getElementsByTagName("bind");if(!(r.length>0))return l.info("SASL binding failed."),this._changeConnectStatus(l.Status.AUTHFAIL,null),!1;i=r[0].getElementsByTagName("jid"),i.length>0&&(this.jid=l.getText(i[0]),this.do_session?(this._addSysHandler(d(this._sasl_session_cb,this),null,null,null,"_session_auth_2"),this.send(c({type:"set",id:"_session_auth_2"}).c("session",{xmlns:l.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(l.Status.CONNECTED,null)))},_sasl_session_cb:function(t){if("result"==t.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(l.Status.CONNECTED,null);else if("error"==t.getAttribute("type"))return l.info("Session creation failed."),this._changeConnectStatus(l.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(t){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(l.Status.AUTHFAIL,null),!1},_auth2_cb:function(t){return"result"==t.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(l.Status.CONNECTED,null)):"error"==t.getAttribute("type")&&(this._changeConnectStatus(l.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(t,e){var n=new l.TimedHandler(t,e);return n.user=!1,this.addTimeds.push(n),n},_addSysHandler:function(t,e,n,i,r){var o=new l.Handler(t,e,n,i,r);return o.user=!1,this.addHandlers.push(o),o},_onDisconnectTimeout:function(){return l.info("_onDisconnectTimeout was called"),this._changeConnectStatus(l.Status.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var t,e,n,i;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)e=this.removeTimeds.pop(),(t=this.timedHandlers.indexOf(e))>=0&&this.timedHandlers.splice(t,1);var r=(new Date).getTime();for(i=[],t=0;t<this.timedHandlers.length;t++)e=this.timedHandlers[t],!this.authenticated&&e.user||(n=e.lastCalled+e.period,n-r<=0?e.run()&&i.push(e):i.push(e));this.timedHandlers=i,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(d(this._onIdle,this),100))}},l.SASLMechanism=function(t,e,n){this.name=t,this.isClientFirst=e,this.priority=n},l.SASLMechanism.prototype={test:function(t){return!0},onStart:function(t){this._connection=t},onChallenge:function(t,e){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},l.SASLAnonymous=function(){},l.SASLAnonymous.prototype=new l.SASLMechanism("ANONYMOUS",!1,10),l.SASLAnonymous.prototype.test=function(t){return null===t.authcid},l.Connection.prototype.mechanisms[l.SASLAnonymous.prototype.name]=l.SASLAnonymous,l.SASLPlain=function(){},l.SASLPlain.prototype=new l.SASLMechanism("PLAIN",!0,20),l.SASLPlain.prototype.test=function(t){return null!==t.authcid},l.SASLPlain.prototype.onChallenge=function(t){var e=t.authzid;return e+="\0",e+=t.authcid,e+="\0",e+=t.pass,r.utf16to8(e)},l.Connection.prototype.mechanisms[l.SASLPlain.prototype.name]=l.SASLPlain,l.SASLSHA1=function(){},l.SASLSHA1.prototype=new l.SASLMechanism("SCRAM-SHA-1",!0,40),l.SASLSHA1.prototype.test=function(t){return null!==t.authcid},l.SASLSHA1.prototype.onChallenge=function(e,o,a){var s=a||i.hexdigest(1234567890*Math.random()),c="n="+r.utf16to8(e.authcid);return c+=",r=",c+=s,e._sasl_data.cnonce=s,e._sasl_data["client-first-message-bare"]=c,c="n,,"+c,this.onChallenge=d(function(e,i){for(var o,a,s,c,u,l,d,h,f,p,g,m="c=biws,",v=e._sasl_data["client-first-message-bare"]+","+i+",",_=e._sasl_data.cnonce;i.match(/([a-z]+)=([^,]+)(,|$)/);){var y=i.match(/([a-z]+)=([^,]+)(,|$)/);switch(i=i.replace(y[0],""),y[1]){case"r":o=y[2];break;case"s":a=y[2];break;case"i":s=y[2]}}if(o.substr(0,_.length)!==_)return e._sasl_data={},e._sasl_failure_cb();m+="r="+o,v+=m,a=n.decode(a),a+="\0\0\0";var b=r.utf16to8(e.pass);for(c=l=t.core_hmac_sha1(b,a),d=1;d<s;d++){for(u=t.core_hmac_sha1(b,t.binb2str(l)),h=0;h<5;h++)c[h]^=u[h];l=u}for(c=t.binb2str(c),f=t.core_hmac_sha1(c,"Client Key"),p=t.str_hmac_sha1(c,"Server Key"),g=t.core_hmac_sha1(t.str_sha1(t.binb2str(f)),v),e._sasl_data["server-signature"]=t.b64_hmac_sha1(p,v),h=0;h<5;h++)f[h]^=g[h];return m+=",p="+n.encode(t.binb2str(f))},this),c},l.Connection.prototype.mechanisms[l.SASLSHA1.prototype.name]=l.SASLSHA1,l.SASLMD5=function(){},l.SASLMD5.prototype=new l.SASLMechanism("DIGEST-MD5",!1,30),l.SASLMD5.prototype.test=function(t){return null!==t.authcid},l.SASLMD5.prototype._quote=function(t){return'"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},l.SASLMD5.prototype.onChallenge=function(t,e,n){for(var o,a=n||i.hexdigest(""+1234567890*Math.random()),s="",c=null,u="";e.match(/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/);)switch(o=e.match(/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/),e=e.replace(o[0],""),o[2]=o[2].replace(/^"(.+)"$/,"$1"),o[1]){case"realm":s=o[2];break;case"nonce":u=o[2];break;case"qop":o[2];break;case"host":c=o[2]}var l=t.servtype+"/"+t.domain;null!==c&&(l=l+"/"+c);var h=r.utf16to8(t.authcid+":"+s+":"+this._connection.pass),f=i.hash(h)+":"+u+":"+a,p="AUTHENTICATE:"+l,g="";return g+="charset=utf-8,",g+="username="+this._quote(r.utf16to8(t.authcid))+",",g+="realm="+this._quote(s)+",",g+="nonce="+this._quote(u)+",",g+="nc=00000001,",g+="cnonce="+this._quote(a)+",",g+="digest-uri="+this._quote(l)+",",g+="response="+i.hexdigest(i.hexdigest(f)+":"+u+":00000001:"+a+":auth:"+i.hexdigest(p))+",",g+="qop=auth",this.onChallenge=d(function(){return""},this),g},l.Connection.prototype.mechanisms[l.SASLMD5.prototype.name]=l.SASLMD5,l.SASLOAuthBearer=function(){},l.SASLOAuthBearer.prototype=new l.SASLMechanism("OAUTHBEARER",!0,50),l.SASLOAuthBearer.prototype.test=function(t){return null!==t.authcid},l.SASLOAuthBearer.prototype.onChallenge=function(t){var e="n,a=";return e+=t.authzid,e+=",",e+="",e+="auth=Bearer ",e+=t.pass,e+="",e+="",r.utf16to8(e)},l.Connection.prototype.mechanisms[l.SASLOAuthBearer.prototype.name]=l.SASLOAuthBearer,l.SASLExternal=function(){},l.SASLExternal.prototype=new l.SASLMechanism("EXTERNAL",!0,60),l.SASLExternal.prototype.onChallenge=function(t){return t.authcid===t.authzid?"":t.authzid},l.Connection.prototype.mechanisms[l.SASLExternal.prototype.name]=l.SASLExternal,{Strophe:l,$build:a,$msg:s,$iq:c,$pres:u,SHA1:t,Base64:n,MD5:i,polyfills:o}}),function(t,e){if("function"!=typeof define||!define.amd)return e(t.Strophe,t.$build,t.polyfills);define("strophe-bosh",["strophe-core"],function(t){return e(t.Strophe,t.$build,t.polyfills)})}(this,function(t,e,n){var i=n.bind;return t.Request=function(e,n,i,r){this.id=++t._requestId,this.xmlData=e,this.data=t.serialize(e),this.origFunc=n,this.func=n,this.rid=i,this.date=NaN,this.sends=r||0,this.abort=!1,this.dead=null,this.age=function(){return this.date?(new Date-this.date)/1e3:0},this.timeDead=function(){return this.dead?(new Date-this.dead)/1e3:0},this.xhr=this._newXHR()},t.Request.prototype={getResponse:function(){var e=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(e=this.xhr.responseXML.documentElement,"parsererror"==e.tagName)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),t.error("responseXML: "+t.serialize(this.xhr.responseXML)),"parsererror"}else if(this.xhr.responseText)throw t.error("invalid response received"),t.error("responseText: "+this.xhr.responseText),"badformat";return e},_newXHR:function(){var t=null;return window.XMLHttpRequest?(t=new XMLHttpRequest,t.overrideMimeType&&t.overrideMimeType("text/xml; charset=utf-8")):window.ActiveXObject&&(t=new ActiveXObject("Microsoft.XMLHTTP")),t.onreadystatechange=i(this.func,null,this),t}},t.Bosh=function(t){this._conn=t,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this._requests=[]},t.Bosh.prototype={strip:null,_buildBody:function(){var n=e("body",{rid:this.rid++,xmlns:t.NS.HTTPBIND});return null!==this.sid&&n.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),n},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_connect:function(e,n,r){this.wait=e||this.wait,this.hold=n||this.hold,this.errors=0;var o=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":t.NS.BOSH});r&&o.attrs({route:r});var a=this._conn._connect_cb;this._requests.push(new t.Request(o.tree(),i(this._onRequestStateChange,this,i(a,this._conn)),o.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(e,n,i,r,o,a,s){this._conn.jid=e,this.sid=n,this.rid=i,this._conn.connect_callback=r,this._conn.domain=t.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=o||this.wait,this.hold=a||this.hold,this.window=s||this.window,this._conn._changeConnectStatus(t.Status.ATTACHED,null)},_restore:function(e,n,i,r,o){var a=JSON.parse(window.sessionStorage.getItem("strophe-bosh-session"));if(!(void 0!==a&&null!==a&&a.rid&&a.sid&&a.jid)||void 0!==e&&null!==e&&t.getBareJidFromJid(a.jid)!=t.getBareJidFromJid(e))throw{name:"StropheSessionError",message:"_restore: no restoreable session."};this._conn.restored=!0,this._attach(a.jid,a.sid,a.rid,n,i,r,o)},_cacheSession:function(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&window.sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):window.sessionStorage.removeItem("strophe-bosh-session")},_connect_cb:function(e){var n,i,r=e.getAttribute("type");if(null!==r&&"terminate"==r)return n=e.getAttribute("condition"),t.error("BOSH-Connection failed: "+n),i=e.getElementsByTagName("conflict"),null!==n?("remote-stream-error"==n&&i.length>0&&(n="conflict"),this._conn._changeConnectStatus(t.Status.CONNFAIL,n)):this._conn._changeConnectStatus(t.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(n),t.Status.CONNFAIL;this.sid||(this.sid=e.getAttribute("sid"));var o=e.getAttribute("requests");o&&(this.window=parseInt(o,10));var a=e.getAttribute("hold");a&&(this.hold=parseInt(a,10));var s=e.getAttribute("wait");s&&(this.wait=parseInt(s,10))},_disconnect:function(t){this._sendTerminate(t)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&window.sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(e){this.errors++,t.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()},_no_auth_received:function(e){e=e?i(e,this._conn):i(this._conn._connect_cb,this._conn);var n=this._buildBody();this._requests.push(new t.Request(n.tree(),i(this._onRequestStateChange,this,i(e,this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){this._abortAllRequests()},_abortAllRequests:function(){for(var t;this._requests.length>0;)t=this._requests.pop(),t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){}},_onIdle:function(){var e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(t.info("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){for(var n=this._buildBody(),r=0;r<e.length;r++)null!==e[r]&&("restart"===e[r]?n.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":t.NS.BOSH}):n.cnode(e[r]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new t.Request(n.tree(),i(this._onRequestStateChange,this,i(this._conn._dataRecv,this._conn)),n.tree().getAttribute("rid"))),this._throttledRequestHandler()}if(this._requests.length>0){var o=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),o>Math.floor(t.TIMEOUT*this.wait)&&(t.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(t.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}},_onRequestStateChange:function(e,n){if(t.debug("request id "+n.id+"."+n.sends+" state changed to "+n.xhr.readyState),n.abort)return void(n.abort=!1);var i;if(4==n.xhr.readyState){i=0;try{i=n.xhr.status}catch(t){}if(void 0===i&&(i=0),this.disconnecting&&i>=400)return void this._hitError(i);var r=this._requests[0]==n,o=this._requests[1]==n;(i>0&&i<500||n.sends>5)&&(this._removeRequest(n),t.debug("request id "+n.id+" should now be removed")),200==i?((o||r&&this._requests.length>0&&this._requests[0].age()>Math.floor(t.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(Number(n.rid)+1),t.debug("request id "+n.id+"."+n.sends+" got 200"),e(n),this.errors=0):(t.error("request id "+n.id+"."+n.sends+" error "+i+" happened"),(0===i||i>=400&&i<600||i>=12e3)&&(this._hitError(i),i>=400&&i<500&&(this._conn._changeConnectStatus(t.Status.DISCONNECTING,null),this._conn._doDisconnect()))),i>0&&i<500||n.sends>5||this._throttledRequestHandler()}},_processRequest:function(e){var n=this,i=this._requests[e],r=-1;try{4==i.xhr.readyState&&(r=i.xhr.status)}catch(n){t.error("caught an error in _requests["+e+"], reqStatus: "+r)}if(void 0===r&&(r=-1),i.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();var o=i.age(),a=!isNaN(o)&&o>Math.floor(t.TIMEOUT*this.wait),s=null!==i.dead&&i.timeDead()>Math.floor(t.SECONDARY_TIMEOUT*this.wait),c=4==i.xhr.readyState&&(r<1||r>=500);if((a||s||c)&&(s&&t.error("Request "+this._requests[e].id+" timed out (secondary), restarting"),i.abort=!0,i.xhr.abort(),i.xhr.onreadystatechange=function(){},this._requests[e]=new t.Request(i.xmlData,i.origFunc,i.rid,i.sends),i=this._requests[e]),0===i.xhr.readyState){t.debug("request id "+i.id+"."+i.sends+" posting");try{var u=this._conn.options.contentType||"text/xml; charset=utf-8";i.xhr.open("POST",this._conn.service,!this._conn.options.sync),i.xhr.setRequestHeader("Content-Type",u),this._conn.options.withCredentials&&(i.xhr.withCredentials=!0)}catch(e){return t.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(t.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var l=function(){if(i.date=new Date,n._conn.options.customHeaders){var t=n._conn.options.customHeaders;for(var e in t)t.hasOwnProperty(e)&&i.xhr.setRequestHeader(e,t[e])}i.xhr.send(i.data)};if(i.sends>1){var d=1e3*Math.min(Math.floor(t.TIMEOUT*this.wait),Math.pow(i.sends,3));setTimeout(function(){l()},d)}else l();i.sends++,this._conn.xmlOutput!==t.Connection.prototype.xmlOutput&&(i.xmlData.nodeName===this.strip&&i.xmlData.childNodes.length?this._conn.xmlOutput(i.xmlData.childNodes[0]):this._conn.xmlOutput(i.xmlData)),this._conn.rawOutput!==t.Connection.prototype.rawOutput&&this._conn.rawOutput(i.data)}else t.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+i.xhr.readyState)},_removeRequest:function(e){t.debug("removing request");var n;for(n=this._requests.length-1;n>=0;n--)e==this._requests[n]&&this._requests.splice(n,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(t){var e=this._requests[t];null===e.dead&&(e.dead=new Date),this._processRequest(t)},_reqToData:function(t){try{return t.getResponse()}catch(t){if("parsererror"!=t)throw t;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(e){t.info("_sendTerminate was called");var n=this._buildBody().attrs({type:"terminate"});e&&n.cnode(e.tree());var r=new t.Request(n.tree(),i(this._onRequestStateChange,this,i(this._conn._dataRecv,this._conn)),n.tree().getAttribute("rid"));this._requests.push(r),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(i(this._conn._onIdle,this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){this._requests?t.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):t.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},t}),function(t,e){if("function"!=typeof define||!define.amd)return e(t.Strophe,t.$build,t.polyfills);define("strophe-websocket",["strophe-core"],function(t){return e(t.Strophe,t.$build)})}(this,function(t,e,n){var i=n.bind;return t.Websocket=function(t){this._conn=t,this.strip="wrapper";var e=t.service;if(0!==e.indexOf("ws:")&&0!==e.indexOf("wss:")){var n="";n+="ws"===t.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",n+="://"+window.location.host,n+=0!==e.indexOf("/")?window.location.pathname+e:e,t.service=n}},t.Websocket.prototype={_buildStream:function(){return e("open",{xmlns:t.NS.FRAMING,to:this._conn.domain,version:"1.0"})},_check_streamerror:function(e,n){var i;if(i=e.getElementsByTagNameNS?e.getElementsByTagNameNS(t.NS.STREAM,"error"):e.getElementsByTagName("stream:error"),0===i.length)return!1;for(var r=i[0],o="",a="",s=0;s<r.childNodes.length;s++){var c=r.childNodes[s];if("urn:ietf:params:xml:ns:xmpp-streams"!==c.getAttribute("xmlns"))break;"text"===c.nodeName?a=c.textContent:o=c.nodeName}var u="WebSocket stream error: ";return u+=o?o:"unknown",a&&(u+=" - "+o),t.error(u),this._conn._changeConnectStatus(n,o),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=i(this._onOpen,this),this.socket.onerror=i(this._onError,this),this.socket.onclose=i(this._onClose,this),this.socket.onmessage=i(this._connect_cb_wrapper,this)},_connect_cb:function(e){if(this._check_streamerror(e,t.Status.CONNFAIL))return t.Status.CONNFAIL},_handleStreamStart:function(e){var n=!1,i=e.getAttribute("xmlns");"string"!=typeof i?n="Missing xmlns in <open />":i!==t.NS.FRAMING&&(n="Wrong xmlns in <open />: "+i);var r=e.getAttribute("version");return"string"!=typeof r?n="Missing version in <open />":"1.0"!==r&&(n="Wrong version in <open />: "+r),!n||(this._conn._changeConnectStatus(t.Status.CONNFAIL,n),this._conn._doDisconnect(),!1)},_connect_cb_wrapper:function(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){var n=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===n)return;var r=(new DOMParser).parseFromString(n,"text/xml").documentElement;this._conn.xmlInput(r),this._conn.rawInput(e.data),this._handleStreamStart(r)&&this._connect_cb(r)}else if(0===e.data.indexOf("<close ")){this._conn.rawInput(e.data),this._conn.xmlInput(e);var o=e.getAttribute("see-other-uri");o?(this._conn._changeConnectStatus(t.Status.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=o,this._connect()):(this._conn._changeConnectStatus(t.Status.CONNFAIL,"Received closing stream"),this._conn._doDisconnect())}else{var a=this._streamWrap(e.data),s=(new DOMParser).parseFromString(a,"text/xml").documentElement;this.socket.onmessage=i(this._onMessage,this),this._conn._connect_cb(s,null,e.data)}},_disconnect:function(n){if(this.socket&&this.socket.readyState!==WebSocket.CLOSED){n&&this._conn.send(n);var i=e("close",{xmlns:t.NS.FRAMING});this._conn.xmlOutput(i);var r=t.serialize(i);this._conn.rawOutput(r);try{this.socket.send(r)}catch(e){t.info("Couldn't send <close /> tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){t.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(t){return"<wrapper>"+t+"</wrapper>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(t){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(t.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):t.info("Websocket closed")},_no_auth_received:function(e){t.error("Server did not send any auth methods"),this._conn._changeConnectStatus(t.Status.CONNFAIL,"Server did not send any auth methods"),e&&(e=i(e,this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_abortAllRequests:function(){},_onError:function(e){t.error("Websocket error "+e),this._conn._changeConnectStatus(t.Status.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()},_onIdle:function(){var e=this._conn._data;if(e.length>0&&!this._conn.paused){for(var n=0;n<e.length;n++)if(null!==e[n]){var i,r;i="restart"===e[n]?this._buildStream().tree():e[n],r=t.serialize(i),this._conn.xmlOutput(i),this._conn.rawOutput(r),this.socket.send(r)}this._conn._data=[]}},_onMessage:function(e){var n,i,r='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===r)return this._conn.rawInput(r),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(n=(new DOMParser).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(n))return}else i=this._streamWrap(e.data),n=(new DOMParser).parseFromString(i,"text/xml").documentElement;return this._check_streamerror(n,t.Status.ERROR)?void 0:this._conn.disconnecting&&"presence"===n.firstChild.nodeName&&"unavailable"===n.firstChild.getAttribute("type")?(this._conn.xmlInput(n),void this._conn.rawInput(t.serialize(n))):void this._conn._dataRecv(n,e.data)},_onOpen:function(){t.info("Websocket open");var e=this._buildStream();this._conn.xmlOutput(e.tree());var n=t.serialize(e);this._conn.rawOutput(n),this.socket.send(n)},_reqToData:function(t){return t},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),i(this._conn._onIdle,this._conn)()}},t})},{}],15:[function(t,e,n){"use strict";n.consoleFormat=t("./lib/console-format.js");var i=n.isEmoji=t("./lib/is-emoji.js"),r=n.split=t("./parsers/unicode-and-emoji.js").parse;n.withoutEmoji=function(t){var e=r(t);return e?e.filter(function(t){return!i(t)}):e},n.onlyEmoji=function(t){var e=r(t);return e?e.filter(function(t){return i(t)}):e}},{"./lib/console-format.js":16,"./lib/is-emoji.js":17,"./parsers/unicode-and-emoji.js":19}],16:[function(t,e,n){"use strict";var i=t("./is-emoji.js"),r=t("../parsers/unicode-and-emoji.js").parse;e.exports=function(t){var e=r(t),n="";return e.forEach(function(t){n+=i(t)?t+" ":t}),n}},{"../parsers/unicode-and-emoji.js":19,"./is-emoji.js":17}],17:[function(t,e,n){"use strict";var i=t("../parsers/emoji.js").Emoji;e.exports=function(t){return i.parse(t).status}},{"../parsers/emoji.js":18}],18:[function(t,e,n){"use strict";var i=t("parsimmon"),r=t("lodash.flattendeep"),o=n.OptionalVariationSelector=i.regex(/[\uFE0E\uFE0F]{0,1}/).desc("an optional variation selector (\\uFE0E or \\uFE0F)"),a=i.seq(i.regex(/[0-9#*]/),o,i.string("⃣")).desc("a keycap emoji"),s=i.regex(/\uD83C[\uDDE6-\uDDFF]/).times(2).desc("a flag emoji"),c=i.string("‍").desc("zero-width joiner (\\u200D)"),u=i.regex(/(\uD83C[\uDFFB-\uDFFF]){0,1}/).desc("an optional Fitzpatrick modifier"),l=i.alt(i.regex(/[\u203C-\u3299]/),i.regex(/[\u2702-\u27B0]/),s,i.regex(/\uD83C[\uDC04-\uDFFF]/),i.regex(/\uD83D[\uDC00-\uDFFF]/),i.regex(/\uD83E[\uDC00-\uDFFF]/),i.string("©"),i.string("®")),d=i.seq(l,o,i.seq(c,l,o).times(1,3)),h=n.Emoji=i.seq(i.alt(d,i.seq(l,o),a),u).map(function(t){return r(t).join("")});n.parseOne=function(t){var e=h.parse(t);return!!e.status&&e.value},n.parse=function(t){var e=h.many().parse(t);return!!e.status&&e.value}},{"lodash.flattendeep":23,parsimmon:58}],19:[function(t,e,n){"use strict";var i=t("./emoji.js").Emoji,r=t("parsimmon"),o=t("lodash.flattendeep"),a=r.regex(/[\uD800-\uDBFF][\uDC00-\uDFFF]/),s=n.Unicode=r.alt(i,r.regex(/[\u0000-\uD799]/),a);n.parseOne=function(t){var e=s.parse(t);return!!e.status&&o(e.value).join("")},n.parse=function(t){var e=s.many().parse(t);return!!e.status&&e.value.map(function(t){return o(t).join("")})}},{"./emoji.js":18,"lodash.flattendeep":23,parsimmon:58}],20:[function(t,e,n){!function(t){function i(){this._events={},this._conf&&r.call(this,this._conf)}function r(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._events.maxListeners=e.maxListeners!==t?e.maxListeners:l,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._events.maxListeners=l}function o(t,e){var n="(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.";this.verboseMemoryLeak?(n+=" Event name: %s.",console.error(n,t,e)):console.error(n,t),console.trace&&console.trace()}function a(t){this._events={},this.newListener=!1,this.verboseMemoryLeak=!1,r.call(this,t)}function s(t,e,n,i){if(!n)return[];var r,o,a,c,u,l,d,h=[],f=e.length,p=e[i],g=e[i+1];if(i===f&&n._listeners){if("function"==typeof n._listeners)return t&&t.push(n._listeners),[n];for(r=0,o=n._listeners.length;r<o;r++)t&&t.push(n._listeners[r]);return[n]}if("*"===p||"**"===p||n[p]){if("*"===p){for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&(h=h.concat(s(t,e,n[a],i+1)));return h}if("**"===p){d=i+1===f||i+2===f&&"*"===g,d&&n._listeners&&(h=h.concat(s(t,e,n,f)));for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&("*"===a||"**"===a?(n[a]._listeners&&!d&&(h=h.concat(s(t,e,n[a],f))),h=h.concat(s(t,e,n[a],i))):h=a===g?h.concat(s(t,e,n[a],i+2)):h.concat(s(t,e,n[a],i)));return h}h=h.concat(s(t,e,n[p],i+1))}if(c=n["*"],c&&s(t,e,c,i+1),u=n["**"])if(i<f){u._listeners&&s(t,e,u,f);for(a in u)"_listeners"!==a&&u.hasOwnProperty(a)&&(a===g?s(t,e,u[a],i+2):a===p?s(t,e,u[a],i+1):(l={},l[a]=u[a],s(t,e,{"**":l},i+1)))}else u._listeners?s(t,e,u,f):u["*"]&&u["*"]._listeners&&s(t,e,u["*"],f);return h}function c(e,n){e="string"==typeof e?e.split(this.delimiter):e.slice();for(var i=0,r=e.length;i+1<r;i++)if("**"===e[i]&&"**"===e[i+1])return;for(var a=this.listenerTree,s=e.shift();s!==t;){if(a[s]||(a[s]={}),a=a[s],0===e.length)return a._listeners?("function"==typeof a._listeners&&(a._listeners=[a._listeners]),a._listeners.push(n),!a._listeners.warned&&this._events.maxListeners>0&&a._listeners.length>this._events.maxListeners&&(a._listeners.warned=!0,o.call(this,a._listeners.length,s))):a._listeners=n,!0;s=e.shift()}return!0}var u=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},l=10;a.EventEmitter2=a,a.prototype.delimiter=".",a.prototype.setMaxListeners=function(e){e!==t&&(this._events||i.call(this),this._events.maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},a.prototype.event="",a.prototype.once=function(t,e){return this.many(t,1,e),this},a.prototype.many=function(t,e,n){function i(){0==--e&&r.off(t,i),n.apply(this,arguments)}var r=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return i._origin=n,this.on(t,i),r},a.prototype.emit=function(){this._events||i.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;var e,n,r,o,a,c=arguments.length;if(this._all&&this._all.length){if(a=this._all.slice(),c>3)for(e=new Array(c),o=0;o<c;o++)e[o]=arguments[o];for(r=0,n=a.length;r<n;r++)switch(this.event=t,c){case 1:a[r].call(this,t);break;case 2:
a[r].call(this,t,arguments[1]);break;case 3:a[r].call(this,t,arguments[1],arguments[2]);break;default:a[r].apply(this,e)}}if(this.wildcard){a=[];var u="string"==typeof t?t.split(this.delimiter):t.slice();s.call(this,a,u,this.listenerTree,0)}else{if("function"==typeof(a=this._events[t])){switch(this.event=t,c){case 1:a.call(this);break;case 2:a.call(this,arguments[1]);break;case 3:a.call(this,arguments[1],arguments[2]);break;default:for(e=new Array(c-1),o=1;o<c;o++)e[o-1]=arguments[o];a.apply(this,e)}return!0}a&&(a=a.slice())}if(a&&a.length){if(c>3)for(e=new Array(c-1),o=1;o<c;o++)e[o-1]=arguments[o];for(r=0,n=a.length;r<n;r++)switch(this.event=t,c){case 1:a[r].call(this);break;case 2:a[r].call(this,arguments[1]);break;case 3:a[r].call(this,arguments[1],arguments[2]);break;default:a[r].apply(this,e)}return!0}if(!this._all&&"error"===t)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},a.prototype.emitAsync=function(){this._events||i.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var e,n,r,o,a,c=[],u=arguments.length;if(this._all){if(u>3)for(e=new Array(u),o=1;o<u;o++)e[o]=arguments[o];for(r=0,n=this._all.length;r<n;r++)switch(this.event=t,u){case 1:c.push(this._all[r].call(this,t));break;case 2:c.push(this._all[r].call(this,t,arguments[1]));break;case 3:c.push(this._all[r].call(this,t,arguments[1],arguments[2]));break;default:c.push(this._all[r].apply(this,e))}}if(this.wildcard){a=[];var l="string"==typeof t?t.split(this.delimiter):t.slice();s.call(this,a,l,this.listenerTree,0)}else a=this._events[t];if("function"==typeof a)switch(this.event=t,u){case 1:c.push(a.call(this));break;case 2:c.push(a.call(this,arguments[1]));break;case 3:c.push(a.call(this,arguments[1],arguments[2]));break;default:for(e=new Array(u-1),o=1;o<u;o++)e[o-1]=arguments[o];c.push(a.apply(this,e))}else if(a&&a.length){if(u>3)for(e=new Array(u-1),o=1;o<u;o++)e[o-1]=arguments[o];for(r=0,n=a.length;r<n;r++)switch(this.event=t,u){case 1:c.push(a[r].call(this));break;case 2:c.push(a[r].call(this,arguments[1]));break;case 3:c.push(a[r].call(this,arguments[1],arguments[2]));break;default:c.push(a[r].apply(this,e))}}else if(!this._all&&"error"===t)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(c)},a.prototype.on=function(t,e){if("function"==typeof t)return this.onAny(t),this;if("function"!=typeof e)throw new Error("on only accepts instances of Function");return this._events||i.call(this),this.emit("newListener",t,e),this.wildcard?(c.call(this,t,e),this):(this._events[t]?("function"==typeof this._events[t]&&(this._events[t]=[this._events[t]]),this._events[t].push(e),!this._events[t].warned&&this._events.maxListeners>0&&this._events[t].length>this._events.maxListeners&&(this._events[t].warned=!0,o.call(this,this._events[t].length,t))):this._events[t]=e,this)},a.prototype.onAny=function(t){if("function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(t),this},a.prototype.addListener=a.prototype.on,a.prototype.off=function(e,n){function i(e){if(e!==t){var n=Object.keys(e);for(var r in n){var o=n[r],a=e[o];a instanceof Function||"object"!=typeof a||null===a||(Object.keys(a).length>0&&i(e[o]),0===Object.keys(a).length&&delete e[o])}}}if("function"!=typeof n)throw new Error("removeListener only takes instances of Function");var r,o=[];if(this.wildcard){var a="string"==typeof e?e.split(this.delimiter):e.slice();o=s.call(this,null,a,this.listenerTree,0)}else{if(!this._events[e])return this;r=this._events[e],o.push({_listeners:r})}for(var c=0;c<o.length;c++){var l=o[c];if(r=l._listeners,u(r)){for(var d=-1,h=0,f=r.length;h<f;h++)if(r[h]===n||r[h].listener&&r[h].listener===n||r[h]._origin&&r[h]._origin===n){d=h;break}if(d<0)continue;return this.wildcard?l._listeners.splice(d,1):this._events[e].splice(d,1),0===r.length&&(this.wildcard?delete l._listeners:delete this._events[e]),this.emit("removeListener",e,n),this}(r===n||r.listener&&r.listener===n||r._origin&&r._origin===n)&&(this.wildcard?delete l._listeners:delete this._events[e],this.emit("removeListener",e,n))}return i(this.listenerTree),this},a.prototype.offAny=function(t){var e,n=0,i=0;if(t&&this._all&&this._all.length>0){for(e=this._all,n=0,i=e.length;n<i;n++)if(t===e[n])return e.splice(n,1),this.emit("removeListenerAny",t),this}else{for(e=this._all,n=0,i=e.length;n<i;n++)this.emit("removeListenerAny",e[n]);this._all=[]}return this},a.prototype.removeListener=a.prototype.off,a.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||i.call(this),this;if(this.wildcard)for(var e="string"==typeof t?t.split(this.delimiter):t.slice(),n=s.call(this,null,e,this.listenerTree,0),r=0;r<n.length;r++){var o=n[r];o._listeners=null}else this._events&&(this._events[t]=null);return this},a.prototype.listeners=function(t){if(this.wildcard){var e=[],n="string"==typeof t?t.split(this.delimiter):t.slice();return s.call(this,e,n,this.listenerTree,0),e}return this._events||i.call(this),this._events[t]||(this._events[t]=[]),u(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},a.prototype.listenerCount=function(t){return this.listeners(t).length},a.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define(function(){return a}):"object"==typeof n?e.exports=a:window.EventEmitter2=a}()},{}],21:[function(t,n,i){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||e}function o(t){return"function"==typeof t}function a(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function c(t){return void 0===t}n.exports=r,r.EventEmitter=r,r.prototype._events=e,r.prototype._maxListeners=e,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(t){if(!a(t)||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},r.prototype.emit=function(t){var e,n,i,r,a,u;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var l=new Error('Uncaught, unspecified "error" event. ('+e+")");throw l.context=e,l}if(n=this._events[t],c(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:r=Array.prototype.slice.call(arguments,1),n.apply(this,r)}else if(s(n))for(r=Array.prototype.slice.call(arguments,1),u=n.slice(),i=u.length,a=0;a<i;a++)u[a].apply(this,r);return!0},r.prototype.addListener=function(t,e){var n;if(!o(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,o(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(n=c(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!o(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},r.prototype.removeListener=function(t,e){var n,i,r,a;if(!o(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],r=n.length,i=-1,n===e||o(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(a=r;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},r.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],o(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},r.prototype.listeners=function(t){return this._events&&this._events[t]?o(this._events[t])?[this._events[t]]:this._events[t].slice():[]},r.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(o(e))return 1;if(e)return e.length}return 0},r.listenerCount=function(t,e){return t.listenerCount(e)}},{}],22:[function(t,n,i){(function(t){"use strict";!function(t){function r(t){var n=arguments.length>1&&arguments[1]!==e?arguments[1]:{},i=[],r=0,c=void 0,u=void 0,l=void 0,d=void 0,h=void 0,f=void 0,p=void 0,g=void 0,m=void 0,v=void 0,_=void 0,y=void 0,b=void 0,w=void 0;if(isNaN(t))throw new Error("Invalid arguments");return l=n.bits===!0,_=n.unix===!0,u=n.base||2,v=n.round!==e?n.round:_?1:2,y=n.spacer!==e?n.spacer:_?"":" ",w=n.symbols||n.suffixes||{},b=2===u?n.standard||"jedec":"jedec",m=n.output||"string",h=n.fullform===!0,f=n.fullforms instanceof Array?n.fullforms:[],c=n.exponent!==e?n.exponent:-1,g=Number(t),p=g<0,d=u>2?1e3:1024,p&&(g=-g),(c===-1||isNaN(c))&&(c=Math.floor(Math.log(g)/Math.log(d)))<0&&(c=0),c>8&&(c=8),0===g?(i[0]=0,i[1]=_?"":a[b][l?"bits":"bytes"][c]):(r=g/(2===u?Math.pow(2,10*c):Math.pow(1e3,c)),l&&(r*=8)>=d&&c<8&&(r/=d,c++),i[0]=Number(r.toFixed(c>0?v:0)),i[1]=10===u&&1===c?l?"kb":"kB":a[b][l?"bits":"bytes"][c],_&&(i[1]="jedec"===b?i[1].charAt(0):c>0?i[1].replace(/B$/,""):i[1],o.test(i[1])&&(i[0]=Math.floor(i[0]),i[1]=""))),p&&(i[0]=-i[0]),i[1]=w[i[1]]||i[1],"array"===m?i:"exponent"===m?c:"object"===m?{value:i[0],suffix:i[1],symbol:i[1]}:(h&&(i[1]=f[c]?f[c]:s[b][c]+(l?"bit":"byte")+(1===i[0]?"":"s")),i.join(y))}var o=/^(b|B)$/,a={iec:{bits:["b","Kib","Mib","Gib","Tib","Pib","Eib","Zib","Yib"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["b","Kb","Mb","Gb","Tb","Pb","Eb","Zb","Yb"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},s={iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]};r.partial=function(t){return function(e){return r(e,t)}},void 0!==i?n.exports=r:"function"==typeof define&&define.amd?define(function(){return r}):t.filesize=r}("undefined"!=typeof window?window:t)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(t,n,i){(function(t){function i(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}function r(t,e,n,a,s){var c=-1,u=t.length;for(n||(n=o),s||(s=[]);++c<u;){var l=t[c];e>0&&n(l)?e>1?r(l,e-1,n,a,s):i(s,l):a||(s[s.length]=l)}return s}function o(t){return E(t)||s(t)||!!(A&&t&&t[A])}function a(t){return(t?t.length:0)?r(t,p):[]}function s(t){return u(t)&&T.call(t,"callee")&&(!O.call(t,"callee")||C.call(t)==m)}function c(t){return null!=t&&d(t.length)&&!l(t)}function u(t){return f(t)&&c(t)}function l(t){var e=h(t)?C.call(t):"";return e==v||e==_}function d(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=g}function h(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function f(t){return!!t&&"object"==typeof t}var p=1/0,g=9007199254740991,m="[object Arguments]",v="[object Function]",_="[object GeneratorFunction]",y="object"==typeof t&&t&&t.Object===Object&&t,b="object"==typeof self&&self&&self.Object===Object&&self,w=y||b||Function("return this")(),x=Object.prototype,T=x.hasOwnProperty,C=x.toString,S=w.Symbol,O=x.propertyIsEnumerable,A=S?S.isConcatSpreadable:e,E=Array.isArray;n.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],24:[function(t,e,n){e.exports=t("./forEach")},{"./forEach":25}],25:[function(t,e,n){var i=t("../internal/arrayEach"),r=t("../internal/baseEach"),o=t("../internal/createForEach"),a=o(i,r);e.exports=a},{"../internal/arrayEach":29,"../internal/baseEach":30,"../internal/createForEach":39}],26:[function(t,e,n){var i=t("../internal/getNative"),r=i(Date,"now"),o=r||function(){return(new Date).getTime()};e.exports=o},{"../internal/getNative":41}],27:[function(t,n,i){function r(t,n,i){function r(){_&&clearTimeout(_),p&&clearTimeout(p),b=0,p=_=y=e}function u(n,i){i&&clearTimeout(i),p=_=y=e,n&&(b=a(),g=t.apply(v,f),_||p||(f=v=e))}function l(){var t=n-(a()-m);t<=0||t>n?u(y,p):_=setTimeout(l,t)}function d(){u(x,_)}function h(){if(f=arguments,m=a(),v=this,y=x&&(_||!T),w===!1)var i=T&&!_;else{p||T||(b=m);var r=w-(m-b),o=r<=0||r>w;o?(p&&(p=clearTimeout(p)),b=m,g=t.apply(v,f)):p||(p=setTimeout(d,r))}return o&&_?_=clearTimeout(_):_||n===w||(_=setTimeout(l,n)),i&&(o=!0,g=t.apply(v,f)),!o||_||p||(f=v=e),g}var f,p,g,m,v,_,y,b=0,w=!1,x=!0;if("function"!=typeof t)throw new TypeError(s);if(n=n<0?0:+n||0,i===!0){var T=!0;x=!1}else o(i)&&(T=!!i.leading,w="maxWait"in i&&c(+i.maxWait||0,n),x="trailing"in i?!!i.trailing:x);return h.cancel=r,h}var o=t("../lang/isObject"),a=t("../date/now"),s="Expected a function",c=Math.max;n.exports=r},{"../date/now":26,"../lang/isObject":53}],28:[function(t,e,n){(function(t){(function(){function i(t,e){if(t!==e){var n=null===t,i=t===S,r=t===t,o=null===e,a=e===S,s=e===e;if(t>e&&!o||!r||n&&!a&&s||i&&s)return 1;if(t<e&&!n||!s||o&&!i&&r||a&&r)return-1}return 0}function r(t,e,n){for(var i=t.length,r=n?i:-1;n?r--:++r<i;)if(e(t[r],r,t))return r;return-1}function o(t,e,n){if(e!==e)return m(t,n);for(var i=n-1,r=t.length;++i<r;)if(t[i]===e)return i;return-1}function a(t){return"function"==typeof t||!1}function s(t){return null==t?"":t+""}function c(t,e){for(var n=-1,i=t.length;++n<i&&e.indexOf(t.charAt(n))>-1;);return n}function u(t,e){for(var n=t.length;n--&&e.indexOf(t.charAt(n))>-1;);return n}function l(t,e){return i(t.criteria,e.criteria)||t.index-e.index}function d(t,e,n){for(var r=-1,o=t.criteria,a=e.criteria,s=o.length,c=n.length;++r<s;){var u=i(o[r],a[r]);if(u){if(r>=c)return u;var l=n[r];return u*("asc"===l||l===!0?1:-1)}}return t.index-e.index}function h(t){return Bt[t]}function f(t){return Ht[t]}function p(t,e,n){return e?t=Vt[t]:n&&(t=Wt[t]),"\\"+t}function g(t){return"\\"+Wt[t]}function m(t,e,n){for(var i=t.length,r=e+(n?0:-1);n?r--:++r<i;){var o=t[r];if(o!==o)return r}return-1}function v(t){return!!t&&"object"==typeof t}function _(t){return t<=160&&t>=9&&t<=13||32==t||160==t||5760==t||6158==t||t>=8192&&(t<=8202||8232==t||8233==t||8239==t||8287==t||12288==t||65279==t)}function y(t,e){for(var n=-1,i=t.length,r=-1,o=[];++n<i;)t[n]===e&&(t[n]=$,o[++r]=n);return o}function b(t,e){for(var n,i=-1,r=t.length,o=-1,a=[];++i<r;){var s=t[i],c=e?e(s,i,t):s;i&&n===c||(n=c,a[++o]=s)}return a}function w(t){for(var e=-1,n=t.length;++e<n&&_(t.charCodeAt(e)););return e}function x(t){for(var e=t.length;e--&&_(t.charCodeAt(e)););return e}function T(t){return Ft[t]}function C(t){function e(t){if(v(t)&&!js(t)&&!(t instanceof Bt)){if(t instanceof _)return t;if(ea.call(t,"__chain__")&&ea.call(t,"__wrapped__"))return fi(t)}return new _(t)}function n(){}function _(t,e,n){this.__wrapped__=t,this.__actions__=n||[],this.__chain__=!!e}function Bt(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ea,this.__views__=[]}function Ht(){var t=new Bt(this.__wrapped__);return t.__actions__=ne(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=ne(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=ne(this.__views__),t}function Ft(){if(this.__filtered__){var t=new Bt(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function $t(){var t=this.__wrapped__.value(),e=this.__dir__,n=js(t),i=e<0,r=n?t.length:0,o=Wn(0,r,this.__views__),a=o.start,s=o.end,c=s-a,u=i?s:a-1,l=this.__iteratees__,d=l.length,h=0,f=Ta(c,this.__takeCount__);if(!n||r<q||r==c&&f==c)return nn(i&&n?t.reverse():t,this.__actions__);var p=[];t:for(;c--&&h<f;){u+=e;for(var g=-1,m=t[u];++g<d;){var v=l[g],_=v.iteratee,y=v.type,b=_(m);if(y==H)m=b;else if(!b){if(y==B)continue t;break t}}p[h++]=m}return p}function Vt(){this.__data__={}}function Wt(t){return this.has(t)&&delete this.__data__[t]}function Jt(t){return"__proto__"==t?S:this.__data__[t]}function Gt(t){return"__proto__"!=t&&ea.call(this.__data__,t)}function Xt(t,e){return"__proto__"!=t&&(this.__data__[t]=e),this}function Qt(t){var e=t?t.length:0;for(this.data={hash:va(null),set:new da};e--;)this.push(t[e])}function Yt(t,e){var n=t.data;return("string"==typeof e||Mr(e)?n.set.has(e):n.hash[e])?0:-1}function Kt(t){var e=this.data;"string"==typeof t||Mr(t)?e.set.add(t):e.hash[t]=!0}function ee(t,e){for(var n=-1,i=t.length,r=-1,o=e.length,a=Bo(i+o);++n<i;)a[n]=t[n];for(;++r<o;)a[n++]=e[r];return a}function ne(t,e){var n=-1,i=t.length;for(e||(e=Bo(i));++n<i;)e[n]=t[n];return e}function ie(t,e){for(var n=-1,i=t.length;++n<i&&e(t[n],n,t)!==!1;);return t}function re(t,e){for(var n=t.length;n--&&e(t[n],n,t)!==!1;);return t}function oe(t,e){for(var n=-1,i=t.length;++n<i;)if(!e(t[n],n,t))return!1;return!0}function ae(t,e,n,i){for(var r=-1,o=t.length,a=i,s=a;++r<o;){var c=t[r],u=+e(c);n(u,a)&&(a=u,s=c)}return s}function se(t,e){for(var n=-1,i=t.length,r=-1,o=[];++n<i;){var a=t[n];e(a,n,t)&&(o[++r]=a)}return o}function ce(t,e){for(var n=-1,i=t.length,r=Bo(i);++n<i;)r[n]=e(t[n],n,t);return r}function ue(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t}function le(t,e,n,i){var r=-1,o=t.length;for(i&&o&&(n=t[++r]);++r<o;)n=e(n,t[r],r,t);return n}function de(t,e,n,i){var r=t.length;for(i&&r&&(n=t[--r]);r--;)n=e(n,t[r],r,t);return n}function he(t,e){for(var n=-1,i=t.length;++n<i;)if(e(t[n],n,t))return!0;return!1}function fe(t,e){for(var n=t.length,i=0;n--;)i+=+e(t[n])||0;return i}function pe(t,e){return t===S?e:t}function ge(t,e,n,i){return t!==S&&ea.call(i,n)?t:e}function me(t,e,n){for(var i=-1,r=qs(e),o=r.length;++i<o;){var a=r[i],s=t[a],c=n(s,e[a],a,t,e);(c===c?c===s:s!==s)&&(s!==S||a in t)||(t[a]=c)}return t}function ve(t,e){return null==e?t:ye(e,qs(e),t)}function _e(t,e){for(var n=-1,i=null==t,r=!i&&Yn(t),o=r?t.length:0,a=e.length,s=Bo(a);++n<a;){var c=e[n];s[n]=r?Kn(c,o)?t[c]:S:i?S:t[c]}return s}function ye(t,e,n){n||(n={});for(var i=-1,r=e.length;++i<r;){var o=e[i];n[o]=t[o]}return n}function be(t,e,n){var i=typeof t;return"function"==i?e===S?t:an(t,e,n):null==t?Eo:"object"==i?Ue(t):e===S?Mo(t):qe(t,e)}function we(t,e,n,i,r,o,a){var s;if(n&&(s=r?n(t,i,r):n(t)),s!==S)return s;if(!Mr(t))return t;var c=js(t);if(c){if(s=Jn(t),!e)return ne(t,s)}else{var u=ia.call(t),l=u==Q;if(u!=K&&u!=V&&(!l||r))return qt[u]?Xn(t,u,e):r?t:{};if(s=Gn(l?{}:t),!e)return ve(s,t)}o||(o=[]),a||(a=[]);for(var d=o.length;d--;)if(o[d]==t)return a[d];return o.push(t),a.push(s),(c?ie:Re)(t,function(i,r){s[r]=we(i,e,n,r,t,o,a)}),s}function xe(t,e,n){if("function"!=typeof t)throw new Qo(F);return ha(function(){t.apply(S,n)},e)}function Te(t,e){var n=t?t.length:0,i=[];if(!n)return i;var r=-1,a=Fn(),s=a==o,c=s&&e.length>=q?gn(e):null,u=e.length;c&&(a=Yt,s=!1,e=c);t:for(;++r<n;){var l=t[r];if(s&&l===l){for(var d=u;d--;)if(e[d]===l)continue t;i.push(l)}else a(e,l,0)<0&&i.push(l)}return i}function Ce(t,e){var n=!0;return za(t,function(t,i,r){return n=!!e(t,i,r)}),n}function Se(t,e,n,i){var r=i,o=r;return za(t,function(t,a,s){var c=+e(t,a,s);(n(c,r)||c===i&&c===o)&&(r=c,o=t)}),o}function Oe(t,e,n,i){var r=t.length;for(n=null==n?0:+n||0,n<0&&(n=-n>r?0:r+n),i=i===S||i>r?r:+i||0,i<0&&(i+=r),r=n>i?0:i>>>0,n>>>=0;n<r;)t[n++]=e;return t}function Ae(t,e){var n=[];return za(t,function(t,i,r){e(t,i,r)&&n.push(t)}),n}function Ee(t,e,n,i){var r;return n(t,function(t,n,o){if(e(t,n,o))return r=i?n:t,!1}),r}function je(t,e,n,i){i||(i=[]);for(var r=-1,o=t.length;++r<o;){var a=t[r];v(a)&&Yn(a)&&(n||js(a)||Sr(a))?e?je(a,e,n,i):ue(i,a):n||(i[i.length]=a)}return i}function ke(t,e){return Pa(t,e,to)}function Re(t,e){return Pa(t,e,qs)}function Ie(t,e){return Ua(t,e,qs)}function Ne(t,e){for(var n=-1,i=e.length,r=-1,o=[];++n<i;){var a=e[n];Nr(t[a])&&(o[++r]=a)}return o}function Me(t,e,n){if(null!=t){n!==S&&n in di(t)&&(e=[n]);for(var i=0,r=e.length;null!=t&&i<r;)t=t[e[i++]];return i&&i==r?t:S}}function De(t,e,n,i,r,o){return t===e||(null==t||null==e||!Mr(t)&&!v(e)?t!==t&&e!==e:ze(t,e,De,n,i,r,o))}function ze(t,e,n,i,r,o,a){var s=js(t),c=js(e),u=W,l=W;s||(u=ia.call(t),u==V?u=K:u!=K&&(s=Fr(t))),c||(l=ia.call(e),l==V?l=K:l!=K&&(c=Fr(e)));var d=u==K,h=l==K,f=u==l;if(f&&!s&&!d)return Un(t,e,u);if(!r){var p=d&&ea.call(t,"__wrapped__"),g=h&&ea.call(e,"__wrapped__");if(p||g)return n(p?t.value():t,g?e.value():e,i,r,o,a)}if(!f)return!1;o||(o=[]),a||(a=[]);for(var m=o.length;m--;)if(o[m]==t)return a[m]==e;o.push(t),a.push(e);var v=(s?Pn:qn)(t,e,n,i,r,o,a);return o.pop(),a.pop(),v}function Le(t,e,n){var i=e.length,r=i,o=!n;if(null==t)return!r;for(t=di(t);i--;){var a=e[i];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++i<r;){a=e[i];var s=a[0],c=t[s],u=a[1];if(o&&a[2]){if(c===S&&!(s in t))return!1}else{var l=n?n(c,u,s):S;if(!(l===S?De(u,c,n,!0):l))return!1}}return!0}function Pe(t,e){var n=-1,i=Yn(t)?Bo(t.length):[];return za(t,function(t,r,o){i[++n]=e(t,r,o)}),i}function Ue(t){var e=$n(t);if(1==e.length&&e[0][2]){var n=e[0][0],i=e[0][1];return function(t){return null!=t&&(t[n]===i&&(i!==S||n in di(t)))}}return function(t){return Le(t,e)}}function qe(t,e){var n=js(t),i=ti(t)&&ii(e),r=t+"";return t=hi(t),function(o){if(null==o)return!1;var a=r;if(o=di(o),(n||!i)&&!(a in o)){if(null==(o=1==t.length?o:Me(o,Ge(t,0,-1))))return!1;a=Oi(t),o=di(o)}return o[a]===e?e!==S||a in o:De(e,o[a],S,!0)}}function Be(t,e,n,i,r){if(!Mr(t))return t;var o=Yn(e)&&(js(e)||Fr(e)),a=o?S:qs(e);return ie(a||e,function(s,c){if(a&&(c=s,s=e[c]),v(s))i||(i=[]),r||(r=[]),He(t,e,c,Be,n,i,r);else{var u=t[c],l=n?n(u,s,c,t,e):S,d=l===S;d&&(l=s),l===S&&(!o||c in t)||!d&&(l===l?l===u:u!==u)||(t[c]=l)}}),t}function He(t,e,n,i,r,o,a){for(var s=o.length,c=e[n];s--;)if(o[s]==c)return void(t[n]=a[s]);var u=t[n],l=r?r(u,c,n,t,e):S,d=l===S;d&&(l=c,Yn(c)&&(js(c)||Fr(c))?l=js(u)?u:Yn(u)?ne(u):[]:qr(c)||Sr(c)?l=Sr(u)?Gr(u):qr(u)?u:{}:d=!1),o.push(c),a.push(l),d?t[n]=i(l,c,r,o,a):(l===l?l!==u:u===u)&&(t[n]=l)}function Fe(t){return function(e){return null==e?S:e[t]}}function $e(t){var e=t+"";return t=hi(t),function(n){return Me(n,t,e)}}function Ve(t,e){for(var n=t?e.length:0;n--;){var i=e[n];if(i!=r&&Kn(i)){var r=i;fa.call(t,i,1)}}return t}function We(t,e){return t+_a(Oa()*(e-t+1))}function Je(t,e,n,i,r){return r(t,function(t,r,o){n=i?(i=!1,t):e(n,t,r,o)}),n}function Ge(t,e,n){var i=-1,r=t.length;e=null==e?0:+e||0,e<0&&(e=-e>r?0:r+e),n=n===S||n>r?r:+n||0,n<0&&(n+=r),r=e>n?0:n-e>>>0,e>>>=0;for(var o=Bo(r);++i<r;)o[i]=t[i+e];return o}function Xe(t,e){var n;return za(t,function(t,i,r){return!(n=e(t,i,r))}),!!n}function Qe(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}function Ye(t,e,n){var i=Bn(),r=-1;return e=ce(e,function(t){return i(t)}),Qe(Pe(t,function(t){return{criteria:ce(e,function(e){return e(t)}),index:++r,value:t}}),function(t,e){return d(t,e,n)})}function Ke(t,e){var n=0;return za(t,function(t,i,r){n+=+e(t,i,r)||0}),n}function Ze(t,e){var n=-1,i=Fn(),r=t.length,a=i==o,s=a&&r>=q,c=s?gn():null,u=[];c?(i=Yt,a=!1):(s=!1,c=e?[]:u);t:for(;++n<r;){var l=t[n],d=e?e(l,n,t):l;if(a&&l===l){for(var h=c.length;h--;)if(c[h]===d)continue t;e&&c.push(d),u.push(l)}else i(c,d,0)<0&&((e||s)&&c.push(d),u.push(l))}return u}function tn(t,e){for(var n=-1,i=e.length,r=Bo(i);++n<i;)r[n]=t[e[n]];return r}function en(t,e,n,i){for(var r=t.length,o=i?r:-1;(i?o--:++o<r)&&e(t[o],o,t););return n?Ge(t,i?0:o,i?o+1:r):Ge(t,i?o+1:0,i?r:o)}function nn(t,e){var n=t;n instanceof Bt&&(n=n.value());for(var i=-1,r=e.length;++i<r;){var o=e[i];n=o.func.apply(o.thisArg,ue([n],o.args))}return n}function rn(t,e,n){var i=0,r=t?t.length:i;if("number"==typeof e&&e===e&&r<=Ra){for(;i<r;){var o=i+r>>>1,a=t[o];(n?a<=e:a<e)&&null!==a?i=o+1:r=o}return r}return on(t,e,Eo,n)}function on(t,e,n,i){e=n(e);for(var r=0,o=t?t.length:0,a=e!==e,s=null===e,c=e===S;r<o;){var u=_a((r+o)/2),l=n(t[u]),d=l!==S,h=l===l;if(a)var f=h||i;else f=s?h&&d&&(i||null!=l):c?h&&(i||d):null!=l&&(i?l<=e:l<e);f?r=u+1:o=u}return Ta(o,ka)}function an(t,e,n){if("function"!=typeof t)return Eo;if(e===S)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,o){return t.call(e,n,i,r,o)};case 5:return function(n,i,r,o,a){return t.call(e,n,i,r,o,a)}}return function(){return t.apply(e,arguments)}}function sn(t){var e=new aa(t.byteLength);return new pa(e).set(new pa(t)),e}function cn(t,e,n){for(var i=n.length,r=-1,o=xa(t.length-i,0),a=-1,s=e.length,c=Bo(s+o);++a<s;)c[a]=e[a];for(;++r<i;)c[n[r]]=t[r];for(;o--;)c[a++]=t[r++];return c}function un(t,e,n){for(var i=-1,r=n.length,o=-1,a=xa(t.length-r,0),s=-1,c=e.length,u=Bo(a+c);++o<a;)u[o]=t[o];for(var l=o;++s<c;)u[l+s]=e[s];for(;++i<r;)u[l+n[i]]=t[o++];return u}function ln(t,e){return function(n,i,r){var o=e?e():{};if(i=Bn(i,r,3),js(n))for(var a=-1,s=n.length;++a<s;){var c=n[a];t(o,c,i(c,a,n),n)}else za(n,function(e,n,r){t(o,e,i(e,n,r),r)});return o}}function dn(t){return vr(function(e,n){var i=-1,r=null==e?0:n.length,o=r>2?n[r-2]:S,a=r>2?n[2]:S,s=r>1?n[r-1]:S;for("function"==typeof o?(o=an(o,s,5),r-=2):(o="function"==typeof s?s:S,r-=o?1:0),a&&Zn(n[0],n[1],a)&&(o=r<3?S:o,r=1);++i<r;){var c=n[i];c&&t(e,c,o)}return e})}function hn(t,e){return function(n,i){var r=n?Ha(n):0;if(!ni(r))return t(n,i);for(var o=e?r:-1,a=di(n);(e?o--:++o<r)&&i(a[o],o,a)!==!1;);return n}}function fn(t){return function(e,n,i){for(var r=di(e),o=i(e),a=o.length,s=t?a:-1;t?s--:++s<a;){var c=o[s];if(n(r[c],c,r)===!1)break}return e}}function pn(t,e){function n(){return(this&&this!==Zt&&this instanceof n?i:t).apply(e,arguments)}var i=vn(t);return n}function gn(t){return va&&da?new Qt(t):null}function mn(t){return function(e){for(var n=-1,i=So(lo(e)),r=i.length,o="";++n<r;)o=t(o,i[n],n);return o}}function vn(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Da(t.prototype),i=t.apply(n,e);return Mr(i)?i:n}}function _n(t){function e(n,i,r){r&&Zn(n,i,r)&&(i=S);var o=Ln(n,t,S,S,S,S,S,i);return o.placeholder=e.placeholder,o}return e}function yn(t,e){return vr(function(n){var i=n[0];return null==i?i:(n.push(e),t.apply(S,n))})}function bn(t,e){return function(n,i,r){if(r&&Zn(n,i,r)&&(i=S),i=Bn(i,r,3),1==i.length){n=js(n)?n:li(n);var o=ae(n,i,t,e);if(!n.length||o!==e)return o}return Se(n,i,t,e)}}function wn(t,e){return function(n,i,o){if(i=Bn(i,o,3),js(n)){var a=r(n,i,e);return a>-1?n[a]:S}return Ee(n,i,t)}}function xn(t){return function(e,n,i){return e&&e.length?(n=Bn(n,i,3),r(e,n,t)):-1}}function Tn(t){return function(e,n,i){return n=Bn(n,i,3),Ee(e,n,t,!0)}}function Cn(t){return function(){for(var e,n=arguments.length,i=t?n:-1,r=0,o=Bo(n);t?i--:++i<n;){var a=o[r++]=arguments[i];if("function"!=typeof a)throw new Qo(F);!e&&_.prototype.thru&&"wrapper"==Hn(a)&&(e=new _([],!0))}for(i=e?-1:n;++i<n;){a=o[i];var s=Hn(a),c="wrapper"==s?Ba(a):S;e=c&&ei(c[0])&&c[1]==(M|k|I|D)&&!c[4].length&&1==c[9]?e[Hn(c[0])].apply(e,c[3]):1==a.length&&ei(a)?e[s]():e.thru(a)}return function(){var t=arguments,i=t[0];if(e&&1==t.length&&js(i)&&i.length>=q)return e.plant(i).value();for(var r=0,a=n?o[r].apply(this,t):i;++r<n;)a=o[r].call(this,a);return a}}}function Sn(t,e){return function(n,i,r){return"function"==typeof i&&r===S&&js(n)?t(n,i):e(n,an(i,r,3))}}function On(t){return function(e,n,i){return"function"==typeof n&&i===S||(n=an(n,i,3)),t(e,n,to)}}function An(t){return function(e,n,i){return"function"==typeof n&&i===S||(n=an(n,i,3)),t(e,n)}}function En(t){return function(e,n,i){var r={};return n=Bn(n,i,3),Re(e,function(e,i,o){var a=n(e,i,o);i=t?a:i,e=t?e:a,r[i]=e}),r}}function jn(t){return function(e,n,i){return e=s(e),(t?e:"")+Nn(e,n,i)+(t?"":e)}}function kn(t){var e=vr(function(n,i){var r=y(i,e.placeholder);return Ln(n,t,S,i,r)});return e}function Rn(t,e){return function(n,i,r,o){var a=arguments.length<3;return"function"==typeof i&&o===S&&js(n)?t(n,i,r,a):Je(n,Bn(i,o,4),r,a,e)}}function In(t,e,n,i,r,o,a,s,c,u){function l(){for(var _=arguments.length,b=_,w=Bo(_);b--;)w[b]=arguments[b];if(i&&(w=cn(w,i,r)),o&&(w=un(w,o,a)),p||m){var x=l.placeholder,T=y(w,x);if((_-=T.length)<u){var C=s?ne(s):S,O=xa(u-_,0),j=p?T:S,k=p?S:T,R=p?w:S,M=p?S:w;e|=p?I:N,e&=~(p?N:I),g||(e&=~(A|E));var D=[t,e,n,R,j,M,k,C,c,O],z=In.apply(S,D);return ei(t)&&Fa(z,D),z.placeholder=x,z}}var L=h?n:this,P=f?L[t]:t;return s&&(w=ci(w,s)),d&&c<w.length&&(w.length=c),this&&this!==Zt&&this instanceof l&&(P=v||vn(t)),P.apply(L,w)}var d=e&M,h=e&A,f=e&E,p=e&k,g=e&j,m=e&R,v=f?S:vn(t);return l}function Nn(t,e,n){var i=t.length;if(e=+e,i>=e||!ba(e))return"";var r=e-i;return n=null==n?" ":n+"",vo(n,ma(r/n.length)).slice(0,r)}function Mn(t,e,n,i){function r(){for(var e=-1,s=arguments.length,c=-1,u=i.length,l=Bo(u+s);++c<u;)l[c]=i[c];for(;s--;)l[c++]=arguments[++e];return(this&&this!==Zt&&this instanceof r?a:t).apply(o?n:this,l)}var o=e&A,a=vn(t);return r}function Dn(t){var e=Vo[t];return function(t,n){return n=n===S?0:+n||0,n?(n=ua(10,n),e(t*n)/n):e(t)}}function zn(t){return function(e,n,i,r){var o=Bn(i);return null==i&&o===be?rn(e,n,t):on(e,n,o(i,r,1),t)}}function Ln(t,e,n,i,r,o,a,s){var c=e&E;if(!c&&"function"!=typeof t)throw new Qo(F);var u=i?i.length:0;if(u||(e&=~(I|N),i=r=S),u-=r?r.length:0,e&N){var l=i,d=r;i=r=S}var h=c?S:Ba(t),f=[t,e,n,i,r,l,d,o,a,s];if(h&&(ri(f,h),e=f[1],s=f[9]),f[9]=null==s?c?0:t.length:xa(s-u,0)||0,e==A)var p=pn(f[0],f[2]);else p=e!=I&&e!=(A|I)||f[4].length?In.apply(S,f):Mn.apply(S,f);return(h?qa:Fa)(p,f)}function Pn(t,e,n,i,r,o,a){var s=-1,c=t.length,u=e.length;if(c!=u&&!(r&&u>c))return!1;for(;++s<c;){var l=t[s],d=e[s],h=i?i(r?d:l,r?l:d,s):S;if(h!==S){if(h)continue;return!1}if(r){if(!he(e,function(t){return l===t||n(l,t,i,r,o,a)}))return!1}else if(l!==d&&!n(l,d,i,r,o,a))return!1}return!0}function Un(t,e,n){switch(n){case J:case G:return+t==+e;case X:return t.name==e.name&&t.message==e.message;case Y:return t!=+t?e!=+e:t==+e;case Z:case tt:return t==e+""}return!1}function qn(t,e,n,i,r,o,a){var s=qs(t),c=s.length;if(c!=qs(e).length&&!r)return!1;for(var u=c;u--;){var l=s[u];if(!(r?l in e:ea.call(e,l)))return!1}for(var d=r;++u<c;){l=s[u];var h=t[l],f=e[l],p=i?i(r?f:h,r?h:f,l):S;if(!(p===S?n(h,f,i,r,o,a):p))return!1;d||(d="constructor"==l)}if(!d){var g=t.constructor,m=e.constructor;if(g!=m&&"constructor"in t&&"constructor"in e&&!("function"==typeof g&&g instanceof g&&"function"==typeof m&&m instanceof m))return!1}return!0}function Bn(t,n,i){var r=e.callback||Oo;return r=r===Oo?be:r,i?r(t,n,i):r}function Hn(t){for(var e=t.name,n=Ma[e],i=n?n.length:0;i--;){var r=n[i],o=r.func;if(null==o||o==t)return r.name}return e}function Fn(t,n,i){var r=e.indexOf||Ci;return r=r===Ci?o:r,t?r(t,n,i):r}function $n(t){for(var e=eo(t),n=e.length;n--;)e[n][2]=ii(e[n][1]);return e}function Vn(t,e){var n=null==t?S:t[e];return Lr(n)?n:S}function Wn(t,e,n){for(var i=-1,r=n.length;++i<r;){var o=n[i],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Ta(e,t+a);break
;case"takeRight":t=xa(t,e-a)}}return{start:t,end:e}}function Jn(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&ea.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function Gn(t){var e=t.constructor;return"function"==typeof e&&e instanceof e||(e=Jo),new e}function Xn(t,e,n){var i=t.constructor;switch(e){case et:return sn(t);case J:case G:return new i(+t);case nt:case it:case rt:case ot:case at:case st:case ct:case ut:case lt:var r=t.buffer;return new i(n?sn(r):r,t.byteOffset,t.length);case Y:case tt:return new i(t);case Z:var o=new i(t.source,jt.exec(t));o.lastIndex=t.lastIndex}return o}function Qn(t,e,n){null==t||ti(e,t)||(e=hi(e),t=1==e.length?t:Me(t,Ge(e,0,-1)),e=Oi(e));var i=null==t?t:t[e];return null==i?S:i.apply(t,n)}function Yn(t){return null!=t&&ni(Ha(t))}function Kn(t,e){return t="number"==typeof t||It.test(t)?+t:-1,e=null==e?Ia:e,t>-1&&t%1==0&&t<e}function Zn(t,e,n){if(!Mr(n))return!1;var i=typeof e;if("number"==i?Yn(n)&&Kn(e,n.length):"string"==i&&e in n){var r=n[e];return t===t?t===r:r!==r}return!1}function ti(t,e){var n=typeof t;return!!("string"==n&&xt.test(t)||"number"==n)||!js(t)&&(!wt.test(t)||null!=e&&t in di(e))}function ei(t){var n=Hn(t);if(!(n in Bt.prototype))return!1;var i=e[n];if(t===i)return!0;var r=Ba(i);return!!r&&t===r[0]}function ni(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Ia}function ii(t){return t===t&&!Mr(t)}function ri(t,e){var n=t[1],i=e[1],r=n|i,o=r<M,a=i==M&&n==k||i==M&&n==D&&t[7].length<=e[8]||i==(M|D)&&n==k;if(!o&&!a)return t;i&A&&(t[2]=e[2],r|=n&A?0:j);var s=e[3];if(s){var c=t[3];t[3]=c?cn(c,s,e[4]):ne(s),t[4]=c?y(t[3],$):ne(e[4])}return s=e[5],s&&(c=t[5],t[5]=c?un(c,s,e[6]):ne(s),t[6]=c?y(t[5],$):ne(e[6])),s=e[7],s&&(t[7]=ne(s)),i&M&&(t[8]=null==t[8]?e[8]:Ta(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=r,t}function oi(t,e){return t===S?e:ks(t,e,oi)}function ai(t,e){t=di(t);for(var n=-1,i=e.length,r={};++n<i;){var o=e[n];o in t&&(r[o]=t[o])}return r}function si(t,e){var n={};return ke(t,function(t,i,r){e(t,i,r)&&(n[i]=t)}),n}function ci(t,e){for(var n=t.length,i=Ta(e.length,n),r=ne(t);i--;){var o=e[i];t[i]=Kn(o,n)?r[o]:S}return t}function ui(t){for(var e=to(t),n=e.length,i=n&&t.length,r=!!i&&ni(i)&&(js(t)||Sr(t)),o=-1,a=[];++o<n;){var s=e[o];(r&&Kn(s,i)||ea.call(t,s))&&a.push(s)}return a}function li(t){return null==t?[]:Yn(t)?Mr(t)?t:Jo(t):oo(t)}function di(t){return Mr(t)?t:Jo(t)}function hi(t){if(js(t))return t;var e=[];return s(t).replace(Tt,function(t,n,i,r){e.push(i?r.replace(At,"$1"):n||t)}),e}function fi(t){return t instanceof Bt?t.clone():new _(t.__wrapped__,t.__chain__,ne(t.__actions__))}function pi(t,e,n){e=(n?Zn(t,e,n):null==e)?1:xa(_a(e)||1,1);for(var i=0,r=t?t.length:0,o=-1,a=Bo(ma(r/e));i<r;)a[++o]=Ge(t,i,i+=e);return a}function gi(t){for(var e=-1,n=t?t.length:0,i=-1,r=[];++e<n;){var o=t[e];o&&(r[++i]=o)}return r}function mi(t,e,n){return(t?t.length:0)?((n?Zn(t,e,n):null==e)&&(e=1),Ge(t,e<0?0:e)):[]}function vi(t,e,n){var i=t?t.length:0;return i?((n?Zn(t,e,n):null==e)&&(e=1),e=i-(+e||0),Ge(t,0,e<0?0:e)):[]}function _i(t,e,n){return t&&t.length?en(t,Bn(e,n,3),!0,!0):[]}function yi(t,e,n){return t&&t.length?en(t,Bn(e,n,3),!0):[]}function bi(t,e,n,i){var r=t?t.length:0;return r?(n&&"number"!=typeof n&&Zn(t,e,n)&&(n=0,i=r),Oe(t,e,n,i)):[]}function wi(t){return t?t[0]:S}function xi(t,e,n){var i=t?t.length:0;return n&&Zn(t,e,n)&&(e=!1),i?je(t,e):[]}function Ti(t){return(t?t.length:0)?je(t,!0):[]}function Ci(t,e,n){var i=t?t.length:0;if(!i)return-1;if("number"==typeof n)n=n<0?xa(i+n,0):n;else if(n){var r=rn(t,e);return r<i&&(e===e?e===t[r]:t[r]!==t[r])?r:-1}return o(t,e,n||0)}function Si(t){return vi(t,1)}function Oi(t){var e=t?t.length:0;return e?t[e-1]:S}function Ai(t,e,n){var i=t?t.length:0;if(!i)return-1;var r=i;if("number"==typeof n)r=(n<0?xa(i+n,0):Ta(n||0,i-1))+1;else if(n){r=rn(t,e,!0)-1;var o=t[r];return(e===e?e===o:o!==o)?r:-1}if(e!==e)return m(t,r,!0);for(;r--;)if(t[r]===e)return r;return-1}function Ei(){var t=arguments,e=t[0];if(!e||!e.length)return e;for(var n=0,i=Fn(),r=t.length;++n<r;)for(var o=0,a=t[n];(o=i(e,a,o))>-1;)fa.call(e,o,1);return e}function ji(t,e,n){var i=[];if(!t||!t.length)return i;var r=-1,o=[],a=t.length;for(e=Bn(e,n,3);++r<a;){var s=t[r];e(s,r,t)&&(i.push(s),o.push(r))}return Ve(t,o),i}function ki(t){return mi(t,1)}function Ri(t,e,n){var i=t?t.length:0;return i?(n&&"number"!=typeof n&&Zn(t,e,n)&&(e=0,n=i),Ge(t,e,n)):[]}function Ii(t,e,n){return(t?t.length:0)?((n?Zn(t,e,n):null==e)&&(e=1),Ge(t,0,e<0?0:e)):[]}function Ni(t,e,n){var i=t?t.length:0;return i?((n?Zn(t,e,n):null==e)&&(e=1),e=i-(+e||0),Ge(t,e<0?0:e)):[]}function Mi(t,e,n){return t&&t.length?en(t,Bn(e,n,3),!1,!0):[]}function Di(t,e,n){return t&&t.length?en(t,Bn(e,n,3)):[]}function zi(t,e,n,i){if(!(t?t.length:0))return[];null!=e&&"boolean"!=typeof e&&(i=n,n=Zn(t,e,i)?S:e,e=!1);var r=Bn();return null==n&&r===be||(n=r(n,i,3)),e&&Fn()==o?b(t,n):Ze(t,n)}function Li(t){if(!t||!t.length)return[];var e=-1,n=0;t=se(t,function(t){if(Yn(t))return n=xa(t.length,n),!0});for(var i=Bo(n);++e<n;)i[e]=ce(t,Fe(e));return i}function Pi(t,e,n){if(!(t?t.length:0))return[];var i=Li(t);return null==e?i:(e=an(e,n,4),ce(i,function(t){return le(t,e,S,!0)}))}function Ui(){for(var t=-1,e=arguments.length;++t<e;){var n=arguments[t];if(Yn(n))var i=i?ue(Te(i,n),Te(n,i)):n}return i?Ze(i):[]}function qi(t,e){var n=-1,i=t?t.length:0,r={};for(!i||e||js(t[0])||(e=[]);++n<i;){var o=t[n];e?r[o]=e[n]:o&&(r[o[0]]=o[1])}return r}function Bi(t){var n=e(t);return n.__chain__=!0,n}function Hi(t,e,n){return e.call(n,t),t}function Fi(t,e,n){return e.call(n,t)}function $i(){return Bi(this)}function Vi(){return new _(this.value(),this.__chain__)}function Wi(t){for(var e,i=this;i instanceof n;){var r=fi(i);e?o.__wrapped__=r:e=r;var o=r;i=i.__wrapped__}return o.__wrapped__=t,e}function Ji(){var t=this.__wrapped__,e=function(t){return n&&n.__dir__<0?t:t.reverse()};if(t instanceof Bt){var n=t;return this.__actions__.length&&(n=new Bt(this)),n=n.reverse(),n.__actions__.push({func:Fi,args:[e],thisArg:S}),new _(n,this.__chain__)}return this.thru(e)}function Gi(){return this.value()+""}function Xi(){return nn(this.__wrapped__,this.__actions__)}function Qi(t,e,n){var i=js(t)?oe:Ce;return n&&Zn(t,e,n)&&(e=S),"function"==typeof e&&n===S||(e=Bn(e,n,3)),i(t,e)}function Yi(t,e,n){var i=js(t)?se:Ae;return e=Bn(e,n,3),i(t,e)}function Ki(t,e){return rs(t,Ue(e))}function Zi(t,e,n,i){var r=t?Ha(t):0;return ni(r)||(t=oo(t),r=t.length),n="number"!=typeof n||i&&Zn(e,n,i)?0:n<0?xa(r+n,0):n||0,"string"==typeof t||!js(t)&&Hr(t)?n<=r&&t.indexOf(e,n)>-1:!!r&&Fn(t,e,n)>-1}function tr(t,e,n){var i=js(t)?ce:Pe;return e=Bn(e,n,3),i(t,e)}function er(t,e){return tr(t,Mo(e))}function nr(t,e,n){var i=js(t)?se:Ae;return e=Bn(e,n,3),i(t,function(t,n,i){return!e(t,n,i)})}function ir(t,e,n){if(n?Zn(t,e,n):null==e){t=li(t);var i=t.length;return i>0?t[We(0,i-1)]:S}var r=-1,o=Jr(t),i=o.length,a=i-1;for(e=Ta(e<0?0:+e||0,i);++r<e;){var s=We(r,a),c=o[s];o[s]=o[r],o[r]=c}return o.length=e,o}function rr(t){return ir(t,Ea)}function or(t){var e=t?Ha(t):0;return ni(e)?e:qs(t).length}function ar(t,e,n){var i=js(t)?he:Xe;return n&&Zn(t,e,n)&&(e=S),"function"==typeof e&&n===S||(e=Bn(e,n,3)),i(t,e)}function sr(t,e,n){if(null==t)return[];n&&Zn(t,e,n)&&(e=S);var i=-1;return e=Bn(e,n,3),Qe(Pe(t,function(t,n,r){return{criteria:e(t,n,r),index:++i,value:t}}),l)}function cr(t,e,n,i){return null==t?[]:(i&&Zn(e,n,i)&&(n=S),js(e)||(e=null==e?[]:[e]),js(n)||(n=null==n?[]:[n]),Ye(t,e,n))}function ur(t,e){return Yi(t,Ue(e))}function lr(t,e){if("function"!=typeof e){if("function"!=typeof t)throw new Qo(F);var n=t;t=e,e=n}return t=ba(t=+t)?t:0,function(){if(--t<1)return e.apply(this,arguments)}}function dr(t,e,n){return n&&Zn(t,e,n)&&(e=S),e=t&&null==e?t.length:xa(+e||0,0),Ln(t,M,S,S,S,S,e)}function hr(t,e){var n;if("function"!=typeof e){if("function"!=typeof t)throw new Qo(F);var i=t;t=e,e=i}return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=S),n}}function fr(t,e,n){function i(){f&&sa(f),u&&sa(u),g=0,u=f=p=S}function r(e,n){n&&sa(n),u=f=p=S,e&&(g=gs(),l=t.apply(h,c),f||u||(c=h=S))}function o(){var t=e-(gs()-d);t<=0||t>e?r(p,u):f=ha(o,t)}function a(){r(v,f)}function s(){if(c=arguments,d=gs(),h=this,p=v&&(f||!_),m===!1)var n=_&&!f;else{u||_||(g=d);var i=m-(d-g),r=i<=0||i>m;r?(u&&(u=sa(u)),g=d,l=t.apply(h,c)):u||(u=ha(a,i))}return r&&f?f=sa(f):f||e===m||(f=ha(o,e)),n&&(r=!0,l=t.apply(h,c)),!r||f||u||(c=h=S),l}var c,u,l,d,h,f,p,g=0,m=!1,v=!0;if("function"!=typeof t)throw new Qo(F);if(e=e<0?0:+e||0,n===!0){var _=!0;v=!1}else Mr(n)&&(_=!!n.leading,m="maxWait"in n&&xa(+n.maxWait||0,e),v="trailing"in n?!!n.trailing:v);return s.cancel=i,s}function pr(t,e){if("function"!=typeof t||e&&"function"!=typeof e)throw new Qo(F);var n=function(){var i=arguments,r=e?e.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=t.apply(this,i);return n.cache=o.set(r,a),a};return n.cache=new pr.Cache,n}function gr(t){if("function"!=typeof t)throw new Qo(F);return function(){return!t.apply(this,arguments)}}function mr(t){return hr(2,t)}function vr(t,e){if("function"!=typeof t)throw new Qo(F);return e=xa(e===S?t.length-1:+e||0,0),function(){for(var n=arguments,i=-1,r=xa(n.length-e,0),o=Bo(r);++i<r;)o[i]=n[e+i];switch(e){case 0:return t.call(this,o);case 1:return t.call(this,n[0],o);case 2:return t.call(this,n[0],n[1],o)}var a=Bo(e+1);for(i=-1;++i<e;)a[i]=n[i];return a[e]=o,t.apply(this,a)}}function _r(t){if("function"!=typeof t)throw new Qo(F);return function(e){return t.apply(this,e)}}function yr(t,e,n){var i=!0,r=!0;if("function"!=typeof t)throw new Qo(F);return n===!1?i=!1:Mr(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),fr(t,e,{leading:i,maxWait:+e,trailing:r})}function br(t,e){return e=null==e?Eo:e,Ln(e,I,S,[t],[])}function wr(t,e,n,i){return e&&"boolean"!=typeof e&&Zn(t,e,n)?e=!1:"function"==typeof e&&(i=n,n=e,e=!1),"function"==typeof n?we(t,e,an(n,i,1)):we(t,e)}function xr(t,e,n){return"function"==typeof e?we(t,!0,an(e,n,1)):we(t,!0)}function Tr(t,e){return t>e}function Cr(t,e){return t>=e}function Sr(t){return v(t)&&Yn(t)&&ea.call(t,"callee")&&!la.call(t,"callee")}function Or(t){return t===!0||t===!1||v(t)&&ia.call(t)==J}function Ar(t){return v(t)&&ia.call(t)==G}function Er(t){return!!t&&1===t.nodeType&&v(t)&&!qr(t)}function jr(t){return null==t||(Yn(t)&&(js(t)||Hr(t)||Sr(t)||v(t)&&Nr(t.splice))?!t.length:!qs(t).length)}function kr(t,e,n,i){n="function"==typeof n?an(n,i,3):S;var r=n?n(t,e):S;return r===S?De(t,e,n):!!r}function Rr(t){return v(t)&&"string"==typeof t.message&&ia.call(t)==X}function Ir(t){return"number"==typeof t&&ba(t)}function Nr(t){return Mr(t)&&ia.call(t)==Q}function Mr(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function Dr(t,e,n,i){return n="function"==typeof n?an(n,i,3):S,Le(t,$n(e),n)}function zr(t){return Ur(t)&&t!=+t}function Lr(t){return null!=t&&(Nr(t)?oa.test(ta.call(t)):v(t)&&Rt.test(t))}function Pr(t){return null===t}function Ur(t){return"number"==typeof t||v(t)&&ia.call(t)==Y}function qr(t){var e;if(!v(t)||ia.call(t)!=K||Sr(t)||!ea.call(t,"constructor")&&"function"==typeof(e=t.constructor)&&!(e instanceof e))return!1;var n;return ke(t,function(t,e){n=e}),n===S||ea.call(t,n)}function Br(t){return Mr(t)&&ia.call(t)==Z}function Hr(t){return"string"==typeof t||v(t)&&ia.call(t)==tt}function Fr(t){return v(t)&&ni(t.length)&&!!Ut[ia.call(t)]}function $r(t){return t===S}function Vr(t,e){return t<e}function Wr(t,e){return t<=e}function Jr(t){var e=t?Ha(t):0;return ni(e)?e?ne(t):[]:oo(t)}function Gr(t){return ye(t,to(t))}function Xr(t,e,n){var i=Da(t);return n&&Zn(t,e,n)&&(e=S),e?ve(i,e):i}function Qr(t){return Ne(t,to(t))}function Yr(t,e,n){var i=null==t?S:Me(t,hi(e),e+"");return i===S?n:i}function Kr(t,e){if(null==t)return!1;var n=ea.call(t,e);if(!n&&!ti(e)){if(e=hi(e),null==(t=1==e.length?t:Me(t,Ge(e,0,-1))))return!1;e=Oi(e),n=ea.call(t,e)}return n||ni(t.length)&&Kn(e,t.length)&&(js(t)||Sr(t))}function Zr(t,e,n){n&&Zn(t,e,n)&&(e=S);for(var i=-1,r=qs(t),o=r.length,a={};++i<o;){var s=r[i],c=t[s];e?ea.call(a,c)?a[c].push(s):a[c]=[s]:a[c]=s}return a}function to(t){if(null==t)return[];Mr(t)||(t=Jo(t));var e=t.length;e=e&&ni(e)&&(js(t)||Sr(t))&&e||0;for(var n=t.constructor,i=-1,r="function"==typeof n&&n.prototype===t,o=Bo(e),a=e>0;++i<e;)o[i]=i+"";for(var s in t)a&&Kn(s,e)||"constructor"==s&&(r||!ea.call(t,s))||o.push(s);return o}function eo(t){t=di(t);for(var e=-1,n=qs(t),i=n.length,r=Bo(i);++e<i;){var o=n[e];r[e]=[o,t[o]]}return r}function no(t,e,n){var i=null==t?S:t[e];return i===S&&(null==t||ti(e,t)||(e=hi(e),t=1==e.length?t:Me(t,Ge(e,0,-1)),i=null==t?S:t[Oi(e)]),i=i===S?n:i),Nr(i)?i.call(t):i}function io(t,e,n){if(null==t)return t;var i=e+"";e=null!=t[i]||ti(e,t)?[i]:hi(e);for(var r=-1,o=e.length,a=o-1,s=t;null!=s&&++r<o;){var c=e[r];Mr(s)&&(r==a?s[c]=n:null==s[c]&&(s[c]=Kn(e[r+1])?[]:{})),s=s[c]}return t}function ro(t,e,n,i){var r=js(t)||Fr(t);if(e=Bn(e,i,4),null==n)if(r||Mr(t)){var o=t.constructor;n=r?js(t)?new o:[]:Da(Nr(o)?o.prototype:S)}else n={};return(r?ie:Re)(t,function(t,i,r){return e(n,t,i,r)}),n}function oo(t){return tn(t,qs(t))}function ao(t){return tn(t,to(t))}function so(t,e,n){return e=+e||0,n===S?(n=e,e=0):n=+n||0,t>=Ta(e,n)&&t<xa(e,n)}function co(t,e,n){n&&Zn(t,e,n)&&(e=n=S);var i=null==t,r=null==e;if(null==n&&(r&&"boolean"==typeof t?(n=t,t=1):"boolean"==typeof e&&(n=e,r=!0)),i&&r&&(e=1,r=!1),t=+t||0,r?(e=t,t=0):e=+e||0,n||t%1||e%1){var o=Oa();return Ta(t+o*(e-t+ca("1e-"+((o+"").length-1))),e)}return We(t,e)}function uo(t){return(t=s(t))&&t.charAt(0).toUpperCase()+t.slice(1)}function lo(t){return(t=s(t))&&t.replace(Nt,h).replace(Ot,"")}function ho(t,e,n){t=s(t),e+="";var i=t.length;return n=n===S?i:Ta(n<0?0:+n||0,i),(n-=e.length)>=0&&t.indexOf(e,n)==n}function fo(t){return t=s(t),t&&vt.test(t)?t.replace(gt,f):t}function po(t){return t=s(t),t&&St.test(t)?t.replace(Ct,p):t||"(?:)"}function go(t,e,n){t=s(t),e=+e;var i=t.length;if(i>=e||!ba(e))return t;var r=(e-i)/2,o=_a(r);return n=Nn("",ma(r),n),n.slice(0,o)+t+n}function mo(t,e,n){return(n?Zn(t,e,n):null==e)?e=0:e&&(e=+e),t=bo(t),Sa(t,e||(kt.test(t)?16:10))}function vo(t,e){var n="";if(t=s(t),(e=+e)<1||!t||!ba(e))return n;do{e%2&&(n+=t),e=_a(e/2),t+=t}while(e);return n}function _o(t,e,n){return t=s(t),n=null==n?0:Ta(n<0?0:+n||0,t.length),t.lastIndexOf(e,n)==n}function yo(t,n,i){var r=e.templateSettings;i&&Zn(t,n,i)&&(n=i=S),t=s(t),n=me(ve({},i||n),r,ge);var o,a,c=me(ve({},n.imports),r.imports,ge),u=qs(c),l=tn(c,u),d=0,h=n.interpolate||Mt,f="__p += '",p=Go((n.escape||Mt).source+"|"+h.source+"|"+(h===bt?Et:Mt).source+"|"+(n.evaluate||Mt).source+"|$","g"),m="//# sourceURL="+("sourceURL"in n?n.sourceURL:"lodash.templateSources["+ ++Pt+"]")+"\n";t.replace(p,function(e,n,i,r,s,c){return i||(i=r),f+=t.slice(d,c).replace(Dt,g),n&&(o=!0,f+="' +\n__e("+n+") +\n'"),s&&(a=!0,f+="';\n"+s+";\n__p += '"),i&&(f+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),d=c+e.length,e}),f+="';\n";var v=n.variable;v||(f="with (obj) {\n"+f+"\n}\n"),f=(a?f.replace(dt,""):f).replace(ht,"$1").replace(ft,"$1;"),f="function("+(v||"obj")+") {\n"+(v?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(o?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var _=Ys(function(){return $o(u,m+"return "+f).apply(S,l)});if(_.source=f,Rr(_))throw _;return _}function bo(t,e,n){var i=t;return(t=s(t))?(n?Zn(i,e,n):null==e)?t.slice(w(t),x(t)+1):(e+="",t.slice(c(t,e),u(t,e)+1)):t}function wo(t,e,n){var i=t;return t=s(t),t?(n?Zn(i,e,n):null==e)?t.slice(w(t)):t.slice(c(t,e+"")):t}function xo(t,e,n){var i=t;return t=s(t),t?(n?Zn(i,e,n):null==e)?t.slice(0,x(t)+1):t.slice(0,u(t,e+"")+1):t}function To(t,e,n){n&&Zn(t,e,n)&&(e=S);var i=z,r=L;if(null!=e)if(Mr(e)){var o="separator"in e?e.separator:o;i="length"in e?+e.length||0:i,r="omission"in e?s(e.omission):r}else i=+e||0;if(t=s(t),i>=t.length)return t;var a=i-r.length;if(a<1)return r;var c=t.slice(0,a);if(null==o)return c+r;if(Br(o)){if(t.slice(a).search(o)){var u,l,d=t.slice(0,a);for(o.global||(o=Go(o.source,(jt.exec(o)||"")+"g")),o.lastIndex=0;u=o.exec(d);)l=u.index;c=c.slice(0,null==l?a:l)}}else if(t.indexOf(o,a)!=a){var h=c.lastIndexOf(o);h>-1&&(c=c.slice(0,h))}return c+r}function Co(t){return t=s(t),t&&mt.test(t)?t.replace(pt,T):t}function So(t,e,n){return n&&Zn(t,e,n)&&(e=S),t=s(t),t.match(e||zt)||[]}function Oo(t,e,n){return n&&Zn(t,e,n)&&(e=S),v(t)?jo(t):be(t,e)}function Ao(t){return function(){return t}}function Eo(t){return t}function jo(t){return Ue(we(t,!0))}function ko(t,e){return qe(t,we(e,!0))}function Ro(t,e,n){if(null==n){var i=Mr(e),r=i?qs(e):S,o=r&&r.length?Ne(e,r):S;(o?o.length:i)||(o=!1,n=e,e=t,t=this)}o||(o=Ne(e,qs(e)));var a=!0,s=-1,c=Nr(t),u=o.length;n===!1?a=!1:Mr(n)&&"chain"in n&&(a=n.chain);for(;++s<u;){var l=o[s],d=e[l];t[l]=d,c&&(t.prototype[l]=function(e){return function(){var n=this.__chain__;if(a||n){var i=t(this.__wrapped__);return(i.__actions__=ne(this.__actions__)).push({func:e,args:arguments,thisArg:t}),i.__chain__=n,i}return e.apply(t,ue([this.value()],arguments))}}(d))}return t}function Io(){return Zt._=ra,this}function No(){}function Mo(t){return ti(t)?Fe(t):$e(t)}function Do(t){return function(e){return Me(t,hi(e),e+"")}}function zo(t,e,n){n&&Zn(t,e,n)&&(e=n=S),t=+t||0,n=null==n?1:+n||0,null==e?(e=t,t=0):e=+e||0;for(var i=-1,r=xa(ma((e-t)/(n||1)),0),o=Bo(r);++i<r;)o[i]=t,t+=n;return o}function Lo(t,e,n){if((t=_a(t))<1||!ba(t))return[];var i=-1,r=Bo(Ta(t,ja));for(e=an(e,n,1);++i<t;)i<ja?r[i]=e(i):e(i);return r}function Po(t){var e=++na;return s(t)+e}function Uo(t,e){return(+t||0)+(+e||0)}function qo(t,e,n){return n&&Zn(t,e,n)&&(e=S),e=Bn(e,n,3),1==e.length?fe(js(t)?t:li(t),e):Ke(t,e)}t=t?te.defaults(Zt.Object(),t,te.pick(Zt,Lt)):Zt;var Bo=t.Array,Ho=t.Date,Fo=t.Error,$o=t.Function,Vo=t.Math,Wo=t.Number,Jo=t.Object,Go=t.RegExp,Xo=t.String,Qo=t.TypeError,Yo=Bo.prototype,Ko=Jo.prototype,Zo=Xo.prototype,ta=$o.prototype.toString,ea=Ko.hasOwnProperty,na=0,ia=Ko.toString,ra=Zt._,oa=Go("^"+ta.call(ea).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),aa=t.ArrayBuffer,sa=t.clearTimeout,ca=t.parseFloat,ua=Vo.pow,la=Ko.propertyIsEnumerable,da=Vn(t,"Set"),ha=t.setTimeout,fa=Yo.splice,pa=t.Uint8Array,ga=Vn(t,"WeakMap"),ma=Vo.ceil,va=Vn(Jo,"create"),_a=Vo.floor,ya=Vn(Bo,"isArray"),ba=t.isFinite,wa=Vn(Jo,"keys"),xa=Vo.max,Ta=Vo.min,Ca=Vn(Ho,"now"),Sa=t.parseInt,Oa=Vo.random,Aa=Wo.NEGATIVE_INFINITY,Ea=Wo.POSITIVE_INFINITY,ja=4294967295,ka=ja-1,Ra=ja>>>1,Ia=9007199254740991,Na=ga&&new ga,Ma={};e.support={};e.templateSettings={escape:_t,evaluate:yt,interpolate:bt,variable:"",imports:{_:e}};var Da=function(){function t(){}return function(e){if(Mr(e)){t.prototype=e;var n=new t;t.prototype=S}return n||{}}}(),za=hn(Re),La=hn(Ie,!0),Pa=fn(),Ua=fn(!0),qa=Na?function(t,e){return Na.set(t,e),t}:Eo,Ba=Na?function(t){return Na.get(t)}:No,Ha=Fe("length"),Fa=function(){var t=0,e=0;return function(n,i){var r=gs(),o=U-(r-e);if(e=r,o>0){if(++t>=P)return n}else t=0;return qa(n,i)}}(),$a=vr(function(t,e){return v(t)&&Yn(t)?Te(t,je(e,!1,!0)):[]}),Va=xn(),Wa=xn(!0),Ja=vr(function(t){for(var e=t.length,n=e,i=Bo(d),r=Fn(),a=r==o,s=[];n--;){var c=t[n]=Yn(c=t[n])?c:[];i[n]=a&&c.length>=120?gn(n&&c):null}var u=t[0],l=-1,d=u?u.length:0,h=i[0];t:for(;++l<d;)if(c=u[l],(h?Yt(h,c):r(s,c,0))<0){for(var n=e;--n;){var f=i[n];if((f?Yt(f,c):r(t[n],c,0))<0)continue t}h&&h.push(c),s.push(c)}return s}),Ga=vr(function(t,e){e=je(e);var n=_e(t,e);return Ve(t,e.sort(i)),n}),Xa=zn(),Qa=zn(!0),Ya=vr(function(t){return Ze(je(t,!1,!0))}),Ka=vr(function(t,e){return Yn(t)?Te(t,e):[]}),Za=vr(Li),ts=vr(function(t){var e=t.length,n=e>2?t[e-2]:S,i=e>1?t[e-1]:S;return e>2&&"function"==typeof n?e-=2:(n=e>1&&"function"==typeof i?(--e,i):S,i=S),t.length=e,Pi(t,n,i)}),es=vr(function(t){return t=je(t),this.thru(function(e){return ee(js(e)?e:[di(e)],t)})}),ns=vr(function(t,e){return _e(t,je(e))}),is=ln(function(t,e,n){ea.call(t,n)?++t[n]:t[n]=1}),rs=wn(za),os=wn(La,!0),as=Sn(ie,za),ss=Sn(re,La),cs=ln(function(t,e,n){ea.call(t,n)?t[n].push(e):t[n]=[e]}),us=ln(function(t,e,n){t[n]=e}),ls=vr(function(t,e,n){var i=-1,r="function"==typeof e,o=ti(e),a=Yn(t)?Bo(t.length):[];return za(t,function(t){var s=r?e:o&&null!=t?t[e]:S;a[++i]=s?s.apply(t,n):Qn(t,e,n)}),a}),ds=ln(function(t,e,n){t[n?0:1].push(e)},function(){return[[],[]]}),hs=Rn(le,za),fs=Rn(de,La),ps=vr(function(t,e){if(null==t)return[];var n=e[2];return n&&Zn(e[0],e[1],n)&&(e.length=1),Ye(t,je(e),[])}),gs=Ca||function(){return(new Ho).getTime()},ms=vr(function(t,e,n){var i=A;if(n.length){var r=y(n,ms.placeholder);i|=I}return Ln(t,i,e,n,r)}),vs=vr(function(t,e){e=e.length?je(e):Qr(t);for(var n=-1,i=e.length;++n<i;){var r=e[n];t[r]=Ln(t[r],A,t)}return t}),_s=vr(function(t,e,n){var i=A|E;if(n.length){var r=y(n,_s.placeholder);i|=I}return Ln(e,i,t,n,r)}),ys=_n(k),bs=_n(R),ws=vr(function(t,e){return xe(t,1,e)}),xs=vr(function(t,e,n){return xe(t,e,n)}),Ts=Cn(),Cs=Cn(!0),Ss=vr(function(t,e){if(e=je(e),"function"!=typeof t||!oe(e,a))throw new Qo(F);var n=e.length;return vr(function(i){for(var r=Ta(i.length,n);r--;)i[r]=e[r](i[r]);return t.apply(this,i)})}),Os=kn(I),As=kn(N),Es=vr(function(t,e){return Ln(t,D,S,S,S,je(e))}),js=ya||function(t){return v(t)&&ni(t.length)&&ia.call(t)==W},ks=dn(Be),Rs=dn(function(t,e,n){return n?me(t,e,n):ve(t,e)}),Is=yn(Rs,pe),Ns=yn(ks,oi),Ms=Tn(Re),Ds=Tn(Ie),zs=On(Pa),Ls=On(Ua),Ps=An(Re),Us=An(Ie),qs=wa?function(t){var e=null==t?S:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&Yn(t)?ui(t):Mr(t)?wa(t):[]}:ui,Bs=En(!0),Hs=En(),Fs=vr(function(t,e){if(null==t)return{};if("function"!=typeof e[0]){var e=ce(je(e),Xo);return ai(t,Te(to(t),e))}var n=an(e[0],e[1],3);return si(t,function(t,e,i){return!n(t,e,i)})}),$s=vr(function(t,e){return null==t?{}:"function"==typeof e[0]?si(t,an(e[0],e[1],3)):ai(t,je(e))}),Vs=mn(function(t,e,n){return e=e.toLowerCase(),t+(n?e.charAt(0).toUpperCase()+e.slice(1):e)}),Ws=mn(function(t,e,n){return t+(n?"-":"")+e.toLowerCase()}),Js=jn(),Gs=jn(!0),Xs=mn(function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}),Qs=mn(function(t,e,n){return t+(n?" ":"")+(e.charAt(0).toUpperCase()+e.slice(1))}),Ys=vr(function(t,e){try{return t.apply(S,e)}catch(t){return Rr(t)?t:new Fo(t)}}),Ks=vr(function(t,e){return function(n){return Qn(n,t,e)}}),Zs=vr(function(t,e){return function(n){return Qn(t,n,e)}}),tc=Dn("ceil"),ec=Dn("floor"),nc=bn(Tr,Aa),ic=bn(Vr,Ea),rc=Dn("round");return e.prototype=n.prototype,_.prototype=Da(n.prototype),_.prototype.constructor=_,Bt.prototype=Da(n.prototype),Bt.prototype.constructor=Bt,Vt.prototype.delete=Wt,Vt.prototype.get=Jt,Vt.prototype.has=Gt,Vt.prototype.set=Xt,Qt.prototype.push=Kt,pr.Cache=Vt,e.after=lr,e.ary=dr,e.assign=Rs,e.at=ns,e.before=hr,e.bind=ms,e.bindAll=vs,e.bindKey=_s,e.callback=Oo,e.chain=Bi,e.chunk=pi,e.compact=gi,e.constant=Ao,e.countBy=is,e.create=Xr,e.curry=ys,e.curryRight=bs,e.debounce=fr,e.defaults=Is,e.defaultsDeep=Ns,e.defer=ws,e.delay=xs,e.difference=$a,e.drop=mi,e.dropRight=vi,e.dropRightWhile=_i,e.dropWhile=yi,e.fill=bi,e.filter=Yi,e.flatten=xi,e.flattenDeep=Ti,e.flow=Ts,e.flowRight=Cs,e.forEach=as,e.forEachRight=ss,e.forIn=zs,e.forInRight=Ls,e.forOwn=Ps,e.forOwnRight=Us,e.functions=Qr,e.groupBy=cs,e.indexBy=us,e.initial=Si,e.intersection=Ja,e.invert=Zr,e.invoke=ls,e.keys=qs,e.keysIn=to,e.map=tr,e.mapKeys=Bs,e.mapValues=Hs,e.matches=jo,e.matchesProperty=ko,e.memoize=pr,e.merge=ks,e.method=Ks,e.methodOf=Zs,e.mixin=Ro,e.modArgs=Ss,e.negate=gr,e.omit=Fs,e.once=mr,e.pairs=eo,e.partial=Os,e.partialRight=As,e.partition=ds,e.pick=$s,e.pluck=er,e.property=Mo,e.propertyOf=Do,e.pull=Ei,e.pullAt=Ga,e.range=zo,e.rearg=Es,e.reject=nr,e.remove=ji,e.rest=ki,e.restParam=vr,e.set=io,e.shuffle=rr,e.slice=Ri,e.sortBy=sr,e.sortByAll=ps,e.sortByOrder=cr,e.spread=_r,e.take=Ii,e.takeRight=Ni,e.takeRightWhile=Mi,e.takeWhile=Di,e.tap=Hi,e.throttle=yr,e.thru=Fi,e.times=Lo,e.toArray=Jr,e.toPlainObject=Gr,e.transform=ro,e.union=Ya,e.uniq=zi,e.unzip=Li,e.unzipWith=Pi,e.values=oo,e.valuesIn=ao,e.where=ur,e.without=Ka,e.wrap=br,e.xor=Ui,e.zip=Za,e.zipObject=qi,e.zipWith=ts,e.backflow=Cs,e.collect=tr,e.compose=Cs,e.each=as,e.eachRight=ss,e.extend=Rs,e.iteratee=Oo,e.methods=Qr,e.object=qi,e.select=Yi,e.tail=ki,e.unique=zi,Ro(e,e),e.add=Uo,e.attempt=Ys,e.camelCase=Vs,e.capitalize=uo,e.ceil=tc,e.clone=wr,e.cloneDeep=xr,e.deburr=lo,e.endsWith=ho,e.escape=fo,e.escapeRegExp=po,e.every=Qi,e.find=rs,e.findIndex=Va,e.findKey=Ms,e.findLast=os,e.findLastIndex=Wa,e.findLastKey=Ds,e.findWhere=Ki,e.first=wi,e.floor=ec,e.get=Yr,e.gt=Tr,e.gte=Cr,e.has=Kr,e.identity=Eo,e.includes=Zi,e.indexOf=Ci,e.inRange=so,e.isArguments=Sr,e.isArray=js,e.isBoolean=Or,e.isDate=Ar,e.isElement=Er,e.isEmpty=jr,e.isEqual=kr,e.isError=Rr,e.isFinite=Ir,e.isFunction=Nr,e.isMatch=Dr,e.isNaN=zr,e.isNative=Lr,e.isNull=Pr,e.isNumber=Ur,e.isObject=Mr,e.isPlainObject=qr,e.isRegExp=Br,e.isString=Hr,e.isTypedArray=Fr,e.isUndefined=$r,e.kebabCase=Ws,e.last=Oi,e.lastIndexOf=Ai,e.lt=Vr,e.lte=Wr,e.max=nc,e.min=ic,e.noConflict=Io,e.noop=No,e.now=gs,e.pad=go,e.padLeft=Js,e.padRight=Gs,e.parseInt=mo,e.random=co,e.reduce=hs,e.reduceRight=fs,e.repeat=vo,e.result=no,e.round=rc,e.runInContext=C,e.size=or,e.snakeCase=Xs,e.some=ar,e.sortedIndex=Xa,e.sortedLastIndex=Qa,e.startCase=Qs,e.startsWith=_o,e.sum=qo,e.template=yo,e.trim=bo,e.trimLeft=wo,e.trimRight=xo,e.trunc=To,e.unescape=Co,e.uniqueId=Po,e.words=So,e.all=Qi,e.any=ar,e.contains=Zi,e.eq=kr,e.detect=rs,e.foldl=hs,e.foldr=fs,e.head=wi,e.include=Zi,e.inject=hs,Ro(e,function(){var t={};return Re(e,function(n,i){e.prototype[i]||(t[i]=n)}),t}(),!1),e.sample=ir,e.prototype.sample=function(t){return this.__chain__||null!=t?this.thru(function(e){return ir(e,t)}):ir(this.value())},e.VERSION=O,ie(["bind","bindKey","curry","curryRight","partial","partialRight"],function(t){e[t].placeholder=e}),ie(["drop","take"],function(t,e){Bt.prototype[t]=function(n){var i=this.__filtered__;if(i&&!e)return new Bt(this);n=null==n?1:xa(_a(n)||0,0);var r=this.clone();return i?r.__takeCount__=Ta(r.__takeCount__,n):r.__views__.push({size:n,type:t+(r.__dir__<0?"Right":"")}),r},Bt.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}}),ie(["filter","map","takeWhile"],function(t,e){var n=e+1,i=n!=H;Bt.prototype[t]=function(t,e){var r=this.clone();return r.__iteratees__.push({iteratee:Bn(t,e,1),type:n}),r.__filtered__=r.__filtered__||i,r}}),ie(["first","last"],function(t,e){var n="take"+(e?"Right":"");Bt.prototype[t]=function(){return this[n](1).value()[0]}}),ie(["initial","rest"],function(t,e){var n="drop"+(e?"":"Right");Bt.prototype[t]=function(){return this.__filtered__?new Bt(this):this[n](1)}}),ie(["pluck","where"],function(t,e){var n=e?"filter":"map",i=e?Ue:Mo;Bt.prototype[t]=function(t){return this[n](i(t))}}),Bt.prototype.compact=function(){return this.filter(Eo)},Bt.prototype.reject=function(t,e){return t=Bn(t,e,1),this.filter(function(e){return!t(e)})},Bt.prototype.slice=function(t,e){t=null==t?0:+t||0;var n=this;return n.__filtered__&&(t>0||e<0)?new Bt(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==S&&(e=+e||0,n=e<0?n.dropRight(-e):n.take(e-t)),n)},Bt.prototype.takeRightWhile=function(t,e){return this.reverse().takeWhile(t,e).reverse()},Bt.prototype.toArray=function(){return this.take(Ea)},Re(Bt.prototype,function(t,n){var i=/^(?:filter|map|reject)|While$/.test(n),r=/^(?:first|last)$/.test(n),o=e[r?"take"+("last"==n?"Right":""):n];o&&(e.prototype[n]=function(){var e=r?[1]:arguments,n=this.__chain__,a=this.__wrapped__,s=!!this.__actions__.length,c=a instanceof Bt,u=e[0],l=c||js(a);l&&i&&"function"==typeof u&&1!=u.length&&(c=l=!1);var d=function(t){return r&&n?o(t,1)[0]:o.apply(S,ue([t],e))},h={func:Fi,args:[d],thisArg:S},f=c&&!s;if(r&&!n)return f?(a=a.clone(),a.__actions__.push(h),t.call(a)):o.call(S,this.value())[0];if(!r&&l){a=f?a:new Bt(this);var p=t.apply(a,e);return p.__actions__.push(h),new _(p,n)}return this.thru(d)})}),ie(["join","pop","push","replace","shift","sort","splice","split","unshift"],function(t){var n=(/^(?:replace|split)$/.test(t)?Zo:Yo)[t],i=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:join|pop|replace|shift)$/.test(t);e.prototype[t]=function(){var t=arguments;return r&&!this.__chain__?n.apply(this.value(),t):this[i](function(e){return n.apply(e,t)})}}),Re(Bt.prototype,function(t,n){var i=e[n];if(i){var r=i.name;(Ma[r]||(Ma[r]=[])).push({name:n,func:i})}}),Ma[In(S,E).name]=[{name:"wrapper",func:S}],Bt.prototype.clone=Ht,Bt.prototype.reverse=Ft,Bt.prototype.value=$t,e.prototype.chain=$i,e.prototype.commit=Vi,e.prototype.concat=es,e.prototype.plant=Wi,e.prototype.reverse=Ji,e.prototype.toString=Gi,e.prototype.run=e.prototype.toJSON=e.prototype.valueOf=e.prototype.value=Xi,e.prototype.collect=e.prototype.map,e.prototype.head=e.prototype.first,e.prototype.select=e.prototype.filter,e.prototype.tail=e.prototype.rest,e}var S,O="3.10.1",A=1,E=2,j=4,k=8,R=16,I=32,N=64,M=128,D=256,z=30,L="...",P=150,U=16,q=200,B=1,H=2,F="Expected a function",$="__lodash_placeholder__",V="[object Arguments]",W="[object Array]",J="[object Boolean]",G="[object Date]",X="[object Error]",Q="[object Function]",Y="[object Number]",K="[object Object]",Z="[object RegExp]",tt="[object String]",et="[object ArrayBuffer]",nt="[object Float32Array]",it="[object Float64Array]",rt="[object Int8Array]",ot="[object Int16Array]",at="[object Int32Array]",st="[object Uint8Array]",ct="[object Uint8ClampedArray]",ut="[object Uint16Array]",lt="[object Uint32Array]",dt=/\b__p \+= '';/g,ht=/\b(__p \+=) '' \+/g,ft=/(__e\(.*?\)|\b__t\)) \+\n'';/g,pt=/&(?:amp|lt|gt|quot|#39|#96);/g,gt=/[&<>"'`]/g,mt=RegExp(pt.source),vt=RegExp(gt.source),_t=/<%-([\s\S]+?)%>/g,yt=/<%([\s\S]+?)%>/g,bt=/<%=([\s\S]+?)%>/g,wt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,xt=/^\w*$/,Tt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,Ct=/^[:!,]|[\\^$.*+?()[\]{}|\/]|(^[0-9a-fA-Fnrtuvx])|([\n\r\u2028\u2029])/g,St=RegExp(Ct.source),Ot=/[\u0300-\u036f\ufe20-\ufe23]/g,At=/\\(\\)?/g,Et=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,jt=/\w*$/,kt=/^0[xX]/,Rt=/^\[object .+?Constructor\]$/,It=/^\d+$/,Nt=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,Mt=/($^)/,Dt=/['\n\r\u2028\u2029\\]/g,zt=function(){var t="[A-Z\\xc0-\\xd6\\xd8-\\xde]",e="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(t+"+(?="+t+e+")|"+t+"?"+e+"|"+t+"+|[0-9]+","g")}(),Lt=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","isFinite","parseFloat","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap"],Pt=-1,Ut={};Ut[nt]=Ut[it]=Ut[rt]=Ut[ot]=Ut[at]=Ut[st]=Ut[ct]=Ut[ut]=Ut[lt]=!0,Ut[V]=Ut[W]=Ut[et]=Ut[J]=Ut[G]=Ut[X]=Ut[Q]=Ut["[object Map]"]=Ut[Y]=Ut[K]=Ut[Z]=Ut["[object Set]"]=Ut[tt]=Ut["[object WeakMap]"]=!1;var qt={};qt[V]=qt[W]=qt[et]=qt[J]=qt[G]=qt[nt]=qt[it]=qt[rt]=qt[ot]=qt[at]=qt[Y]=qt[K]=qt[Z]=qt[tt]=qt[st]=qt[ct]=qt[ut]=qt[lt]=!0,qt[X]=qt[Q]=qt["[object Map]"]=qt["[object Set]"]=qt["[object WeakMap]"]=!1;var Bt={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss"},Ht={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},Ft={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},$t={function:!0,object:!0},Vt={0:"x30",1:"x31",2:"x32",3:"x33",4:"x34",5:"x35",6:"x36",7:"x37",8:"x38",9:"x39",A:"x41",B:"x42",C:"x43",D:"x44",E:"x45",F:"x46",a:"x61",b:"x62",c:"x63",d:"x64",e:"x65",f:"x66",
n:"x6e",r:"x72",t:"x74",u:"x75",v:"x76",x:"x78"},Wt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Jt=$t[typeof n]&&n&&!n.nodeType&&n,Gt=$t[typeof e]&&e&&!e.nodeType&&e,Xt=Jt&&Gt&&"object"==typeof t&&t&&t.Object&&t,Qt=$t[typeof self]&&self&&self.Object&&self,Yt=$t[typeof window]&&window&&window.Object&&window,Kt=Gt&&Gt.exports===Jt&&Jt,Zt=Xt||Yt!==(this&&this.window)&&Yt||Qt||this,te=C();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Zt._=te,define(function(){return te})):Jt&&Gt?Kt?(Gt.exports=te)._=te:Jt._=te:Zt._=te}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],29:[function(t,e,n){function i(t,e){for(var n=-1,i=t.length;++n<i&&e(t[n],n,t)!==!1;);return t}e.exports=i},{}],30:[function(t,e,n){var i=t("./baseForOwn"),r=t("./createBaseEach"),o=r(i);e.exports=o},{"./baseForOwn":32,"./createBaseEach":37}],31:[function(t,e,n){var i=t("./createBaseFor"),r=i();e.exports=r},{"./createBaseFor":38}],32:[function(t,e,n){function i(t,e){return r(t,e,o)}var r=t("./baseFor"),o=t("../object/keys");e.exports=i},{"../object/keys":55,"./baseFor":31}],33:[function(t,n,i){function r(t,n,i){if(null!=t){i!==e&&i in o(t)&&(n=[i]);for(var r=0,a=n.length;null!=t&&r<a;)t=t[n[r++]];return r&&r==a?t:e}}var o=t("./toObject");n.exports=r},{"./toObject":47}],34:[function(t,n,i){function r(t){return function(n){return null==n?e:n[t]}}n.exports=r},{}],35:[function(t,e,n){function i(t){return null==t?"":t+""}e.exports=i},{}],36:[function(t,n,i){function r(t,n,i){if("function"!=typeof t)return o;if(n===e)return t;switch(i){case 1:return function(e){return t.call(n,e)};case 3:return function(e,i,r){return t.call(n,e,i,r)};case 4:return function(e,i,r,o){return t.call(n,e,i,r,o)};case 5:return function(e,i,r,o,a){return t.call(n,e,i,r,o,a)}}return function(){return t.apply(n,arguments)}}var o=t("../utility/identity");n.exports=r},{"../utility/identity":57}],37:[function(t,e,n){function i(t,e){return function(n,i){var s=n?r(n):0;if(!o(s))return t(n,i);for(var c=e?s:-1,u=a(n);(e?c--:++c<s)&&i(u[c],c,u)!==!1;);return n}}var r=t("./getLength"),o=t("./isLength"),a=t("./toObject");e.exports=i},{"./getLength":40,"./isLength":44,"./toObject":47}],38:[function(t,e,n){function i(t){return function(e,n,i){for(var o=r(e),a=i(e),s=a.length,c=t?s:-1;t?c--:++c<s;){var u=a[c];if(n(o[u],u,o)===!1)break}return e}}var r=t("./toObject");e.exports=i},{"./toObject":47}],39:[function(t,n,i){function r(t,n){return function(i,r,s){return"function"==typeof r&&s===e&&a(i)?t(i,r):n(i,o(r,s,3))}}var o=t("./bindCallback"),a=t("../lang/isArray");n.exports=r},{"../lang/isArray":50,"./bindCallback":36}],40:[function(t,e,n){var i=t("./baseProperty"),r=i("length");e.exports=r},{"./baseProperty":34}],41:[function(t,n,i){function r(t,n){var i=null==t?e:t[n];return o(i)?i:e}var o=t("../lang/isNative");n.exports=r},{"../lang/isNative":52}],42:[function(t,e,n){function i(t){return null!=t&&o(r(t))}var r=t("./getLength"),o=t("./isLength");e.exports=i},{"./getLength":40,"./isLength":44}],43:[function(t,e,n){function i(t,e){return t="number"==typeof t||r.test(t)?+t:-1,e=null==e?o:e,t>-1&&t%1==0&&t<e}var r=/^\d+$/,o=9007199254740991;e.exports=i},{}],44:[function(t,e,n){function i(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=r}var r=9007199254740991;e.exports=i},{}],45:[function(t,e,n){function i(t){return!!t&&"object"==typeof t}e.exports=i},{}],46:[function(t,e,n){function i(t){for(var e=c(t),n=e.length,i=n&&t.length,u=!!i&&s(i)&&(o(t)||r(t)),d=-1,h=[];++d<n;){var f=e[d];(u&&a(f,i)||l.call(t,f))&&h.push(f)}return h}var r=t("../lang/isArguments"),o=t("../lang/isArray"),a=t("./isIndex"),s=t("./isLength"),c=t("../object/keysIn"),u=Object.prototype,l=u.hasOwnProperty;e.exports=i},{"../lang/isArguments":49,"../lang/isArray":50,"../object/keysIn":56,"./isIndex":43,"./isLength":44}],47:[function(t,e,n){function i(t){return r(t)?t:Object(t)}var r=t("../lang/isObject");e.exports=i},{"../lang/isObject":53}],48:[function(t,e,n){function i(t){if(o(t))return t;var e=[];return r(t).replace(a,function(t,n,i,r){e.push(i?r.replace(s,"$1"):n||t)}),e}var r=t("./baseToString"),o=t("../lang/isArray"),a=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,s=/\\(\\)?/g;e.exports=i},{"../lang/isArray":50,"./baseToString":35}],49:[function(t,e,n){function i(t){return o(t)&&r(t)&&s.call(t,"callee")&&!c.call(t,"callee")}var r=t("../internal/isArrayLike"),o=t("../internal/isObjectLike"),a=Object.prototype,s=a.hasOwnProperty,c=a.propertyIsEnumerable;e.exports=i},{"../internal/isArrayLike":42,"../internal/isObjectLike":45}],50:[function(t,e,n){var i=t("../internal/getNative"),r=t("../internal/isLength"),o=t("../internal/isObjectLike"),a=Object.prototype,s=a.toString,c=i(Array,"isArray"),u=c||function(t){return o(t)&&r(t.length)&&"[object Array]"==s.call(t)};e.exports=u},{"../internal/getNative":41,"../internal/isLength":44,"../internal/isObjectLike":45}],51:[function(t,e,n){function i(t){return r(t)&&s.call(t)==o}var r=t("./isObject"),o="[object Function]",a=Object.prototype,s=a.toString;e.exports=i},{"./isObject":53}],52:[function(t,e,n){function i(t){return null!=t&&(r(t)?l.test(c.call(t)):o(t)&&a.test(t))}var r=t("./isFunction"),o=t("../internal/isObjectLike"),a=/^\[object .+?Constructor\]$/,s=Object.prototype,c=Function.prototype.toString,u=s.hasOwnProperty,l=RegExp("^"+c.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=i},{"../internal/isObjectLike":45,"./isFunction":51}],53:[function(t,e,n){function i(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=i},{}],54:[function(t,n,i){function r(t,n,i){var r=null==t?e:o(t,a(n),n+"");return r===e?i:r}var o=t("../internal/baseGet"),a=t("../internal/toPath");n.exports=r},{"../internal/baseGet":33,"../internal/toPath":48}],55:[function(t,n,i){var r=t("../internal/getNative"),o=t("../internal/isArrayLike"),a=t("../lang/isObject"),s=t("../internal/shimKeys"),c=r(Object,"keys"),u=c?function(t){var n=null==t?e:t.constructor;return"function"==typeof n&&n.prototype===t||"function"!=typeof t&&o(t)?s(t):a(t)?c(t):[]}:s;n.exports=u},{"../internal/getNative":41,"../internal/isArrayLike":42,"../internal/shimKeys":46,"../lang/isObject":53}],56:[function(t,e,n){function i(t){if(null==t)return[];c(t)||(t=Object(t));var e=t.length;e=e&&s(e)&&(o(t)||r(t))&&e||0;for(var n=t.constructor,i=-1,u="function"==typeof n&&n.prototype===t,d=Array(e),h=e>0;++i<e;)d[i]=i+"";for(var f in t)h&&a(f,e)||"constructor"==f&&(u||!l.call(t,f))||d.push(f);return d}var r=t("../lang/isArguments"),o=t("../lang/isArray"),a=t("../internal/isIndex"),s=t("../internal/isLength"),c=t("../lang/isObject"),u=Object.prototype,l=u.hasOwnProperty;e.exports=i},{"../internal/isIndex":43,"../internal/isLength":44,"../lang/isArguments":49,"../lang/isArray":50,"../lang/isObject":53}],57:[function(t,e,n){function i(t){return t}e.exports=i},{}],58:[function(t,n,i){!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof n&&n.exports?n.exports=e():t.Parsimmon=e()}(this,function(){"use strict";function t(e){if(!(this instanceof t))return new t(e);this._=e}function n(e){return e instanceof t}function i(t,e){return{status:!0,index:t,value:e,furthest:-1,expected:[]}}function r(t,e){return{status:!1,index:-1,value:null,furthest:t,expected:[e]}}function o(t,e){if(!e)return t;if(t.furthest>e.furthest)return t;var n=t.furthest===e.furthest?a(t.expected,e.expected):e.expected;return{status:t.status,index:t.index,value:t.value,furthest:e.furthest,expected:n}}function a(t,e){var n=t.length,i=e.length;if(0===n)return e;if(0===i)return t;for(var r={},o=0;o<n;o++)r[t[o]]=!0;for(var a=0;a<i;a++)r[e[a]]=!0;var s=[];for(var c in r)r.hasOwnProperty(c)&&s.push(c);return s.sort(),s}function s(t){if(!n(t))throw new Error("not a parser: "+t)}function c(t){if("number"!=typeof t)throw new Error("not a number: "+t)}function u(t){if(!(t instanceof RegExp))throw new Error("not a regexp: "+t);for(var e=x(t),n=0;n<e.length;n++){var i=e.charAt(n);if("i"!=i&&"m"!=i&&"u"!=i)throw new Error('unsupported regexp flag "'+i+'": '+t)}}function l(t){if("function"!=typeof t)throw new Error("not a function: "+t)}function d(t){if("string"!=typeof t)throw new Error("not a string: "+t)}function h(t){return 1===t.length?t[0]:"one of "+t.join(", ")}function f(t,e){var n=e.index,i=n.offset;if(i===t.length)return", got the end of the input";var r=i>0?"'...":"'",o=t.length-i>12?"...'":"'";return" at line "+n.line+" column "+n.column+", got "+r+t.slice(i,i+12)+o}function p(t,e){return"expected "+h(e.expected)+f(t,e)}function g(){for(var e=[].slice.call(arguments),n=e.length,r=0;r<n;r+=1)s(e[r]);return t(function(t,r){for(var a,s=new Array(n),c=0;c<n;c+=1){if(a=o(e[c]._(t,r),a),!a.status)return a;s[c]=a.value,r=a.index}return o(i(r,s),a)})}function m(){var t=[].slice.call(arguments);if(0===t.length)throw new Error("seqMap needs at least one argument");var e=t.pop();return l(e),g.apply(null,t).map(function(t){return e.apply(null,t)})}function v(e){return t(e(i,r))}function _(){var e=[].slice.call(arguments),n=e.length;if(0===n)return O("zero alternates");for(var i=0;i<n;i+=1)s(e[i]);return t(function(t,n){for(var i,r=0;r<e.length;r+=1)if(i=o(e[r]._(t,n),i),i.status)return i;return i})}function y(t,e){return b(t,e).or(S([]))}function b(t,e){s(t),s(e);var n=e.then(t).many();return t.chain(function(t){return n.map(function(e){return[t].concat(e)})})}function w(e){d(e);var n="'"+e+"'";return t(function(t,o){var a=o+e.length,s=t.slice(o,a);return s===e?i(a,s):r(o,n)})}function x(t){var e=""+t;return e.slice(e.lastIndexOf("/")+1)}function T(t){return RegExp("^(?:"+t.source+")",x(t))}function C(e,n){u(e),arguments.length>=2?c(n):n=0;var o=T(e),a=""+e;return t(function(t,e){var s=o.exec(t.slice(e));if(s){var c=s[0],u=s[n];if(null!=u)return i(e+c.length,u)}return r(e,a)})}function S(e){return t(function(t,n){return i(n,e)})}function O(e){return t(function(t,n){return r(n,e)})}function A(e){if(n(e))return t(function(t,n){var i=e._(t,n);return i.index=n,i.value="",i});if("string"==typeof e)return A(w(e));if(e instanceof RegExp)return A(C(e));throw new Error("not a string, regexp, or parser: "+e)}function E(e){return l(e),t(function(t,n){var o=t.charAt(n);return n<t.length&&e(o)?i(n+1,o):r(n,"a character matching "+e)})}function j(t){return E(function(e){return t.indexOf(e)>=0})}function k(t){return E(function(e){return t.indexOf(e)<0})}function R(e){return l(e),t(function(t,n){for(var r=n;r<t.length&&e(t.charAt(r));)r++;return i(r,t.slice(n,r))})}function I(n,i){arguments.length<2&&(i=n,n=e);var r=t(function(t,e){return r._=i()._,r._(t,e)});return n?r.desc(n):r}function N(t,e){var n=t.slice(0,e).split("\n");return{offset:e,line:n.length,column:n[n.length-1].length+1}}function M(){return O("fantasy-land/empty")}var D=t.prototype;D.parse=function(t){if("string"!=typeof t)throw new Error(".parse must be called with a string as its argument");var e=this.skip(P)._(t,0);return e.status?{status:!0,value:e.value}:{status:!1,index:N(t,e.furthest),expected:e.expected}},D.tryParse=function(t){var e=this.parse(t);if(e.status)return e.value;var n=p(t,e),i=new Error(n);throw i.type="ParsimmonError",i.result=e,i},D.or=function(t){return _(this,t)},D.then=function(t){if("function"==typeof t)throw new Error("chaining features of .then are no longer supported, use .chain instead");return s(t),g(this,t).map(function(t){return t[1]})},D.many=function(){var n=this;return t(function(t,r){for(var a=[],s=e;;){if(s=o(n._(t,r),s),!s.status)return o(i(r,a),s);r=s.index,a.push(s.value)}})},D.times=function(n,r){var a=this;return arguments.length<2&&(r=n),c(n),c(r),t(function(t,s){for(var c=[],u=e,l=e,d=0;d<n;d+=1){if(u=a._(t,s),l=o(u,l),!u.status)return l;s=u.index,c.push(u.value)}for(;d<r&&(u=a._(t,s),l=o(u,l),u.status);d+=1)s=u.index,c.push(u.value);return o(i(s,c),l)})},D.result=function(t){return this.map(function(){return t})},D.atMost=function(t){return this.times(0,t)},D.atLeast=function(t){return m(this.times(t),this.many(),function(t,e){return t.concat(e)})},D.map=function(e){l(e);var n=this;return t(function(t,r){var a=n._(t,r);return a.status?o(i(a.index,e(a.value)),a):a})},D["fantasy-land/map"]=D.map,D.skip=function(t){return g(this,t).map(function(t){return t[0]})},D.mark=function(){return m(U,this,U,function(t,e,n){return{start:t,value:e,end:n}})},D.lookahead=function(t){return this.skip(A(t))},D.desc=function(e){var n=this;return t(function(t,i){var r=n._(t,i);return r.status||(r.expected=[e]),r})},D.fallback=function(t){return this.or(S(t))};var z=t(function(t,e){return e>=t.length?r(e,"any character"):i(e+1,t.charAt(e))}),L=t(function(t,e){return i(t.length,t.slice(e))}),P=t(function(t,e){return e<t.length?r(e,"EOF"):i(e,null)}),U=t(function(t,e){return i(e,N(t,e))});D.concat=D.or,D["fantasy-land/concat"]=D.concat,D.empty=M,D["fantasy-land/empty"]=D.empty,D.of=S,D["fantasy-land/of"]=D.of,D.ap=function(t){return m(t,this,function(t,e){return t(e)})},D["fantasy-land/ap"]=D.ap,D.chain=function(e){var n=this;return t(function(t,i){var r=n._(t,i);return r.status?o(e(r.value)._(t,r.index),r):r})},D["fantasy-land/chain"]=D.chain;var q=C(/[0-9]/).desc("a digit"),B=C(/[0-9]*/).desc("optional digits"),H=C(/[a-z]/i).desc("a letter"),F=C(/[a-z]*/i).desc("optional letters"),$=C(/\s*/).desc("optional whitespace"),V=C(/\s+/).desc("whitespace");return t.all=L,t.alt=_,t.any=z,t.custom=v,t.digit=q,t.digits=B,t.eof=P,t.fail=O,t.formatError=p,t.index=U,t.isParser=n,t.lazy=I,t.letter=H,t.letters=F,t.lookahead=A,t.makeFailure=r,t.makeSuccess=i,t.noneOf=k,t.oneOf=j,t.optWhitespace=$,t.Parser=t,t.regex=C,t.regexp=C,t.sepBy=y,t.sepBy1=b,t.seq=g,t.seqMap=m,t.string=w,t.succeed=S,t.takeWhile=R,t.test=E,t.whitespace=V,t.empty=M,t["fantasy-land/empty"]=M,t.of=S,t["fantasy-land/of"]=S,t})},{}],59:[function(t,e,n){function i(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(t){if(d===setTimeout)return setTimeout(t,0);if((d===i||!d)&&setTimeout)return d=setTimeout,setTimeout(t,0);try{return d(t,0)}catch(e){try{return d.call(null,t,0)}catch(e){return d.call(this,t,0)}}}function a(t){if(h===clearTimeout)return clearTimeout(t);if((h===r||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function s(){m&&p&&(m=!1,p.length?g=p.concat(g):v=-1,g.length&&c())}function c(){if(!m){var t=o(s);m=!0;for(var e=g.length;e;){for(p=g,g=[];++v<e;)p&&p[v].run();v=-1,e=g.length}p=null,m=!1,a(t)}}function u(t,e){this.fun=t,this.array=e}function l(){}var d,h,f=e.exports={};!function(){try{d="function"==typeof setTimeout?setTimeout:i}catch(t){d=i}try{h="function"==typeof clearTimeout?clearTimeout:r}catch(t){h=r}}();var p,g=[],m=!1,v=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];g.push(new u(t,e)),1!==g.length||m||o(c)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=l,f.addListener=l,f.once=l,f.off=l,f.removeListener=l,f.removeAllListeners=l,f.emit=l,f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],60:[function(t,n,i){(function(t){"use strict";!function(t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof i?n.exports=e():t.store=e()}(this,function(){var n,i={},r="undefined"!=typeof window?window:t,o=r.document,a="localStorage";if(i.disabled=!1,i.version="1.3.20",i.set=function(t,e){},i.get=function(t,e){},i.has=function(t){return i.get(t)!==e},i.remove=function(t){},i.clear=function(){},i.transact=function(t,e,n){null==n&&(n=e,e=null),null==e&&(e={});var r=i.get(t,e);n(r),i.set(t,r)},i.getAll=function(){},i.forEach=function(){},i.serialize=function(t){return JSON.stringify(t)},i.deserialize=function(t){if("string"!=typeof t)return e;try{return JSON.parse(t)}catch(n){return t||e}},function(){try{return a in r&&r[a]}catch(t){return!1}}())n=r[a],i.set=function(t,r){return r===e?i.remove(t):(n.setItem(t,i.serialize(r)),r)},i.get=function(t,r){var o=i.deserialize(n.getItem(t));return o===e?r:o},i.remove=function(t){n.removeItem(t)},i.clear=function(){n.clear()},i.getAll=function(){var t={};return i.forEach(function(e,n){t[e]=n}),t},i.forEach=function(t){for(var e=0;e<n.length;e++){var r=n.key(e);t(r,i.get(r))}};else if(o&&o.documentElement.addBehavior){var s,c;try{c=new ActiveXObject("htmlfile"),c.open(),c.write('<script>document.w=window</script><iframe src="/favicon.ico"></iframe>'),c.close(),s=c.w.frames[0].document,n=s.createElement("div")}catch(t){n=o.createElement("div"),s=o.body}var u=function(t){return function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(n),s.appendChild(n),n.addBehavior("#default#userData"),n.load(a);var r=t.apply(i,e);return s.removeChild(n),r}},l=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g"),d=function(t){return t.replace(/^d/,"___$&").replace(l,"___")};i.set=u(function(t,n,r){return n=d(n),r===e?i.remove(n):(t.setAttribute(n,i.serialize(r)),t.save(a),r)}),i.get=u(function(t,n,r){n=d(n);var o=i.deserialize(t.getAttribute(n));return o===e?r:o}),i.remove=u(function(t,e){e=d(e),t.removeAttribute(e),t.save(a)}),i.clear=u(function(t){var e=t.XMLDocument.documentElement.attributes;t.load(a);for(var n=e.length-1;n>=0;n--)t.removeAttribute(e[n].name);t.save(a)}),i.getAll=function(t){var e={};return i.forEach(function(t,n){e[t]=n}),e},i.forEach=u(function(t,e){for(var n,r=t.XMLDocument.documentElement.attributes,o=0;n=r[o];++o)e(n.name,i.deserialize(t.getAttribute(n.name)))})}try{var h="__storejs__";i.set(h,h),i.get(h)!=h&&(i.disabled=!0),i.remove(h)}catch(t){i.disabled=!0}return i.enabled=!i.disabled,i})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],61:[function(t,e,n){!function(t,i){"use strict";var r="model",o="name",a="type",s="vendor",c="version",u="mobile",l="tablet",d={extend:function(t,e){var n={};for(var i in t)e[i]&&e[i].length%2==0?n[i]=e[i].concat(t[i]):n[i]=t[i];return n},has:function(t,e){return"string"==typeof t&&e.toLowerCase().indexOf(t.toLowerCase())!==-1},lowerize:function(t){return t.toLowerCase()},major:function(t){return"string"==typeof t?t.replace(/[^\d\.]/g,"").split(".")[0]:void 0},trim:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},h={rgx:function(){for(var t,e,n,i,r,o,a,s=0,c=arguments;s<c.length&&!o;){var u=c[s],l=c[s+1];if(void 0===t){t={};for(i in l)l.hasOwnProperty(i)&&(r=l[i],"object"==typeof r?t[r[0]]=void 0:t[r]=void 0)}for(e=n=0;e<u.length&&!o;)if(o=u[e++].exec(this.getUA()))for(i=0;i<l.length;i++)a=o[++n],r=l[i],"object"==typeof r&&r.length>0?2==r.length?"function"==typeof r[1]?t[r[0]]=r[1].call(this,a):t[r[0]]=r[1]:3==r.length?"function"!=typeof r[1]||r[1].exec&&r[1].test?t[r[0]]=a?a.replace(r[1],r[2]):void 0:t[r[0]]=a?r[1].call(this,a,r[2]):void 0:4==r.length&&(t[r[0]]=a?r[3].call(this,a.replace(r[1],r[2])):void 0):t[r]=a?a:void 0;s+=2}return t},str:function(t,e){for(var n in e)if("object"==typeof e[n]&&e[n].length>0){for(var i=0;i<e[n].length;i++)if(d.has(e[n][i],t))return"?"===n?void 0:n}else if(d.has(e[n],t))return"?"===n?void 0:n;return t}},f={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},p={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[o,c],[/(opios)[\/\s]+([\w\.]+)/i],[[o,"Opera Mini"],c],[/\s(opr)\/([\w\.]+)/i],[[o,"Opera"],c],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[o,c],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[o,"IE"],c],[/(edge)\/((\d+)?[\w\.]+)/i],[o,c],[/(yabrowser)\/([\w\.]+)/i],[[o,"Yandex"],c],[/(comodo_dragon)\/([\w\.]+)/i],[[o,/_/g," "],c],[/(micromessenger)\/([\w\.]+)/i],[[o,"WeChat"],c],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[c,[o,"MIUI Browser"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[o,/(.+)/,"$1 WebView"],c],[/android.+samsungbrowser\/([\w\.]+)/i,/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[c,[o,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[o,c],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/juc.+(ucweb)[\/\s]?([\w\.]+)/i],[[o,"UCBrowser"],c],[/(dolfin)\/([\w\.]+)/i],[[o,"Dolphin"],c],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[o,"Chrome"],c],[/;fbav\/([\w\.]+);/i],[c,[o,"Facebook"]],[/fxios\/([\w\.-]+)/i],[c,[o,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[c,[o,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[c,o],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[o,[c,h.str,f.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[o,c],[/(navigator|netscape)\/([\w\.-]+)/i],[[o,"Netscape"],c],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[o,c]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",d.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",d.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",d.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[r,s,[a,l]],[/applecoremedia\/[\w\.]+ \((ipad)/],[r,[s,"Apple"],[a,l]],[/(apple\s{0,1}tv)/i],[[r,"Apple TV"],[s,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[s,r,[a,l]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[r,[s,"Amazon"],[a,l]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[r,h.str,f.device.amazon.model],[s,"Amazon"],[a,u]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[r,s,[a,u]],[/\((ip[honed|\s\w*]+);/i],[r,[s,"Apple"],[a,u]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[s,r,[a,u]],[/\(bb10;\s(\w+)/i],[r,[s,"BlackBerry"],[a,u]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone)/i],[r,[s,"Asus"],[a,l]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[s,"Sony"],[r,"Xperia Tablet"],[a,l]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[s,"Sony"],[r,"Xperia Phone"],[a,u]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[s,r,[a,"console"]],[/android.+;\s(shield)\sbuild/i],[r,[s,"Nvidia"],[a,"console"]],[/(playstation\s[34portablevi]+)/i],[r,[s,"Sony"],[a,"console"]],[/(sprint\s(\w+))/i],[[s,h.str,f.device.sprint.vendor],[r,h.str,f.device.sprint.model],[a,u]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[s,r,[a,l]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[s,[r,/_/g," "],[a,u]],[/(nexus\s9)/i],[r,[s,"HTC"],[a,l]],[/(nexus\s6p)/i],[r,[s,"Huawei"],[a,u]],[/(microsoft);\s(lumia[\s\w]+)/i],[s,r,[a,u]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[r,[s,"Microsoft"],[a,"console"]],[/(kin\.[onetw]{3})/i],[[r,/\./g," "],[s,"Microsoft"],[a,u]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[r,[s,"Motorola"],[a,u]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[r,[s,"Motorola"],[a,l]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[s,d.trim],[r,d.trim],[a,"smarttv"]],[/hbbtv.+maple;(\d+)/i],[[r,/^/,"SmartTV"],[s,"Samsung"],[a,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[r,[s,"Sharp"],[a,"smarttv"]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[s,"Samsung"],r,[a,l]],[/smart-tv.+(samsung)/i],[s,[a,"smarttv"],r],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[s,"Samsung"],r,[a,u]],[/sie-(\w+)*/i],[r,[s,"Siemens"],[a,u]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[s,"Nokia"],r,[a,u]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[r,[s,"Acer"],[a,l]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[s,"LG"],r,[a,l]],[/(lg) netcast\.tv/i],[s,r,[a,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[r,[s,"LG"],[a,u]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[r,[s,"Lenovo"],[a,l]],[/linux;.+((jolla));/i],[s,r,[a,u]],[/((pebble))app\/[\d\.]+\s/i],[s,r,[a,"wearable"]],[/android.+;\s(glass)\s\d/i],[r,[s,"Google"],[a,"wearable"]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus|note lte)?[\s_]*(?:\d\w)?)\s+build/i],[[r,/_/g," "],[s,"Xiaomi"],[a,u]],[/android.+a000(1)\s+build/i],[r,[s,"OnePlus"],[a,u]],[/\s(tablet)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[a,d.lowerize],s,r]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[c,[o,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[o,c],[/rv\:([\w\.]+).*(gecko)/i],[c,o]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[o,c],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s]+\w)*/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[o,[c,h.str,f.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[o,"Windows"],[c,h.str,f.os.windows.version]],[/\((bb)(10);/i],[[o,"BlackBerry"],c],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[o,c],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[o,"Symbian"],c],[/\((series40);/i],[o],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[o,"Firefox OS"],c],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[o,c],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[o,"Chromium OS"],c],[/(sunos)\s?([\w\.]+\d)*/i],[[o,"Solaris"],c],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[o,c],[/(haiku)\s(\w+)/i],[o,c],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[o,"iOS"],[c,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[o,"Mac OS"],[c,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[o,c]]},g=function(e,n){if(!(this instanceof g))return new g(e,n).getResult();var i=e||(t&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:""),r=n?d.extend(p,n):p;return this.getBrowser=function(){var t=h.rgx.apply(this,r.browser);return t.major=d.major(t.version),t},this.getCPU=function(){return h.rgx.apply(this,r.cpu)},this.getDevice=function(){return h.rgx.apply(this,r.device)},this.getEngine=function(){return h.rgx.apply(this,r.engine)},this.getOS=function(){return h.rgx.apply(this,r.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(t){return i=t,this},this};g.VERSION="0.7.12",g.BROWSER={NAME:o,MAJOR:"major",VERSION:c},g.CPU={ARCHITECTURE:"architecture"},g.DEVICE={MODEL:r,VENDOR:s,TYPE:a,CONSOLE:"console",MOBILE:u,SMARTTV:"smarttv",TABLET:l,WEARABLE:"wearable",EMBEDDED:"embedded"},g.ENGINE={NAME:o,VERSION:c},g.OS={NAME:o,VERSION:c},void 0!==n?(void 0!==e&&e.exports&&(n=e.exports=g),n.UAParser=g):"function"==typeof define&&define.amd?define(function(){return g}):t.UAParser=g;var m=t.jQuery||t.Zepto;if(void 0!==m){var v=new g;m.ua=v.getResult(),m.ua.get=function(){return v.getUA()},m.ua.set=function(t){v.setUA(t);var e=v.getResult();for(var n in e)m.ua[n]=e[n]}}}("object"==typeof window?window:this)},{}],62:[function(t,e,n){!function(t){"use strict";t(function(t){return t("./makePromise")({scheduler:new(t("./Scheduler"))(t("./env").asap)})})}("function"==typeof define&&define.amd?define:function(n){e.exports=n(t)})},{"./Scheduler":63,"./env":75,"./makePromise":77}],63:[function(t,e,n){!function(t){"use strict";t(function(){function t(t){this._async=t,this._running=!1,this._queue=this,this._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var e=this;this.drain=function(){e._drain()}}return t.prototype.enqueue=function(t){this._queue[this._queueLen++]=t,this.run()},t.prototype.afterQueue=function(t){this._afterQueue[this._afterQueueLen++]=t,this.run()},t.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},t.prototype._drain=function(){for(var t=0;t<this._queueLen;++t)this._queue[t].run(),this._queue[t]=void 0;for(this._queueLen=0,this._running=!1,t=0;t<this._afterQueueLen;++t)this._afterQueue[t].run(),this._afterQueue[t]=void 0;this._afterQueueLen=0},t})}("function"==typeof define&&define.amd?define:function(t){e.exports=t()})},{}],64:[function(t,e,n){!function(t){"use strict";t(function(){function t(e){Error.call(this),this.message=e,this.name=t.name,"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t})}("function"==typeof define&&define.amd?define:function(t){e.exports=t()})},{}],65:[function(t,e,n){!function(t){"use strict";t(function(){function t(t,n){function i(e,i,o){var a=t._defer(),s=o.length;return r({f:e,thisArg:i,args:o,params:new Array(s),i:s-1,call:n},a._handler),a}function r(e,i){if(e.i<0)return n(e.f,e.thisArg,e.params,i);t._handler(e.args[e.i]).fold(o,e,void 0,i)}function o(t,e,n){t.params[t.i]=e,t.i-=1,r(t,n)}return arguments.length<2&&(n=e),i}function e(t,e,n,i){try{i.resolve(t.apply(e,n))}catch(t){i.reject(t)}}return t.tryCatchResolve=e,t})}("function"==typeof define&&define.amd?define:function(t){e.exports=t()})},{}],66:[function(t,e,n){!function(t){"use strict";t(function(t){var e=t("../state"),n=t("../apply");return function(t){function i(e){function n(t){l=null,this.resolve(t)}function i(t){this.resolved||(l.push(t),0==--u&&this.reject(l))}for(var r,o,a=t._defer(),s=a._handler,c=e.length>>>0,u=c,l=[],d=0;d<c;++d)if(void 0!==(o=e[d])||d in e){if(r=t._handler(o),r.state()>0){s.become(r),t._visitRemaining(e,d,r);break}r.visit(s,n,i)}else--u;return 0===u&&s.reject(new RangeError("any(): array must not be empty")),a}function r(e,n){
function i(t){this.resolved||(l.push(t),0==--f&&(d=null,this.resolve(l)))}function r(t){this.resolved||(d.push(t),0==--o&&(l=null,this.reject(d)))}var o,a,s,c=t._defer(),u=c._handler,l=[],d=[],h=e.length>>>0,f=0;for(s=0;s<h;++s)(void 0!==(a=e[s])||s in e)&&++f;for(n=Math.max(n,0),o=f-n+1,f=Math.min(n,f),n>f?u.reject(new RangeError("some(): array must contain at least "+n+" item(s), but had "+f)):0===f&&u.resolve(l),s=0;s<h;++s)(void 0!==(a=e[s])||s in e)&&t._handler(a).visit(u,i,r,u.notify);return c}function o(e,n){return t._traverse(n,e)}function a(e,n){var i=_.call(e);return t._traverse(n,i).then(function(t){return s(i,t)})}function s(e,n){for(var i=n.length,r=new Array(i),o=0,a=0;o<i;++o)n[o]&&(r[a++]=t._handler(e[o]).value);return r.length=a,r}function c(t){return g(t.map(u))}function u(n){var i;return n instanceof t&&(i=n._handler.join()),i&&0===i.state()||!i?p(n).then(e.fulfilled,e.rejected):(i._unreport(),e.inspect(i))}function l(t,e){return arguments.length>2?m.call(t,h(e),arguments[2]):m.call(t,h(e))}function d(t,e){return arguments.length>2?v.call(t,h(e),arguments[2]):v.call(t,h(e))}function h(t){return function(e,n,i){return f(t,void 0,[e,n,i])}}var f=n(t),p=t.resolve,g=t.all,m=Array.prototype.reduce,v=Array.prototype.reduceRight,_=Array.prototype.slice;return t.any=i,t.some=r,t.settle=c,t.map=o,t.filter=a,t.reduce=l,t.reduceRight=d,t.prototype.spread=function(t){return this.then(g).then(function(e){return t.apply(this,e)})},t}})}("function"==typeof define&&define.amd?define:function(n){e.exports=n(t)})},{"../apply":65,"../state":78}],67:[function(t,e,n){!function(t){"use strict";t(function(){function t(){throw new TypeError("catch predicate must be a function")}function e(t,e){return n(e)?t instanceof e:e(t)}function n(t){return t===Error||null!=t&&t.prototype instanceof Error}function i(t){return("object"==typeof t||"function"==typeof t)&&null!==t}function r(t){return t}return function(n){function o(t,n){return function(i){return e(i,n)?t.call(this,i):u(i)}}function a(t,e,n,r){var o=t.call(e);return i(o)?s(o,n,r):n(r)}function s(t,e,n){return c(t).then(function(){return e(n)})}var c=n.resolve,u=n.reject,l=n.prototype.catch;return n.prototype.done=function(t,e){this._handler.visit(this._handler.receiver,t,e)},n.prototype.catch=n.prototype.otherwise=function(e){return arguments.length<2?l.call(this,e):"function"!=typeof e?this.ensure(t):l.call(this,o(arguments[1],e))},n.prototype.finally=n.prototype.ensure=function(t){return"function"!=typeof t?this:this.then(function(e){return a(t,this,r,e)},function(e){return a(t,this,u,e)})},n.prototype.else=n.prototype.orElse=function(t){return this.then(void 0,function(){return t})},n.prototype.yield=function(t){return this.then(function(){return t})},n.prototype.tap=function(t){return this.then(t).yield(this)},n}})}("function"==typeof define&&define.amd?define:function(t){e.exports=t()})},{}],68:[function(t,e,n){!function(t){"use strict";t(function(){return function(t){return t.prototype.fold=function(e,n){var i=this._beget();return this._handler.fold(function(n,i,r){t._handler(n).fold(function(t,n,i){i.resolve(e.call(this,n,t))},i,this,r)},n,i._handler.receiver,i._handler),i},t}})}("function"==typeof define&&define.amd?define:function(t){e.exports=t()})},{}],69:[function(t,e,n){!function(t){"use strict";t(function(t){var e=t("../state").inspect;return function(t){return t.prototype.inspect=function(){return e(t._handler(this))},t}})}("function"==typeof define&&define.amd?define:function(n){e.exports=n(t)})},{"../state":78}],70:[function(t,e,n){!function(t){"use strict";t(function(){return function(t){function e(t,e,i,r){return n(function(e){return[e,t(e)]},e,i,r)}function n(t,e,r,o){function a(o,a){return i(r(o)).then(function(){return n(t,e,r,a)})}return i(o).then(function(n){return i(e(n)).then(function(e){return e?n:i(t(n)).spread(a)})})}var i=t.resolve;return t.iterate=e,t.unfold=n,t}})}("function"==typeof define&&define.amd?define:function(t){e.exports=t()})},{}],71:[function(t,e,n){!function(t){"use strict";t(function(){return function(t){return t.prototype.progress=function(t){return this.then(void 0,void 0,t)},t}})}("function"==typeof define&&define.amd?define:function(t){e.exports=t()})},{}],72:[function(t,e,n){!function(t){"use strict";t(function(t){function e(t,e,i,r){return n.setTimer(function(){t(i,r,e)},e)}var n=t("../env"),i=t("../TimeoutError");return function(t){function r(t,n,i){e(o,t,n,i)}function o(t,e){e.resolve(t)}function a(t,e,n){var r=void 0===t?new i("timed out after "+n+"ms"):t;e.reject(r)}return t.prototype.delay=function(t){var e=this._beget();return this._handler.fold(r,t,void 0,e._handler),e},t.prototype.timeout=function(t,i){var r=this._beget(),o=r._handler,s=e(a,t,i,r._handler);return this._handler.visit(o,function(t){n.clearTimer(s),this.resolve(t)},function(t){n.clearTimer(s),this.reject(t)},o.notify),r},t}})}("function"==typeof define&&define.amd?define:function(n){e.exports=n(t)})},{"../TimeoutError":64,"../env":75}],73:[function(t,e,n){!function(t){"use strict";t(function(t){function e(t){throw t}function n(){}var i=t("../env").setTimer,r=t("../format");return function(t){function o(t){t.handled||(f.push(t),l("Potentially unhandled rejection ["+t.id+"] "+r.formatError(t.value)))}function a(t){var e=f.indexOf(t);e>=0&&(f.splice(e,1),d("Handled previous rejection ["+t.id+"] "+r.formatObject(t.value)))}function s(t,e){h.push(t,e),null===p&&(p=i(c,0))}function c(){for(p=null;h.length>0;)h.shift()(h.shift())}var u,l=n,d=n;"undefined"!=typeof console&&(u=console,l=void 0!==u.error?function(t){u.error(t)}:function(t){u.log(t)},d=void 0!==u.info?function(t){u.info(t)}:function(t){u.log(t)}),t.onPotentiallyUnhandledRejection=function(t){s(o,t)},t.onPotentiallyUnhandledRejectionHandled=function(t){s(a,t)},t.onFatalRejection=function(t){s(e,t.value)};var h=[],f=[],p=null;return t}})}("function"==typeof define&&define.amd?define:function(n){e.exports=n(t)})},{"../env":75,"../format":76}],74:[function(t,e,n){!function(t){"use strict";t(function(){return function(t){return t.prototype.with=t.prototype.withThis=function(t){var e=this._beget(),n=e._handler;return n.receiver=t,this._handler.chain(n,t),e},t}})}("function"==typeof define&&define.amd?define:function(t){e.exports=t()})},{}],75:[function(t,e,n){(function(n){!function(t){"use strict";t(function(t){var e,i="undefined"!=typeof setTimeout&&setTimeout,r=function(t,e){return setTimeout(t,e)},o=function(t){return clearTimeout(t)},a=function(t){return i(t,0)};if(function(){return void 0!==n&&"[object process]"===Object.prototype.toString.call(n)}())a=function(t){return n.nextTick(t)};else if(e=function(){return"undefined"!=typeof MutationObserver&&MutationObserver||"undefined"!=typeof WebKitMutationObserver&&WebKitMutationObserver}())a=function(t){function e(){var t=n;n=void 0,t()}var n,i=document.createTextNode("");new t(e).observe(i,{characterData:!0});var r=0;return function(t){n=t,i.data=r^=1}}(e);else if(!i){var s=t,c=s("vertx");r=function(t,e){return c.setTimer(e,t)},o=c.cancelTimer,a=c.runOnLoop||c.runOnContext}return{setTimer:r,clearTimer:o,asap:a}})}("function"==typeof define&&define.amd?define:function(n){e.exports=n(t)})}).call(this,t("_process"))},{_process:59}],76:[function(t,e,n){!function(t){"use strict";t(function(){function t(t){var n="object"==typeof t&&null!==t&&(t.stack||t.message)?t.stack||t.message:e(t);return t instanceof Error?n:n+" (WARNING: non-Error used)"}function e(t){var e=String(t);return"[object Object]"===e&&"undefined"!=typeof JSON&&(e=n(t,e)),e}function n(t,e){try{return JSON.stringify(t)}catch(t){return e}}return{formatError:t,formatObject:e,tryStringify:n}})}("function"==typeof define&&define.amd?define:function(t){e.exports=t()})},{}],77:[function(t,e,n){(function(t){!function(e){"use strict";e(function(){return function(e){function n(t,e){this._handler=t===b?e:i(t)}function i(t){function e(t){r.resolve(t)}function n(t){r.reject(t)}function i(t){r.notify(t)}var r=new x;try{t(e,n,i)}catch(t){n(t)}return r}function r(t){return D(t)?t:new n(b,new T(v(t)))}function o(t){return new n(b,new T(new O(t)))}function a(){return et}function s(){return new n(b,new x)}function c(t,e){return new e(b,new x(t.receiver,t.join().context))}function u(t){return d(V,null,t)}function l(t,e){return d(q,t,e)}function d(t,e,i){function r(n,r,a){a.resolved||h(i,o,n,t(e,r,n),a)}function o(t,e,n){l[t]=e,0==--u&&n.become(new S(l))}for(var a,s="function"==typeof e?r:o,c=new x,u=i.length>>>0,l=new Array(u),d=0;d<i.length&&!c.resolved;++d)a=i[d],void 0!==a||d in i?h(i,s,d,a,c):--u;return 0===u&&c.become(new S(l)),new n(b,c)}function h(t,e,n,i,r){if(z(i)){var o=_(i),a=o.state();0===a?o.fold(e,n,void 0,r):a>0?e(n,o.value,r):(r.become(o),f(t,n+1,o))}else e(n,i,r)}function f(t,e,n){for(var i=e;i<t.length;++i)p(v(t[i]),n)}function p(t,e){if(t!==e){var n=t.state();0===n?t.visit(t,void 0,t._unreport):n<0&&t._unreport()}}function g(t){return"object"!=typeof t||null===t?o(new TypeError("non-iterable passed to race()")):0===t.length?a():1===t.length?r(t[0]):m(t)}function m(t){var e,i,r,o=new x;for(e=0;e<t.length;++e)if(void 0!==(i=t[e])||e in t){if(r=v(i),0!==r.state()){o.become(r),f(t,e+1,r);break}r.visit(o,o.resolve,o.reject)}return new n(b,o)}function v(t){return D(t)?t._handler.join():z(t)?y(t):new S(t)}function _(t){return D(t)?t._handler.join():y(t)}function y(t){try{var e=t.then;return"function"==typeof e?new C(e,t):new S(t)}catch(t){return new O(t)}}function b(){}function w(){}function x(t,e){n.createContext(this,e),this.consumers=void 0,this.receiver=t,this.handler=void 0,this.resolved=!1}function T(t){this.handler=t}function C(t,e){x.call(this),X.enqueue(new I(t,e,this))}function S(t){n.createContext(this),this.value=t}function O(t){n.createContext(this),this.id=++Z,this.value=t,this.handled=!1,this.reported=!1,this._report()}function A(t,e){this.rejection=t,this.context=e}function E(t){this.rejection=t}function j(){return new O(new TypeError("Promise cycle"))}function k(t,e){this.continuation=t,this.handler=e}function R(t,e){this.handler=e,this.value=t}function I(t,e,n){this._then=t,this.thenable=e,this.resolver=n}function N(t,e,n,i,r){try{t.call(e,n,i,r)}catch(t){i(t)}}function M(t,e,n,i){this.f=t,this.z=e,this.c=n,this.to=i,this.resolver=K,this.receiver=this}function D(t){return t instanceof n}function z(t){return("object"==typeof t||"function"==typeof t)&&null!==t}function L(t,e,i,r){if("function"!=typeof t)return r.become(e);n.enterContext(e),B(t,e.value,i,r),n.exitContext()}function P(t,e,i,r,o){if("function"!=typeof t)return o.become(i);n.enterContext(i),H(t,e,i.value,r,o),n.exitContext()}function U(t,e,i,r,o){if("function"!=typeof t)return o.notify(e);n.enterContext(i),F(t,e,r,o),n.exitContext()}function q(t,e,n){try{return t(e,n)}catch(t){return o(t)}}function B(t,e,n,i){try{i.become(v(t.call(n,e)))}catch(t){i.become(new O(t))}}function H(t,e,n,i,r){try{t.call(i,e,n,r)}catch(t){r.become(new O(t))}}function F(t,e,n,i){try{i.notify(t.call(n,e))}catch(t){i.notify(t)}}function $(t,e){e.prototype=Y(t.prototype),e.prototype.constructor=e}function V(t,e){return e}function W(){}function J(){if("function"==typeof CustomEvent)try{return new CustomEvent("unhandledRejection")instanceof CustomEvent}catch(t){}return!1}function G(){if("undefined"!=typeof document&&"function"==typeof document.createEvent)try{return document.createEvent("CustomEvent").initCustomEvent("eventType",!1,!0,{}),!0}catch(t){}return!1}var X=e.scheduler,Q=function(){return void 0!==t&&null!==t&&"function"==typeof t.emit?function(e,n){return"unhandledRejection"===e?t.emit(e,n.value,n):t.emit(e,n)}:"undefined"!=typeof self&&J()?function(t,e){return function(n,i){var r=new e(n,{detail:{reason:i.value,key:i},bubbles:!1,cancelable:!0});return!t.dispatchEvent(r)}}(self,CustomEvent):"undefined"!=typeof self&&G()?function(t,e){return function(n,i){var r=e.createEvent("CustomEvent");return r.initCustomEvent(n,!1,!0,{reason:i.value,key:i}),!t.dispatchEvent(r)}}(self,document):W}(),Y=Object.create||function(t){function e(){}return e.prototype=t,new e};n.resolve=r,n.reject=o,n.never=a,n._defer=s,n._handler=v,n.prototype.then=function(t,e,n){var i=this._handler,r=i.join().state();if("function"!=typeof t&&r>0||"function"!=typeof e&&r<0)return new this.constructor(b,i);var o=this._beget(),a=o._handler;return i.chain(a,i.receiver,t,e,n),o},n.prototype.catch=function(t){return this.then(void 0,t)},n.prototype._beget=function(){return c(this._handler,this.constructor)},n.all=u,n.race=g,n._traverse=l,n._visitRemaining=f,b.prototype.when=b.prototype.become=b.prototype.notify=b.prototype.fail=b.prototype._unreport=b.prototype._report=W,b.prototype._state=0,b.prototype.state=function(){return this._state},b.prototype.join=function(){for(var t=this;void 0!==t.handler;)t=t.handler;return t},b.prototype.chain=function(t,e,n,i,r){this.when({resolver:t,receiver:e,fulfilled:n,rejected:i,progress:r})},b.prototype.visit=function(t,e,n,i){this.chain(K,t,e,n,i)},b.prototype.fold=function(t,e,n,i){this.when(new M(t,e,n,i))},$(b,w),w.prototype.become=function(t){t.fail()};var K=new w;$(b,x),x.prototype._state=0,x.prototype.resolve=function(t){this.become(v(t))},x.prototype.reject=function(t){this.resolved||this.become(new O(t))},x.prototype.join=function(){if(!this.resolved)return this;for(var t=this;void 0!==t.handler;)if((t=t.handler)===this)return this.handler=j();return t},x.prototype.run=function(){var t=this.consumers,e=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var n=0;n<t.length;++n)e.when(t[n])},x.prototype.become=function(t){this.resolved||(this.resolved=!0,this.handler=t,void 0!==this.consumers&&X.enqueue(this),void 0!==this.context&&t._report(this.context))},x.prototype.when=function(t){this.resolved?X.enqueue(new k(t,this.handler)):void 0===this.consumers?this.consumers=[t]:this.consumers.push(t)},x.prototype.notify=function(t){this.resolved||X.enqueue(new R(t,this))},x.prototype.fail=function(t){var e=void 0===t?this.context:t;this.resolved&&this.handler.join().fail(e)},x.prototype._report=function(t){this.resolved&&this.handler.join()._report(t)},x.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},$(b,T),T.prototype.when=function(t){X.enqueue(new k(t,this))},T.prototype._report=function(t){this.join()._report(t)},T.prototype._unreport=function(){this.join()._unreport()},$(x,C),$(b,S),S.prototype._state=1,S.prototype.fold=function(t,e,n,i){P(t,e,this,n,i)},S.prototype.when=function(t){L(t.fulfilled,this,t.receiver,t.resolver)};var Z=0;$(b,O),O.prototype._state=-1,O.prototype.fold=function(t,e,n,i){i.become(this)},O.prototype.when=function(t){"function"==typeof t.rejected&&this._unreport(),L(t.rejected,this,t.receiver,t.resolver)},O.prototype._report=function(t){X.afterQueue(new A(this,t))},O.prototype._unreport=function(){this.handled||(this.handled=!0,X.afterQueue(new E(this)))},O.prototype.fail=function(t){this.reported=!0,Q("unhandledRejection",this),n.onFatalRejection(this,void 0===t?this.context:t)},A.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,Q("unhandledRejection",this.rejection)||n.onPotentiallyUnhandledRejection(this.rejection,this.context))},E.prototype.run=function(){this.rejection.reported&&(Q("rejectionHandled",this.rejection)||n.onPotentiallyUnhandledRejectionHandled(this.rejection))},n.createContext=n.enterContext=n.exitContext=n.onPotentiallyUnhandledRejection=n.onPotentiallyUnhandledRejectionHandled=n.onFatalRejection=W;var tt=new b,et=new n(b,tt);return k.prototype.run=function(){this.handler.join().when(this.continuation)},R.prototype.run=function(){var t=this.handler.consumers;if(void 0!==t)for(var e,n=0;n<t.length;++n)e=t[n],U(e.progress,this.value,this.handler,e.receiver,e.resolver)},I.prototype.run=function(){function t(t){i.resolve(t)}function e(t){i.reject(t)}function n(t){i.notify(t)}var i=this.resolver;N(this._then,this.thenable,t,e,n)},M.prototype.fulfilled=function(t){this.f.call(this.c,this.z,t,this.to)},M.prototype.rejected=function(t){this.to.reject(t)},M.prototype.progress=function(t){this.to.notify(t)},n}})}("function"==typeof define&&define.amd?define:function(t){e.exports=t()})}).call(this,t("_process"))},{_process:59}],78:[function(t,e,n){!function(t){"use strict";t(function(){function t(){return{state:"pending"}}function e(t){return{state:"rejected",reason:t}}function n(t){return{state:"fulfilled",value:t}}function i(i){var r=i.state();return 0===r?t():r>0?n(i.value):e(i.value)}return{pending:t,fulfilled:n,rejected:e,inspect:i}})}("function"==typeof define&&define.amd?define:function(t){e.exports=t()})},{}],79:[function(t,e,n){!function(t){"use strict";t(function(t){function e(t,e,n,i){var r=T.resolve(t);return arguments.length<2?r:r.then(e,n,i)}function n(t){return new T(t)}function i(t){return function(){for(var e=0,n=arguments.length,i=new Array(n);e<n;++e)i[e]=arguments[e];return C(t,this,i)}}function r(t){for(var e=0,n=arguments.length-1,i=new Array(n);e<n;++e)i[e]=arguments[e+1];return C(t,this,i)}function o(){return new a}function a(){function t(t){i._handler.resolve(t)}function e(t){i._handler.reject(t)}function n(t){i._handler.notify(t)}var i=T._defer();this.promise=i,this.resolve=t,this.reject=e,this.notify=n,this.resolver={resolve:t,reject:e,notify:n}}function s(t){return t&&"function"==typeof t.then}function c(){return T.all(arguments)}function u(t){return e(t,T.all)}function l(t){return e(t,T.settle)}function d(t,n){return e(t,function(t){return T.map(t,n)})}function h(t,n){return e(t,function(t){return T.filter(t,n)})}var f=t("./lib/decorators/timed"),p=t("./lib/decorators/array"),g=t("./lib/decorators/flow"),m=t("./lib/decorators/fold"),v=t("./lib/decorators/inspect"),_=t("./lib/decorators/iterate"),y=t("./lib/decorators/progress"),b=t("./lib/decorators/with"),w=t("./lib/decorators/unhandledRejection"),x=t("./lib/TimeoutError"),T=[p,g,m,_,y,v,b,f,w].reduce(function(t,e){return e(t)},t("./lib/Promise")),C=t("./lib/apply")(T);return e.promise=n,e.resolve=T.resolve,e.reject=T.reject,e.lift=i,e.try=r,e.attempt=r,e.iterate=T.iterate,e.unfold=T.unfold,e.join=c,e.all=u,e.settle=l,e.any=i(T.any),e.some=i(T.some),e.race=i(T.race),e.map=d,e.filter=h,e.reduce=i(T.reduce),e.reduceRight=i(T.reduceRight),e.isPromiseLike=s,e.Promise=T,e.defer=o,e.TimeoutError=x,e})}("function"==typeof define&&define.amd?define:function(n){e.exports=n(t)})},{"./lib/Promise":62,"./lib/TimeoutError":64,"./lib/apply":65,"./lib/decorators/array":66,"./lib/decorators/flow":67,"./lib/decorators/fold":68,"./lib/decorators/inspect":69,"./lib/decorators/iterate":70,"./lib/decorators/progress":71,"./lib/decorators/timed":72,"./lib/decorators/unhandledRejection":73,"./lib/decorators/with":74}],80:[function(t,e,n){!function(t){var e={max:0,changeHandler:function(){},className:"",maxReachedClassName:"",maxReachedText:""};t.fn.charcount=function(n){n=t.extend({},e,n);var i,r,o,a,s=this,c=+n.max,u=function(t){var e=t?s.val():"",u=i!==e,l=e.length===c;if(u&&(i=e,r.text(c-e.length).removeClass(n.maxReachedClassName),o.hide(),!a)){var d=s.width();d>0&&(s.width(d-r.outerWidth()-5),a=!0)}u&&l?(r.addClass(n.maxReachedClassName),o.enable()):l&&(o.show(),o.disable())};return c>0&&(s.attr("maxlength",c),r=t('<div class="'+n.className+'" title="'+n.maxReachedText+'"/>').appendTo(s.parent()),o=r.tipsy({trigger:"manual",gravity:"se",offset:4,opacity:.95}).tipsy(!0),u(),s.bind("keydown change paste input propertychange",u)),s}}(iAdvize.$)},{}],81:[function(t,e,n){!function(t){function e(){}function n(t){a=[t]}function i(t,e,n){return t&&t.apply&&t.apply(e.context||e,n)}function r(t){return/\?/.test(t)?"&":"?"}function o(o){function f(t){X++||(Q(),$&&(O[W]={s:[t]}),q&&(t=q.apply(o,[t])),i(L,o,[t,w,o]),i(U,o,[o,w]))}function R(t){X++||(Q(),$&&t!=x&&(O[W]=t),i(P,o,[o,t]),i(U,o,[o,t]))}o=t.extend({},E,o);var I,N,M,D,z,L=o.success,P=o.error,U=o.complete,q=o.dataFilter,B=o.callbackParameter,H=o.callback,F=o.cache,$=o.pageCache,V=o.charset,W=o.url,J=o.data,G=o.timeout,X=0,Q=e;return C&&C(function(t){t.done(L).fail(P),L=t.resolve,P=t.reject}).promise(o),o.abort=function(){!X++&&Q()},i(o.beforeSend,o,[o])===!1||X?o:(W=W||u,J=J?"string"==typeof J?J:t.param(J,o.traditional):u,W+=J?r(W)+J:u,B&&(W+=r(W)+encodeURIComponent(B)+"=?"),!F&&!$&&(W+=r(W)+"_"+(new Date).getTime()+"="),W=W.replace(/=\?(&|$)/,"="+H+"$1"),$&&(I=O[W])?I.s?f(I.s[0]):R(I):(T[H]=n,M=t(b)[0],M.id=h+A++,V&&(M[c]=V),j&&j.version()<11.6?(D=t(b)[0]).text="document.getElementById('"+M.id+"')."+g+"()":M[s]=s,k&&(M.htmlFor=M.id,M.event=p),M[m]=M[g]=M[v]=function(t){if(!M[_]||!/i/.test(M[_])){try{M[p]&&M[p]()}catch(t){}t=a,a=0,t?f(t[0]):R(l)}},M.src=W,Q=function(t){z&&clearTimeout(z),M[v]=M[m]=M[g]=null,S[y](M),D&&S[y](D)},S[d](M,N=S.firstChild),D&&S[d](D,N),z=G>0&&setTimeout(function(){R(x)},G)),o)}var a,s="async",c="charset",u="",l="error",d="insertBefore",h="_jqjsp",f="on",p="onclick",g=f+l,m="onload",v="onreadystatechange",_="readyState",y="removeChild",b="<script>",w="success",x="timeout",T=window,C=t.Deferred,S=t("head")[0]||document.documentElement,O={},A=0,E={callback:h,url:location.href},j=T.opera,k=!!t("<div>").html("<!--[if IE]><i><![endif]-->").find("i").length;o.setup=function(e){t.extend(E,e)},t.jsonp=o}(iAdvize.$)},{}],82:[function(t,e,n){!function(t){function e(t,e){return"function"==typeof t?t.call(e):t}function n(e,n){this.$element=t(e),this.options=n,this.enabled=!0,this.fixTitle()}n.prototype={show:function(){var n=this.getTitle();if(n&&this.enabled){var i=this.tip();i.find(".tipsy-inner")[this.options.html?"html":"text"](n),i[0].className="tipsy",i.remove().css({top:0,left:0,visibility:"hidden",display:"block"}).appendTo(this.$element.offsetParent());var r,o=t.extend({},this.$element.position(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight}),a=i[0].offsetWidth,s=i[0].offsetHeight,c=e(this.options.gravity,this.$element[0]);switch(c.charAt(0)){case"n":r={top:o.top+o.height+this.options.offset,left:o.left+o.width/2-a/2};break;case"s":r={top:o.top-s-this.options.offset,left:o.left+o.width/2-a/2};break;case"e":r={top:o.top+o.height/2-s/2,left:o.left-a-this.options.offset};break;case"w":r={top:o.top+o.height/2-s/2,left:o.left+o.width+this.options.offset}}2==c.length&&("w"==c.charAt(1)?r.left=o.left+o.width/2-15:r.left=o.left+o.width/2-a+15),i.css(r).addClass("tipsy-"+c),i.find(".tipsy-arrow")[0].className="tipsy-arrow tipsy-arrow-"+c.charAt(0),this.options.className&&i.addClass(e(this.options.className,this.$element[0])),this.options.fade?i.stop().css({opacity:0,display:"block",visibility:"visible"}).animate({opacity:this.options.opacity}):i.css({visibility:"visible",opacity:this.options.opacity})}},hide:function(){this.options.fade?this.tip().stop().fadeOut(function(){t(this).remove()}):this.tip().remove()},fixTitle:function(){var t=this.$element;(t.attr("title")||"string"!=typeof t.attr("original-title"))&&t.attr("original-title",t.attr("title")||"").removeAttr("title")},getTitle:function(){var t,e=this.$element,n=this.options;return this.fixTitle(),"string"==typeof n.title?t=e.attr("title"==n.title?"original-title":n.title):"function"==typeof n.title&&(t=n.title.call(e[0])),(t=(""+t).replace(/(^\s*|\s*$)/,""))||n.fallback},tip:function(){return this.$tip||(this.$tip=t('<div class="tipsy"></div>').html('<div class="tipsy-arrow"></div><div class="tipsy-inner"></div>')),this.$tip},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled}},t.fn.tipsy=function(e){function i(i){var r=t.data(i,"tipsy");return r||(r=new n(i,t.fn.tipsy.elementOptions(i,e)),t.data(i,"tipsy",r)),r}function r(){var t=i(this);t.hoverState="in",0==e.delayIn?t.show():(t.fixTitle(),setTimeout(function(){"in"==t.hoverState&&t.show()},e.delayIn))}function o(){var t=i(this);t.hoverState="out",0==e.delayOut?t.hide():setTimeout(function(){"out"==t.hoverState&&t.hide()},e.delayOut)}if(e===!0)return this.data("tipsy");if("string"==typeof e){var a=this.data("tipsy");return a&&a[e](),this}if(e=t.extend({},t.fn.tipsy.defaults,e),e.live||this.each(function(){i(this)}),"manual"!=e.trigger){var s=e.live?"live":"bind",c="hover"==e.trigger?"mouseenter":"focus",u="hover"==e.trigger?"mouseleave":"blur";this[s](c,r)[s](u,o)}return this},t.fn.tipsy.defaults={className:null,delayIn:0,delayOut:0,fade:!1,fallback:"",gravity:"n",html:!1,live:!1,offset:0,opacity:.8,title:"title",trigger:"hover"},t.fn.tipsy.elementOptions=function(e,n){return t.metadata?t.extend({},n,t(e).metadata()):n},t.fn.tipsy.autoNS=function(){return t(this).offset().top>t(document).scrollTop()+t(window).height()/2?"s":"n"},t.fn.tipsy.autoWE=function(){return t(this).offset().left>t(document).scrollLeft()+t(window).width()/2?"e":"w"},t.fn.tipsy.autoBounds=function(e,n){return function(){var i={ns:n[0],ew:n.length>1&&n[1]},r=t(document).scrollTop()+e,o=t(document).scrollLeft()+e,a=t(this);return a.offset().top<r&&(i.ns="n"),a.offset().left<o&&(i.ew="w"),t(window).width()+t(document).scrollLeft()-a.offset().left<e&&(i.ew="e"),t(window).height()+t(document).scrollTop()-a.offset().top<e&&(i.ns="s"),i.ns+(i.ew?i.ew:"")}}}(iAdvize.$)},{}],83:[function(t,e,n){var i=t("events").EventEmitter,r=new i,o=t("./events.enum");iAdvize.define("eventManager",function(t,e){return r.events=o,r}),e.exports=r},{"./events.enum":84,events:21}],84:[function(t,e,n){e.exports={chatButtonDisplayed:"ChatButtonDisplayed",callButtonDisplayed:"CallButtonDisplayed",callMeetingConfirmed:"CallMeetingConfirmed",videoButtonDisplayed:"VideoButtonDisplayed",OnXmppConnectionConnected:"xmpp.connection.connected",OnConversationVisioRequested:"conversations.visio.requested",OnConversationVisioClosed:"conversations.visio.closed",OnConversationVisioRefused:"conversations.visio.refused",OnConversationVisioTimeout:"conversations.visio.timeout",OnConversationVisioClose:"conversations.visio.close",OnXmppOOBReceived:"xmpp.message.oob.received",OnXmppConnectionDisconnected:"xmpp.connection.disconnected",OnConversationChatFileSelected:"conversation.chat.file.selected",OnConversationChatUploadAborted:"conversation.chat.upload.aborted"}},{}],85:[function(t,e,n){"use strict";function i(t){var e=[];return e=r(t),e=o(e)}function r(t){for(var e=[],n=0;n<t.length;n++)"interaction"===t[n].type&&e.push(t[n]);return e}function o(t){for(var e=[],n=0;n<t.length;n++)t[n].is_community||e.push(t[n]);return e}function a(t){return!u.hasJustLoaded&&t.gt_threshold&&null!==t.gt_threshold&&(u.hasTimeRule||!u.hasTimeRule&&h!==t.gt_threshold)}if(iAdvize.gtEnabled){var s=iAdvize.require("eventManager"),c=iAdvize.$,u=t("./stateProvider"),l=t("./thresholdCalculationManager"),d=t("./rulesModificationManager"),h="";s.on("targeting.loaded",function(t){h=iAdvize.gtEnabled,u.hasJustLoaded=!0,u.gtThreshold=iAdvize.gtThreshold;var e={list:i(t.list)},n=c.extend(!0,{},e);l.addRuleParams(e),iAdvize.gtThreshold&&(l.addParamsToCriterias(n),d.setRulesForModification(iAdvize.gtThreshold,n),u.stopModularity=!1),u.hasJustLoaded=!1}),s.on("targeting.rule.triggered",function(t){if("interaction"===t.type){var e=u.areRulesModified;u.areRulesModified=!1,u.stopModularity=!1,l.sendParams("",1,e)}}),s.on("targeting.poll.callback",function(t){if(u.gtThreshold=t.gt_threshold,u.statusCanChange){if(a(t)){u.stopModularity=!1;var e={list:u.cloneOriginRules},n=c.extend(!0,{},e);d.setRulesForModification(t.gt_threshold,n),h=t.gt_threshold}u.hasJustLoaded=!1}})}},{"./rulesModificationManager":86,"./stateProvider":87,"./thresholdCalculationManager":88}],86:[function(t,e,n){"use strict";function i(t,e){var n,i=!1,h=e.list,f=h.length;iAdvize.gtDarkLaunchEnabled||(u.areRulesModified=!0),t>0?i=!0:t*=-1,n=t;for(var p=0;p<f;p++){var g=h[p].conditions;o(g,i,n),r(g),d.push(c.extend(!0,{},h[p])),l.oldParseRules(h[p]),u.stopModularity||a(h,p)}u.stopModularity||s(),!iAdvize.gtDarkLaunchEnabled&&u.hasJustLoaded&&(iAdvize.proactifData=d)}function r(t){for(var e=0;e<t.length;e++){var n=t[e];l.isTimeCriteria(t,n,e)}}function o(t,e,n){for(var i=t.length,r=0;r<i;r++){var o=n,a=t[r];a.isModular&&(a.value<0&&e&&(a.value=1),void 0===a.getValue()&&a.isModular&&l.setNewStat(a),null===a.geniusTargetingMaxBoundary&&null===a.geniusTargetingMinBoundary||(o=l.hasBoundaries(a,o,e)),l.modifyCriteriaValue(a,o,e),a.value=a.value.toString())}}function a(t,e){t.executed||0!==t[e].conditions.length||(t.executed=!0,iAdvize.gtDarkLaunchEnabled||u.hasJustLoaded||iAdvize.ProActif.fireRule(t[e]),u.stopModularity=!0,l.sendParams("",1,!0))}function s(){u.stopModularity,l.sendParams("",0,!0)}var c=iAdvize.$,u=t("./stateProvider"),l=t("./thresholdCalculationManager"),d=[];n.setRulesForModification=i},{"./stateProvider":87,"./thresholdCalculationManager":88}],87:[function(t,e,n){"use strict";var i={statusCanChange:!0,stopModularity:!1,hasJustLoaded:!1,hasTimeRule:!1,noneModularRules:[],cloneOriginRules:"",sentThreshold:"",areRulesModified:!1,startTime:new Date};e.exports=i},{}],88:[function(t,n,i){"use strict";function r(t){o(t,c(t))}function o(t,e){var n={list:t.list},i=H.extend(!0,{},n);f(e);var r={list:e},o=H.extend(!0,{},r);o=S(i,F.noneModularRules,o),F.cloneOriginRules=H.extend(!0,{},o),F.cloneOriginRules=F.cloneOriginRules.list,a(o),F.hasTimeRule&&s(t,e)}function a(t){V||F.statusCanChange?V&&!F.statusCanChange?(A("null",1,!1),t.list=[]):F.statusCanChange&&t.list.length>0&&E(t):(A("null",0,!1),t.list=[]),iAdvize.ProActif._ModifiedDatas=t.list}function s(t,e){setTimeout(function(){F.statusCanChange=!0,W=!1,o(t,e)},3e4)}function c(t){for(var e=t.list,n=e.length,i=0;i<n;i++)for(var r=e[i].conditions.length,o=0;o<r;o++){var a=iAdvize.ProActif.createCondition(e[i].conditions[o]);u(a)}return e}function u(t){t.isModular=l(t),t.isModular?t.originVal=t.value:d(t)}function l(t){var e=t.criteria;return!("INTEGER"!==t.getType()&&"FHTML"!==t.getType()&&"HTML"!==t.getType()&&"IHTML"!==t.getType()&&"FLOAT"!==t.getType()&&"ACTIVITY"!==t.getType()||isNaN(t.getValue())&&void 0!==t.getValue()||t.logicalOperator!==G.opMoreThan&&t.logicalOperator!==G.opLessThan||"lastseen"===e.field||"chatcount"===e.field)}function d(t){"dureePageEnCours"===t.criteria.field&&(F.hasTimeRule=!0,h(t))}function h(t){var e=new Date,n=1e3*t.value;t.time=new Date(e.setMilliseconds(F.startTime.getMilliseconds()+n))}function f(t){for(var e=t.length,n=[];e--;)p(t,e,n);v(n),b(n)}function p(t,e,n){var i=t[e],r={list:i},o={list:i},a=H.extend(!0,{},r),s=H.extend(!0,{},o),c=i.conditions.length;for(g(s.list,e);c--;){a.list.conditions=[];w(n,x(a,t,e,c))}}function g(t,e){for(var n=t.conditions,i=0;i<n.length;i++)n[i]=iAdvize.ProActif.createCondition(n[i]),m(n,n[i],i);z(t),0===t.conditions.length&&(V=!0,W=!0)}function m(t,e,n){"dureePageEnCours"===e.criteria.field&&(T(e),e.isValid&&t.splice(n,1))}function v(t){for(var e=t.length,n=0;n<e;n++){var i=t[n],r=i.conditions.length,o=[];_(r,i,o),y(o,i)}}function _(t,e,n){for(var i=0;i<t;i++)e.conditions[i].isModular||e.conditions[i].isValid||n.push(2),!e.conditions[i].isModular&&e.conditions[i].isValid&&(e.modularRule=!0,n.push(1)),e.conditions[i].isModular&&n.push(0)}function y(t,e){B.indexOf(t,2)>=0?e.modularRule=!1:B.indexOf(t,1)<0?e.modularRule=!0:B.indexOf(t,1)>=0&&B.indexOf(t,0)>=0?e.modularRule=!0:(e.modularRule=!1,F.statusCanChange=!1,J=e.id)}function b(t){var e=t.length;F.noneModularRules=[];for(var n=0;n<e;n++)t[n].modularRule||F.noneModularRules.push(t[n])}function w(t,e){if(t.length){for(var n=!1,i=t.length,r=0;r<i;r++)t[r].label===e.label&&(n=!0);if(n)for(var o=0;o<i;o++){var a=H.inArray(e.conditions[0],t[o].conditions);t[o].label===e.label&&a<0&&t[o].conditions.push(e.conditions[0])}else t.push(e)}else t.push(e)}function x(t,e,n,i){var r={list:t.list},o=H.extend(!0,{},r),a=iAdvize.ProActif.createCondition(e[n].conditions[i]);return void 0===a.getValue()&&a.isModular&&C(a),t.list.conditions.push(a),z(t.list),t.list.conditions.length?a.isValid=!1:a.isValid=!0,T(a),
o.list.conditions.push(a),o.list}function T(t){t.time&&new Date>=t.time&&(t.isValid=!0)}function C(t){var e=t.criteria;iAdvize.ProActif.vStatsI||(iAdvize.ProActif.vStatsI={}),iAdvize.ProActif.vStatsI[e.field]||(iAdvize.ProActif.vStatsI[e.field]=!0,iAdvize.vStats[e.field]=60*iAdvize.vStats[e.field]||0)}function S(t,e,n){if(e.length){var i=t.list.length,r=e.length;r===i&&(F.statusCanChange=!1);for(var o=0;o<i;o++)for(var a=t.list[o],s=0;s<r;s++)O(a,e,s,n)}return n}function O(t,e,n,i){if(t.label===e[n].label)for(var r=0;r<i.list.length;r++)if(t.label===i.list[r].label){var o=B.indexOf(i.list,i.list[r]);i.list.splice(o,1)}}function A(t,e,n){$.setParam("ruleId",J),""!==t&&$.setParam("visitorThreshold",t),iAdvize.gtDarkLaunchEnabled?n?$.setParam("ghostEligibility",e):$.setParam("isEligible",e):n?$.setParam("isEligible",e):$.setParam("disabledEligibility",e),iAdvize.gtDarkLaunchEnabled||F.gtThreshold||n||$.setParam("isEligible",e),!iAdvize.gtDarkLaunchEnabled||F.gtThreshold||n||$.setParam("ghostEligibility",e)}function E(t){for(var e=t.list.length,n=0;n<e;n++){for(var i=0;i<t.list[n].conditions.length;i++){var r=t.list[n].conditions[i];r.isModular&&(r.toModify=j(r),r.toModify?k(t.list[n],n,r):R(r),U(t.list[n],r))}q(t.list,n),t.list.visitorThreshold==t.list[n].threshold&&(J=t.list[n].id)}var o=+V;"boolean"==typeof t.list.visitorThreshold&&(t.list.visitorThreshold="null"),A(t.list.visitorThreshold,o,!1)}function j(t){return W&&t.isValid||!W&&!t.isValid}function k(t,e,n){var i=I(n);null===n.geniusTargetingMaxBoundary&&null===n.geniusTargetingMinBoundary||(i=N(n,i,W)),M(n,i,W),D(t,e,n)}function R(t){t.threshold=0}function I(t){var n=0;return t.previousStep=0,t.step!==e&&(t.previousStep=t.step,t.step=n=t.step+5),n}function N(t,e,n){var i=t.geniusTargetingMaxBoundary,r=t.geniusTargetingMinBoundary;return null!==i&&(n&&t.logicalOperator===G.opMoreThan&&e>i||!n&&t.logicalOperator===G.opLessThan&&e>i)?(e=i,t.modifiedWithBoundary=!0):null!==r&&(n&&t.logicalOperator===G.opLessThan&&e>r||!n&&t.logicalOperator===G.opMoreThan&&e>r)&&(e=r,t.modifiedWithBoundary=!0),e}function M(t,e,n){t.step=e,t.value=parseFloat(t.originVal);var i=t.value*e/100;n?(t.logicalOperator===G.opMoreThan&&(t.value=t.value+i),t.logicalOperator===G.opLessThan&&(t.value=t.value-i)):(t.logicalOperator===G.opMoreThan&&(t.value=t.value-i),t.logicalOperator===G.opLessThan&&(t.value=t.value+i))}function D(t,e,n){var i=H.extend(!0,{},t);i.conditions=[],i.conditions.push(n),z(i),L(i,e,n)}function z(t){t.conditions=B.map(t.conditions,iAdvize.ProActif.createCondition),t.conditions=B.reject(t.conditions,B.partial(iAdvize.ProActif.isRuleConditionMet.bind(iAdvize.ProActif),B,t.id))}function L(t,e,n){W&&0===t.conditions.length||!W&&t.conditions.length>0?n.modifiedWithBoundary?n.threshold=W:k(t,e,n):P(n)}function P(t){t.threshold="-"+t.step,W&&(t.threshold="+"+t.previousStep),0==t.threshold&&(t.threshold=t.threshold.slice(1,2))}function U(t,n){t.threshold===e||t.threshold===!0&&n.threshold!==!0?t.threshold=n.threshold:t.threshold===!1||n.threshold===!1?t.threshold=!1:t.threshold===!0&&n.threshold===!0?t.threshold=!0:n.threshold===!0&&t.threshold!==!0?t.threshold=t.threshold:t.threshold=Math.min(t.threshold,n.threshold)}function q(t,e){t.visitorThreshold?t.visitorThreshold===!0||t[e].threshold===!0?t.visitorThreshold="null":t.visitorThreshold===!1&&t[e].threshold!==!1?t.visitorThreshold=t[e].threshold:t.visitorThreshold!==!1&&t[e].threshold===!1?t.visitorThreshold=t.visitorThreshold:t.visitorThreshold=Math.max(t.visitorThreshold,t[e].threshold):"boolean"==typeof t[e].threshold?t.visitorThreshold=t[e].threshold:t.visitorThreshold=parseInt(t[e].threshold,10),t.visitorThreshold>0&&(t.visitorThreshold="+"+t.visitorThreshold)}var B=t("lodash"),H=iAdvize.$,F=t("./stateProvider"),$=t("idz/livechat/src/polling"),V=!1,W=!1,J="",G={opMoreThan:"more than",opLessThan:"less than"};i.addRuleParams=r,i.hasBoundaries=N,i.modifyCriteriaValue=M,i.setNewStat=C,i.sendParams=A,i.addParamsToCriterias=c,i.isTimeCriteria=m,i.oldParseRules=z},{"./stateProvider":87,"idz/livechat/src/polling":112,lodash:28}],89:[function(t,e,n){"use strict";var i=iAdvize.require("eventManager");i.on("targeting.rule.presence.updated",function(t){iAdvize.callbacks.onTargetingRuleTriggered(t)}),i.on("call.popin.open",function(){iAdvize.callbacks.onVisitorCallboxDisplayed()})},{}],90:[function(t,e,n){!function(t){function e(){}var n=t.callbacks={onScriptLoaded:e,onInvitationDisplayed:e,onChatDisplayed:e,onChatHidden:e,onChatButtonDisplayed:e,onCallButtonDisplayed:e,onVideoButtonDisplayed:e,onChatStarted:e,onChatEnded:e,onCallStarted:e,onCallEnded:e,onStatusChanged:e,onCallStatusChanged:e,onRuleStarted:e,onCookieSaved:e,onMessageReceived:e,onMessageSent:e,onAlertReceived:e,onOperatorWriting:e,onOperatorStopWriting:e,onVisitorWriting:e,onVisitorStopWriting:e,onOfferReceived:e,onLinkReceived:e,onCobrowsingRequested:e,onCobrowsingAccepted:e,onCobrowsingRefused:e,onCobrowsingStopped:e,onSatisfactionDisplayed:e,onSatisfactionAnswered:e,onVisitorTransferred:e,onVisitorCallboxDisplayed:e,onTargetingRuleTriggered:e},i={onInvitation:"onInvitationDisplayed",onC2cStatusChanged:"onCallStatusChanged",onOperatorMsg:"onMessageReceived",onVisitorMsg:"onMessageSent"};if("undefined"!=typeof iAdvizeCallbacks){var r=iAdvizeCallbacks;for(var o in r)"function"==typeof r[o]&&(n[o in i?i[o]:o]=function(t){return function(){try{r[t].apply(this,arguments)}catch(t){}}}(o))}}(iAdvize)},{}],91:[function(t,e,n){function i(t,e){return["sid="+e.website_id,"u="+e.vuid,"data="+encodeURIComponent(JSON.stringify(t)),"callback=?"].join("&")}function r(){}var o=t("lodash/function/debounce"),a=t("lodash/collection/each");e.exports=function(t,e){var n={},s={};n.onSave=function(t){this.saveData(t)},n.save=function(n){var o=n;o||(o=s,s={}),t.getJSON(e.chaturl+"rpc/jsonstore.php?"+i(o,e),r)};var c=o(n.save,1600);return n.saveData=function(t){a(t,function(t,e){s[e]=t}),c()},n}},{"lodash/collection/each":24,"lodash/function/debounce":27}],92:[function(t,e,n){!function(t){var e=null,n=t.chaturl+"popout.php?idzchat&sid="+t.website_id;t.PopOut={popChatOut:function(i){i=i||{};var r="resizable=no, location=no, status=no, menubar=no";i.template&&(n+="&tpl="+i.template),r+=i.width?", width="+i.width:", width=565",r+=i.height?", height="+i.height:", height=325",i.top&&(r+=", top="+i.top),i.left&&(r+=", left="+i.left),t.Templates.hideUI(),e=window.open(n,"idzchat",r),window.focus&&e&&e.focus()}}}(iAdvize)},{}],93:[function(t,e,n){!function(t,e){var n=t.vRoster={Contact:function(){this.name="",this.resources={},this.subscription="none",this.ask="",this.groups=[]},contacts:{},isOnline:function(t){var e=9,n="";try{for(var i in this.contacts[t].resources)n=this.contacts[t].resources[i].show,"dnd"==n&&e>3&&(e=3),"away"==n&&e>2&&(e=2),"available"==n&&e>1&&(e=1)}catch(t){return 0}return 9==e&&(e=0),e},isOnPupitre:function(t){var e=!1;try{for(var n in this.contacts[t].resources)if("operators"==n){e=!0;break}}catch(t){return!1}return e},addContact:function(n,i,r){var o=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{name:i||"",jid:n});r&&r.length>0&&e.each(r,function(){o.c("group").t(this).up()}),t.require("xmpp").getConnection().sendIQ(o)},deleteContact:function(e){var n=$iq({type:"set"}).c("query",{xmlns:Strophe.NS.ROSTER}).c("item",{jid:e,subscription:"remove"});t.require("xmpp").getConnection().sendIQ(n)},modifyContact:function(t,e,n){this.addContact(t,e,n)},subscribe:function(e){t.require("xmpp").getConnection().send($pres({to:e,type:"subscribe"}))},unsubscribe:function(e){t.require("xmpp").getConnection().send($pres({to:e,type:"unsubscribe"})),this.deleteContact(e)},getRoster:function(i){t.require("xmpp").getConnection().sendIQ($iq({type:"get"}).c("query",{xmlns:Strophe.NS.ROSTER}),function(r){e(r).find("item").each(function(){var i=e(this),r=i.attr("jid"),o=new n.Contact;o.name=i.attr("name")||"",o.subscription=i.attr("subscription")||"none",o.ask=i.attr("ask")||"",n.contacts[r]=o,"subscribe"!=o.ask&&("to"==o.subscription?t.require("xmpp").getConnection().send($pres({to:r,type:"subscribed"})):"from"==o.subscription&&t.require("xmpp").getConnection().send($pres({to:r,type:"subscribe"})))}),i&&i()})},onRosterChanged:function(i){var r,o=e(i).find("item"),a=o.attr("jid"),s=o.attr("subscription")||"none";return"remove"===s?delete n.contacts[a]:"none"===s?(r=new n.Contact,r.name=o.attr("name")||"",n.contacts[a]=r):(r=n.contacts[a],r?(r.name=o.attr("name")||r.name,r.subscription=s||r.subscription,r.ask=o.attr("ask")||r.ask,r.groups=[]):(r=new n.Contact,r.name=o.attr("name")||"",r.subscription=s||"none",r.ask=o.attr("ask")||"",n.contacts[a]=r)),t.require("xmpp").getConnection().send($iq({type:"result",id:e(i).attr("id")})),!0}}}(iAdvize,iAdvize.$)},{}],94:[function(t,n,i){!function(t){t.Store=function(){function t(t){return JSON.stringify(t)}function n(t){var n;if("string"!=typeof t)return e;try{n=JSON.parse(t)}catch(t){}return n}var i={},r={};return i.set=function(){},i.get=function(){},i.remove=function(){},i.clear=function(){},window.sessionStorage?(i.set=function(e,n){try{window.sessionStorage.setItem(e,t(n))}catch(t){}},i.get=function(t){return n(window.sessionStorage.getItem(t))},i.remove=function(t){window.sessionStorage.removeItem(t)},i.clear=function(){window.sessionStorage.clear()}):(i.get=function(t){return r[t]},i.set=function(t,e){return r[t]=e},i.remove=function(t){delete r[t]},i.clear=function(){for(var t in r)delete r[t]}),i.addToItem=function(t,e){var n=i.get(t);n=n?n+e:e,i.set(t,n)},i.incrementItem=function(t){this.addToItem(t,1)},i.decrementItem=function(t){this.addToItem(t,-1)},i}()}(iAdvize)},{}],95:[function(t,e,n){e.exports=function(t,e){e.util={detectDoctype:function(){var t=/\s+(X?HTML)\s+([\d\.]+)\s*([^\/]+)*\//gi,e=0;if(void 0!==document.namespaces){if(8!=document.all[0].nodeType)return null;t.exec(document.all[0].nodeValue),document.all[0].nodeValue.indexOf("loose")!=-1&&(e=1)}else{if(null==document.doctype)return null;t.exec(document.doctype.publicId),document.doctype.systemId&&document.doctype.systemId.indexOf("loose")!=-1&&(e=1)}return{xhtml:RegExp.$1,version:RegExp.$2,importance:RegExp.$3,loose:e}},get_body:function(){var t=document.getElementsByTagName("html")||"",e=null;t.length<1?(e=document.createElement("html"),document.appendChild(e)):e=t[0],t=document.getElementsByTagName("body")||"";var n=null;return t.length>0?n=document.getElementsByTagName("body").item(0):(n=document.createElement("body"),e.appendChild(n)),n},get_head:function(){var t=document.getElementsByTagName("html"),e=null;t.length<1?(e=document.createElement("html"),document.appendChild(e)):e=t[0],t=document.getElementsByTagName("head");var n=null;return t.length>0?n=document.getElementsByTagName("head").item(0):(n=document.createElement("head"),e.appendChild(n)),n},load_js:function(t,e){var n=this.get_head(),i=document.createElement("script");i.async=!0,i.setAttribute("language","javascript"),i.setAttribute("type","text/javascript"),i.setAttribute("src",t),n.insertBefore(i,n.firstChild);i.onload=i.onreadystatechange=function(){this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||e()}},load_css:function(t){var e=this.get_head(),n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",t),e.appendChild(n)},addScript:function(t,e){var n=new Date,i=document.getElementById(t);null!==i&&i.parentNode.removeChild(i);var r=this.get_head(),o=document.createElement("script");o.id=t,o.type="text/javascript",o.async=!0,o.src=e+"&random="+n.getTime(),r.insertBefore(o,r.firstChild);o.onload=o.onreadystatechange=function(){!this.readyState||"complete"===this.readyState||this.readyState}},delScript:function(t){var e=document.getElementById(t);null!==e&&e.parentNode.removeChild(e)},addEvent:function(t,e,n,i){if(t.addEventListener)return t.addEventListener(e,n,i),!0;if(t.attachEvent){return t.attachEvent("on"+e,n)}},removeEvent:function(t,e,n,i){if(t.removeEventListener)return t.removeEventListener(e,n,i),!0;if(t.detachEvent){return t.detachEvent("on"+e,n)}},setCookie:function(t,e){var n=new Date;n.setTime(n.getTime()+6e4),document.cookie=t+"="+e+"; expires="+n.toGMTString()},getCookie:function(t){var e=document.cookie.indexOf(t+"="),n=e+t.length+1;if(!e&&t!=document.cookie.substring(0,t.length))return null;if(e==-1)return null;var i=document.cookie.indexOf(";",n);return i==-1&&(i=document.cookie.length),unescape(document.cookie.substring(n,i))},delCookie:function(t){var e=new Date;e.setTime(e.getTime()-6e4),document.cookie=t+"= ; expires="+e.toGMTString()},debug:function(){},info:function(){},warn:function(){},error:function(){},profile:function(){},nl2br:function(t){return(t+"").replace(/([^>]?)(\r\n|\n\r|\n|\r)/g,"$1<br/>")},htmlspecialchars:function(t){return"string"==typeof t&&(t=t.replace(/&/g,"&amp;"),t=t.replace(/"/g,"&quot;"),t=t.replace(/'/g,"&#039;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/\\/g,"&#92;")),t},htmlSimpleEscape:function(t){return"string"==typeof t&&(t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;")),t},long2ip:function(t){var e=!1;return!isNaN(t)&&(t>=0||t<=4294967295)&&(e=Math.floor(t/Math.pow(256,3))+"."+Math.floor(t%Math.pow(256,3)/Math.pow(256,2))+"."+Math.floor(t%Math.pow(256,3)%Math.pow(256,2)/Math.pow(256,1))+"."+Math.floor(t%Math.pow(256,3)%Math.pow(256,2)%Math.pow(256,1)/Math.pow(256,0))),e},sec2minsec:function(t){var e=Math.floor(t/60),n=t%60;return e<10&&(e="0"+e),n<10&&(n="0"+n),e+":"+n},getDebounce:function(t,e){var n=null,i=[],r=function(){e(i),i=[],n=null};return function(){n&&(clearTimeout(n),n=null),i.push(arguments),n=setTimeout(r,t)}},proxy:function(t,e){return outfunc=function(){return t.apply(e||this,arguments)},outfunc},runOnce:function(t,e){var n=null,i=!1;return function(){i===!1&&(i=!0,e(arguments)),n||(n=setTimeout(function(){i=!1,n=null},t))}},retry:function(t,n,i,r,o){var a=o||e.$.Deferred();return--t,n.apply(i,r).done(function(t){a.resolve(t)}).fail(function(){t?e.util.retry(t,n,i,r,a):a.reject()}),a.promise()},string:{padLeft:function(t,e,n){for(var i=t;i.length<n;)i=e+i;return i}},date:{getMonthName:function(t){if(!t)return"";switch(t.getMonth()){case 0:return e.T("january");case 1:return e.T("february");case 2:return e.T("march");case 3:return e.T("april");case 4:return e.T("may");case 5:return e.T("june");case 6:return e.T("july");case 7:return e.T("august");case 8:return e.T("september");case 9:return e.T("october");case 10:return e.T("november");case 11:return e.T("december");default:return""}},getDayName:function(t){if(!t)return"";switch(t.getDay()){case 0:return e.T("sunday");case 1:return e.T("monday");case 2:return e.T("tuesday");case 3:return e.T("wednesday");case 4:return e.T("thursday");case 5:return e.T("friday");case 6:return e.T("saturday");default:return""}},formatDate:function(t,n){var i=this.getMonthName(t),r=this.getDayName(t);return n.replace(/yyyy/g,t.getFullYear()).replace(/yy/g,String(t.getFullYear()).substr(2,2)).replace(/MMM/g,i.substr(0,3).toUpperCase()).replace(/Mmm/g,i.substr(0,3)).replace(/MM\*/g,i.toUpperCase()).replace(/Mm\*/g,i).replace(/mm/g,e.util.string.padLeft(String(t.getMonth()+1),"0",2)).replace(/DDD/g,r.substr(0,3).toUpperCase()).replace(/Ddd/g,r.substr(0,3)).replace(/DD\*/g,r.toUpperCase()).replace(/Dd\*/g,r).replace(/dd/g,e.util.string.padLeft(String(t.getDate()),"0",2)).replace(/d\*/g,t.getDate()).replace(/hh/g,e.util.string.padLeft(String(t.getHours()),"0",2)).replace(/ii/g,e.util.string.padLeft(String(t.getMinutes()),"0",2))},getDateISOString:function(t){if(t.toISOString)return t.toISOString();var n=e.util.string.padLeft(String(t.getUTCMonth()+1),"0",2),i=e.util.string.padLeft(String(t.getUTCDate()),"0",2),r=e.util.string.padLeft(String(t.getUTCHours()),"0",2),o=e.util.string.padLeft(String(t.getUTCMinutes()),"0",2),a=e.util.string.padLeft(String(t.getUTCSeconds()),"0",2),s=e.util.string.padLeft(String(t.getUTCMilliseconds()),"0",3),c=t.getUTCFullYear()+"-"+n+"-"+i+"T";return c+=r+":"+o+":"+a+"."+s+"Z"}},object:{mapKey:function(t,e){var n={};for(var i in t)t.hasOwnProperty(i)&&(n[e(i)]=t[i]);return n}},JSONStringify:function(e){for(var n="",i=["Array","Object","String"],r={},o=0;o<i.length;o++)t[i[o]].prototype.toJSON&&(r[i[o]]=t[i[o]].prototype.toJSON,delete t[i[o]].prototype.toJSON);try{n=JSON.stringify(e)}catch(t){}finally{for(var a in r)r.hasOwnProperty(a)&&(t[a].prototype.toJSON=r[a])}return n}}}},{}],96:[function(t,e,n){"use strict";e.exports=function(t,e){var n=iAdvize,i=function(){return!!(window.File&&window.FileList&&window.FileReader)&&void 0!==window.FormData},r=function(){i()&&n.Templates.upload&&(n.Templates.upload.initialize(),t.emit(e.OnConversationChatUploadInitialized))},o=function(n){for(var i=n.target.files,r=0;r<i.length;r++){var o=i[r];o.size>3e7?t.emit(e.OnConversationChatUploadMaxSizeReached,3e7,o):/image\//.test(o.type)||/application\/pdf/.test(o.type)?t.emit(e.OnConversationChatUploadFilesChecked,o):t.emit(e.OnConversationChatUploadBadMimeType,o)}};t.on(e.OnConversationChatFileSelected,o),t.on(e.OnXmppConnectionConnected,r)}},{}],97:[function(t,e,n){"use strict";e.exports=function(t,e,n){var i=function(e){var n=t.$("#idz_msgmsg"),i=n.get(0),r=i.selectionStart,o=i.value.substr(0,i.selectionStart),a=i.value.substr(i.selectionStart,i.value.length-1),s=[o,e,a].join("");t.$(i).val(s).focus().trigger("change"),i.setSelectionRange(r+e.length,r+e.length)},r=function(t,e){i(":"+t.shortname+":")};e.on(n.OnConversationChatEmojiSelected,r)}},{}],98:[function(t,e,n){"use strict";e.exports={OnUploadMessage:"conversations.message.upload.received",OnProductMessage:"conversations.message.product.received",OnTextMessage:"conversations.message.text.received",OnConversationChatFileSelected:"conversation.chat.file.selected",OnConversationChatUploadFilesChecked:"conversation.chat.files.checked",OnConversationChatUploadMaxSizeReached:"conversation.chat.file.maxSizeReached",OnConversationChatUploadBadMimeType:"conversation.chat.file.badMimeType",OnConversationChatUploadStarted:"conversation.chat.upload.started",OnConversationChatUploadProgress:"conversation.chat.upload.progress",OnConversationChatUploadCompleted:"conversation.chat.upload.completed",OnConversationChatUploadFailed:"conversation.chat.upload.failed",OnConversationChatUploadAborted:"conversation.chat.upload.aborted",OnConversationChatUploadInitialized:"conversation.chat.upload.initialized",OnConversationChatEmojiSelected:"conversation.chat.emoji.selected",OnConversationEmojisLoaded:"conversation.emojis.loaded"}},{}],99:[function(t,e,n){"use strict";e.exports=function(e,n,i){t("./richContentHandler")(n,i),t("./FileUploadHandler")(n,i),t("./InputsHandler")(e,n,i)}},{"./FileUploadHandler":96,"./InputsHandler":97,"./richContentHandler":102}],100:[function(t,e,n){"use strict";var i=function(t,e){this.url=t||"",this.name=e.name||"unknown",this.mimeType=e.type||"unknown"};i.prototype.getUrl=function(){return this.url},i.prototype.getName=function(){return this.name},i.prototype.getMimeType=function(){return this.mimeType},e.exports=i},{}],101:[function(t,e,n){"use strict";var i=function(t,e){this.url=e.productUrl||"",this.title=e.title||"",this.imageUrl=e.imageUrl||"",this.priceCatalog=e.priceCatalog||"",this.pricePromotion=e.pricePromotion||"",this.isAvailable=!!e.available};i.prototype.getUrl=function(){return this.url},i.prototype.getTitle=function(){return this.title},i.prototype.getPrice=function(){return""!==this.pricePromotion?this.pricePromotion:this.priceCatalog},i.prototype.getImage=function(){return this.imageUrl},i.prototype.getPriceOriginal=function(){return""!==this.pricePromotion?this.priceCatalog:""},i.prototype.getIsAvailable=function(){return this.isAvailable},e.exports=i},{}],102:[function(t,e,n){"use strict";var i=t("./models/file"),r=t("./models/product");e.exports=function(t,e){var n=function(n,o,a,s,c,u,l){switch(s){case"upload":var d=new i(c,u);t.emit(e.OnUploadMessage,n,o,a,d,l);break;case"product":var h=new r(c,u);t.emit(e.OnProductMessage,n,o,a,h,l)}};t.on(e.OnXmppOOBReceived,n)}},{"./models/file":100,"./models/product":101}],103:[function(t,e,n){"use strict";e.exports=function(e,n,i){var r=t("@iadvize/front-emojis-service")({baseUrl:e.static_url+"images/emojis"});return e.$.get(r.getJSONUrl("apple"),function(t){r.setEmojis("apple",t),n.emit(i.OnConversationEmojisLoaded)}),e.define("emojis-service",function(){return r}),r}},{"@iadvize/front-emojis-service":7}],104:[function(t,e,n){"use strict";var i=t("lodash").assign;e.exports=i(t("./xmpp/events"),t("./conversations/events"))},{"./conversations/events":98,"./xmpp/events":119,lodash:28}],105:[function(t,e,n){"use strict";function i(t,e){this.stack=(new Error).stack,this.message=t||"An error as occured",this.name="UploadError",this.statusCode=e}function r(t){this.stack=(new Error).stack,this.message=t||"Upload aborted",this.name="AbortUploadError"}function o(t,e){this.stack=(new Error).stack,this.message=t||"An error as occured",this.name="HttpError",this.statusCode=e}function a(t){this.stack=(new Error).stack,this.message=t||"Request aborted",this.name="AbortedRequestError"}i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,a.prototype=Object.create(Error.prototype),a.prototype.constructor=a,e.exports={HttpError:o,AbortedRequestError:a,UploadError:i,AbortUploadError:r}},{}],106:[function(t,e,n){"use strict";var i=t("when"),r=t("lodash");e.exports=function(e){var n={},o=t("./errors"),a=function(t,n,a,s){function c(t,e){return t.abort=e,t.then=r.wrap(t.then.bind(t),function(t,n,i){return c(t(n,i),e)}),t}var u=i.defer(),l=!1,d=r.noop,h=function(){l=!0,d()};return s=s||{},a=r.assign({dataType:"json",contentType:"application/json",data:s,type:n,url:t,beforeSend:function(t,e){return d=t.abort,!l}},a),e.ajax(a).then(function(t){return u.resolve(t)},function(t){var e=new o.HttpError(""+t.statusText,t.status||0);0===t.status&&"abort"===t.statusText&&(e=new o.AbortedRequestError("Aborted")),u.reject(e)}),c(u.promise,h)};return r.forEach(["get","post","put","delete"],function(t){n[t]=function(e,n,i){return a(e,t.toUpperCase(),n,i)}}),n}},{"./errors":105,lodash:28,when:79}],107:[function(t,e,n){"use strict";e.exports=function(e){var n=e.$,i=t("./httpService")(n);return{httpService:i,uploadService:t("./uploadService")(n,i)}}},{"./httpService":106,"./uploadService":108}],108:[function(t,e,n){"use strict";var i=t("lodash").assign;e.exports=function(e,n){var r={},o=t("./errors"),a=function(t){throw"AbortedRequestError"===t.name?new o.AbortUploadError(t.message):new o.UploadError(t.message,t.statusCode)};return r.upload=function(t,r,o,s){s=s||{};var c=i({data:t,processData:!1,contentType:t.type,cache:!1,dataType:"xml",xhr:function(){var t=e.ajaxSettings.xhr();return t.upload&&t.upload.addEventListener("progress",function(t){if(o){var e=parseInt(t.loaded/t.total*100,10);o(e)}},!1),t}},s);return n.put(r,c).catch(a)},r}},{"./errors":105,lodash:28}],109:[function(t,e,n){"use strict";!function(e){var n=e.require("eventManager"),i=t("./events"),r=t("./http")(e),o=t("./logmatic")(e);e.JSONStore=t("./JSONStore")(e.$,e);var a=(t("./xmpp")(n,i,o,e,r.uploadService),t("./emojis")(e,n,i,r.httpService));t("./conversations")(e,n,i),t("./templates")(n,i,e,a),t("./Util")(window,e)}(iAdvize)},{"./JSONStore":91,"./Util":95,"./conversations":99,"./emojis":103,"./events":104,"./http":107,"./logmatic":110,"./templates":113,"./xmpp":126}],110:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t){function e(e,n,i,a){if(!t.PROD)return console.error(n,e,i,a);r.push({desc:e,err:JSON.stringify(n),msg:i,extras:JSON.stringify(a)}),o()}function n(e,n,i){if(!t.PROD)return console.log(e,n,i);r.push({desc:e,msg:n,extras:JSON.stringify(i)}),o()}var r=[],o=i.debounce(function(){t.$.ajax({type:"POST",contentType:"application/json; charset=UTF-8",url:t.chaturl+"rpc/mail_error.php",data:JSON.stringify(r),processData:!1,complete:function(){}}),r=[]},15e3,{leading:!1,trailing:!0});return t.define("logger",function(){return{error:e,info:n}}),{error:e,info:n}}},{lodash:28}],111:[function(t,e,n){var i=iAdvize,r=i.require("eventManager"),o={record:function(t,e){try{if("gtm"===i.preferences.plugins.GOOGLEANALYTICS_PLUGIN){var n=i.preferences.plugins.GOOGLEANALYTICS_GTM_NAME;window[n].push({category:"iAdvize",action:t,label:e,event:"iAdvize"})}"ga"===i.preferences.plugins.GOOGLEANALYTICS_PLUGIN&&_gaq.push(["_trackEvent","iAdvize",t,e]),"gau"===i.preferences.plugins.GOOGLEANALYTICS_PLUGIN&&ga("send","event","iAdvize",t,e)}catch(t){}},handleEvents:function(){r.on("conversation.call.started",function(){o.record("Call",i.c2coperator.pseudo)}),r.on("conversation.chat.started",function(){o.record("Chat",i.operator.pseudo)}),r.on("conversation.video.started",function(){o.record("Video",i.operator.pseudo)})}};o.handleEvents(),e.exports=o},{}],112:[function(t,e,n){var i={},r=iAdvize,o=r.$;n.setParam=function(t,e){i[t]=e},n.find=function(t,e){t=t||{};var a={findop:r.website_id,u:r.vuid,dep:r.forceDep,s:r.chat.status,o:r.forceAgent||0};o.extend(a,t,i);var s=e||o.Deferred();return document.visibilityState&&"hidden"===document.visibilityState?(setTimeout(function(){n.find(t,s)},1e3),s.promise()):(o.getJSON(r.chaturl+"rpc/"+iAdvize.pollingEndPoint+"?callback=?",a).done(r.findOpCallback).done(s.resolve).fail(function(){setTimeout(function(){n.find(t,s)},1e4)}),s.promise())};var a=0;n.oldPolling=function(){return n.find().done(function(){clearTimeout(a),a=setTimeout(function(){n.oldPolling()},3e4)})},r.AvailableOp=n},{}],113:[function(t,e,n){"use strict";e.exports=function(e,n,i,r){return{renderingController:t("./renderingController.js")(e,n,i,r)}}},{"./renderingController.js":114}],114:[function(t,e,n){"use strict";var i=t("filesize");e.exports=function(t,e,n,r){var o=function(t){return t.length>29&&(t=t.substring(0,18-"...".length)+"..."+t.substring(t.length-11,t.length)),t},a=function(t,e,i,r,o){if(n.Templates.upload&&n.Templates.upload.getUploadedFileDOM){var a="",s=i||n.chat.getMsgTime();switch(e){case"operator":n.operator&&n.operator.pseudo&&(a=n.operator.pseudo);break;case"visitor":a=n.T("VOUS")}var c=n.Templates.upload.getUploadedFileDOM(a,e,s,r.getName(),r.getMimeType(),r.getUrl());c.attr("data-id",t),o?o.append(c):n.chat.putOpFile(t,c)}else n.chat.putOpMsg(t,r.getUrl(),0)},s=function(t,e,i,r,o){switch(e){case"operator":n.chat.putOpMsg(t,r,0)}},c=function(t,e,i,r,o){var a=i||n.chat.getMsgTime(),s="";switch(e){case"operator":n.operator&&n.operator.pseudo&&(s=n.operator.pseudo)}if(n.Templates.products&&n.Templates.products.getProductDOM){var c=n.Templates.products.getProductDOM(r.getImage(),r.getTitle(),r.getPrice(),r.getPriceOriginal(),r.getIsAvailable(),r.getUrl(),s,a,n.T("chatbox.products.link_label"));o?o.append(c):n.chat.putOpProduct(t,c)}else""!=r.getUrl()&&n.chat.putOpMsg(t,r.getUrl(),0)},u=function(t,e){var r=n.T("livechat.conversations.upload.fileTooBig").replace("%maxSize%",i(t)).replace("%fileName%",e.name),o=n.Templates.upload.getUploadErrorMessageDOM(r);n.chat.putOpFile("error",o)},l=function(t){var e=t.name+": "+n.T("livechat.conversations.upload.badType"),i=n.Templates.upload.getUploadErrorMessageDOM(e);n.chat.putOpFile("error",i)},d=function(t,e){var i=n.Templates.upload.getUploadProgressDOM(o(t.name),e);n.chat.putOpFile(e,i)},h=function(t,e){n.$('.idz_upload[data-id="'+e+'"]').find(".idz_progress").css("width",t+"%")},f=function(t){n.$('.idz_upload[data-id="'+t+'"]').remove()},p=function(t,e){n.$('.idz_upload[data-id="'+t+'"]').addClass("idz_upload_error").html(e)},g=function(){if(n.Templates.hasUpload&&n.Templates.upload&&n.Templates.dragNDrop){var i=n.$("#idz_chatbox").find(".chatboxDropZoneContainer"),r=function(){n.$(window).focus(),i.addClass("displayed")},o=function(){n.$(window).focus(),i.removeClass("displayed"),i.find(".chatboxDropZone").removeClass("active")},a=n.Templates.dragNDrop.getDropZone();a.on("dragenter dragover",function(){var t=n.$(this).addClass("active").find("img");t.attr("src",t.data("src-on"))}).on("dragleave",function(){var t=n.$(this).removeClass("active").find("img");t.attr("src",t.data("src-off"))}),a.find("input").on("change",function(i){t.emit(e.OnConversationChatFileSelected,i),n.$(this).val(""),o()}),a.find(".chatFileUploader").on("click",function(t){n.$(t.target).find("input").click()});var s=a.find("img");s.attr("src",s.data("src-off")),n.$(window).on("dragenter",r),n.$(window).on("mouseleave",o),i.append(a)}},m=function(){if(n.Templates&&n.Templates.emojis){if(0!==n.$(".idzEmojisPopupToggler").length||0===Object.keys(r.getEmojis("apple",!1)).length)return;if(!n.$("#idz_msgmsg").length)return;var i=!1,o=r.getEmojis("apple",!0),a=r.getIcons(),s=n.$("#idz_chatglobal"),c=n.Templates.emojis.getEmojisPopupDOM(),u=c.find(".idzFloatingPopupArrow"),l=c.find(".idzEmojisList"),d=c.find(".idzEmojisCategories"),h=n.Templates.emojis.getTogglerDOM();for(var f in a){var p=o[f].fullName,g=o[f].emojis,m=n.Templates.emojis.getEmojisCategoryDOM(p,f),v=n.Templates.emojis.getCategoryTabDOM(f,a[f]);for(var _ in g){var y=n.Templates.emojis.getEmojiDOM(g[_].shortname);m.find(".idzEmojisCategoryEmojis").append(y),"noRecent"!==g[_].shortname&&y.on("click",function(i){var r=n.$(this).data("emoji");t.emit(e.OnConversationChatEmojiSelected,r,i),h.click()}).data("emoji",g[_])}v.on("click",function(t){var e=n.$(this).data("category");l.animate({scrollTop:n.$('.idzEmojisCategory[data-category="'+e+'"]').get(0).offsetTop},500),t.preventDefault()}),c.find(".idzEmojisList").append(m),d.append(v)}var b=d.find(".idzEmojiCategoryChar"),w=l.find(".idzEmojisCategory");b.first().addClass("selected"),l.on("scroll",function(t){var e=parseInt(l.css("padding-top"),10),i=l.get(0).scrollTop+e+1;n.$(".idzEmojiCategoryChar").removeClass("selected");for(var r=0;r<w.length;r++){var o=w[r],a={top:o.offsetTop,bottom:o.offsetTop+o.offsetHeight};i>a.top&&i<a.bottom&&n.$(b[r]).addClass("selected")}t.stopPropagation()});var x=n.$("#idz_chat_actions"),T=n.$("#idz_msgmsg");h.on("click",function(t){i=!i;var e=s.get(0).getBoundingClientRect(),r=n.$(this).get(0).getBoundingClientRect(),o=Math.abs(e.top-r.top),a=Math.abs(e.left-r.left),l=o-c.height()-10,d=e.width-c.width();c.css({bottom:"auto",right:"auto",left:d,top:l}).toggleClass("opened"),u.css({left:a-d+2}),h.toggleClass("active"),t.stopPropagation()}),s.append(c),x.prepend(h);var C=x.width();T.css({paddingRight:C,width:T.get(0).offsetWidth-C}),c.find(".idzEmojiChar").css("background-image","url("+r.getSpriteUrl("apple")+")"),n.$(document).on("click.emojis",function(t){var e=c.get(0);e&&e.contains(t.target)||!i||(t.stopPropagation(),t.preventDefault(),h.click())})}};t.on(e.OnUploadMessage,a),t.on(e.OnTextMessage,s),t.on(e.OnProductMessage,c),t.on(e.OnConversationChatUploadMaxSizeReached,u),t.on(e.OnConversationChatUploadBadMimeType,l),t.on(e.OnConversationChatUploadStarted,d),t.on(e.OnConversationChatUploadProgress,h),t.on(e.OnConversationChatUploadCompleted,f),t.on(e.OnConversationChatUploadFailed,p),t.on(e.OnConversationChatUploadInitialized,g),t.on(e.OnXmppConnectionConnected,m),t.on(e.OnConversationEmojisLoaded,m)}},{filesize:22}],115:[function(t,e,n){"use strict";e.exports=function(t){var e=[];return{get:function(){var n=t.Deferred();return e.push(n),n.promise()},reject:function(t){e.map(function(e){e.reject(t)}),e=[]},resolve:function(){var t=arguments;e.map(function(e){e.resolve.apply(e,t)}),e=[]}}}},{}],116:[function(t,e,n){e.exports=function(t){var e=t.split(" ");this.name=e.shift().substr(1),this.param1=e.shift()||"",this.param2=e.join(" ")}},{}],117:[function(t,e,n){function i(t){r.call(this,t);var e=this,n=o(t),i=n.find("error");this.text=i.length?i.find("text").text():[],this.fromUsername=(n.attr("from")||"").split("@")[0],this.code=parseInt(i.attr("code"),10),this.retry=0,o.each(n.find("x"),function(t,n){
"https://iadvize.com/schemas/retry"===n.getAttribute("xmlns")&&(e.retry=parseInt(n.getAttribute("retry"),10))})}var r=t("./Message"),o=iAdvize.$;i.prototype=r.prototype,i.constructor=i,i.prototype.canRetry=function(){return this.retry<3},e.exports=i},{"./Message":118}],118:[function(t,e,n){function i(t){var e=o(t);this.raw=e,this.id=e.attr("id")||null,this.to=e.attr("to"),this.from=e.attr("from").toLowerCase(),this.barejid=Strophe.getBareJidFromJid(this.from),this.type=e.attr("type"),this.bodies=e.find("body"),this.body=this.bodies.length?Strophe.xmlunescape(Strophe.getText(this.bodies[0])):"",this.x=e.find("x")}var r=t("./Command"),o=iAdvize.$;i.prototype={isChat:function(){return("chat"===this.type||"groupchat"===this.type)&&this.bodies.length>0&&!this.isCommand()},isCommand:function(){return 0===this.body.indexOf("!")},getCommand:function(){return this.command||(this.command=new r(this.body))}},e.exports=i},{"./Command":116}],119:[function(t,e,n){"use strict";e.exports={OnXmppConnectionConnected:"xmpp.connection.connected",OnXmppConnectionDisconnected:"xmpp.connection.disconnected",OnXmppRoomInvitation:"xmpp.room.invited",OnXmppRoomJoined:"xmpp.room.joined",OnXmppOOBReceived:"xmpp.message.oob.received"}},{}],120:[function(t,e,n){"use strict";var i=t("@iadvize/strophe.js");window.Strophe=i.Strophe,window.$build=i.$build,window.$iq=i.$iq,window.$msg=i.$msg,window.$pres=i.$pres,t("@iadvize/strophe-muc"),t("@iadvize/strophe-receipts"),t("@iadvize/strophe-http-file-upload")(window.Strophe),t("@iadvize/strophe-outofband")(window.Strophe);var r=t("lodash");e.exports=function(t,e,n,i,o,a,s,c){var u=i.$,l=0,d=0,h=!1,f=!1,p=function(){return r.isObject(window.WebSocket)&&i.ws_enabled},g=function(){return p()&&!h?i.ws_url:i.bosh_url},m=new Strophe.Connection(g()),v=!1,_=null,y=null,b={},w={jid:null,nick:null},x=function(n){if(m.connected||v)return _.promise();_=u.Deferred(),v=!0;var r={connect:iAdvize.website_id,u:iAdvize.vuid};return i.popout&&(r.pop=1),u.getJSON(i.chaturl+"rpc/connect.php?callback=?",r).done(function(n){var i=n.nick,r=n.pass,o=n.vhost;if(""===i||""===r||""===o)return _.reject("Unable to retrieve valid credentials");m.connect(i+"@"+o+"/"+ +new Date,r,function(n){return n===Strophe.Status.ATTACHED||n===Strophe.Status.CONNECTED?(!p()||f||h||(f=!0),t.emit(e.OnXmppConnectionConnected)):n===Strophe.Status.DISCONNECTED&&t.emit(e.OnXmppConnectionDisconnected),!0})}).fail(function(){n?t.emit(e.OnXmppConnectionDisconnected):_.reject("Error while retrieving credentials")}),_.promise()},T=function(){if(v=!1,i.chat.connected=!1,++l>=5){if(p()&&(h||f)||!p())return _.reject();h=!0,l=1,m.reset(),m=new Strophe.Connection(g())}clearTimeout(d),d=setTimeout(function(){x(!0)},l>1?3e3:2300)},C=function(){v=!1,_.resolve(),i.chat.connected=!0,m.addHandler(i.vRoster.onRosterChanged,Strophe.NS.ROSTER,"iq","set"),m.addHandler(E,null,"message","chat"),m.addHandler(E,null,"message","groupchat"),m.addHandler(E,null,"message","command"),m.addHandler(S("presence"),null,"presence","error"),m.addHandler(S("message"),null,"message","error"),m.addHandler(O,null,"message","error"),m.addHandler(A,null,"presence","error"),m.addHandler(j,"http://jabber.org/protocol/chatstates","message","groupchat"),m.receipts.addReceiptHandler(P),i.vRoster.getRoster(function(){m.flush(),i.doInit()}),l=0},S=function(t){return function(e){var n=new s(e);return c.error("livechat.xmpp.stanza.error".replace("stanza",t),Strophe.serialize(e),n.text,{id:e.id,code:parseInt(n.code,10),rooms:m.muc.roomNames,conversationId:n.fromUsername}),!0}},O=function(t){var e=new s(t);return e.from!==i.conversationJid||406!==e.code&&404!==e.code||L(e),!0},A=function(t){var e=new s(t);return n.reject(e),e.from!==i.conversationJid||406!=e.code&&404!=e.code||R(e.from,i.vuid,0),!0},E=function(t){var e=new o(t);if(e.x.length>0){if("jabber:x:delay"===e.x[0].getAttribute("xmlns"))return!0}try{e.isChat()?i.chat.onMessage(e):e.isCommand()&&i.chat.onCommand(e)}catch(t){c.error("livechat.xmpp.handler.onMessage",t,e)}return!0},j=function(t){var e=u(t).attr("from").toLowerCase(),n=Strophe.getResourceFromJid(e),r=t.childNodes[0].localName;return i.chat.onChatStates(n,r),!0},k=function(t){m.connected&&m.send&&m.send($msg({to:i.conversationJid,from:m.jid,type:"groupchat",website:i.website_id}).c(t).attrs({xmlns:"http://jabber.org/protocol/chatstates"}))},R=function(i,r,o){var a=n.get(),s={seconds:o||0};w.jid=i,w.nick=r;var c=function(r){if(!r)return!0;var o=u(r).find("status"),a=u.map(o,function(t){return parseInt(u(t).attr("code"),10)});return!(u.inArray(110,a)!==-1&&(t.emit(e.OnXmppRoomJoined),n.resolve(i),B(i),1))};return m.muc.join(i,r,null,null,null,null,s),m.muc.rooms[i].addHandler("presence",c),a},I=function(t,e){var n=u.Deferred(),i=e||m.getUniqueId(),r=function(){var e=+new Date;m.muc.rooms[w.jid].addHandler("message",z(n,i,e)),m.muc.groupchat(w.jid,t,null,i)};return b[i]=n,m.muc.rooms[w.jid]?r():R(w.jid,w.nick,0).always(r),n.promise()},N=function(t,e){q(),m.muc.leave(t,e),w.jid=w.nick=null},M=function(t){q();var e=m.muc.roomNames.indexOf(t);delete m.muc[t],e>=0&&(m.muc.roomNames.splice(e,1),0===m.muc.roomNames.length&&(m.deleteHandler(m.muc._muc_handler),m.muc._muc_handler=null))},D=function(t){var e=u.Deferred();if(b[t.id]&&b[t.id].reject("desk.publish.error.outside",t,e.promise()),!t.canRetry())return c.error("livechat.xmpp.retry.error",t,"Max retry reached",{code:parseInt(t.code,10),rooms:m.muc.roomNames,conversationId:t.fromUsername}),e.reject("desk.publish.error.retry.max",t);var n=$msg({to:t.from,from:m.jid,type:"groupchat",id:t.id}).c("body").t(t.body).up();n.c("x",{xmlns:"https://iadvize.com/schemas/retry",retry:t.retry+1});var i=+new Date;return m.muc.rooms[t.from].addHandler("message",z(e,t.id,i,t)),m.send(n),b[t.id]=e,e.promise()},z=function(t,e,n,i){return function(o){var a=u(o).attr("id"),s=+new Date;if(a===e){i&&c.info("livechat.xmpp.retry.success","Successfully retried "+i.id,r.merge(i,{conversationId:i.fromUsername}));var l=s-n;return c.info("livechat.xmpp.message.latency","Successfully delivered in "+l+" ms",{id:e,latency:l}),t.resolve(e),!1}return!0}},L=function(t){M(t.from);var e=R(t.from,i.vuid,0);t.body&&function(e){e.done(function(){if(t.body)return D(t)}).fail(function(){L(t)})}(e)},P=function(t){var e=new o(t);return i.chat.onMessageReceipt(e),!0},U=function(t){var e=m.getUniqueId(),n=$msg({to:t,from:m.jid,type:"groupchat",id:e}).c("ping",{xmlns:"urn:xmpp:ping"});n.up(),m.send(n)},q=function(){clearInterval(y)},B=function(t){q(),y=setInterval(function(){U(t)},6e4)};return t.on(e.OnXmppConnectionDisconnected,T),t.on(e.OnXmppConnectionConnected,C),{sendChatState:k,getConnection:function(){return m},connect:x,room:{groupchat:I,leave:N,join:R}}}},{"@iadvize/strophe-http-file-upload":10,"@iadvize/strophe-muc":11,"@iadvize/strophe-outofband":12,"@iadvize/strophe-receipts":13,"@iadvize/strophe.js":14,lodash:28}],121:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){var o=n.$,a=function(t){return!0},s=function(t,e,n,a,s,c,u){var l=o.Deferred(),d="!visitor_engage "+(e||""),h={id:t||r().getUniqueId(),to:a+"/operators",from:r().jid,type:"chat",website:s,history:c,channel:u||"chat",conversationJid:n},f=$msg(h).c("body").t(d).up().c("active",{xmlns:"http://jabber.org/protocol/chatstates"});return r().receipts.sendMessage(f,i.partial(l.resolve,t),l.reject),l.promise()};return r().addHandler(a,Strophe.NS.MUC_USER,"message",null),{sendEngage:s}}},{lodash:28}],122:[function(t,e,n){"use strict";e.exports=function(e,n,i,r,o){function a(t){try{var e={},n=t.childNodes[0].childNodes;return e[n[0].tagName]=n[0].textContent,e[n[1].tagName]=n[1].textContent,e.id=c(t).attr("id"),e}catch(t){throw new u(t.message)}}var s=iAdvize,c=s.$,u=t("./XmppSlotParseError"),l=t("./XmppUploadError"),d={},h=function(t){var c=t.name+0;e.emit(n.OnConversationChatUploadStarted,t,c),i().fileupload.requestSlot({name:o+"/"+t.name,size:t.size,contentType:t.type},function(o){var u=a(o);d[c]=r.upload(t,u.put,function(t){e.emit(n.OnConversationChatUploadProgress,t,c)}).then(function(){var r={type:"upload",data:{url:u.get,type:t.type,name:t.name}},o=JSON.stringify(r);e.emit(n.OnConversationChatUploadCompleted,c),e.emit(n.OnXmppOOBReceived,u.id,"visitor",null,"upload",u.get,r.data),i().outofband.sendUrl(iAdvize.operator.barejid+"/operators",u.get,o),s.chat.updateHistory(s.chat.VRC,JSON.stringify(r),u.id)}).catch(function(t){var i=s.T("livechat.conversations.upload.error");"AbortUploadError"===t.name&&(i=s.T("livechat.conversations.upload.abort")),e.emit(n.OnConversationChatUploadFailed,c,i)})},function(t){throw e.emit(n.OnConversationChatUploadFailed,c,s.T("livechat.conversations.upload.error")),new l(t.message)},1e4)},f=function(t){d[t]&&d[t].abort()},p=function(t){var r=c(t),o=r.attr("id"),a=r.attr("from"),s=r.find("url").text(),u=r.find("desc").text();try{var l=JSON.parse(u),d=l.type,h=l.data;e.emit(n.OnXmppOOBReceived,o,"operator",null,d,s,h),i().send($iq({type:"result",id:o,to:a}).c("query",{xmlns:Strophe.NS.OUTOFBAND}))}catch(t){e.emit(n.OnTextMessage,o,"operator",s),i().send($iq({type:"error",id:o,to:a}).c("query",{xmlns:Strophe.NS.OUTOFBAND})),console.error(t)}return!0};i().outofband.addOutOfBandHandler(p,"set"),e.on(n.OnConversationChatUploadFilesChecked,h),e.on(n.OnConversationChatUploadAborted,f)}},{"./XmppSlotParseError":124,"./XmppUploadError":125}],123:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){var r,o=n.$;1==n.preferences.mirroring_enabled&&(r=n.require("mirror"));var a=function(t,e){return t&&e?t.toLowerCase()===e.toLowerCase():t===e},s=function(t){try{var e=o(t).attr("from"),s=Strophe.getBareJidFromJid(e),c=Strophe.getResourceFromJid(e),u=o(t).attr("type")||"available",l=o(t).find("show").text()||"available",d=o(t).find("status").text();if("error"===u)return!0;if("subscribe"===u)return i().send($pres({to:s,type:"subscribed"})),!0;if("subscribed"===u)return i().send($pres({to:s,type:"subscribe"})),!0;if("unsubscribe"===u)return n.vRoster.unsubscribe(s),!0;if(a(s,Strophe.getBareJidFromJid(i().jid))&&c!=Strophe.getResourceFromJid(i().jid)){var h=parseInt(o(t).attr("history"),10)||0;return h>0&&(n.chat.history_id=h),!0}if(!n.vRoster.contacts[s]||"error"===u){var f=new n.vRoster.Contact;f.name=s,f.subscription="both",n.vRoster.contacts[s]=f}if("unavailable"===u)delete n.vRoster.contacts[s].resources[c],a(s,n.operator.nick+"@"+n.bosh_host)&&(n.vRoster.isOnPupitre(s)===!1&&(n.operator.on_pupitre="0"),1!==n.vRoster.isOnline(s)&&(n.operator.is_online="0",2==n.chat.status&&(n.opDecTM=setTimeout(function(){n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("OPERATEUR_DECONNECTION")).replace(/\{TIME\}/g,n.chat.getMsgTime())),n.opDisconnected=1,n.JSONStore.saveData({opdisconnected:1})},1e4),o(".idz_writting").html(" ")),r&&r.disable&&r.disable()));else{n.util.warn("updating resource "+c+" for "+s),n.vRoster.contacts[s].resources[c]={show:l,status:d};var p=!1;"available"===l&&a(s,n.operator.nick+"@"+n.bosh_host)&&(n.vRoster.isOnPupitre(s)===!0?n.operator.on_pupitre="1":n.operator.on_pupitre="0",n.operator.is_online="1",n.operator.barejid=s,p=!0),p&&n.opDecTM&&(clearTimeout(n.opDecTM),delete n.opDecTM),p&&n.opDisconnected&&(n.opDisconnected=0,n.JSONStore.saveData({opdisconnected:0}),n.chat.put_dialog(n.Templates.opAlert.replace(/\{MSG\}/g,n.T("OPERATEUR_RECONNECTION")).replace(/\{TIME\}/g,n.chat.getMsgTime())))}}catch(e){n.errorMailer("onPresence: ",e,Strophe.serialize(t))}return!0};i().addHandler(s,null,"presence")}},{}],124:[function(t,e,n){"use strict";function i(t){this.stack=(new Error).stack,this.message=t||"Failed to get an upload slot from Xmpp server",this.name="XmppSlotParseError"}i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,e.exports=i},{}],125:[function(t,e,n){"use strict";function i(t){this.stack=(new Error).stack,this.message=t||"Failed to upload file",this.name="XmppUploadError"}i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,e.exports=i},{}],126:[function(t,e,n){"use strict";e.exports=function(e,n,i,r,o){var a=t("./domain/Command"),s=t("./domain/Message"),c=t("./domain/Error"),u=t("./DeferredManager"),l=new u(r.$),d=t("./handlers/ConnectionHandler")(e,n,l,r,s,a,c,i);t("./handlers/OutOfBandHandler")(e,n,d.getConnection,o,r.website_id),t("./handlers/PresenceHandler")(e,n,r,d.getConnection);var h=t("./handlers/InvitationHandler")(e,n,r,d.getConnection);return r.define("xmpp",function(){return{invitation:h,connect:d.connect,getConnection:d.getConnection,sendChatState:d.sendChatState,room:d.room}}),{invitation:h,connection:d}}},{"./DeferredManager":115,"./domain/Command":116,"./domain/Error":117,"./domain/Message":118,"./handlers/ConnectionHandler":120,"./handlers/InvitationHandler":121,"./handlers/OutOfBandHandler":122,"./handlers/PresenceHandler":123}],127:[function(t,e,n){var i=t("ua-parser-js"),r=t("lodash/object/get"),o=(new i).getResult();e.exports=function(t){return{browser:r(o,"browser.name")||"unknown",version:parseInt(r(o,"browser.major"))||"unknown",OS:r(o,"os.name")||"unknown",deviceType:function(e){return e===i.DEVICE.MOBILE?t.MOBILE:e===i.DEVICE.TABLET?t.TABLET:t.DESKTOP}(r(o,"device.type"))}}},{"lodash/object/get":54,"ua-parser-js":61}],128:[function(t,n,i){!function(t){var n=[],i=!1,r=!1,o=function(){!function(){for(var t=n.length,e=0;e<t;e++){var o=n[e][1]();n[e][0]!==o&&(n[e][0]=o,n[e][2](o))}r?i=!1:setTimeout(arguments.callee,850)}(),i=!0},a={add:function(t,a,s){for(var c in n)if(n[c][3]==s)return;var u=[e,t,a,s];n.push(u),i===!1&&(r=!1,o())},start:function(){r=!1,i===!1&&o()},clear:function(){n=[],r=!0},stop:function(){r=!0}};t.Watcher=a}(iAdvize)},{}],129:[function(t,e,n){function i(t){return o[t]instanceof r||(o[t]=new r(t)),o[t]}var r=t("./model/channel"),o={};n.chat=i("chat"),n.call=i("call"),n.visio=i("visio"),n.all=i("all"),n.getChannel=i},{"./model/channel":139}],130:[function(t,e,n){e.exports=function(){return{MOBILE:"mobile",TABLET:"tablet",DESKTOP:"desktop"}}},{}],131:[function(t,e,n){"use strict";e.exports={TargetingLoaded:"targeting.loaded",TargetingRuleTriggered:"targeting.rule.triggered",TargetingRulePresenceUpdated:"targeting.rule.presence.updated",TargetingEngineRan:"targeting.engine.ran",UserNavigated:"used.navigated",TargetingEngineCheckAvailability:"targeting.engine.checkAvailability"}},{}],132:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){function o(e,n){var i=t.Deferred();return d.push({targetingRuleId:e,executeApiCall:n,defer:i}),f(),i.promise()}function a(t){return o(t.rule.id,t.rule.isInAbtest()&&t.rule.hasAtLeastOneAvailableAndVisibleInteractionAction(t.availability)).then(function(e){return{ruleWithAvailability:t,isVisitorAllowed:e}})}function s(t){return i.each(t.availability,function(t){t.available=!1}),t}function c(t,e){return e.isVisitorAllowed||(u(e.ruleWithAvailability),s(e.ruleWithAvailability)),t.push(e.ruleWithAvailability),t}function u(t){i.forEach(t.rule.actions,function(e){e.isAvailable(t.availability)&&e.isVisible()&&e.recordExecution()})}function l(e){var n=t.Deferred();return t.when.apply(t,i.map(e,a)).then(function(){n.resolve(i.reduce(arguments,c,[]))}),n.promise()}var d=[],h=!1,f=function(){if(!h){var i=d.shift();if(i){h=!0;var o=i.defer,a=i.targetingRuleId;if(!i.executeApiCall)return h=!1,setTimeout(f,0),void o.resolve(!0);t.ajax({url:e+"rpc/getVisitorAbTesting.php",data:{targetingRuleId:a,vuid:n,siteId:r},method:"GET",success:function(t){o.resolve(t.isVisitorAllowed===!0)},error:function(){o.resolve(!1)},complete:function(){h=!1,setTimeout(f,0)}})}}};return{checkAbTest:l}}},{lodash:28}],133:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e){function n(e,n,r){var o={rule:r},a=i.find(e,{id:r.id+""});return"interaction"===r.type&&a?(o.availability=a.availability,"call"!==r.channel.type&&"both"!==r.channel.type||(o.availability.call.available=o.availability.call.available||t.callOffline.enabled&&t.callOffline.available),n.push(o)):"qualification"===r.type&&n.push(o),n}function r(t,e){return i.reduce(t,i.partial(n,e),[])}function o(t){var n=i.filter(t,{type:"interaction"});return e.checkRulesAvailability(n).then(i.partial(r,t))}return{getRulesAvailabilities:o,reduceRulesToAvailabilities:r}}},{lodash:28}],134:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n){function r(e){t.opOffline=e.chat.available?0:1,t.c2cOffline=e.call.available||t.callMeeting.available&&t.callMeeting.enabled?0:1,t.c2vOffline=e.video.available?0:1,t.callInstant&&(t.callInstant.available=e.call.available),t.opBusy=e.chat.busy?1:0}function o(e,o){var a=!1;return i.forEach(e.actions,function(t){t.isAvailable(o)?t.isExecuted()||(t.isVisible()&&("interaction"===e.type&&n&&r(o),a=!0),t.execute()):e.displayed&&t.cancel()}),a&&(t.callbacks.onRuleStarted({id:e.id,label:e.label}),t.flags.message=t.T("LA_REGLE")+" "+e.label+" "+t.T("VIENT_ETRE_EXECUTEE"),t.flags.proactif_alert="!proactif "+e.label,t.proactif_now=1,t.flags.proactif_activatedId=e.id,e.displayed=!0,t.ProActif.saveData()),e}function a(t,e){return i.isEmpty(t.actions)?t:o(t,e)}function s(t){var n=e.Deferred(),r=i.filter(t,{rule:{type:"interaction"}});return i.forEach(r,function(t){return a(t.rule,t.availability)}),n.resolve(i.map(t,"rule")),n.promise()}return{executeInteractionRules:s,doActions:a}}},{lodash:28}],135:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){function o(){return{chat:{available:!t.opOffline,busy:!!t.opBusy},call:{available:!t.c2cOffline},video:{available:!t.c2vOffline}}}function a(i){var o=e.Deferred();return 2!=t.chat.status&&(r||i)?(t.forceDep=i,n.find({forceDep:i}).done(function(){o.resolve()})):o.resolve(),o.promise()}function s(t){return i.map(t,function(t){var e={rule:t};return"interaction"===t.type&&(e.availability=o()),e})}function c(t){var e=i.slice(t);return i.get(i.chain(e).reverse().find(function(t){return"interaction"===t.type&&t.skill}).value(),"skill.id")}function u(t){var n=e.Deferred();if(i.some(t,{type:"interaction"})){a(c(t)).then(function(){n.resolve(s(t))})}else n.resolve(s(t));return n.promise()}return{getRulesAvailabilities:u,getFirstEligibleSkillIdForRules:c}}},{lodash:28}],136:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){function o(t){var e=t.rule,i=t.availability,o={id:e.id,type:e.type,exec:e.hasActionRequiringExecutionCountIncrement()?1:0,dis:e.hasAtLeastOneAvailableAndVisibleInteractionAction(i)?1:0};return i&&(o.chatoff=i.chat.available?0:1,o.calloff=i.call.available?0:1,o.busy=i.chat.busy?1:0,n.emit(r.TargetingRulePresenceUpdated,e,i)),o}function a(e){return{s:t.website_id,u:t.vuid,rules:i.map(e,o)}}function s(t){var e=t.rule,n=t.availability;return{id:e.id,isVisibleAndAvailable:e.hasAtLeastOneAvailableAndVisibleInteractionAction(n),availability:n}}function c(t,e){var n=e.rule;return"qualification"===n.type?(t.qualificationRules.push(n.id),t):(n.hasActionRequiringExecutionCountIncrement()&&t.interactionRules.push(s(e)),t)}function u(e){var n=i.reduce(e,c,{qualificationRules:[],interactionRules:[]});return{visitor:{id:t.vuid,websiteId:+t.website_id},qualificationRules:n.qualificationRules,interactionRules:n.interactionRules}}function l(n){if(t.targetedVisitors&&t.targetedVisitors.enabled){var i=u(n);if(0!==i.interactionRules.length||0!==i.qualificationRules.length){var r={url:f,data:t.util.JSONStringify(i),contentType:"application/json",processData:!1,type:"post"};e.ajax(r)}}}function d(n){var i=e.Deferred();if(2===t.chat.status)return i.resolve(n),i.promise();l(n);var r={url:h,data:a(n),type:"post"};return e.ajax(r),i.resolve(n),i.promise()}var h=t.chaturl+"rpc/proactif_count.php",f=t.targetedVisitors&&t.targetedVisitors.url?t.targetedVisitors.url+"triggered-rules?platform="+t.platform:"";return{getRulesOpportunities:d}}},{lodash:28}],137:[function(t,e,n){var i=t("./deviceType")(),r=t("./DeviceInformationExtractor")(i),o=t("./vStats")(iAdvize,iAdvize.$,r),a=t("idz/livechat/src/polling"),s=t("./channels"),c=t("./logger")(),u=t("lodash"),l=t("./events");t("./Watcher"),function(e,n){function i(t){return!t||!n("#idzc2c").is(":visible")&&(t instanceof T||(t=new T(t)),t.executed=!0,void("qualification"===t.type?(j.doActions(t,{}),r(t)):p(t).then(r)))}function r(t){k.setRule(t.id,t),k.setStatus(t.id,"pending"),R()}function d(t){if(t)return t.executed=!1,t.displayed=!1,u.forEach(t.actions,function(t){t.cancel()}),t}function h(t){var e=n.Deferred();return w.emit(l.TargetingRuleTriggered,t),e.resolve(t),e.promise()}function f(){return!/(ip-label|WatchMouse)/.test(navigator.userAgent)}function p(t){var i=n.Deferred();return 2!=e.chat.status&&t.checkHash&&e.vStats.merpHash?a.find({h:e.vStats.merpHash}).done(function(n){n.merpData?(e.forceAgent=n.merpData.operatorId,0==n.opOffline?i.resolve(t):(e.setStatus(),i.reject(t))):i.reject(t)}).fail(function(){i.reject(t)}):i.resolve(t),i.promise()}function g(t){if("all"===t.type)return g(s.chat),void g(s.call);var n={chat:"",call:"c2c_",visio:"visio_"},i=n[t.type];e.preferences["param_"+i+"connectedwidget"]=0,e.preferences["param_"+i+"noconnectedwidget"]=0,e.setStatus()}function m(t){var e=0;return"qualification"===t.type&&--e,t.channel&&"all"===t.channel.type&&++e,e}var v={},_=t("./model/rule/condition")(e.vStats,v,e),y=window.iAdvizeCallbacks&&(window.iAdvizeCallbacks.onStatusChanged||window.iAdvizeCallbacks.onCallStatusChanged||window.iAdvizeCallbacks.onTargetingRuleTriggered),b=iAdvize.routing&&iAdvize.routing.enabled||!y,w=e.require("eventManager"),x=t("./model/ruleAction")(e,w),T=t("./model/rule")(x),C=t("./handlers/OldAvailabilityHandler")(e,e.$,a,b),S=!1;if(e.routing&&e.routing.enabled){var O=t("./routingService")(e,e.$,a,C.getFirstEligibleSkillIdForRules);C=t("./handlers/AvailabilityHandler")(e,O),S=!0}var A=t("./handlers/OpportunityHandler")(e,e.$,w,l),E=t("./handlers/AbTestHandler")(n,e.chaturl,e.vStats.vuid,e.vStats.site_id),j=t("./handlers/ExecutionHandler")(e,e.$,S);"1"===u.get(e.preferences,"abtest_enabled")&&"1"===u.get(e.preferences,"online_clustering_service_enabled")&&t("./visitor-tracking")(c,o,e);var k={data:{rules:{},status:{}},setStatus:function(t,e){this.data.status[t]=e},getTriggeredRules:function(){var t=this.data;return u.chain(this.data.status).pick(function(t){return"pending"===t}).forEach(function(e,n){t.status[n]="done"}).keys().map(function(e){return t.rules[e]}).value()},setRule:function(t,e){this.data.rules[t]=e},clean:function(){this.data.rules={},this.data.status={}}};w.on("rule.action.executed.button",g);var R=u.debounce(function(){var t=k.getTriggeredRules();0!==t.length&&C.getRulesAvailabilities(t).then(E.checkAbTest).then(A.getRulesOpportunities).then(j.executeInteractionRules).then(function(t){u.some(t,"displayed")&&w.emit(l.TargetingEngineCheckAvailability),u.forEach(t,h)})},2e3),I=e.ProActif={_datas:[],vStatsI:v,run:function(t){if(!f())return!0;if(void 0!==window.idzCustomData)for(var n in idzCustomData)idzCustomData.hasOwnProperty(n)&&void 0!==idzCustomData[n]&&null!==idzCustomData[n]&&e.vStats.val(n,idzCustomData[n]);if(e.chat.status&&2==e.chat.status)return!0;var r=this._datas;r=t?u.filter(r,function(e){return e.id==t}):u.sortBy(r,m);for(var o=0;o<r.length;o++){var a=r[o];this.areRuleConditionsMet(a)?i(a):a.executed&&(a=d(a))}return r},reRun:function(){if(!e.chat.status||2!=e.chat.status){var t=u.filter(I._datas,"displayed");u.isEmpty(t)||C.getRulesAvailabilities(t).then(j.executeInteractionRules).then(function(){w.emit(l.TargetingEngineCheckAvailability)})}},areRuleConditionsMet:function(t){var e=u.chain(t.conditions).filter("criteria").forEach(function(e){var n=e.criteria;void 0!==e.getValue()&&"merpLink"===n.field&&(t.checkHash=!0)}).map(u.partial(this.isRuleConditionMet,u,t.id)).value();return u.every(e)},isRuleConditionMet:function(t,e){if(void 0!==t.getValue()){if(t.tRefreshData instanceof Function&&t.tRefreshData(),t.isMet())return!0;t.tIsFalse instanceof Function&&t.tIsFalse(e)}return!1},fireRule:i,saveData:function(){f()&&setTimeout(function(){e.JSONStore.saveData({proactif_activated:e.flags.proactif_activated,proactif_showchatbar:e.flags.proactif_showchatbar,proactif_message:e.util.htmlspecialchars(e.flags.proactif_message),message:e.util.htmlspecialchars(e.flags.message),proactif_invit:e.flags.proactif_invit,proactif_activatedId:e.flags.proactif_activatedId,proactif_alert:e.flags.proactif_alert,phoneDisplayed:e.flags.phoneDisplayed})},400)},watchCustomData:function(t,i,r,o,a){e.Watcher.add(function(){var e=n(t).text()||n(t).val();return e&&"INTEGER"==r&&"count"!==o&&(e=parseInt(e.replace(/,/g,".").replace(/[^\d.]+/g,""),10)),e&&"FLOAT"==r&&"count"!==o&&(e=parseFloat(e.replace(/,/g,".").replace(/[^\d.]+/g,""),10)),e},function(t){var n=e.vStats[i],s=e.Store.get(i);if("count"!=o&&void 0===s&&(s=t),"current"==o)void 0!==t?e.vStats[i]=t:delete e.vStats[i];else if("max"==o)void 0!==t&&t>=s&&(s=t,e.Store.set(i,s)),void 0!==s&&(e.vStats[i]=s);else if(void 0!==t&&"min"==o)void 0!==t&&t<=s&&(s=t,e.Store.set(i,s)),void 0!==s&&(e.vStats[i]=s);else if("count"==o){if(a){var c=!1;"STRING"!=r&&t==a?c=!0:"STRING"==r&&void 0!==t&&t.indexOf(a)!=-1&&(c=!0),c&&(s=s||0,s++,e.Store.set(i,s))}e.vStats[i]=s||0}e.vStats[i]!=n&&setTimeout(function(){e.ProActif.run()},200)},i)},setData:function(t){t&&(this._datas=u.map(t,function(t){var e=new T(t);return e.conditions=u.map(e.targetingConditions,function(t){var e=t.targetingConditionCriteria||t.visitorAttribute;if(t.criteria=e,e&&t.visitorAttribute&&(e.field="ext_"+e.field),t.value.indexOf("IDZ_CDATA_")!=-1){t.isValCustom=!0;var n=JSON.parse(t.value.substr(10));t.valField="ext_"+n.field,t.valPath=n.path,t.valBaseType=n.basetype,t.valValType=n.valtype,""!=t.valPath&&I.watchCustomData(t.valPath,t.valField,t.valBaseType,t.valValType)}return t=_(t),e&&e.path&&""!=e.path&&I.watchCustomData(e.path,e.field,t.getBaseType(),e.valueType,e.value),t}),e}))},match:function(t){w.on(l.TargetingRuleTriggered,t)},createCondition:_};I.setData(e.proactifData),w.emit(l.TargetingLoaded,u.cloneDeep({list:I._datas}));var N=t("./replayTargeting")(e,w,l,function(){k.clean(),u.forEach(e.ProActif._datas,function(t){"qualification"===t.type&&t.executed&&d(t)});var t=e.ProActif.run();t instanceof Array&&w.emit(l.TargetingEngineRan,t)},o);N.launch(),e.navigate=N.navigate,w.on(l.TargetingEngineCheckAvailability,u.debounce(I.reRun,3e4))}(iAdvize,iAdvize.$)},{"./DeviceInformationExtractor":127,"./Watcher":128,"./channels":129,"./deviceType":130,"./events":131,"./handlers/AbTestHandler":132,"./handlers/AvailabilityHandler":133,"./handlers/ExecutionHandler":134,"./handlers/OldAvailabilityHandler":135,"./handlers/OpportunityHandler":136,"./logger":138,"./model/rule":140,"./model/rule/condition":142,"./model/ruleAction":145,"./replayTargeting":147,"./routingService":148,"./vStats":149,"./visitor-tracking":174,"idz/livechat/src/polling":112,lodash:28}],138:[function(t,e,n){"use strict";var i=t("lodash"),r=["debug","info","warn","error"],o={debug:i.partial(i.bind,console.log,console),info:i.partial(i.bind,console.info,console),warn:i.partial(i.bind,console.warn,console),error:i.partial(i.bind,console.warn,console)};e.exports=function(t){t=t||!1;var e=r.indexOf(t);return e===-1&&t!==!1&&(t=!1,e=r.indexOf(!1)),i.reduce(r,function(n,r,a){return n[r]=t!==!1&&a>=e?o[r]():i.noop,n},{})}},{lodash:28}],139:[function(t,e,n){function i(t){"both"==t&&(t="all"),this.type=t}var r={chat:function(t){return t.chat.available},call:function(t){return t.call.available},visio:function(t){return t.video.available},all:function(t){return r.chat(t)||r.call(t)},"social-facebook-messenger-messageUs":function(){return!0},"social-facebook-messenger-sendToMessenger":function(){return!0},"social-sms-desktop":function(){return!0},"social-sms-mobile":function(){return!0},"social-whatsapp-desktop":function(){return!0},"social-whatsapp-mobile":function(){return!0},none:function(){return!1}};i.prototype.isAvailable=function(t){return(r[this.type]||r.none)(t)},e.exports=i},{}],140:[function(t,e,n){var i=t("../channels"),r=t("lodash");e.exports=function(t){function e(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.channel&&(this.channel=i.getChannel(e.channel)),e.targetingActions&&(this.actions=r.map(e.targetingActions,function(e){return new t(e)}))}var n=e.prototype;return n.hasButtonAction=function(){if(!this.actions)return!1;for(var t=0,e=this.actions.length;t<e;t++)if("button"===this.actions[t].type)return!0;return!1},n.hasAtLeastOneAvailableAndVisibleInteractionAction=function(t){return r.some(this.actions,function(e){return e.isAvailable(t)&&e.isVisible()})},n.isInAbtest=function(){return this.abtest_enabled===!0},n.hasActionRequiringExecutionCountIncrement=function(){return r.some(this.actions,function(t){return t.shouldIncrementExecutionCount()})},e}},{"../channels":129,lodash:28}],141:[function(t,e,n){"use strict";var i=t("lodash"),r=t("./operators");e.exports=function(t){function e(t){i.assign(this,t),this.types=[]}return e.prototype.super=function(){return Object.getPrototypeOf(this)},e.prototype.sanitizeValue=function(t){return null===t||void 0===t?t:(""+t).toLowerCase()},e.prototype.getValue=function(){return this.sanitizeValue(t[this.criteria.field])},e.prototype.getTestValue=function(){return this.sanitizeValue(this.isValCustom?t[this.valField]:this.value)},e.prototype.isMet=function(){var t=i.get(r,this.logicalOperator);if(!t)throw new Error("The operator "+this.logicalOperator+" isn't recognized");return t(this.getValue(),this.getTestValue())},e.prototype.getType=function(){return i.last(this.types)},e.prototype.getBaseType=function(){return i.head(this.types)},e}},{"./operators":143,lodash:28}],142:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(e,n,r){var o=t("./Condition")(e),a=t("./types")(o,e,n,r);return function(t){var e=t.criteria||{},n=e.type;return e.valueType&&"count"===e.valueType&&(n="INTEGER"),new(i.get(a,n,o))(t)}}},{"./Condition":141,"./types":144,lodash:28}],143:[function(t,e,n){"use strict";e.exports={is:function(t,e){return t==e},"is not":function(t,e){return t!=e},contains:function(t,e){return t.indexOf(e)!==-1},"not contains":function(t,e){return t.indexOf(e)===-1},"ends with":function(t,e){return t.match(e+"$")==e},"begins with":function(t,e){return t.match("^"+e)==e},regex:function(t,e){return new RegExp(e).test(t)},"not regex":function(t,e){return!new RegExp(e).test(t)},equal:function(t,e){return t==e},"less than":function(t,e){return t<e},"more than":function(t,e){return t>e},"less than or equal":function(t,e){return t<=e},"more than or equal":function(t,e){return t>=e}}},{}],144:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){function o(e,n,r){function o(t){s.call(this,t),this.types.push(e),o.prototype.tInit instanceof Function&&o.prototype.tInit.call(this)}var s=i.get(a,r,t);o.prototype=i.create(s.prototype,n),o.prototype.constructor=o,a[e]=o}var a={};return o("BOOL"),o("INTEGER",{sanitizeValue:function(t){return null===t||void 0===t?t:parseInt(t,10)}}),o("FLOAT",{sanitizeValue:function(t){return null===t||void 0===t?t:parseFloat(t)}}),o("STRING"),o("TIME",{_tTimeBegin:0,_timeOut:null,tInit:function(){this.value*=60;var t=this.criteria.field;n[t]||(n[t]=!0,e[t]=60*e[t]||0),this._tTimeBegin=new Date},tRefreshData:function(){var t=new Date;this.value-=Math.ceil((t.getTime()-this._tTimeBegin.getTime())/1e3),this._tTimeBegin=t},tIsFalse:function(t){this.tRefreshData();var n=1e3+1e3*(this.value-e[this.criteria.field]);"equal"==this.logicalOperator&&(this.logicalOperator="more than or equal"),"less than"==this.logicalOperator&&(n-=2e3),clearTimeout(this._timeOut),this._timeOut=setTimeout(function(){r.ProActif.run(t)},Math.abs(n))}},"INTEGER"),o("ACTIVITY",{_timeOut:null,tInit:function(){var t=this.criteria.field;this.value*=60,e[t]=e[t]||0},tRefreshData:function(){var t=new Date,n=Math.ceil((t.getTime()-e.lastMove)/1e3);e.activeSince=n>5?e.activeSince:t.getTime(),e[this.criteria.field]=Math.ceil((t.getTime()-e.activeSince)/1e3)},tIsFalse:function(t){
var n=1e3+1e3*(this.value-e[this.criteria.field]);"equal"===this.logicalOperator&&(this.logicalOperator="more than or equal"),"less than"===this.logicalOperator&&(n-=2e3),clearTimeout(this._timeOut),this._timeOut=setTimeout(function(){r.ProActif.run(t)},Math.abs(n))}},"FLOAT"),o("HTML",null,"STRING"),o("IHTML",null,"INTEGER"),o("FHTML",null,"FLOAT"),o("COUNTRY",null,"STRING"),o("TOWN",null,"STRING"),o("REFERRER",null,"STRING"),o("LANG",null,"STRING"),o("DAY",null,"INTEGER"),o("HOUR",null,"INTEGER"),o("DEVICE",null,"STRING"),a}},{lodash:28}],145:[function(t,e,n){var i=t("../channels"),r=t("./ruleActionTag"),o=t("lodash");e.exports=function(t,e){function n(t){this.visible=!1,this.executed=!1;for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);var n=a[this.type];n&&(n.isAvailable&&(this.isAvailable=n.isAvailable),n.execute&&(this.innerExecute=n.execute),n.cancel&&(this.innerCancel=n.cancel),n.visible&&(this.visible=n.visible),n.shouldIncrementExecutionCount&&(this.shouldIncrementExecutionCount=n.shouldIncrementExecutionCount),n.recordExecution&&(this.recordExecution=n.recordExecution))}var a={increase_visitor_attribute:{execute:r.getExecute(function(t,e){return t+e})},decrease_visitor_attribute:{execute:r.getExecute(function(t,e){return t-e})},modify_visitor_attribute:{execute:r.getExecute(function(t,e){return e})},button:{visible:!0,isAvailable:function(e){var n=this.data.button;if(!n)return!1;var r=i.getChannel(n.type);return!("call"!=n.type&&"both"!=n.type||!t.callMeeting.available||!t.callMeeting.enabled)||r.isAvailable(e)},execute:function(){t.floatingWidget.switchWidget(this.data.button);var n=i.getChannel(this.data.button.type);e.emit("rule.action.executed.button",n)},cancel:function(){t.floatingWidget.destroy(this.data.button)}},invitation:{visible:!0,isAvailable:function(e){var n=this.data.invitation,r=i.getChannel(n.type);return 2!=t.chat.status&&(null==t.flags.proactif_invit||t.flags.proactif_invit.indexOf(n.id)===-1)&&r.isAvailable(e)},execute:function(){var e=this.data.invitation;t.chat.loadInvitation(e.id)},recordExecution:function(){var e=this.data.invitation;t.flags.proactif_invit=t.flags.proactif_invit||"",t.flags.proactif_invit+=e.id+","},shouldIncrementExecutionCount:function(){return null==t.flags.proactif_invit||t.flags.proactif_invit.indexOf(this.data.invitation.id)===-1}},chatbox:{visible:!0,isAvailable:function(t){return i.chat.isAvailable(t)},execute:function(){t.Templates.showUI()}},message:{visible:!0,isAvailable:function(e){return i.chat.isAvailable(e)&&2!=t.chat.status&&null==t.flags.proactif_message&&1!=t.opBusy},execute:function(){t.chat.putOpMsg(null,this.data.text,0)},recordExecution:function(){t.flags.proactif_message=t.flags.proactif_message||""},shouldIncrementExecutionCount:function(){return null==t.flags.proactif_message}},fixed_buttons:{visible:!0,isAvailable:function(t){var e=this.data.channel;return!!e&&i.getChannel(e).isAvailable(t)},execute:function(){var n=i.getChannel(this.data.channel);e.emit("rule.action.executed.button",n),t.floatingWidget.onPresenceChange(!0)}}},s=n.prototype;return s.execute=function(){this.executed=!0,this.recordExecution(),this.innerExecute()},s.innerExecute=o.noop,s.cancel=function(){this.executed=!1,this.innerCancel()},s.innerCancel=o.noop,s.recordExecution=o.noop,s.isAvailable=function(){return!0},s.isExecuted=function(){return this.executed},s.isVisible=function(){return this.visible},s.shouldIncrementExecutionCount=function(){return!0},n}},{"../channels":129,"./ruleActionTag":146,lodash:28}],146:[function(t,e,n){function i(t){return function(){var e=this.data.visitorAttribute;if(e){var n,i=e.field;n=r.getAttribute(i,0),n=+n,n=t(n,this.data.value),r.setAttribute(i,n).persist()}}}var r=t("../visitor");n.getExecute=i},{"../visitor":178}],147:[function(t,e,n){var i=t("lodash").throttle,r=t("lodash");e.exports=function(t,e,n,o,a){function s(e){a.refresh(e),2==t.chat.status&&t.chat.sendPresence("dnd"),o()}function c(t){var e=document.location.href;h!==e&&(u(e),h=e),setTimeout(c,t)}function u(t){if("string"!=typeof t)return void console.warn("navigate first argument must be a string");l(function(){e.emit(f,t)})}function l(e){var n=t.chaturl+"rpc/maintainVisitorState.php?s="+t.website_id+"&u="+t.vuid+"&lang="+t.curlang;t.$.ajax(n,{dataType:"jsonp",complete:function(){t.config&&(t.flags=t.config.flags,t.vProf=t.config.vProf,a.resetFlags(t.flags),a.resetProfile(t.vProf),delete t.config),e()}})}function d(e){2!=t.chat.status&&r.chain(e).filter({executed:!0}).isEmpty().value()&&t.Templates.hideUI()}var h=document.location.href,f=n.UserNavigated;return{launch:function(t){c(t||50),e.on(f,s),e.on(n.TargetingEngineRan,d)},stop:function(){e.off(f,s)},navigate:i(u,1e3,{trailing:!0,leading:!1})}}},{lodash:28}],148:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n,r){function o(t){return{id:t.id,availability:t.attributes}}function a(t){return i.map(t,o)}function s(t,n){e.ajax({url:t,method:"GET",error:function(){return n.resolve([])},success:function(t){return n.resolve(a(t.data))}})}var c=!1,u=function(e){return t.routing.url+"targeting-rules/available?platform="+t.platform+"&lang="+t.curlang+"&ids[]="+e.join("&ids[]=")},l=function(o,a){var d=a||e.Deferred();if(0===o.length)return d.resolve([]),d.promise();if(document.visibilityState&&"hidden"===document.visibilityState)return setTimeout(function(){l(o,d)},1e3),d.promise();var h=i.chain(o).filter({type:"interaction"}).map("id").value(),f=u(h);return c?s(f,d):(c=!0,t.forceDep=r(o),n.find().done(function(){s(f,d)})),d.promise()};return{checkRulesAvailability:l}}},{lodash:28}],149:[function(t,n,i){n.exports=function(t,n,i){var r=t.vStats={val:function(t,e){return this["ext_"+t]=e,this},getValue:function(t){return this["ext_"+t]},customData:function(){var t={};for(var e in this)null!==this[e]&&"function"!=typeof this[e]&&e.indexOf("ext_")!==-1&&(t[e.substr(4).replace(/_/g," ")]=this[e]);return JSON.stringify(t)},getProfile:function(){var t={};for(var e in this)null!==this[e]&&"function"!=typeof this[e]&&e.indexOf("ext_")===-1&&("navTime"===e&&(this[e]=1e3*Math.round(+new Date/1e3-this.connectionTime),this[e]<0&&(this[e]=3e3)),t[e]=this[e]);return JSON.stringify(t)}},o=function(t){if(t){r.history_id=+t.history_id;for(var e in t)if(t.hasOwnProperty(e)&&"va_"===e.substring(0,3)){var n=e.substring(3),i=t[e];r.val(n,i)}r.transactionProbability=t.transactionProbability,r.isLastEventProbability=t.isLastEventProbability,r.addCartProbability=t.addCartProbability,r.chatAcceptedProbability=t.chatAcceptedProbability}},a=function(t){for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e])},s=function(o){var a=encodeURIComponent(document.location.href);if(r.actualURI=decodeURIComponent(a),r.referrer_lastPage=document.referrer,o?(r.referrer_lastPage=r.actualScreen,r.actualScreen=o):r.actualScreen=r.actualURI,r.actualURI.search(/idz-[a-z0-9]{5}$/)>0&&(r.merpLink=!0,r.merpHash=r.actualURI.substr(r.actualURI.indexOf("idz-"))),r.winWidth=n(window).width(),r.winHeight=n(window).height(),r.browserInfo=i.browser+" "+i.version,r.deviceInfo=i.OS,r.userAgent=navigator.userAgent,r.deviceType=i.deviceType,r.vuid=t.vuid,void 0!==window.idzCustomData){for(var s in idzCustomData)null!==idzCustomData[s]&&"undefined"!==idzCustomData[s]&&r.val(s,idzCustomData[s]);var c=idzCustomData.custProfile||"",u=idzCustomData.extID||"";ue=idzCustomData.cust_email||idzCustomData.user_email||"",""===c&&""===u&&""===ue||t.JSONStore.saveData({custProfile:c,extID:u,email:ue})}try{for(var l=0,d=t.insiteCD.length;l<d;l++){var h=t.insiteCD[l],f=n(h.path).text()||n(h.path).val();f&&"INTEGER"===h.type&&(f=parseInt(f.replace(/,/g,".").replace(/[^\d.]+/g,""),10)),f&&"FLOAT"===h.type&&(f=parseFloat(f.replace(/,/g,".").replace(/[^\d.]+/g,""),10));var p=t.Store.get("ext_"+h.field);if("count"!==h.valtype&&"prev"!==h.valtype&&p===e&&(p=f),"current"===h.valtype)f!==e?r["ext_"+h.field]=f:delete r["ext_"+h.field];else if("prev"===h.valtype)p!==e&&(r["ext_"+h.field]=p),f!==e&&(p=f,t.Store.set("ext_"+h.field,p));else if("max"===h.valtype)f!==e&&f>=p&&(p=f,t.Store.set("ext_"+h.field,p)),p!==e&&(r["ext_"+h.field]=p);else if(f!==e&&"min"===h.valtype)f!==e&&f<=p&&(p=f,t.Store.set("ext_"+h.field,p)),p!==e&&(r["ext_"+h.field]=p);else if("count"===h.valtype){if(h.val){var g=!1;"STRING"!==h.type&&f==h.val?g=!0:"STRING"===h.type&&f&&f.indexOf(h.val)!==-1&&(g=!0),g&&(p=p||0,p++,t.Store.set("ext_"+h.field,p))}r["ext_"+h.field]=p||0}}}catch(t){console&&console.log&&console.log(t)}};return function(){a(t.vProf),r.lang=t.curlang,r.activeSince=r.lastMove=(new Date).getTime(),r.history_id=0,o(t.flags),s()}(),{refresh:s,resetFlags:o,resetProfile:a}}},{}],150:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t){function e(e){t.register(e),this.get=i.bind(t.get,t,e),this.set=i.bind(t.set,t,e)}return{newCollector:function(t){return new e(t)}}}},{lodash:28}],151:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(t,e,n){var r=t.newCollector("customData");return i.each(n,function(t,e){void 0!==t&&null!==t&&r.set(e,t)}),r}},{lodash:28}],152:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(e,n,r){var o=i.reduce({customData:!1,predictiveTargeting:"1"===n.preferences.online_clustering_service_enabled},function(t,e,n){return e&&t.push(n),t},[]),a={customData:t("./customData"),predictiveTargeting:t("./predictiveTargeting")};return i.mapValues(i.pick(a,o),function(t){return t(e,n,r)})}},{"./customData":151,"./predictiveTargeting":154,lodash:28}],153:[function(t,e,n){"use strict";var i=t("lodash"),r=t("eventemitter2").EventEmitter2;e.exports=function(e,n,o,a){function s(t,e){u.emit("metricChanged",t,e)}var c=t("./storageWrapper")(e),u=new r,l=t("./metrics").reduce(function(t,e){var r=e(c(e.NAME),n,o,a,s);return r.get?t[e.NAME]=r:t=i.assign(t,r),t},{});return i.assign(u,{collect:function(){return i.mapValues(l,i.method("get"))},dispose:function(){l.forEach(i.method("dispose"))}})}},{"./metrics":161,"./storageWrapper":172,eventemitter2:20,lodash:28}],154:[function(t,e,n){"use strict";var i=t("lodash");e.exports=function(e,n,r){var o=e.newCollector("predictiveTargeting"),a=t("./collector")(n.Store,n.require("eventManager"),n,r);i.each(a.collect(),function(t,e){o.set(e,t)}),a.on("metricChanged",i.bind(o.set,o))}},{"./collector":153,lodash:28}],155:[function(t,e,n){"use strict";e.exports=function(t,e,n){return{get:function(){return n.vStats.pageview},dispose:function(){}}},e.exports.NAME="all_seen_page_count"},{}],156:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){return{get:function(){var t;return 1===n.vStats.pageview&&(t=i.cart_amount),t},dispose:function(){}}},e.exports.NAME="cart_amount_on_website_load"},{}],157:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){return{get:function(){return i.cart_amount||0},dispose:function(){}}},e.exports.NAME="current_cart_amount"},{}],158:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){return{get:function(){return i.nb_products_cart||0},dispose:function(){}}},e.exports.NAME="current_cart_product_count"},{}],159:[function(t,e,n){"use strict";e.exports=function(t,e,n){return{get:function(){return n.util.date.getDateISOString(new Date)},dispose:function(){}}},e.exports.NAME="current_time"},{}],160:[function(t,e,n){"use strict";e.exports=function(){return{get:function(){return window.location.href},dispose:function(){}}},e.exports.NAME="current_url"},{}],161:[function(t,e,n){"use strict";e.exports=[t("./visitorUid"),t("./sessionUid"),t("./websiteUid"),t("./currentTime"),t("./currentUrl"),t("./sessionDuration"),t("./allSeenPageCount"),t("./nbVisits"),t("./screenWidth"),t("./screenHeight"),t("./transactionAmount"),t("./currentCartAmount"),t("./seenPageCounts"),t("./currentCartProductCount"),t("./lastSeenProductPrice"),t("./cartAmountOnWebsiteLoad")]},{"./allSeenPageCount":155,"./cartAmountOnWebsiteLoad":156,"./currentCartAmount":157,"./currentCartProductCount":158,"./currentTime":159,"./currentUrl":160,"./lastSeenProductPrice":162,"./nbVisits":163,"./screenHeight":164,"./screenWidth":165,"./seenPageCounts":166,"./sessionDuration":167,"./sessionUid":168,"./transactionAmount":169,"./visitorUid":170,"./websiteUid":171}],162:[function(t,e,n){"use strict";e.exports=function(t,e,n,i){return{get:function(){return i.product_price},dispose:function(){}}},e.exports.NAME="last_seen_product_price"},{}],163:[function(t,e,n){"use strict";e.exports=function(t,e,n){return{get:function(){return n.vStats.nbrVisite},dispose:function(){}}},e.exports.NAME="nb_visits"},{}],164:[function(t,e,n){"use strict";e.exports=function(){return{get:function(){return screen.height},dispose:function(){}}},e.exports.NAME="screen_height"},{}],165:[function(t,e,n){"use strict";e.exports=function(){return{get:function(){return screen.width},dispose:function(){}}},e.exports.NAME="screen_width"},{}],166:[function(t,e,n){"use strict";function i(t){return t+"_seen_page_count"}function r(t){return"vt_"+i(t)}var o=t("lodash"),a=t("../../../../visitor"),s={search:["search","recherche"],listing:["list","listing"],product:["produit","product"],funnel:["funnel","tunnel","panier","cart","basket","checkout"],others:[]};e.exports=function(t,e,n,c,u){var l=c.page_type||c.page_name||"";l=o.findKey(s,function(t){return o.includes(t,l.toLowerCase())})||"others";var d=r(l),h=a.getAttribute(d)||0;return a.setAttribute(d,++h).persist(),u(i(l),h),o.keys(s).reduce(function(t,e){return t[i(e)]={get:function(){return a.getAttribute(r(e))||0},dispose:function(){}},t},{})}},{"../../../../visitor":178,lodash:28}],167:[function(t,e,n){"use strict";e.exports=function(t,e,n){return{get:function(){return n.vStats.navTime},dispose:function(){}}},e.exports.NAME="session_duration"},{}],168:[function(t,e,n){"use strict";e.exports=function(t,e,n){return{get:function(){return n.sessionId},dispose:function(){}}},e.exports.NAME="session_uid"},{}],169:[function(t,e,n){"use strict";e.exports=function(t,e,n){return{get:function(){return n.getTransactionAmount()},dispose:function(){}}},e.exports.NAME="transaction_amount"},{}],170:[function(t,e,n){"use strict";e.exports=function(t,e,n){return{get:function(){return n.vuid},dispose:function(){}}},e.exports.NAME="visitor_uid"},{}],171:[function(t,e,n){"use strict";e.exports=function(t,e,n){return{get:function(){return n.platform+"-"+n.website_id},dispose:function(){}}},e.exports.NAME="website_uid"},{}],172:[function(t,e,n){"use strict";e.exports=function(t){var e=".";return function n(i){function r(t){return function(){var n=Array.prototype.slice.call(arguments);return n.unshift("iAdvize"+e+i),t.apply(this,n)}}return{createSubScopedStorage:function(t){return n(i+e+t)},get:r(t.get),set:r(t.set),increment:r(t.incrementItem),decrement:r(t.decrementItem),add:r(t.addToItem)}}}},{}],173:[function(t,e,n){"use strict";e.exports=function(t,e){function n(t){void 0!==t.value&&e.send(t.key,t.value)}t.on("visitor.**",n)}},{}],174:[function(t,e,n){"use strict";t("lodash");e.exports=function(e,n,i){var r="undefined"==typeof idzCustomData?{}:idzCustomData,o=t("./visitorState")(),a=t("./collectorFactory")(o),s=t("./transport")(e,"wss://%HOST%/ws/%PLATFORM%-%WEBSITE_ID%/%VUID%".replace("%HOST%","c.iadvize.com").replace("%PLATFORM%",i.platform).replace("%WEBSITE_ID%",i.website_id).replace("%VUID%",i.vuid));return t("./flusher")(o,s),t("./collectors")(a,i,r)}},{"./collectorFactory":150,"./collectors":152,"./flusher":173,"./transport":175,"./visitorState":177,lodash:28}],175:[function(t,e,n){"use strict";var i=t("./transports/WebSocketApi");e.exports=function(t,e,n){n=n||i;var r=!1,o=[],a=0,s=new n(e);return s.on("open",function(){for(;o.length&&s.isOpen();)s.send(o.shift());r=!0,a=0,t.info("Socket connection opened.")}),s.on("close",function(){r=!1,t.info("Socket connection closed."),0===a?(++a,s.connect()):a<10?setTimeout(function(){++a,s.connect()},1e3):t.error("Socket connection failed too many times.")}),s.on("error",function(e){t.error("Socket error",e)}),{send:function(e,n){var i=JSON.stringify({key:e,value:n});t.debug("Sending message",i),r?s.send(i):o.length<500&&o.push(i)}}}},{"./transports/WebSocketApi":176}],176:[function(t,e,n){"use strict";function i(t){r.call(this),this.endpoint=t,this.connect()}var r=t("eventemitter2").EventEmitter2;i.prototype=Object.create(r.prototype),i.prototype.constructor=i,i.prototype.connect=function(){function t(t){return function(){var n=Array.prototype.slice.call(arguments);n.unshift(t),e.emit.apply(e,n)}}this.socket=new WebSocket(this.endpoint);var e=this;this.socket.onopen=t("open"),this.socket.onclose=t("close"),this.socket.onerror=t("error"),this.socket.onmessage=t("message")},i.prototype.send=function(){return this.socket.send.apply(this.socket,arguments)},i.prototype.isOpen=function(){return this.socket.readyState===WebSocket.OPEN},e.exports=i},{eventemitter2:20}],177:[function(t,e,n){"use strict";var i=t("lodash"),r=t("eventemitter2").EventEmitter2;e.exports=function(){function t(){return Array.prototype.join.call(arguments,".")}function e(t){if(!i.has(u,t))throw new Error("The domain you are trying to access hasn't been define")}function n(t){u[t]=u[t]||{}}function o(t){return e(t),i.get(u,t)}function a(){return i.cloneDeep(u)}function s(n,r,o){e(n),i.set(u,t(n,r),o);var a=t("visitor",n,r);l.emit(a,{key:a,value:i.cloneDeep(o)})}function c(n,r){return e(n),i.get(u,t(n,r))}var u={},l=new r({wildcard:!0});return i.assign(l,{register:n,getDomain:o,getState:a,get:c,set:s})}},{eventemitter2:20,lodash:28}],178:[function(t,n,i){var r=iAdvize,o={getAttribute:function(t,n){var i=r.vStats.getValue(t);return i===e?n:i},setAttribute:function(t,e){return r.vStats.val(t,e),{persist:function(){var n={};n["va_"+t]=e,r.JSONStore.saveData(n)}}}};n.exports=o},{}]},{},[2,82,80,81,83,85,90,98,96,99,97,100,101,102,103,104,105,106,107,108,109,91,110,111,112,92,93,94,113,114,95,115,116,117,118,119,120,121,122,123,124,125,126,129,127,130,131,137,138,147,148,178,149,128,89,6,4,5,3,1]),n&&(define=n)}();